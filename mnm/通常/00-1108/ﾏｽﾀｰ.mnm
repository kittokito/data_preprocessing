DEVICE:51
;MODULE:ﾏｽﾀｰ
;MODULE_TYPE:0
;立ち会い用ﾀﾞﾐｰ運転
LD LR100
OUT R58000               ; ONで立合い用ﾀﾞﾐｰ運転
LD LR101
AND R58000               ; ONで立合い用ﾀﾞﾐｰ運転
OUT R58001               ; ONで立合い用ﾀﾞﾐｰ運転_切断管搬送
LD R58001                ; ONで立合い用ﾀﾞﾐｰ運転_切断管搬送
ANP R1004                ; 寸動ｽｲｯﾁ
SET R58002               ; 切断管搬送
;定寸送りｻｰﾎﾞ動作可条件
;
LD R1508                 ; ｴｱｰ元圧確認
AND R1101                ; 生地管搬送_ﾎｯﾊﾟｰ側限
ANB R1100                ; 生地管搬送_定寸送り側限
AND R1103                ; 生地管搬送ﾁｬｯｸ上下_上昇限
ANB R1102                ; 生地管搬送ﾁｬｯｸ上下_下降限
AND R1108                ; 終端側生地管ｸﾗﾝﾌﾟ_下降限
ANB R1109                ; 終端側生地管ｸﾗﾝﾌﾟ_上昇限
AND R1401                ; ｶｯﾄ側生地管ｸﾗﾝﾌﾟ_上昇限
ANB R1400                ; ｶｯﾄ側生地管ｸﾗﾝﾌﾟ_下降限
OUT R60001               ; 定寸送りｻｰﾎﾞ動作可条件1
LD R1413                 ; 切断除材ﾁｬｯｸ上下_上昇限
ANB R1412                ; 切断除材ﾁｬｯｸ上下_下降限
AND R1405                ; 初端落下補助（排出側）_下降限
ANB R1404                ; 初端落下補助（排出側）_上昇限
OUT R60002               ; 定寸送りｻｰﾎﾞ動作可条件2
LD CR2002                ; 常時ON
LD R1202                 ; ｻﾎﾟｰﾄ下降ｴﾘｱ検出
AND R1115                ; 生地管ｸﾗﾝﾌﾟ1_上昇限
ANB R1114                ; 生地管ｸﾗﾝﾌﾟ1_下降限
AND R1201                ; 生地管ｸﾗﾝﾌﾟ2（ﾍﾞｰｽ側）_上昇限
ANB R1200                ; 生地管ｸﾗﾝﾌﾟ2（ﾍﾞｰｽ側）_下降限
AND R1113                ; 給材ｻﾎﾟｰﾄ（反給材側）_下降限
ANB R1112                ; 給材ｻﾎﾟｰﾄ（反給材側）_上昇限
ORB R1202                ; ｻﾎﾟｰﾄ下降ｴﾘｱ検出
ANL
OUT R60003               ; 定寸送りｻｰﾎﾞ動作可条件3
LD CR2002                ; 常時ON
LD R1202                 ; ｻﾎﾟｰﾄ下降ｴﾘｱ検出
AND R1115                ; 生地管ｸﾗﾝﾌﾟ1_上昇限
ANB R1114                ; 生地管ｸﾗﾝﾌﾟ1_下降限
ORB R1202                ; ｻﾎﾟｰﾄ下降ｴﾘｱ検出
ANL
OUT R60004               ; 定寸送りｻｰﾎﾞ動作可条件4
LD R60001                ; 定寸送りｻｰﾎﾞ動作可条件1
AND R60002               ; 定寸送りｻｰﾎﾞ動作可条件2
AND R60003               ; 定寸送りｻｰﾎﾞ動作可条件3
AND R60004               ; 定寸送りｻｰﾎﾞ動作可条件4
OR CR2002                ; 常時ON
OUT R60000               ; 定寸送りｻｰﾎﾞ動作可
;電源投入記憶
;
LD CR2002                ; 常時ON
TMR #200 #10             ; 電源投入後ｳｪｲﾄ
LD T200                  ; 電源投入後ｳｪｲﾄ
AND R1203                ; 装置電源ON
TMR #201 #20
LD T201
@SET MR2601              ; ﾎｯﾊﾟﾓｰﾀ　解除入力
CON
TMR #202 #10             ; 電源投入後ｼｽﾃﾑ立上り
LD T202                  ; 電源投入後ｼｽﾃﾑ立上り
RES MR2601               ; ﾎｯﾊﾟﾓｰﾀ　解除入力
LDP T201
RES CR3007               ; X軸ｴﾗｰ/ｴﾗｰｸﾘｱ
LDP T201
SET MR2715               ; 除材横搬送RB　非常停止
CON
SET MR503                ; ｻｰﾎﾞ　非常停止
;非常停止処理
;
;
LD R50010                ; 非常停止
ORB R1203                ; 装置電源ON
ZRES @MR000 @MR915       ; PLS.AUTO
LD R1203                 ; 装置電源ON
MC
;タスク制御
;
LD R50001                ; 自動運転中
DIFU @MR000              ; PLS.AUTO
LDP @MR000               ; PLS.AUTO
ORP @MR004               ; 0004
ORP R50003               ; 原点復帰
ANB R50209               ; 動作開始
RES @MR004               ; 0004
CON
SET R50209               ; 動作開始
LDP R50209               ; 動作開始
LD R50001                ; 自動運転中
OR R50003                ; 原点復帰
ANL
MDSTRT ﾒｲﾝ_管切断
RES R50409               ; 1ｻｲｸﾙ完了
CON
SET @MR001               ; 0001
STG @MR001               ; 0001
AND R50410               ; ﾒｲﾝ_切断部   1ｻｲｸﾙ終了
TMH @1 #1                ; ｻｲｸﾙ終了確認ﾀｲﾏ
CON
AND @T1                  ; ｻｲｸﾙ終了確認ﾀｲﾏ
RES R50209               ; 動作開始
CON
JMP @MR002
STG @MR002
RES R50410               ; ﾒｲﾝ_切断部   1ｻｲｸﾙ終了
CON
SET R50409               ; 1ｻｲｸﾙ完了
CON
TMH #110 #2              ; ｳｪｲﾄ
CON
AND T110                 ; ｳｪｲﾄ
MPS
LD R50001                ; 自動運転中
ANB R50000               ; HOLD
ANL
SET @MR004               ; 0004
MPP
ENDS
;<h1/>停止処理
;
LD R50001                ; 自動運転中
LDP R1003                ; ｻｲｸﾙ停止ｽｲｯﾁ
ORF R1001                ; 手/自切替ｽｲｯﾁ　（ONで自動）
ANL
SET MR407                ; ｻｲｸﾙ停止表示灯
CON
SET R51200               ; 装置停止要求
CON
SET MR1300               ; 投入CV停止要求ﾌﾗｸﾞ
LD MR407                 ; ｻｲｸﾙ停止表示灯
OR R15201                ; 停止動作
AND MR100                ; ﾌﾘｯｶｰﾘﾚｰ1
OUT MR2701               ; ｻｲｸﾙ停止ｽｲｯﾁ表示灯
LD R51200                ; 装置停止要求
AND MR1301               ; 投入CV停止完了
AND MR1303               ; 生地管搬送PP停止完了
AND MR1400               ; 切断部停止完了
AND MR1401               ; 切断管排出部停止完了
AND MR1402               ; 切断管搬送CV停止完了
SET R51202               ; 動作完了　装置停止可
LD R51200                ; 装置停止要求
AND R51202               ; 動作完了　装置停止可
AND R50001               ; 自動運転中
LD R50002                ; 手動　MODE
ANP R50009               ; HOLDRQ
ORL
ORP R50003               ; 原点復帰
SET R50000               ; HOLD
LDP R50000               ; HOLD
ZRES MR1300 MR1415       ; 投入CV停止要求ﾌﾗｸﾞ
CON
RES R51200               ; 装置停止要求
CON
RES R50009               ; HOLDRQ
CON
RES R50006               ; 自動運転可能
CON
RES R50009               ; HOLDRQ
CON
RES R51202               ; 動作完了　装置停止可
LDB R50004               ; TASKDO
OR R50308                ; タスク停止待ち
RES R50001               ; 自動運転中
CON
RES MR407                ; ｻｲｸﾙ停止表示灯
CON
RES R50002               ; 手動　MODE
LD R50003                ; 原点復帰
LDB R50004               ; TASKDO
OR R50308                ; タスク停止待ち
ANL
TMR @0 #5                ; Start SW確認ﾀｲﾏｰ
CON
AND @T0                  ; Start SW確認ﾀｲﾏｰ
RES R50003               ; 原点復帰
CON
RES R50409               ; 1ｻｲｸﾙ完了
CON
SET R50007               ; 原点復帰　完了
;各UTタスク停止
;
LD R50001                ; 自動運転中
AND R50409               ; 1ｻｲｸﾙ完了
AND R50000               ; HOLD
LD R50002                ; 手動　MODE
OR R50003                ; 原点復帰
AND R50409               ; 1ｻｲｸﾙ完了
ORL
RES R50001               ; 自動運転中
CON
RES R50409               ; 1ｻｲｸﾙ完了
CON
RES R50209               ; 動作開始
CON
SET R50308               ; タスク停止待ち
LD R50308                ; タスク停止待ち
ANB R50201               ; ﾎｯﾊﾟ_搬送PP部 Do
ANB R50202               ; 切断後搬送PP部 Do
ANB R50203               ; 切断管搬送部 Do
ANB R50200               ; ﾒｲﾝ_切断部 Do
RES R50308               ; タスク停止待ち
CON
RES R50004               ; TASKDO
CON
RES R50000               ; HOLD
CON
DIFU @MR104
STG @MR104
JMP @MR105
MDSTOP 生地管搬送PP部
MDSTOP 切断管排出PP部
MDSTOP 切断管搬送CV
MDSTOP 投入CV部
MDSTOP ﾒｲﾝ_管切断
STG @MR105
ANB _生地管搬送PP部
ANB _切断管排出PP部
ANB _切断管搬送CV
ANB _ﾒｲﾝ_管切断
ANB _投入CV部
TMR @2 #5
CON
AND @T2
RES R50409               ; 1ｻｲｸﾙ完了
CON
ZRES MR1000 MR2315
CON
ZRES MR2800 MR9915
CON
ENDS
;＠モード選択
;原点復帰
LDB R50007               ; 原点復帰　完了
ANB R50003               ; 原点復帰
ANB R50001               ; 自動運転中
OUT R50210               ; 原点復帰要求
LD R50210                ; 原点復帰要求
ANP R40005               ; 原点復帰開始ｽｲｯﾁ/TP
DIFU @MR006
LD @MR006
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50010               ; 非常停止
AND R1508                ; ｴｱｰ元圧確認
SET R50003               ; 原点復帰
CON
SET R50004               ; TASKDO
;ＡＵＴＯ
LDB R50008               ; 全体ERROR
AND R1001                ; 手/自切替ｽｲｯﾁ　（ONで自動）
AND= DM4000 #2           ; 現在表示中画面
MPS
LD R50006                ; 自動運転可能
AND R1002                ; 運転開始ｽｲｯﾁ
ANL
TMR #0 #9999             ; 児童運転時ｽﾀｰﾄ長押し時間
CON
OUT MR2010               ; 自動運転ｽﾀｰﾄﾌﾞｻﾞｰ
CON
AND T0                   ; 児童運転時ｽﾀｰﾄ長押し時間
DIFU @MR008
MPP
LDB R50006               ; 自動運転可能
AND R1002                ; 運転開始ｽｲｯﾁ
ANL
LDA #540
CON
STA DM100                ; ﾒｯｾｰｼﾞ表示
LDB R50008               ; 全体ERROR
AND R1001                ; 手/自切替ｽｲｯﾁ　（ONで自動）
AND= DM4000 #2           ; 現在表示中画面
ANB R50006               ; 自動運転可能
ANF R1002                ; 運転開始ｽｲｯﾁ
LDA #0
CON
STA DM100                ; ﾒｯｾｰｼﾞ表示
LD @MR008
AND R50007               ; 原点復帰　完了
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50010               ; 非常停止
AND R1508                ; ｴｱｰ元圧確認
RES @MR008
CON
SET R50001               ; 自動運転中
CON
SET R50004               ; TASKDO
;ＭＡＮＵＡＬ（ＴＥＳＴ　ＣＵＴ　ＭＯＤＥ）
LDB R1001                ; 手/自切替ｽｲｯﾁ　（ONで自動）
AND= DM4000 #370         ; 現在表示中画面
AND R50007               ; 原点復帰　完了
ANB R15200               ; ﾃｽﾄｶｯﾄ動作中
OUT R15012               ; ﾃｽﾄｶｯﾄ開始
LDB R50008               ; 全体ERROR
ANB R1001                ; 手/自切替ｽｲｯﾁ　（ONで自動）
AND= DM4000 #370         ; 現在表示中画面
AND R50007               ; 原点復帰　完了
ANB R15200               ; ﾃｽﾄｶｯﾄ動作中
AND R15013               ; ﾃｽﾄｶｯﾄ開始SW
DIFU @MR010
LD @MR010
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50010               ; 非常停止
AND R1508                ; ｴｱｰ元圧確認
SET R50002               ; 手動　MODE
CON
SET R50004               ; TASKDO
LD R50002                ; 手動　MODE
AND= DM4000 #370         ; 現在表示中画面
MPS
ANB _ﾃｽﾄｶｯﾄ
MDSTRT ﾃｽﾄｶｯﾄ
MPP
AND R50414               ; ﾃｽﾄｶｯﾄ　1ｻｲｸﾙ動作終了
SET R50409               ; 1ｻｲｸﾙ完了
CON
RES R50414               ; ﾃｽﾄｶｯﾄ　1ｻｲｸﾙ動作終了
;Ｃａｌｌ　Ｐｏｓｔ
LDB R50002               ; 手動　MODE
ZRES R50403 R50405
STG R50400               ; Call Post
ANB R50403
ANB R1002                ; 運転開始ｽｲｯﾁ
AND R50002               ; 手動　MODE
SET R50403
CON
JMP R50404
STG R50404
LDP R1002                ; 運転開始ｽｲｯﾁ
ORP R15201               ; 停止動作
ANL
ANB R50008               ; 全体ERROR
ANB R50010               ; 非常停止
AND R1508                ; ｴｱｰ元圧確認
JMP R50405
STG R50405
ANB R50400               ; Call Post
RES R50403
CON
ENDS
LD R50400                ; Call Post
AND R50404
OUT R50401               ; Post Busy
LD R50002                ; 手動　MODE
AND R50405
ORB R50002               ; 手動　MODE
OUT R50402               ; Post Ok
;エラー解除遅延処理
;
LDP R50107               ; エラー中　非常停止
SET R50109               ; ERROR解除
LDB R50008               ; 全体ERROR
OR R50109                ; ERROR解除
TMR @3 #15               ; ERROR解除ﾀｲﾏｰ
LD @T3                   ; ERROR解除ﾀｲﾏｰ
SET @MR300               ; ｴﾗｰ解除確認
CON
RES R50109               ; ERROR解除
CON
RES R50107               ; エラー中　非常停止
;エラー解除処理
LD R50008                ; 全体ERROR
AND R50108               ; ｴﾗｰ中
TMR @4 #15               ; ERROR解除遅延ﾀｲﾏｰ
LD R50008                ; 全体ERROR
AND R50108               ; ｴﾗｰ中
AND R50015               ; ｴﾗｰﾘｾｯﾄSWON
ANP R40006               ; ｴﾗｰﾘｾｯﾄｽｲｯﾁ
AND @T4                  ; ERROR解除遅延ﾀｲﾏｰ
MPS
SET R50206               ; ｴﾗｰﾘｾｯﾄ
CON
SET R50109               ; ERROR解除
CON
RES R50108               ; ｴﾗｰ中
CON
RES R50008               ; 全体ERROR
MPP
ZRES R50110 R50115       ; Err ﾒｲﾝ_切断部  Err 
CON
ZRES R50500 R51015
CON
ZRES R46100 R47015       ; 終端側生地管ｸﾗﾝﾌﾟ_下降行_E
LDP R50008               ; 全体ERROR
SET @MR301
STG @MR301
AND @MR300               ; ｴﾗｰ解除確認
RES @MR300               ; ｴﾗｰ解除確認
CON
SET R50108               ; ｴﾗｰ中
CON
ENDS
MCR
END
ENDH
