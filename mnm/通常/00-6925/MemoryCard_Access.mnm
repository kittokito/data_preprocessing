DEVICE:52
;MODULE:MemoryCard_Access
;MODULE_TYPE:0
;SCRIPT_TYPE:
;***** <<　ﾒﾓﾘｰｶｰﾄﾞｱｸｾｽﾓｼﾞｭｰﾙが起動された時の処理　>> *****
;
LDF @CR2008
DW #0 @DM0
CON
ZRES @MR000 @MR1215
CON
SET @MR005
;***** <<　ﾒﾓﾘｰｶｰﾄﾞの選択情報を確認する　>> *****
;
; DM300 Bit0 = OFF : 結果ﾃﾞｰﾀの書込みを実施　ON : 書込まない
; DM300 Bit1 = OFF : 生ﾃﾞｰﾀの書込みを実施	ON : 書込まない
; 
STG @MR005
MPS
ANB MR107                ; 全データ取得フラグ
MPS
BANB DM300 #0            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
SET MR114                ; ﾒﾓﾘｶｰﾄﾞ書込み中
CON
JMP @MR100
MPP
BLD DM300 #0             ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
BANB DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
ANL
SET MR114                ; ﾒﾓﾘｶｰﾄﾞ書込み中
CON
JMP @MR500
MRD
AND MR107                ; 全データ取得フラグ
SET MR114                ; ﾒﾓﾘｶｰﾄﾞ書込み中
CON
JMP @MR800
MPP
BLD DM300 #0             ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
BAND DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
ANL
SET MR114                ; ﾒﾓﾘｶｰﾄﾞ書込み中
CON
JMP @MR1200
;***** <<  ﾒﾓﾘｰｶｰﾄﾞ書込み  検査結果のデータ  >> *****
;
;'ﾌｫﾙﾀﾞｰ名を作成
;'@EM100.T = "Data\CISS(Rufus2)\WK1\Result"
;@EM100.T = "Data\" + EM30200.T:EM30082 + "\Result"
;
;'書込みﾃﾞｰﾀ数を設定
;@DM40.U = #46				'ﾃﾞｰﾀ数
;adrset( EM0,@EM0.D )		'ﾃﾞｰﾀ格納ｴﾘｱのｱﾄﾞﾚｽ
;
;'ﾌｧｲﾙ名作成(年月日部分) 文字列生成
;@DM20 = ASC(TBCD(CM700))	'年
;@DM21 = ASC(TBCD(CM701))	'月
;@DM22 = ASC(TBCD(CM702))	'日
;@DM23 = $0000				'文字列 Nullｺｰﾄﾞ
;
;'ﾌｧｲﾙ名を作成
;'@DM20.T = "Log_WK1_Res_" + @DM20.T
;@DM20.T = EM30400.T:(EM30080 * 10) + "_Res" + @DM20.T
;
;'保存形式を設定   6:16bit符号付きﾊﾞｲﾅﾘｰﾃﾞｰﾀ
;@DM30 = 6
;'書込みﾓｰﾄﾞを設定 0:追加書込
;@DM31 = 0
;'行末処理を設定   1:CRLF
;@DM32 = 1
;
;'処理開始
;if @DM40.U <> #0 then		'書込みﾃﾞｰﾀ数が0の場合は実行しない
;	set( @MR400.B )
;end if
;
LDP @MR100
NCJ #1000
;'ﾌｫﾙﾀﾞｰ名を作成
;
;'@EM100.T = "Data\CISS(Rufus2)\WK1\Result"
;
;@EM100.T = "Data\" + EM30200.T:EM30082 + "\Result"
;
LD CR2002                ; 常時ON
LDA EM30082              ; 機種番号 機種名表示用
CON
EXT
CON
STA.L Z12
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM0
SMOV "Data\" *@VM0
LD CR2002                ; 常時ON
SADD *@VM0 EM30200:Z12 *@VM0;機種名1
SADD *@VM0 "\Result" *@VM0
SMOV *@VM0 @EM100
;'書込みﾃﾞｰﾀ数を設定
;
;@DM40.U = #46				'ﾃﾞｰﾀ数
;
LD CR2002                ; 常時ON
MOV #46 @DM40
;adrset( EM0,@EM0.D )		'ﾃﾞｰﾀ格納ｴﾘｱのｱﾄﾞﾚｽ
;
LD CR2002                ; 常時ON
ADRSET EM0 @EM0          ; ﾜｰｸNo.
;'ﾌｧｲﾙ名作成(年月日部分) 文字列生成
;
;@DM20 = ASC(TBCD(CM700))	'年
;
LD CR2002                ; 常時ON
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
CON
TBCD
CON
ASC
CON
STA @DM20
;@DM21 = ASC(TBCD(CM701))	'月
;
LD CR2002                ; 常時ON
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
CON
TBCD
CON
ASC
CON
STA @DM21
;@DM22 = ASC(TBCD(CM702))	'日
;
LD CR2002                ; 常時ON
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
CON
TBCD
CON
ASC
CON
STA @DM22
;@DM23 = $0000				'文字列 Nullｺｰﾄﾞ
;
LD CR2002                ; 常時ON
MOV $0000 @DM23
;'ﾌｧｲﾙ名を作成
;
;'@DM20.T = "Log_WK1_Res_" + @DM20.T
;
;@DM20.T = EM30400.T:(EM30080 * 10) + "_Res" + @DM20.T
;
LD CR2002                ; 常時ON
LDA EM30080              ; 機種番号
CON
EXT
CON
MUL.L +10
CON
STA.L Z12
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM2
SMOV EM30400:Z12 *@VM2   ; 部品コード1
LD CR2002                ; 常時ON
SADD *@VM2 "_Res" *@VM2
SADD *@VM2 @DM20 *@VM2
SMOV *@VM2 @DM20
;'保存形式を設定   6:16bit符号付きﾊﾞｲﾅﾘｰﾃﾞｰﾀ
;
;@DM30 = 6
;
LD CR2002                ; 常時ON
MOV #6 @DM30
;'書込みﾓｰﾄﾞを設定 0:追加書込
;
;@DM31 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM31
;'行末処理を設定   1:CRLF
;
;@DM32 = 1
;
LD CR2002                ; 常時ON
MOV #1 @DM32
;'処理開始
;
;if @DM40.U <> #0 then		'書込みﾃﾞｰﾀ数が0の場合は実行しない
;
LD<> @DM40 #0
NCJ #2000
;	set( @MR400.B )
;
LD CR2002                ; 常時ON
SET @MR400
;end if
;
LABEL #2000
LABEL #1000
;
;***** <<　ﾒﾓﾘｰｶｰﾄﾞ書込み用のﾊﾟﾗﾒｰﾀを設定する　>> *****
;
STG @MR100
ANP @MR400
RES @MR400
CON
JMP @MR101
;***** <<　ﾒﾓﾘｰｶｰﾄﾞの空き容量を確認する　>> *****
;
STG @MR101
MPS
ANP @MR101
MSTRT MEM_FREE_11 DM296 DM298 @MR000 @DM0;ﾒﾓﾘｰｶｰﾄﾞ指定空き容量(下位)  ﾒﾓﾘｰｶｰﾄﾞ空き容量(下位)
MPP
ANF _MEM_FREE_11
MPS
ANB @MR000
JMP @MR210
MPP
AND @MR000
JMP @MR1300
;***** <<　ﾒﾓﾘｰｶｰﾄﾞに指定ﾌｫﾙﾀﾞを作成する　>> *****
;
;***** <<　書込みデータを作成する　>> *****
;　EM0～EM2:年月日
;　EM3～EM5:時分秒
;  EM6～   :検査データ
;  
;***** <<　ﾒﾓﾘｰｶｰﾄﾞに検査データを書き込む　>> *****
;
STG @MR210
MPS
ANP @MR210
MSTRT MEM_WRITE_11 @EM100 @DM20 @DM30 @DM31 @DM32 *@EM0 @DM40 @MR000 @DM0
MPP
ANF _MEM_WRITE_11
MPS
ANB @MR000
MPS
BANB DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
JMP @MR500
MPP
BAND DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
JMP @MR1200
MPP
AND @MR000
JMP @MR1300
;***** <<　ﾒﾓﾘｰｶｰﾄﾞ書込み　検査の生データ　>> *****
;
;'ﾌｫﾙﾀﾞｰ名を作成
;'@EM100.T = "Data\CISS(Rufus2)\WK1\MesDat"
;@EM100.T = "Data\" + EM30200.T:EM30082 + "\MesDat"
;
;'流路数を設定
;@DM44.U = EM39999		'ﾃﾞｰﾀ数
;if @DM44 = 0 then
;	@DM44 = 1
;end if
;@DM45.U = #1		'ﾃﾞｰﾀNoの初期値
;
;'ﾌｧｲﾙ名作成(年月日部分) 文字列生成
;@DM20 = ASC(TBCD(CM700))	'年
;@DM21 = ASC(TBCD(CM701))	'月
;@DM22 = ASC(TBCD(CM702))	'日
;@DM23 = $0000				'文字列 Nullｺｰﾄﾞ
;
;'ﾌｧｲﾙ名を作成
;'@DM20.T = "Log_WK1_Mdt_" + @DM20.T
;@DM20.T = EM30400.T:(EM30080 * 10) + "_Mdt" + @DM20.T
;
;'保存形式を設定   6:16bit符号付きﾊﾞｲﾅﾘｰﾃﾞｰﾀ
;@DM30 = 6
;'書込みﾓｰﾄﾞを設定 0:追加書込
;@DM31 = 0
;'行末処理を設定   1:CRLF
;@DM32 = 1
;
;'書込みﾃﾞｰﾀ数を設定
;@DM40.U = 1009			'ﾄｰﾀﾙ数
;@DM42.U = 1000			'ﾃﾞｰﾀのみの数
;
;'書込みﾃﾞｰﾀ格納先ｱﾄﾞﾚｽを設定
;adrset( FM0,@EM0.D )	'ﾃﾞｰﾀ格納ｴﾘｱのｱﾄﾞﾚｽ
;
;'処理開始
;if @DM40.U <> #0 then		'書込みﾃﾞｰﾀ数が0の場合は実行しない
;	set( @MR400.B )
;end if
;
LDP @MR500
NCJ #1001
;'ﾌｫﾙﾀﾞｰ名を作成
;
;'@EM100.T = "Data\CISS(Rufus2)\WK1\MesDat"
;
;@EM100.T = "Data\" + EM30200.T:EM30082 + "\MesDat"
;
LD CR2002                ; 常時ON
LDA EM30082              ; 機種番号 機種名表示用
CON
EXT
CON
STA.L Z12
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM4
SMOV "Data\" *@VM4
LD CR2002                ; 常時ON
SADD *@VM4 EM30200:Z12 *@VM4;機種名1
SADD *@VM4 "\MesDat" *@VM4
SMOV *@VM4 @EM100
;'流路数を設定
;
;@DM44.U = EM39999		'ﾃﾞｰﾀ数
;
LD CR2002                ; 常時ON
MOV EM39999 @DM44        ; ﾒﾓﾘｰｶｰﾄﾞ書込みデータ回数
;if @DM44 = 0 then
;
LD= @DM44 #0
NCJ #2001
;	@DM44 = 1
;
LD CR2002                ; 常時ON
MOV #1 @DM44
;end if
;
LABEL #2001
;@DM45.U = #1		'ﾃﾞｰﾀNoの初期値
;
LD CR2002                ; 常時ON
MOV #1 @DM45
;'ﾌｧｲﾙ名作成(年月日部分) 文字列生成
;
;@DM20 = ASC(TBCD(CM700))	'年
;
LD CR2002                ; 常時ON
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
CON
TBCD
CON
ASC
CON
STA @DM20
;@DM21 = ASC(TBCD(CM701))	'月
;
LD CR2002                ; 常時ON
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
CON
TBCD
CON
ASC
CON
STA @DM21
;@DM22 = ASC(TBCD(CM702))	'日
;
LD CR2002                ; 常時ON
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
CON
TBCD
CON
ASC
CON
STA @DM22
;@DM23 = $0000				'文字列 Nullｺｰﾄﾞ
;
LD CR2002                ; 常時ON
MOV $0000 @DM23
;'ﾌｧｲﾙ名を作成
;
;'@DM20.T = "Log_WK1_Mdt_" + @DM20.T
;
;@DM20.T = EM30400.T:(EM30080 * 10) + "_Mdt" + @DM20.T
;
LD CR2002                ; 常時ON
LDA EM30080              ; 機種番号
CON
EXT
CON
MUL.L +10
CON
STA.L Z12
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM6
SMOV EM30400:Z12 *@VM6   ; 部品コード1
LD CR2002                ; 常時ON
SADD *@VM6 "_Mdt" *@VM6
SADD *@VM6 @DM20 *@VM6
SMOV *@VM6 @DM20
;'保存形式を設定   6:16bit符号付きﾊﾞｲﾅﾘｰﾃﾞｰﾀ
;
;@DM30 = 6
;
LD CR2002                ; 常時ON
MOV #6 @DM30
;'書込みﾓｰﾄﾞを設定 0:追加書込
;
;@DM31 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM31
;'行末処理を設定   1:CRLF
;
;@DM32 = 1
;
LD CR2002                ; 常時ON
MOV #1 @DM32
;'書込みﾃﾞｰﾀ数を設定
;
;@DM40.U = 1009			'ﾄｰﾀﾙ数
;
LD CR2002                ; 常時ON
MOV #1009 @DM40
;@DM42.U = 1000			'ﾃﾞｰﾀのみの数
;
LD CR2002                ; 常時ON
MOV #1000 @DM42
;'書込みﾃﾞｰﾀ格納先ｱﾄﾞﾚｽを設定
;
;adrset( FM0,@EM0.D )	'ﾃﾞｰﾀ格納ｴﾘｱのｱﾄﾞﾚｽ
;
LD CR2002                ; 常時ON
ADRSET FM0 @EM0
;'処理開始
;
;if @DM40.U <> #0 then		'書込みﾃﾞｰﾀ数が0の場合は実行しない
;
LD<> @DM40 #0
NCJ #2002
;	set( @MR400.B )
;
LD CR2002                ; 常時ON
SET @MR400
;end if
;
LABEL #2002
LABEL #1001
;
;***** <<　ﾒﾓﾘｰｶｰﾄﾞ書込み用のﾊﾟﾗﾒｰﾀを設定する　>> *****
;
STG @MR500
ANP @MR400
RES @MR400
CON
JMP @MR501
;***** <<　ﾒﾓﾘｰｶｰﾄﾞの空き容量を確認する　>> *****
;
STG @MR501
MPS
ANP @MR501
MSTRT MEM_FREE_12 DM296 DM298 @MR000 @DM0;ﾒﾓﾘｰｶｰﾄﾞ指定空き容量(下位)  ﾒﾓﾘｰｶｰﾄﾞ空き容量(下位)
MPP
ANF _MEM_FREE_12
MPS
ANB @MR000
JMP @MR600
MPP
AND @MR000
JMP @MR1300
;***** <<　ﾒﾓﾘｰｶｰﾄﾞに指定ﾌｫﾙﾀﾞを作成する　>> *****
;
;***** <<　書込みデータを作成する　>> *****
;　EM0     :ワーク№
;　EM1～EM3:年月日
;　EM4～EM6:時分秒
;　EM7     :エラー№
;　EM8     :エラー詳細
;　EM9     :判定方法
;  EM10～  :検査データ
;  
STG @MR600
MPS
BANB DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
JMP @MR700
MPP
BAND DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
JMP @MR1200
;***** <<　ﾒﾓﾘｰｶｰﾄﾞに検査データを書き込む　>> *****
;
STG @MR700
MOV EM0 EM40000          ; ﾜｰｸNo.  検査ﾃﾞｰﾀ 一時保存場所
BMOV EM1 EM40001 #6      ; 日付〔year〕  年
MOV #0 EM40007           ; 流路No
MOV @DM45 EM40008        ; 検査種類
BMOV *@EM0 EM40009 @DM42 ; 取得ﾃﾞｰﾀ予想数
JMP @MR701
STG @MR701
MPS
ANP @MR701
MSTRT MEM_WRITE_12 @EM100 @DM20 @DM30 @DM31 @DM32 EM40000 @DM40 @MR000 @DM0;検査ﾃﾞｰﾀ 一時保存場所
MPP
ANF _MEM_WRITE_12
MPS
ANB @MR000
JMP @MR710
MPP
AND @MR000
JMP @MR1300
STG @MR710
ANP @MR710
DEC @DM44
CON
MPS
AND= DM302 #0            ; 検査ﾃﾞｰﾀ測定ﾓｰﾄﾞ 確認用
MPS
AND<> @DM44 #0
ADRADD.S +1000 @EM0
INC @DM45
JMP @MR501
MPP
AND= @DM44 #0
JMP @MR1200
MPP
AND<> DM302 #0           ; 検査ﾃﾞｰﾀ測定ﾓｰﾄﾞ 確認用
JMP @MR1200
;***** <<  ﾒﾓﾘｰｶｰﾄﾞ書込み  全データ  >> *****
;
;'ﾌｫﾙﾀﾞｰ名を作成
;@EM100.T = "Data\" + EM30200.T:EM30082 + "\AllData"
;
;'流路数を設定
;@DM44.U = 1	'ﾃﾞｰﾀ数
;@DM45.U = 1		'ﾃﾞｰﾀNoの初期値
;
;'ﾌｧｲﾙ名作成(年月日部分) 文字列生成
;@DM20 = ASC(TBCD(CM700))	'年
;@DM21 = ASC(TBCD(CM701))	'月
;@DM22 = ASC(TBCD(CM702))	'日
;@DM23 = $0000				'文字列 Nullｺｰﾄﾞ
;
;'ﾌｧｲﾙ名を作成
;@DM20.T = EM30400.T:(EM30080 * 10) + "_All" + @DM20.T
;
;'保存形式を設定   6:16bit符号付きﾊﾞｲﾅﾘｰﾃﾞｰﾀ
;@DM30 = 6
;'書込みﾓｰﾄﾞを設定 0:追加書込
;@DM31 = 0
;'行末処理を設定   1:CRLF
;@DM32 = 1
;
;'書込みﾃﾞｰﾀ数を設定
;@DM40.U = FM0 + 9		'ﾄｰﾀﾙ数
;@DM42.U = FM0			'ﾃﾞｰﾀのみの数
;
;'書込みﾃﾞｰﾀ格納先ｱﾄﾞﾚｽを設定
;adrset( FM1,@EM0.D )	'ﾃﾞｰﾀ格納ｴﾘｱのｱﾄﾞﾚｽ
;
;'処理開始
;if @DM40.U <> #0 then		'書込みﾃﾞｰﾀ数が0の場合は実行しない
;	set( @MR400.B )
;end if
;
LDP @MR800
NCJ #1002
;'ﾌｫﾙﾀﾞｰ名を作成
;
;@EM100.T = "Data\" + EM30200.T:EM30082 + "\AllData"
;
LD CR2002                ; 常時ON
LDA EM30082              ; 機種番号 機種名表示用
CON
EXT
CON
STA.L Z12
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM8
SMOV "Data\" *@VM8
LD CR2002                ; 常時ON
SADD *@VM8 EM30200:Z12 *@VM8;機種名1
SADD *@VM8 "\AllData" *@VM8
SMOV *@VM8 @EM100
;'流路数を設定
;
;@DM44.U = 1	'ﾃﾞｰﾀ数
;
LD CR2002                ; 常時ON
MOV #1 @DM44
;@DM45.U = 1		'ﾃﾞｰﾀNoの初期値
;
LD CR2002                ; 常時ON
MOV #1 @DM45
;'ﾌｧｲﾙ名作成(年月日部分) 文字列生成
;
;@DM20 = ASC(TBCD(CM700))	'年
;
LD CR2002                ; 常時ON
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
CON
TBCD
CON
ASC
CON
STA @DM20
;@DM21 = ASC(TBCD(CM701))	'月
;
LD CR2002                ; 常時ON
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
CON
TBCD
CON
ASC
CON
STA @DM21
;@DM22 = ASC(TBCD(CM702))	'日
;
LD CR2002                ; 常時ON
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
CON
TBCD
CON
ASC
CON
STA @DM22
;@DM23 = $0000				'文字列 Nullｺｰﾄﾞ
;
LD CR2002                ; 常時ON
MOV $0000 @DM23
;'ﾌｧｲﾙ名を作成
;
;@DM20.T = EM30400.T:(EM30080 * 10) + "_All" + @DM20.T
;
LD CR2002                ; 常時ON
LDA EM30080              ; 機種番号
CON
EXT
CON
MUL.L +10
CON
STA.L Z12
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM10
SMOV EM30400:Z12 *@VM10  ; 部品コード1
LD CR2002                ; 常時ON
SADD *@VM10 "_All" *@VM10
SADD *@VM10 @DM20 *@VM10
SMOV *@VM10 @DM20
;'保存形式を設定   6:16bit符号付きﾊﾞｲﾅﾘｰﾃﾞｰﾀ
;
;@DM30 = 6
;
LD CR2002                ; 常時ON
MOV #6 @DM30
;'書込みﾓｰﾄﾞを設定 0:追加書込
;
;@DM31 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM31
;'行末処理を設定   1:CRLF
;
;@DM32 = 1
;
LD CR2002                ; 常時ON
MOV #1 @DM32
;'書込みﾃﾞｰﾀ数を設定
;
;@DM40.U = FM0 + 9		'ﾄｰﾀﾙ数
;
;;Warning[1103]: "=": (符号付き32ビット整数型->符号無し16ビット整数型) 代入によりデータが欠落する可能性があります。
LD CR2002                ; 常時ON
LDA FM0
CON
EXT
CON
ADD.L +9
CON
STA @DM40
;@DM42.U = FM0			'ﾃﾞｰﾀのみの数
;
LD CR2002                ; 常時ON
MOV FM0 @DM42
;'書込みﾃﾞｰﾀ格納先ｱﾄﾞﾚｽを設定
;
;adrset( FM1,@EM0.D )	'ﾃﾞｰﾀ格納ｴﾘｱのｱﾄﾞﾚｽ
;
LD CR2002                ; 常時ON
ADRSET FM1 @EM0
;'処理開始
;
;if @DM40.U <> #0 then		'書込みﾃﾞｰﾀ数が0の場合は実行しない
;
LD<> @DM40 #0
NCJ #2003
;	set( @MR400.B )
;
LD CR2002                ; 常時ON
SET @MR400
;end if
;
LABEL #2003
LABEL #1002
;
;***** <<　ﾒﾓﾘｰｶｰﾄﾞ書込み用のﾊﾟﾗﾒｰﾀを設定する　>> *****
;
STG @MR800
ANP @MR400
RES @MR400
CON
JMP @MR801
;***** <<　ﾒﾓﾘｰｶｰﾄﾞの空き容量を確認する　>> *****
;
STG @MR801
MPS
ANP @MR801
MSTRT MEM_FREE_13 DM296 DM298 @MR000 @DM0;ﾒﾓﾘｰｶｰﾄﾞ指定空き容量(下位)  ﾒﾓﾘｰｶｰﾄﾞ空き容量(下位)
MPP
ANF _MEM_FREE_13
MPS
ANB @MR000
JMP @MR900
MPP
AND @MR000
JMP @MR1300
;***** <<　ﾒﾓﾘｰｶｰﾄﾞに指定ﾌｫﾙﾀﾞを作成する　>> *****
;
;***** <<　書込みデータを作成する　>> *****
;　EM0     :ワーク№
;　EM1～EM3:年月日
;　EM4～EM6:時分秒
;　EM7     :エラー№
;　EM8     :エラー詳細
;　EM9     :判定方法
;  EM10～  :検査データ
;  
STG @MR900
MPS
BANB DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
JMP @MR1000
MPP
BAND DM300 #1            ; ﾒﾓﾘｰｶｰﾄﾞ書き込み
JMP @MR1200
;***** <<　ﾒﾓﾘｰｶｰﾄﾞに検査データを書き込む　>> *****
;
STG @MR1000
MOV EM0 EM40000          ; ﾜｰｸNo.  検査ﾃﾞｰﾀ 一時保存場所
BMOV EM1 EM40001 #6      ; 日付〔year〕  年
MOV #0 EM40007           ; 流路No
MOV @DM45 EM40008        ; 検査種類
BMOV *@EM0 EM40009 @DM42 ; 取得ﾃﾞｰﾀ予想数
JMP @MR1001
STG @MR1001
MPS
ANP @MR1001
MSTRT MEM_WRITE_13 @EM100 @DM20 @DM30 @DM31 @DM32 EM40000 @DM40 @MR000 @DM0;検査ﾃﾞｰﾀ 一時保存場所
MPP
ANF _MEM_WRITE_13
MPS
ANB @MR000
JMP @MR1010
MPP
AND @MR000
JMP @MR1300
STG @MR1010
ANP @MR1010
DEC @DM44
CON
MPS
AND= DM302 #0            ; 検査ﾃﾞｰﾀ測定ﾓｰﾄﾞ 確認用
MPS
AND<> @DM44 #0
ADRADD.S +1000 @EM0
INC @DM45
JMP @MR801
MPP
AND= @DM44 #0
JMP @MR1200
MPP
AND<> DM302 #0           ; 検査ﾃﾞｰﾀ測定ﾓｰﾄﾞ 確認用
JMP @MR1200
;***** <<　ﾒﾓﾘｰｶｰﾄﾞ書込み正常終了　>> *****
;
STG @MR1200
TMH @0 #3
CON
AND @T0
RES MR114                ; ﾒﾓﾘｶｰﾄﾞ書込み中
CON
ENDS
;***** <<　ﾒﾓﾘｰｶｰﾄﾞｴﾗｰ発生時の終了　>> *****
;
STG @MR1300
MOV @DM0 DM145           ; 詳細ｴﾗｰｺｰﾄﾞ
RES MR114                ; ﾒﾓﾘｶｰﾄﾞ書込み中
CON
SET MR311                ; ﾒﾓﾘｶｰﾄﾞｴﾗｰ
CON
ENDS
END
ENDH
