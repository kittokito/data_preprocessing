DEVICE:133
;MODULE:EtherNetIP
;MODULE_TYPE:0
;TO Chamber1 AND 2 
;
;ﾁｬﾝﾊﾞｰ側でJIGからの出力TAGをみてもうらう
LD M1001                 ; S01_取出し開始要求ON
OR M50                   ; ﾁｬﾝﾊﾞｰ取出開始PL(ﾁｬﾝﾊﾞｰへ)
ANB M1004                ; S04_計時開始確認
ANB M1014                ; S14_ﾀｲﾑｱｳﾄNG
ANB M1015                ; S15_槽取出ｷｬﾝｾﾙ
AND M100                 ; 起動指令
LD W00.4                 ; ｽﾃｰｼﾞ有効/無効
OR M3                    ; OFFLINE
ANL
OUT M50                  ; ﾁｬﾝﾊﾞｰ取出開始PL(ﾁｬﾝﾊﾞｰへ)
LD M50                   ; ﾁｬﾝﾊﾞｰ取出開始PL(ﾁｬﾝﾊﾞｰへ)
OUT B0110                ; ﾁｬﾝﾊﾞｰ取出開始PL(ﾁｬﾝﾊﾞｰへ)
;FROM CHAMBER1
LD M50                   ; ﾁｬﾝﾊﾞｰ取出開始PL(ﾁｬﾝﾊﾞｰへ)
LD B0310                 ; 槽1→PLC 取り出し開始信号
OR M60                   ; 槽1→PLC ﾜｰｸ取出し記憶
ANL
OUT M60                  ; 槽1→PLC ﾜｰｸ取出し記憶
LD B0311                 ; 槽1→PLC 取り出しｷｬﾝｾﾙ信号
OUT M61                  ; 槽1→PLC 取り出しｷｬﾝｾﾙ信号
;FROM CHAMBER2
LD M50                   ; ﾁｬﾝﾊﾞｰ取出開始PL(ﾁｬﾝﾊﾞｰへ)
LD B0320                 ; 槽2→PLC 取り出し開始信号
OR M70                   ; 槽2→PLC ﾜｰｸ取出し記憶
ANL
OUT M70                  ; 槽2→PLC ﾜｰｸ取出し記憶
LD B0321                 ; 槽2→PLC 取り出しｷｬﾝｾﾙ信号
OUT M71                  ; 槽2→PLC 取り出しｷｬﾝｾﾙ信号
;JIG - JIG間
;	OUTPUT
;ｷｬﾝｾﾙ指令の理由
;１．作業者がチャンバーからワークを取出後、取出し開始信号を全ＪＩＧへ送信する。
;２．受取可能ＪＩＧがすべてワーク搭載待ちになる。
;３．ワークが乗っかった治具以外を受取可能状態にする為、ワークが乗っかった治具からキャンセル指令を出す。
LD M1006                 ; S06_ﾜｰｸｸﾗﾝﾌﾟ要求
OUT M90                  ; JIG OUT JIGｷｬﾝｾﾙ指令
LD M90                   ; JIG OUT JIGｷｬﾝｾﾙ指令
OFDL K50 B0200           ; JIG-JIG ｷｬﾝｾﾙ指令
;	INPUT
LDB B0210                ; JIG1 ｷｬﾝｾﾙ指令
ANB B0220                ; JIG2 ｷｬﾝｾﾙ指令
ANB B0230                ; JIG3 ｷｬﾝｾﾙ指令
ANB B0240                ; JIG4 ｷｬﾝｾﾙ指令
ANB B0250                ; JIG5 ｷｬﾝｾﾙ指令
ANB B0260                ; JIG6 ｷｬﾝｾﾙ指令
INV
OUT M95                  ; JIG IN 投入ｷｬﾝｾﾙ受け
;IP Address 取得
LD X290                  ; IPｱﾄﾞﾚｽ有効
UREAD K1 K1566 D100 K4   ; IP ADRS (1/4)
MOV K0 W023              ; ST NO.(共通)
MPS
AND= D103 K11            ; IP ADRS (4/4)
DW K1 W023               ; ST NO.(共通)
MRD
AND= D103 K21            ; IP ADRS (4/4)
DW K2 W023               ; ST NO.(共通)
MRD
AND= D103 K31            ; IP ADRS (4/4)
DW K3 W023               ; ST NO.(共通)
MRD
AND= D103 K41            ; IP ADRS (4/4)
DW K4 W023               ; ST NO.(共通)
MRD
AND= D103 K51            ; IP ADRS (4/4)
DW K5 W023               ; ST NO.(共通)
MPP
AND= D103 K61            ; IP ADRS (4/4)
DW K6 W023               ; ST NO.(共通)
;ERROR
LD CR2002                ; 常時ON
ONDL K3000 M0            ; PLC RUN TIMER(30s)
LD CR2003                ; 常時OFF
MC
LDB D10026.0
AND<> D103 K11           ; IP ADRS (4/4)
OUT B030                 ; JIG1 EIP 通信異常
LDB D10026.1
AND<> D103 K21           ; IP ADRS (4/4)
OUT B031                 ; JIG2 EIP 通信異常
LDB D10026.2
AND<> D103 K31           ; IP ADRS (4/4)
OUT B032                 ; JIG3 EIP 通信異常
LDB D10026.3
AND<> D103 K41           ; IP ADRS (4/4)
OUT B033                 ; JIG4 EIP 通信異常
LDB D10026.4
AND<> D103 K51           ; IP ADRS (4/4)
ANB M10                  ; 低温起動中
ANB M11                  ; 電特起動中
OUT B034                 ; JIG5 EIP 通信異常
LDB D10026.5
AND<> D103 K61           ; IP ADRS (4/4)
ANB M10                  ; 低温起動中
ANB M11                  ; 電特起動中
OUT B035                 ; JIG6 EIP 通信異常
LDB D10026.10
ANB M11                  ; 電特起動中
OUT B036                 ; Chamber1 EIP 通信異常
LDB D10026.11
ANB M11                  ; 電特起動中
OUT B037                 ; Chamber2 EIP 通信異常
MCR
;サイクリック通信ＯＦＦ処理 / 
;	サイクリック通信停止テーブル作成
LD CR2008                ; 運転開始時1ｽｷｬﾝON
FMOV K0 D110 K40         ; ｻｲｸﾘｯｸ通信 通信再開ﾉｰﾄﾞﾃｰﾌﾞﾙ 001
MOV K0 D160              ; 工程NO
MOV K0 D161              ; サイクリック通信処理完了工程NO
LDB M10                  ; 低温起動中
ANB M11                  ; 電特起動中
INV
OUT D130.3
CON
OUT D130.4
CON
OUT D130.5
LD M12                   ; 高温起動中
OUT D130.4
CON
OUT D130.5
LD M11                   ; 電特起動中
OUT D130.10
CON
OUT D130.11
LDB M10                  ; 低温起動中
ANB M11                  ; 電特起動中
ANB M12                  ; 高温起動中
INV
AND<> D160 K0            ; 工程NO
AND<> D160 D161          ; 工程NO  サイクリック通信処理完了工程NO
AND M0                   ; PLC RUN TIMER(30s)
OUT M500                 ; EIPｻｲｸﾘｯｸ通信停止指令
MPS
ANB M501                 ; EIPｻｲｸﾘｯｸ通信停止確認
OUT Y103                 ; ｻｲｸﾘｯｸ通信停止要求
U_CSTOP K1 D130          ; ｻｲｸﾘｯｸ通信 通信停止ﾉｰﾄﾞﾃｰﾌﾞﾙ 001
MRD
LD X203                  ; ｻｲｸﾘｯｸ通信停止完了
OR M501                  ; EIPｻｲｸﾘｯｸ通信停止確認
ANL
OUT M501                 ; EIPｻｲｸﾘｯｸ通信停止確認
MPP
LDB X203                 ; ｻｲｸﾘｯｸ通信停止完了
AND M501                 ; EIPｻｲｸﾘｯｸ通信停止確認
OR M502                  ; EIPｻｲｸﾘｯｸ通信停止完了
ANL
OUT M502                 ; EIPｻｲｸﾘｯｸ通信停止完了
;サイクリック通信再開処理 / 
LD M502                  ; EIPｻｲｸﾘｯｸ通信停止完了
OUT M510                 ; EIPｻｲｸﾘｯｸ通信再開ﾃｰﾌﾞﾙ作成
;	サイクリック通信再開テーブル作成
LD M510                  ; EIPｻｲｸﾘｯｸ通信再開ﾃｰﾌﾞﾙ作成
MPS
AND<> D103 K11           ; IP ADRS (4/4)
OUT D110.0
MRD
AND<> D103 K21           ; IP ADRS (4/4)
OUT D110.1
MRD
AND<> D103 K31           ; IP ADRS (4/4)
OUT D110.2
MRD
LDB M10                  ; 低温起動中
ANB M11                  ; 電特起動中
AND<> D103 K41           ; IP ADRS (4/4)
ANL
OUT D110.3
MRD
AND CR2003               ; 常時OFF
MPS
AND<> D103 K51           ; IP ADRS (4/4)
OUT D110.4
MPP
AND<> D103 K61           ; IP ADRS (4/4)
OUT D110.5
MRD
ANB M11                  ; 電特起動中
OUT D110.10
CON
OUT D110.11
MRD
OUT M511                 ; EIPｻｲｸﾘｯｸ通信再開指令
MRD
ANB M512                 ; EIPｻｲｸﾘｯｸ通信再開確認
OUT Y105                 ; ｻｲｸﾘｯｸ通信再開要求
U_CSTRT K1 D110          ; ｻｲｸﾘｯｸ通信 通信再開ﾉｰﾄﾞﾃｰﾌﾞﾙ 001
MRD
LD X205                  ; ｻｲｸﾘｯｸ通信再開完了
OR M512                  ; EIPｻｲｸﾘｯｸ通信再開確認
ANL
OUT M512                 ; EIPｻｲｸﾘｯｸ通信再開確認
MPP
LDB X205                 ; ｻｲｸﾘｯｸ通信再開完了
AND M512                 ; EIPｻｲｸﾘｯｸ通信再開確認
OR M513                  ; EIPｻｲｸﾘｯｸ通信再開完了
ANL
OUT M513                 ; EIPｻｲｸﾘｯｸ通信再開完了
@MOV D160 D161           ; 工程NO  サイクリック通信処理完了工程NO
END
ENDH
