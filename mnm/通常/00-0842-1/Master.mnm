DEVICE:51
;MODULE:Master
;MODULE_TYPE:0
;電源投入記憶
;
LD CR2002                ; 常時ON
TMR #200 #10             ; 電源投入後ｳｪｲﾄ
LD T200                  ; 電源投入後ｳｪｲﾄ
AND R1014                ; 装置　電源ON
TMR #201 #20             ; ﾊﾟﾙｽﾓｰﾀｻｰﾎﾞONﾀｲﾐﾝｸﾞ
@LDA #0
CON
@STA DM510               ; ｽﾃ-ﾀ検査NGｶｳﾝﾄ
CON
@STA DM511               ; ﾛｰﾀｰ検査NGｶｳﾝﾄ
;非常停止処理
;
;
LD R50010                ; 非常停止
ZRES @MR000 @MR915
LD R1014                 ; 装置　電源ON
MC
;Task Control / タスク制御
;
LD R50001                ; 自動運転中
DIFU @MR000
LDP @MR000
ORP @MR004
ORP R50003               ; 原点復帰
ANB R50209               ; 動作開始
RES @MR004
CON
SET R50209               ; 動作開始
;Task Controll / タスク制御
LDP R50209               ; 動作開始
LD R50001                ; 自動運転中
OR R50003                ; 原点復帰
ANL
MDSTRT 搬送RB
RES R50409               ; 1ｻｲｸﾙ完了
CON
SET @MR001
STG @MR001
AND R50410               ; 搬送RB　  1ｻｲｸﾙ終了
TMH @1 #1
CON
AND @T1
RES R50209               ; 動作開始
CON
JMP @MR002
STG @MR002
RES R50410               ; 搬送RB　  1ｻｲｸﾙ終了
CON
SET R50409               ; 1ｻｲｸﾙ完了
CON
TMH #110 #2              ; Wait timer110
CON
AND T110                 ; Wait timer110
MPS
LD R50001                ; 自動運転中
ANB R50000               ; HOLD
ANL
SET @MR004
MPP
ENDS
;STOP Manegment/停止処理
;
LD R50002                ; STEP　MODE
LDP R1003                ; SW.操作BOX    停止
ORP R1001                ; SW.操作BOX    手/自切替”手動”
ORP R50009               ; HOLDRQ
ANL
ORP R50003               ; 原点復帰
SET R50000               ; HOLD
LD R50001                ; 自動運転中
LDP R1003                ; SW.操作BOX    停止
ORP R1001                ; SW.操作BOX    手/自切替”手動”
ANL
SET MR407                ; 停止SW　表示灯
CON
SET R51200               ; 装置停止要求
LD R51200                ; 装置停止要求
AND MR1705               ; PP給材部停止完了
AND MR1805               ; PP給材部停止完了
SET R51202               ; CV停止完了
LD R51202                ; CV停止完了
AND MR1307               ; 位置決め停止ﾌﾗｸﾞ
AND MR1208               ; 平打ち停止完了
AND MR1108               ; 厚み検査停止完了
AND R50001               ; 自動運転中
LD R50002                ; STEP　MODE
ANP R50009               ; HOLDRQ
ORL
ORP R50003               ; 原点復帰
SET R50000               ; HOLD
LDP R50000               ; HOLD
MPS
RES R51202               ; CV停止完了
CON
RES MR1307               ; 位置決め停止ﾌﾗｸﾞ
CON
RES MR1208               ; 平打ち停止完了
CON
RES MR1108               ; 厚み検査停止完了
CON
RES R50009               ; HOLDRQ
CON
RES R50006               ; 自動運転可能
CON
RES R50009               ; HOLDRQ
MPP
RES R51200               ; 装置停止要求
CON
RES MR1705               ; PP給材部停止完了
CON
RES MR1805               ; PP給材部停止完了
CON
ZRES MR912 MR915         ; ｽﾃｰﾀ　ｽﾄｯﾊﾟｴｽｹｰﾊﾟ処理終了  ﾛｰﾀ　ｽﾄｯﾊﾟｴｽｹｰﾊﾟ処理終了
LDB R50004               ; TASKDO
OR R50308                ; タスク停止待ち
RES R50001               ; 自動運転中
CON
RES MR407                ; 停止SW　表示灯
CON
RES R50002               ; STEP　MODE
LD R50003                ; 原点復帰
LDB R50004               ; TASKDO
OR R50308                ; タスク停止待ち
ANL
TMR @0 #5
CON
AND @T0
RES R50003               ; 原点復帰
CON
RES R50409               ; 1ｻｲｸﾙ完了
CON
@MOV #0 DM150            ; 位置決め部ｽﾃｰﾀﾜｰｸ有無
@MOV #0 DM151            ; 位置決め部ﾛｰﾀﾜｰｸ有無
@MOV #0 DM152            ; 平打ち部ｽﾃｰﾀﾜｰｸ有無
@MOV #0 DM153            ; 平打ち部ﾛｰﾀﾜｰｸ有無
@MOV #0 DM154            ; 検査部ｽﾃｰﾀﾜｰｸ有無
@MOV #0 DM155            ; 検査部ﾛｰﾀﾜｰｸ有無
@MOV #0 DM156            ; 排出部ｽﾃｰﾀﾜｰｸ有無
@MOV #0 DM157            ; 排出部ﾛｰﾀﾜｰｸ有無
@MOV #0 DM158            ; 排出ｺﾝﾍﾞｱ上ｽﾃｰﾀ有無
@MOV #0 DM159            ; 排出ｺﾝﾍﾞｱ上ﾛｰﾀ有無
@MOV #0 DM160            ; 位置決めPPﾁｬｯｸ_ｽﾃｰﾀ
@MOV #0 DM161            ; 位置決めPPﾁｬｯｸ_ﾛｰﾀ
RES MR1011               ; 搬送ｺﾝﾍﾞｱ回転要求
CON
RES MR1901               ; 平打ち前CV_回転開始
CON
RES R55003               ; TP_動作中表示
CON
SET R55002               ; TP_停止中表示
CON
RES R55001               ; TP_動作中表示
CON
SET R55000               ; TP_停止中表示
CON
RES R55005               ; TP_動作中表示
CON
SET R55004               ; TP_停止中表示
CON
SET R50007               ; 原点復帰　完了
;Each UT Task Stop / 各UTタスク停止
;
LD R50001                ; 自動運転中
AND R50409               ; 1ｻｲｸﾙ完了
AND R50000               ; HOLD
LD R50002                ; STEP　MODE
OR R50003                ; 原点復帰
AND R50409               ; 1ｻｲｸﾙ完了
ORL
RES R50409               ; 1ｻｲｸﾙ完了
CON
RES R50209               ; 動作開始
CON
SET R50308               ; タスク停止待ち
LD R50308                ; タスク停止待ち
ANB R50201               ; 位置決め Do
ANB R50202               ; 平打ち Do
ANB R50203               ; 厚み検査 Do
ANB R50200               ; 搬送RB Do
RES R50308               ; タスク停止待ち
CON
RES R50004               ; TASKDO
CON
RES R50000               ; HOLD
CON
DIFU @MR104
STG @MR104
JMP @MR105
MDSTOP 位置決め
MDSTOP 平打ち
MDSTOP 厚み検査
MDSTOP 搬送RB
STG @MR105
ANB _位置決め
ANB _平打ち
ANB _厚み検査
ANB _搬送RB
ENDS
;＠モード選択　/　Select Mode
;
;原点復帰
LDP R1001                ; SW.操作BOX    手/自切替”手動”
OR R50210                ; 原点復帰中
ANB R14915               ; 手動操作BOXより有効ｽｲｯﾁ
AND R1001                ; SW.操作BOX    手/自切替”手動”
ANB R50007               ; 原点復帰　完了
ANB R50003               ; 原点復帰
OUT R50210               ; 原点復帰中
LD R50210                ; 原点復帰中
ANP R1000                ; SW.操作BOX    原点復帰
DIFU @MR006
LD @MR006
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50300               ; 一時停止中
ANB R50010               ; 非常停止
AND R1915                ; 元圧空確認
AND R1115                ; ｴﾘｱｾﾝｻ遮光SIG
ZRES MR12510 MR12513     ; ｽﾃｰﾀ　ﾌﾟﾚｽ後搬送C/V　OFF  回転位置決め前C/V　OFF
CON
SET R50003               ; 原点復帰
CON
SET R50004               ; TASKDO
;ＡＵＴＯ
LD R50006                ; 自動運転可能
ANB R50008               ; 全体ERROR
ANB R1001                ; SW.操作BOX    手/自切替”手動”
ANP R1002                ; SW.操作BOX    運転開始
AND= DM4000 #2           ; 現在表示中画面
ZRES MR31000 MR31103     ; 給材ﾁｬｯｸ ﾜｰｸ取出開始  ﾛｰﾀｰ検査NG
CON
MPS
AND CR3213               ; ﾒﾓﾘｶｰﾄﾞあり
MPS
ANB CR3215               ; ﾒﾓﾘｶｰﾄﾞﾗｲﾄﾌﾟﾛﾃｸﾄ
MPS
LDB CR009                ; ﾛｷﾞﾝｸﾞ0ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
ANB CR109                ; ﾛｷﾞﾝｸﾞ1ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
ANL
SET @MR008
MPP
LD CR009                 ; ﾛｷﾞﾝｸﾞ0ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
OR CR109                 ; ﾛｷﾞﾝｸﾞ1ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
ANB @MR102
ANB @MR101
ANL
SET @MR100
MPP
LD CR3215                ; ﾒﾓﾘｶｰﾄﾞﾗｲﾄﾌﾟﾛﾃｸﾄ
ANB @MR102
ANB @MR100
ANL
SET @MR101
MPP
LDB CR3213               ; ﾒﾓﾘｶｰﾄﾞあり
ANB @MR100
ANB @MR101
ANL
SET @MR102
STG @MR101
SET R50008               ; 全体ERROR
CON
SET R50214               ; Err ﾒﾓﾘｶｰﾄﾞ
CON
SET R51006               ; ﾒﾓﾘｶｰﾄﾞ
CON
SET R50912               ; ERR76
CON
JMP @MR200
MOV #76 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR200
AND R50008               ; 全体ERROR
JMP @MR202
STG @MR202
ANB R50008               ; 全体ERROR
ENDS
STG @MR100
SET R50008               ; 全体ERROR
CON
SET R50214               ; Err ﾒﾓﾘｶｰﾄﾞ
CON
SET R51006               ; ﾒﾓﾘｶｰﾄﾞ
CON
SET R50911               ; ERR75
CON
JMP @MR203
MOV #75 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR203
AND R50008               ; 全体ERROR
JMP @MR204
STG @MR204
ANB R50008               ; 全体ERROR
ENDS
STG @MR102
SET R50008               ; 全体ERROR
CON
SET R50214               ; Err ﾒﾓﾘｶｰﾄﾞ
CON
SET R51006               ; ﾒﾓﾘｶｰﾄﾞ
CON
SET R50915               ; ERR79
CON
JMP @MR205
MOV #79 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR205
AND R50008               ; 全体ERROR
JMP @MR206
STG @MR206
ANB R50008               ; 全体ERROR
@SET @MR008
CON
ENDS
LD @MR008
AND R50007               ; 原点復帰　完了
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50300               ; 一時停止中
ANB R50010               ; 非常停止
AND R1915                ; 元圧空確認
AND R1115                ; ｴﾘｱｾﾝｻ遮光SIG
RES @MR008
CON
MPS
SET R50001               ; 自動運転中
CON
SET R50004               ; TASKDO
MRD
@MOV #0 DM150            ; 位置決め部ｽﾃｰﾀﾜｰｸ有無
MRD
@MOV #0 DM151            ; 位置決め部ﾛｰﾀﾜｰｸ有無
MRD
@MOV #0 DM152            ; 平打ち部ｽﾃｰﾀﾜｰｸ有無
MRD
@MOV #0 DM153            ; 平打ち部ﾛｰﾀﾜｰｸ有無
MRD
@MOV #0 DM154            ; 検査部ｽﾃｰﾀﾜｰｸ有無
MRD
@MOV #0 DM155            ; 検査部ﾛｰﾀﾜｰｸ有無
MRD
@MOV #0 DM156            ; 排出部ｽﾃｰﾀﾜｰｸ有無
MRD
@MOV #0 DM157            ; 排出部ﾛｰﾀﾜｰｸ有無
MRD
@MOV #0 DM158            ; 排出ｺﾝﾍﾞｱ上ｽﾃｰﾀ有無
MRD
@MOV #0 DM159            ; 排出ｺﾝﾍﾞｱ上ﾛｰﾀ有無
MRD
@MOV #0 DM160            ; 位置決めPPﾁｬｯｸ_ｽﾃｰﾀ
MPP
@MOV #0 DM161            ; 位置決めPPﾁｬｯｸ_ﾛｰﾀ
;手動／ｽﾃｯﾌﾟ運転
LD= DM4000 #410          ; 現在表示中画面
OR= DM4000 #420          ; 現在表示中画面
OR= DM4000 #440          ; 現在表示中画面
AND R50007               ; 原点復帰　完了
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50300               ; 一時停止中
ANB R50010               ; 非常停止
AND R1915                ; 元圧空確認
AND R1115                ; ｴﾘｱｾﾝｻ遮光SIG
OUT @MR010
LD @MR010
ANP R1002                ; SW.操作BOX    運転開始
SET R50002               ; STEP　MODE
CON
SET R50004               ; TASKDO
;STEP Operation / STEP動作
;Ｃａｌｌ　Ｐｏｓｔ
LDB R50002               ; STEP　MODE
ZRES R50403 R50405       ; 1ｽﾃｯﾌﾟ停止中
STG R50400               ; Call Post
ANB R50403               ; 1ｽﾃｯﾌﾟ停止中
ANB R1002                ; SW.操作BOX    運転開始
AND R50002               ; STEP　MODE
SET R50403               ; 1ｽﾃｯﾌﾟ停止中
CON
JMP R50404
STG R50404
ANP R1002                ; SW.操作BOX    運転開始
ANB R50008               ; 全体ERROR
ANB R50010               ; 非常停止
AND R1915                ; 元圧空確認
JMP R50405
STG R50405
ANB R50400               ; Call Post
RES R50403               ; 1ｽﾃｯﾌﾟ停止中
CON
ENDS
LD R50400                ; Call Post
AND R50404
OUT R50401               ; Post Busy
LD R50002                ; STEP　MODE
AND R50405
ORB R50002               ; STEP　MODE
OUT R50402               ; Post Ok
;Error Release Delay Management / エラー解除遅延処理
;
LDP R50107               ; エラー中　非常停止
SET R50109               ; ERROR解除
LDB R50008               ; 全体ERROR
OR R50109                ; ERROR解除
TMR @3 #15
LD @T3
SET @MR300
CON
RES R50109               ; ERROR解除
CON
RES R50107               ; エラー中　非常停止
;エラー解除処理
LD R50008                ; 全体ERROR
AND R50108               ; エラー中
TMR @4 #15
LD R50008                ; 全体ERROR
AND R50108               ; エラー中
AND R50015               ; ｴﾗｰﾘｾｯﾄSWON
ANP R40006               ; ｴﾗｰﾘｾｯﾄｽｲｯﾁ
AND @T4
ANB R50306               ; 1ｾﾙ ﾎﾟｰｽﾞ中
MPS
SET R50206
CON
SET R50109               ; ERROR解除
CON
RES R50108               ; エラー中
CON
RES R50008               ; 全体ERROR
MPP
ZRES R50110 R50115       ; Err 搬送RB  Err 反転P&P
CON
ZRES R50500 R51015
CON
ZRES R46100 R47015       ; 反転PP部　ﾛｰﾀ 1個前押え上昇ｴﾗｰ
LDP R50008               ; 全体ERROR
SET @MR301
STG @MR301
AND @MR300
RES @MR300
CON
SET R50108               ; エラー中
CON
ENDS
MCR
LD R50209                ; 動作開始
AND CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
@INC DM7020
LDF R50209               ; 動作開始
MOV DM7020 DM7021
LDF @MR004
MOV #0 DM7020
END
ENDH
