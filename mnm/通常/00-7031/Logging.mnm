DEVICE:128
;MODULE:Logging
;MODULE_TYPE:0
;SCRIPT_TYPE:
;<h1/>□_ﾛｷﾞﾝｸﾞ回路
;	ﾛｷﾞﾝｸﾞ・ﾄﾚｰｽ機能  ID0_開始
;	開始トリガ：押し込みロボ  プレス開始信号
LDB CR001                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
ANP W102F.9              ; BOARD_BUILT-IN_RB_PRUN
LD M73                   ; 各工程起動指令
OR M150                  ; 日常点検1ﾓｰﾄﾞ
ANL
LOGE K0
LD CR001                 ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
MPS
LD W202F.9               ; BOARD_BUILT-IN_RB_FPST
OR W102E.3               ; BOARD_BUILT-IN_RB_PSTP
ANL
TMR K400 K10             ; ﾛｷﾞﾝｸﾞ終了ﾃﾞｨﾚｲ
MPP
TMR K401 K150            ; ﾛｷﾞﾝｸﾞ実行時間制限
;	ID0_終了
LD T400                  ; ﾛｷﾞﾝｸﾞ終了ﾃﾞｨﾚｲ
ORP T401                 ; ﾛｷﾞﾝｸﾞ実行時間制限
OR W102E.5               ; BOARD_BUILT-IN_RB_RTRN
ORF W102F.9              ; BOARD_BUILT-IN_RB_PRUN
AND CR001                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
LOGD K0
;	ID0_リネームトリガ発動  @M101
LD M73                   ; 各工程起動指令
ANF CR001                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
OR @M101                 ; ﾘﾈｰﾑ処理要求#1
ANB @M10                 ; ﾘﾈｰﾑ完了#1
OUT @M101                ; ﾘﾈｰﾑ処理要求#1
;	ﾛｷﾞﾝｸﾞ・ﾄﾚｰｽ機能  ID1_開始
;	開始トリガ：押し込みロボ  プレス開始信号
LD CR001                 ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
ANB CR101                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ1 動作中
ANP W102F.9              ; BOARD_BUILT-IN_RB_PRUN
LD M73                   ; 各工程起動指令
OR M150                  ; 日常点検1ﾓｰﾄﾞ
ANL
LOGE K1
LD CR101                 ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ1 動作中
MPS
LD W202F.9               ; BOARD_BUILT-IN_RB_FPST
OR W102E.3               ; BOARD_BUILT-IN_RB_PSTP
ANL
TMR K403 K10             ; ロギング終了ディレイ
MPP
TMR K404 K150            ; ロギング実行タイムアウト
;	ID1_終了
LD T403                  ; ロギング終了ディレイ
ORP T404                 ; ロギング実行タイムアウト
OR W102E.5               ; BOARD_BUILT-IN_RB_RTRN
ORF W102F.9              ; BOARD_BUILT-IN_RB_PRUN
AND CR101                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ1 動作中
LOGD K1
LD T400                  ; ﾛｷﾞﾝｸﾞ終了ﾃﾞｨﾚｲ
OR @M1
AND CR001                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
MPS
OUT @M1
MPP
AND CR2004               ; 10msｸﾛｯｸﾊﾟﾙｽ
INC @D1
;	ID1_リネームトリガ発動  @M201
LD M73                   ; 各工程起動指令
ANF CR101                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ1 動作中
OR @M201                 ; ﾘﾈｰﾑ処理要求#2
ANB @M20                 ; ﾘﾈｰﾑ完了#2
OUT @M201                ; ﾘﾈｰﾑ処理要求#2
;<h1/>▽_ﾛｷﾞﾝｸﾞ0_ファイルリネーム回路
;<h1/>▽_ﾃﾞｰﾀ生成
;'ｶﾚﾝﾀﾞｰ生成
;ZRES(@D10,@D39)	'領域ﾘｾｯﾄ
;'年月日
;@D10.T = RIGHT("0"+STR(CM700),2)+RIGHT("0"+STR(CM701),2)+RIGHT("0"+ STR(CM702),2)
;'時分秒
;@D20.T = RIGHT("0"+STR(CM703),2)+RIGHT("0"+STR(CM704),2)+RIGHT("0"+ STR(CM705),2)
;'年月日時分秒
;@D30.T = @D10.T + @D20.T
;'ｶﾚﾝﾀﾞｰ生成
;
;ZRES(@D10,@D39)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D10 @D39           ; 年月日.T
;'年月日
;
;@D10.T = RIGHT("0"+STR(CM700),2)+RIGHT("0"+STR(CM701),2)+RIGHT("0"+ STR(CM702),2)
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM2
LD CR2002                ; 常時ON
MOV CR2800 @VM0
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC CM702 *@VM2         ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
PMOV @VM0 K14 CR2800 K14 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM1
LD CR2002                ; 常時ON
LDA @VM1
CON
SRA K1
CON
STA @VM1
CON
INC @VM1
CON
ADRADD.S @VM1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM4
SMOV "0" *@VM4
LD CR2002                ; 常時ON
SADD *@VM4 *@VM2 *@VM4
LD CR2002                ; 常時ON
LEN *VM0 @VM6
LD CR2002                ; 常時ON
LDA @VM6
CON
SRA K1
CON
STA @VM6
CON
INC @VM6
CON
ADRADD.S @VM6 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM8
LD CR2002                ; 常時ON
SRGHT *@VM4 *@VM8 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM10
LD CR2002                ; 常時ON
LDA @VM10
CON
SRA K1
CON
STA @VM10
CON
INC @VM10
CON
ADRADD.S @VM10 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM12
LD CR2002                ; 常時ON
MOV CR2800 @VM7
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC CM701 *@VM12        ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
PMOV @VM7 K14 CR2800 K14 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM11
LD CR2002                ; 常時ON
LDA @VM11
CON
SRA K1
CON
STA @VM11
CON
INC @VM11
CON
ADRADD.S @VM11 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM14
SMOV "0" *@VM14
LD CR2002                ; 常時ON
SADD *@VM14 *@VM12 *@VM14
LD CR2002                ; 常時ON
LEN *VM0 @VM16
LD CR2002                ; 常時ON
LDA @VM16
CON
SRA K1
CON
STA @VM16
CON
INC @VM16
CON
ADRADD.S @VM16 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM18
LD CR2002                ; 常時ON
SRGHT *@VM14 *@VM18 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM20
LD CR2002                ; 常時ON
LDA @VM20
CON
SRA K1
CON
STA @VM20
CON
INC @VM20
CON
ADRADD.S @VM20 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM22
LD CR2002                ; 常時ON
MOV CR2800 @VM17
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC CM700 *@VM22        ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
PMOV @VM17 K14 CR2800 K14 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM21
LD CR2002                ; 常時ON
LDA @VM21
CON
SRA K1
CON
STA @VM21
CON
INC @VM21
CON
ADRADD.S @VM21 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM24
SMOV "0" *@VM24
LD CR2002                ; 常時ON
SADD *@VM24 *@VM22 *@VM24
LD CR2002                ; 常時ON
LEN *VM0 @VM26
LD CR2002                ; 常時ON
LDA @VM26
CON
SRA K1
CON
STA @VM26
CON
INC @VM26
CON
ADRADD.S @VM26 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM28
LD CR2002                ; 常時ON
SRGHT *@VM24 *@VM28 K2
LD CR2002                ; 常時ON
SADD *@VM28 *@VM18 *@VM28
SADD *@VM28 *@VM8 *@VM28
SMOV *@VM28 @D10         ; 年月日.T
;'時分秒
;
;@D20.T = RIGHT("0"+STR(CM703),2)+RIGHT("0"+STR(CM704),2)+RIGHT("0"+ STR(CM705),2)
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM30
LD CR2002                ; 常時ON
MOV CR2800 @VM27
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC CM705 *@VM30        ; ｶﾚﾝﾀﾞﾀｲﾏ（秒）
PMOV @VM27 K14 CR2800 K14 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM32
LD CR2002                ; 常時ON
LDA @VM32
CON
SRA K1
CON
STA @VM32
CON
INC @VM32
CON
ADRADD.S @VM32 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM34
SMOV "0" *@VM34
LD CR2002                ; 常時ON
SADD *@VM34 *@VM30 *@VM34
LD CR2002                ; 常時ON
LEN *VM0 @VM33
LD CR2002                ; 常時ON
LDA @VM33
CON
SRA K1
CON
STA @VM33
CON
INC @VM33
CON
ADRADD.S @VM33 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM36
LD CR2002                ; 常時ON
SRGHT *@VM34 *@VM36 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM39
LD CR2002                ; 常時ON
LDA @VM39
CON
SRA K1
CON
STA @VM39
CON
INC @VM39
CON
ADRADD.S @VM39 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM40
LD CR2002                ; 常時ON
MOV CR2800 @VM38
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC CM704 *@VM40        ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
PMOV @VM38 K14 CR2800 K14 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM42
LD CR2002                ; 常時ON
LDA @VM42
CON
SRA K1
CON
STA @VM42
CON
INC @VM42
CON
ADRADD.S @VM42 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM44
SMOV "0" *@VM44
LD CR2002                ; 常時ON
SADD *@VM44 *@VM40 *@VM44
LD CR2002                ; 常時ON
LEN *VM0 @VM43
LD CR2002                ; 常時ON
LDA @VM43
CON
SRA K1
CON
STA @VM43
CON
INC @VM43
CON
ADRADD.S @VM43 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM46
LD CR2002                ; 常時ON
SRGHT *@VM44 *@VM46 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM49
LD CR2002                ; 常時ON
LDA @VM49
CON
SRA K1
CON
STA @VM49
CON
INC @VM49
CON
ADRADD.S @VM49 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM50
LD CR2002                ; 常時ON
MOV CR2800 @VM48
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC CM703 *@VM50        ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
PMOV @VM48 K14 CR2800 K14 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM52
LD CR2002                ; 常時ON
LDA @VM52
CON
SRA K1
CON
STA @VM52
CON
INC @VM52
CON
ADRADD.S @VM52 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM54
SMOV "0" *@VM54
LD CR2002                ; 常時ON
SADD *@VM54 *@VM50 *@VM54
LD CR2002                ; 常時ON
LEN *VM0 @VM53
LD CR2002                ; 常時ON
LDA @VM53
CON
SRA K1
CON
STA @VM53
CON
INC @VM53
CON
ADRADD.S @VM53 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM56
LD CR2002                ; 常時ON
SRGHT *@VM54 *@VM56 K2
LD CR2002                ; 常時ON
SADD *@VM56 *@VM46 *@VM56
SADD *@VM56 *@VM36 *@VM56
SMOV *@VM56 @D20         ; 時分秒.T
;'年月日時分秒
;
;@D30.T = @D10.T + @D20.T
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM58
SMOV @D10 *@VM58         ; 年月日.T
LD CR2002                ; 常時ON
SADD *@VM58 @D20 *@VM58  ; 時分秒.T
SMOV *@VM58 @D30         ; 年月日時分秒.T
;
;	ﾌｧｲﾙ名生成
;ZRES(@D50,@D59)	'領域ﾘｾｯﾄ
;@D50.T = LEFT(W27.T,4)
;@D55.T = LEFT(W29.T,6)
LDP CR001                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
NCJ K1000
;ZRES(@D50,@D59)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D50 @D59           ; 製品ﾀｲﾌﾟ#1.T
;@D50.T = LEFT(W27.T,4)
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM62
LD CR2002                ; 常時ON
SLEFT W027 *@VM62 K4     ; PC→PLC ﾀｲﾌﾟ1-2桁目
LD CR2002                ; 常時ON
SMOV *@VM62 @D50         ; 製品ﾀｲﾌﾟ#1.T
;@D55.T = LEFT(W29.T,6)
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM64
LD CR2002                ; 常時ON
SLEFT W029 *@VM64 K6     ; PC→PLC ｼﾘｱﾙ1-2桁目
LD CR2002                ; 常時ON
SMOV *@VM64 @D55         ; 製品ｼﾘｱﾙ#1.T
LABEL K1000
;
;ZRES(@D100,@D199)	'領域ﾘｾｯﾄ
;@D100.T = "log0\log000.csv"
;@D150.T = @D30.T + "_" + @D50.T + "_" + @D55.T + ".csv"
LDP CR001                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
NCJ K1001
;ZRES(@D100,@D199)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D100 @D199         ; 変更前ﾌｧｲﾙ名#1.T
;@D100.T = "log0\log000.csv"
;
LD CR2002                ; 常時ON
SMOV "log0\log000.csv" @D100;変更前ﾌｧｲﾙ名#1.T
;@D150.T = @D30.T + "_" + @D50.T + "_" + @D55.T + ".csv"
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM60
SMOV @D30 *@VM60         ; 年月日時分秒.T
LD CR2002                ; 常時ON
SADD *@VM60 "_" *@VM60
SADD *@VM60 @D50 *@VM60  ; 製品ﾀｲﾌﾟ#1.T
SADD *@VM60 "_" *@VM60
SADD *@VM60 @D55 *@VM60  ; 製品ｼﾘｱﾙ#1.T
SADD *@VM60 ".csv" *@VM60
SMOV *@VM60 @D150        ; 変更後ﾌｧｲﾙ名#1.T
LABEL K1001
;
;	ﾘﾈｰﾑ
LD @M101                 ; ﾘﾈｰﾑ処理要求#1
ANB CR3214               ; ﾒﾓﾘｶｰﾄﾞ命令実行中
MREN @D100 @D150 @M10    ; 変更前ﾌｧｲﾙ名#1.T  変更後ﾌｧｲﾙ名#1.T  ﾘﾈｰﾑ完了#1
LDB @M101                ; ﾘﾈｰﾑ処理要求#1
RES @M10                 ; ﾘﾈｰﾑ完了#1
;	ﾌｧｲﾙ名生成
;ZRES(@D60,@D69)	'領域ﾘｾｯﾄ
;@D60.T = LEFT(W27.T,4)
;@D65.T = LEFT(W29.T,6)
LDP CR101                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ1 動作中
NCJ K1002
;ZRES(@D60,@D69)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D60 @D69           ; 製品ﾀｲﾌﾟ#2.T
;@D60.T = LEFT(W27.T,4)
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM84
LD CR2002                ; 常時ON
SLEFT W027 *@VM84 K4     ; PC→PLC ﾀｲﾌﾟ1-2桁目
LD CR2002                ; 常時ON
SMOV *@VM84 @D60         ; 製品ﾀｲﾌﾟ#2.T
;@D65.T = LEFT(W29.T,6)
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM86
LD CR2002                ; 常時ON
SLEFT W029 *@VM86 K6     ; PC→PLC ｼﾘｱﾙ1-2桁目
LD CR2002                ; 常時ON
SMOV *@VM86 @D65         ; 製品ｼﾘｱﾙ#2.T
LABEL K1002
;
;ZRES(@D200,@D299)	'領域ﾘｾｯﾄ
;@D200.T = "log1\log000.csv"
;@D250.T = @D30.T + "_" + @D60.T + "_" + @D65.T + ".csv"
LDP CR101                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ1 動作中
NCJ K1003
;ZRES(@D200,@D299)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D200 @D299         ; 変更前ﾌｧｲﾙ名#2.T
;@D200.T = "log1\log000.csv"
;
LD CR2002                ; 常時ON
SMOV "log1\log000.csv" @D200;変更前ﾌｧｲﾙ名#2.T
;@D250.T = @D30.T + "_" + @D60.T + "_" + @D65.T + ".csv"
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM66
SMOV @D30 *@VM66         ; 年月日時分秒.T
LD CR2002                ; 常時ON
SADD *@VM66 "_" *@VM66
SADD *@VM66 @D60 *@VM66  ; 製品ﾀｲﾌﾟ#2.T
SADD *@VM66 "_" *@VM66
SADD *@VM66 @D65 *@VM66  ; 製品ｼﾘｱﾙ#2.T
SADD *@VM66 ".csv" *@VM66
SMOV *@VM66 @D250        ; 変更後ﾌｧｲﾙ名#2.T
LABEL K1003
;
;	ﾘﾈｰﾑ
LD @M201                 ; ﾘﾈｰﾑ処理要求#2
ANB CR3214               ; ﾒﾓﾘｶｰﾄﾞ命令実行中
MREN @D200 @D250 @M20    ; 変更前ﾌｧｲﾙ名#2.T  変更後ﾌｧｲﾙ名#2.T  ﾘﾈｰﾑ完了#2
LDB @M201                ; ﾘﾈｰﾑ処理要求#2
RES @M20                 ; ﾘﾈｰﾑ完了#2
;<h1/>▽_日常点検_結果保存 / Daily check _ result save
;	PLCのﾛｷﾞﾝｸﾞ機能で作成したCSVﾌｧｲﾙをﾘﾈｰﾑする
;	
;	保存ﾌｫﾙﾀﾞ
;			ﾌﾟﾚｽ1： log0\
;	
;	変更前ﾌｧｲﾙ名
;			ﾌﾟﾚｽ1：	log000.csv
;			
;	変更後ﾌｧｲﾙ名
;			ﾌﾟﾚｽ1：	(INDEX No)_ROBO1_(年月日時分秒).csv
;<h1/>__▽_動作回路 / Operation circuit
;  始業点検中のロギング完了をトリガとして回路発動
;
LDF CR001                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ0 動作中
ORF CR101                ; ﾛｷﾞﾝｸﾞ･ﾄﾚｰｽ1 動作中
AND M150                 ; 日常点検1ﾓｰﾄﾞ
OR @M400                 ; 日常点検_ﾘﾈｰﾑ処理中
ANB @M402                ; 日常点検_#1ﾘﾈｰﾑ処理完了
OUT @M400                ; 日常点検_ﾘﾈｰﾑ処理中
;	ﾘﾈｰﾑ処理 / Rename process
LD @M400                 ; 日常点検_ﾘﾈｰﾑ処理中
OR @M401                 ; 日常点検_#1ﾘﾈｰﾑ処理要求
ANB @M402                ; 日常点検_#1ﾘﾈｰﾑ処理完了
OUT @M401                ; 日常点検_#1ﾘﾈｰﾑ処理要求
LD @M401                 ; 日常点検_#1ﾘﾈｰﾑ処理要求
AND @M40                 ; 日常点検_ﾘﾈｰﾑ完了#1
OR @M402                 ; 日常点検_#1ﾘﾈｰﾑ処理完了
AND @M400                ; 日常点検_ﾘﾈｰﾑ処理中
OUT @M402                ; 日常点検_#1ﾘﾈｰﾑ処理完了
;<h1/>____▽_ﾘﾈｰﾑ処理 / Rename process
;	ﾌｧｲﾙ名生成 / File name generation
LD X101                  ; INDEX 旋回戻端
MOV K2 @D699             ; INDEX判定
LD X100                  ; INDEX 旋回端
MOV K1 @D699             ; INDEX判定
;ZRES(@D700,@D799)	'領域ﾘｾｯﾄ
;@D700.T = "log0\log000.csv"
;@D750.T = "Daily-INDEX" + STR(@D699) + "_" + @D30.T + ".csv"
LDP @M400                ; 日常点検_ﾘﾈｰﾑ処理中
NCJ K1006
;ZRES(@D700,@D799)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D700 @D799         ; 日常点検_RB1変更前ﾌｧｲﾙ名.T
;@D700.T = "log0\log000.csv"
;
LD CR2002                ; 常時ON
SMOV "log0\log000.csv" @D700;日常点検_RB1変更前ﾌｧｲﾙ名.T
;@D750.T = "Daily-INDEX" + STR(@D699) + "_" + @D30.T + ".csv"
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM70
LD CR2002                ; 常時ON
MOV CR2800 @VM68
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC @D699 *@VM70        ; INDEX判定
PMOV @VM68 K14 CR2800 K14 K2
LD CR2002                ; 常時ON
LEN *VM0 @VM69
LD CR2002                ; 常時ON
LDA @VM69
CON
SRA K1
CON
STA @VM69
CON
INC @VM69
CON
ADRADD.S @VM69 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM72
SMOV "Daily-INDEX" *@VM72
LD CR2002                ; 常時ON
SADD *@VM72 *@VM70 *@VM72
SADD *@VM72 "_" *@VM72
SADD *@VM72 @D30 *@VM72  ; 年月日時分秒.T
SADD *@VM72 ".csv" *@VM72
SMOV *@VM72 @D750        ; 日常点検_RB1変更後ﾌｧｲﾙ名.T
LABEL K1006
;
;	ﾘﾈｰﾑ / Rename
LD @M401                 ; 日常点検_#1ﾘﾈｰﾑ処理要求
ANB CR3214               ; ﾒﾓﾘｶｰﾄﾞ命令実行中
MREN @D700 @D750 @M40    ; 日常点検_RB1変更前ﾌｧｲﾙ名.T  日常点検_RB1変更後ﾌｧｲﾙ名.T  日常点検_ﾘﾈｰﾑ完了#1
LDB @M401                ; 日常点検_#1ﾘﾈｰﾑ処理要求
RES @M40                 ; 日常点検_ﾘﾈｰﾑ完了#1
;<h1/>▽_日常点検_CSV出力 / Daily check _ CSV output
;	日常点検の実行結果をSDｶｰﾄﾞへCSV形式で保存する
;	
;	保存ﾌｫﾙﾀﾞ：	\
;	ﾌｧｲﾙ名：	Daily_check_result_(年月日時分秒).csv
;	
;	ﾃﾞｰﾀ生成 / Data generation
;ZRES(@D500,@D549)	'領域ﾘｾｯﾄ
;'ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名生成
;@D500.T = "log0\Daily_check_result_" + @D30.T
;
;'保存形式
;@D550 = 5	'32bit符号なしﾊﾞｲﾅﾘ
;
;'書込みﾓｰﾄﾞ
;@D551 = 0	'追加ﾓｰﾄﾞ
;
;'ｵﾌﾟｼｮﾝ
;@D552 = 1	'末尾に改行挿入
;
;'書込みﾃﾞｰﾀ数
;@D556 = 4	'1ST * 2
LDP @M511                ; [1]CSV出力中
NCJ K1008
;ZRES(@D500,@D549)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D500 @D549         ; ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名
;'ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名生成
;
;@D500.T = "log0\Daily_check_result_" + @D30.T
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM74
SMOV "log0\Daily_check_result_" *@VM74
LD CR2002                ; 常時ON
SADD *@VM74 @D30 *@VM74  ; 年月日時分秒.T
SMOV *@VM74 @D500        ; ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名
;'保存形式
;
;@D550 = 5	'32bit符号なしﾊﾞｲﾅﾘ
;
LD CR2002                ; 常時ON
MOV K5 @D550             ; 保存形式
;'書込みﾓｰﾄﾞ
;
;@D551 = 0	'追加ﾓｰﾄﾞ
;
LD CR2002                ; 常時ON
MOV K0 @D551             ; 書込みﾓｰﾄﾞ
;'ｵﾌﾟｼｮﾝ
;
;@D552 = 1	'末尾に改行挿入
;
LD CR2002                ; 常時ON
MOV K1 @D552             ; ｵﾌﾟｼｮﾝ
;'書込みﾃﾞｰﾀ数
;
;@D556 = 4	'1ST * 2
LD CR2002                ; 常時ON
MOV K4 @D556             ; 書込みﾃﾞｰﾀ数
LABEL K1008
;
;ZRES(@D600,@D699)	'領域ﾘｾｯﾄ
;
;'ﾍｯﾀﾞ記録用ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名生成
;@D600.T = @D500.T + ".csv"
;
;'ﾍｯﾀﾞ書込みﾃﾞｰﾀ
;@D650.T = "ST1_1,ST2_1"
;@D650.T += CHR($0D) + CHR($0A)	'改行
LDP @M511                ; [1]CSV出力中
NCJ K1009
;ZRES(@D600,@D699)	'領域ﾘｾｯﾄ
;
LD CR2002                ; 常時ON
ZRES @D600 @D699         ; ﾍｯﾀﾞ記録用ﾌｧｲﾙ名  INDEX判定
;'ﾍｯﾀﾞ記録用ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名生成
;
;@D600.T = @D500.T + ".csv"
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM76
SMOV @D500 *@VM76        ; ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名
LD CR2002                ; 常時ON
SADD *@VM76 ".csv" *@VM76
SMOV *@VM76 @D600        ; ﾍｯﾀﾞ記録用ﾌｧｲﾙ名
;'ﾍｯﾀﾞ書込みﾃﾞｰﾀ
;
;@D650.T = "ST1_1,ST2_1"
;
LD CR2002                ; 常時ON
SMOV "ST1_1,ST2_1" @D650 ; ﾍｯﾀﾞ書込みﾃﾞｰﾀ
;@D650.T += CHR($0D) + CHR($0A)	'改行
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV K0 VM2
MOV.D VM0 @VM80
LD CR2002                ; 常時ON
LDA H000A
CON
SLA K8
CON
STA @VM78
CON
SMOV @VM78 *@VM80
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM82
LD CR2002                ; 常時ON
LDA H000D
CON
SLA K8
CON
STA @VM79
CON
SMOV @VM79 *@VM82
LD CR2002                ; 常時ON
SADD *@VM82 *@VM80 *@VM82
SADD @D650 *@VM82 @D650  ; ﾍｯﾀﾞ書込みﾃﾞｰﾀ  ﾍｯﾀﾞ書込みﾃﾞｰﾀ
LABEL K1009
;
;<h1/>__▽_CSV出力_動作回路 / CSV output _ operation circuit
;	要求受付 / Request reception
LD M3478                 ; 判断OK
OUT @M510                ; [0]CSV出力要求受付
;	処理開始 / Processing start
LDP @M510                ; [0]CSV出力要求受付
OR @M511                 ; [1]CSV出力中
ANB @M514                ; [4]書込み完了
OUT @M511                ; [1]CSV出力中
;	初期化 / Initialize
LDP @M511                ; [1]CSV出力中
ZRES @M500 @M503         ; ﾌｧｲﾙ書込み完了通知  ﾍｯﾀﾞ書込みｴﾗｰ通知
;	ﾍｯﾀﾞ書込み / Header write
LD @M511                 ; [1]CSV出力中
OR @M512                 ; [2]ﾍｯﾀﾞ書込み
AND @M511                ; [1]CSV出力中
MPS
OUT @M512                ; [2]ﾍｯﾀﾞ書込み
MPP
ANB @M502                ; ﾍｯﾀﾞ書込み完了通知
ONDL K10 @M520           ; ﾍｯﾀﾞ書込み要求
;	記録書込み / Record writing
LD @M512                 ; [2]ﾍｯﾀﾞ書込み
AND @M502                ; ﾍｯﾀﾞ書込み完了通知
OR @M513                 ; [3]記録書込み
AND @M511                ; [1]CSV出力中
MPS
OUT @M513                ; [3]記録書込み
MPP
ANB @M500                ; ﾌｧｲﾙ書込み完了通知
ONDL K10 @M521           ; 記録書込み要求
;	書込み完了 / Write complete
LD @M513                 ; [3]記録書込み
AND @M500                ; ﾌｧｲﾙ書込み完了通知
OR @M514                 ; [4]書込み完了
AND @M511                ; [1]CSV出力中
OUT @M514                ; [4]書込み完了
;<h1/>____▽_ﾍｯﾀﾞ書込み / Header write
LD @M520                 ; ﾍｯﾀﾞ書込み要求
ANB CR3214               ; ﾒﾓﾘｶｰﾄﾞ命令実行中
MPRINT @D600 @D650 @M502 ; ﾍｯﾀﾞ記録用ﾌｧｲﾙ名  ﾍｯﾀﾞ書込みﾃﾞｰﾀ  ﾍｯﾀﾞ書込み完了通知
;<h1/>____▽_記録書込み / Record writing
LD @M521                 ; 記録書込み要求
ANB CR3214               ; ﾒﾓﾘｶｰﾄﾞ命令実行中
MWRIT @D500 D3222 @D556 @D550 @M500;ﾌｫﾙﾀﾞｰ + ﾌｧｲﾙ名  日常判定1結果  書込みﾃﾞｰﾀ数  保存形式  ﾌｧｲﾙ書込み完了通知
END
ENDH
