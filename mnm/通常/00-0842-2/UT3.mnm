DEVICE:51
;MODULE:UT3
;MODULE_TYPE:0
;
;非常停止　Emergency Stop
;
LD R50010                ; Emargency　Stop
OR @MR001                ; 001
ZRES @MR002 @MR6915
CON
OUT @MR001               ; 001
TMR @0 #5                ; ｳｴｲﾄﾀｲﾏｰ00
LD @T0                   ; ｳｴｲﾄﾀｲﾏｰ00
MDSTOP UT3
;***************************************
; 原点復帰動作
;  HOME RETURN OPERATION 
;***************************************
;HOME
LD R50003                ; 原点復帰
ANB R50203               ; ST3 Do
SET R50203               ; ST3 Do
CON
SET @MR1000              ; 原点復帰開始
LDB R50003               ; 原点復帰
ANB R50001               ; AUTO　MODE
ANB R50002               ; STEP
AND @MR1015              ; 原点復帰完了
RES R50203               ; ST3 Do
CON
RES @MR1015              ; 原点復帰完了
STG @MR1000              ; 原点復帰開始
ANB R50300               ; 一時停止中
ANB R50113               ; ST3部ｴﾗｰ発生中
MPS
AND R1212                ; ｻｰﾎﾞﾌﾟﾚｽ運転準備可
JMP @MR1002              ; 1002
MPP
ANB R1212                ; ｻｰﾎﾞﾌﾟﾚｽ運転準備可
SET @MR100               ; ｻｰﾎﾞﾌﾟﾚｽ準備要求
CON
JMP @MR1001              ; 1001
STG @MR1001              ; 1001
AND @MR107               ; ｴﾗｰ20解除
RES @MR107               ; ｴﾗｰ20解除
CON
JMP @MR1000              ; 原点復帰開始
STG @MR1002              ; 1002
ANB R50300               ; 一時停止中
ANB R50113               ; ST3部ｴﾗｰ発生中
SET R50413               ; ST3        1ｻｲｸﾙ終了
CON
SET @MR1015              ; 原点復帰完了
CON
ENDS
;***************************************
; 自動運転
;  AUTO OPERATION 
;***************************************
;AUTO
LD R50001                ; AUTO　MODE
ANB R50203               ; ST3 Do
SET R50203               ; ST3 Do
CON
SET @MR2000              ; 2000
LDB R50003               ; 原点復帰
ANB R50001               ; AUTO　MODE
ANB R50002               ; STEP
AND @MR2915              ; AUTO運転終了
RES R50203               ; ST3 Do
CON
RES @MR2915              ; AUTO運転終了
CON
RES @MR5505              ; ﾌｨﾙﾑ搬送切断Hold
;動作パラメーター確認
;0通常動作
;1払い出し
;
LD @MR2000               ; 2000
TMR @29 #1               ; ｳｴｲﾄﾀｲﾏｰ29
CON
AND @T29                 ; ｳｴｲﾄﾀｲﾏｰ29
DIFU @MR2001             ; 2001
LD @MR2001               ; 2001
SET @MR2002              ; 2002
STG @MR2002              ; 2002
MPS
AND R50209               ; 動作開始
RES @MR2000              ; 2000
CON
JMP @MR2003              ; 2003
MPP
LDB R50209               ; 動作開始
AND R50000               ; HOLD
ANL
RES @MR2000              ; 2000
CON
JMP @MR2908              ; 2908
STG @MR2003              ; 2003
MPS
AND R1214                ; ｻｰﾎﾞﾌﾟﾚｽ自動運転準備可
JMP @MR2200              ; 2200
MPP
ANB R1214                ; ｻｰﾎﾞﾌﾟﾚｽ自動運転準備可
SET @MR200               ; ｴﾗｰ23
CON
JMP @MR2004              ; 2004
STG @MR2004              ; 2004
AND @MR207               ; ｴﾗｰ23解除
RES @MR207               ; ｴﾗｰ23解除
CON
JMP @MR2003              ; 2003
;***** ﾜｰｸ有ﾁｪｯｸ / Work check *****
;
STG @MR2200              ; 2200
ANB R50300               ; 一時停止中
ANB R50113               ; ST3部ｴﾗｰ発生中
MPS
AND R1409                ; 3ST部　ﾛｰﾀｺｱ有無検出
JMP @MR2209              ; 2209
MPP
ANB R1409                ; 3ST部　ﾛｰﾀｺｱ有無検出
TMR #210 #20
CON
AND T210
JMP @MR2907              ; 2907
;***** ﾜｰｸ浮きﾁｪｯｸ/ work flote check*****
;
STG @MR2209              ; 2209
ANB R50300               ; 一時停止中
ANB R50113               ; ST3部ｴﾗｰ発生中
MPS
LD R1410                 ; 3ST部　ﾛｰﾀｺｱ浮き検出-1
AND R1411                ; 3ST部　ﾛｰﾀｺｱ浮き検出-2
ANL
JMP @MR2300              ; 2300
MPP
LDB R1410                ; 3ST部　ﾛｰﾀｺｱ浮き検出-1
ORB R1411                ; 3ST部　ﾛｰﾀｺｱ浮き検出-2
ANL
TMR #215 #5
CON
AND T215
SET @MR108               ; ｴﾗｰ21
CON
JMP @MR4104              ; 4104
STG @MR4104              ; 4104
AND @MR115               ; ｴﾗｰ21解除
RES @MR115               ; ｴﾗｰ21解除
CON
JMP @MR2209              ; 2209
STG @MR2300              ; 2300
RES R55008               ; TP 3ST停止中表示
CON
SET R55007               ; TP 3ST動作中表示
CON
SET @MR2215              ; 一時停止禁止
CON
SET MR6203               ; ｻｰﾎﾞﾌﾟﾚｽ　ｽﾀｰﾄ信号
CON
SET MR1012               ; ｻｰﾎﾞﾌﾟﾚｽ監視
CON
JMP @MR2301              ; 2301
STG @MR2301              ; 2301
MPS
LD<= DM750 DM28030       ; 上昇切替え設定値  ﾛｰﾄﾞｾﾙ現在値
AND CR2003               ; 常時OFF
ANL
SET MR6204               ; ｻｰﾎﾞﾌﾟﾚｽ　下降停止
CON
JMP @MR2302              ; 2302
MRD
AND R1213                ; ｻｰﾎﾞ上昇開始
JMP @MR2302              ; 2302
MPP
AND R1201                ; ｻｰﾎﾞﾌﾟﾚｽ　下死点検出
JMP @MR2302              ; 2302
STG @MR2302              ; 2302
MPS
AND= DM609 #1            ; INDEX位置記憶
RES MR6402               ; ﾀﾞｲｾｯﾄ3　位置決め　上昇　
CON
RES MR6203               ; ｻｰﾎﾞﾌﾟﾚｽ　ｽﾀｰﾄ信号
CON
JMP @MR2303              ; 2303
MRD
AND= DM609 #2            ; INDEX位置記憶
RES MR6403               ; ﾀﾞｲｾｯﾄ4　位置決め　上昇　
CON
RES MR6203               ; ｻｰﾎﾞﾌﾟﾚｽ　ｽﾀｰﾄ信号
CON
JMP @MR2303              ; 2303
MRD
AND= DM609 #3            ; INDEX位置記憶
RES MR6400               ; ﾀﾞｲｾｯﾄ1　位置決め　上昇　
CON
RES MR6203               ; ｻｰﾎﾞﾌﾟﾚｽ　ｽﾀｰﾄ信号
CON
JMP @MR2303              ; 2303
MPP
AND= DM609 #4            ; INDEX位置記憶
RES MR6401               ; ﾀﾞｲｾｯﾄ2　位置決め　上昇　
CON
RES MR6203               ; ｻｰﾎﾞﾌﾟﾚｽ　ｽﾀｰﾄ信号
CON
JMP @MR2303              ; 2303
STG @MR2303              ; 2303
AND R1200                ; ｻｰﾎﾞﾌﾟﾚｽ　上死点検出
MPS
LD= DM6500 #1            ; ｼｬﾌﾄ品種設定
AND>= DM29030 DM29010    ; L勘合MAX  圧入範囲勘合MAX値
AND>= DM29010 DM29032    ; 圧入範囲勘合MAX値  L勘合MIN
ANL
JMP @MR2304              ; 2304
MRD
LD= DM6500 #2            ; ｼｬﾌﾄ品種設定
AND>= DM29034 DM29010    ; S勘合MAX  圧入範囲勘合MAX値
AND>= DM29010 DM29036    ; 圧入範囲勘合MAX値  S勘合MIN
ANL
JMP @MR2304              ; 2304
MRD
LD= DM6500 #3            ; ｼｬﾌﾄ品種設定
AND>= DM29038 DM29010    ; C勘合MAX  圧入範囲勘合MAX値
AND>= DM29010 DM29040    ; 圧入範囲勘合MAX値  C勘合MIN
ANL
JMP @MR2304              ; 2304
MRD
LD= DM6500 #4            ; ｼｬﾌﾄ品種設定
AND>= DM29042 DM29010    ; D勘合MAX  圧入範囲勘合MAX値
AND>= DM29010 DM29042    ; 圧入範囲勘合MAX値  D勘合MAX
ANL
JMP @MR2304              ; 2304
MRD
AND= DM6500 #1           ; ｼｬﾌﾄ品種設定
MPS
AND< DM29030 DM29010     ; L勘合MAX  圧入範囲勘合MAX値
LDA.L +99999
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
MPP
AND< DM29010 DM29032     ; 圧入範囲勘合MAX値  L勘合MIN
LDA.L +88888
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
MRD
AND= DM6500 #2           ; ｼｬﾌﾄ品種設定
MPS
AND< DM29034 DM29010     ; S勘合MAX  圧入範囲勘合MAX値
LDA.L +99999
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
MPP
AND< DM29010 DM29036     ; 圧入範囲勘合MAX値  S勘合MIN
LDA.L +88888
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
MRD
AND= DM6500 #3           ; ｼｬﾌﾄ品種設定
MPS
AND< DM29038 DM29010     ; C勘合MAX  圧入範囲勘合MAX値
LDA.L +99999
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
MPP
AND< DM29010 DM29040     ; 圧入範囲勘合MAX値  C勘合MIN
LDA.L +88888
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
MPP
AND= DM6500 #4           ; ｼｬﾌﾄ品種設定
MPS
AND< DM29042 DM29010     ; D勘合MAX  圧入範囲勘合MAX値
LDA.L +99999
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
MPP
AND< DM29010 DM29044     ; 圧入範囲勘合MAX値  D勘合MIN
LDA.L +88888
CON
STA.L DM6802
CON
JMP @MR2304              ; 2304
STG @MR2304              ; 2304
RES MR6203               ; ｻｰﾎﾞﾌﾟﾚｽ　ｽﾀｰﾄ信号
CON
RES MR1012               ; ｻｰﾎﾞﾌﾟﾚｽ監視
CON
RES @MR2215              ; 一時停止禁止
CON
JMP @MR2907              ; 2907
STG @MR2907              ; 2907
RES R55007               ; TP 3ST動作中表示
CON
SET R55008               ; TP 3ST停止中表示
CON
SET R50413               ; ST3        1ｻｲｸﾙ終了
CON
JMP @MR2908              ; 2908
STG @MR2908              ; 2908
ANB R50209               ; 動作開始
ANB R50413               ; ST3        1ｻｲｸﾙ終了
MPS
ANB R50000               ; HOLD
SET @MR2000              ; 2000
CON
ENDS
MPP
AND R50000               ; HOLD
JMP @MR2909              ; 2909
;終了処理
STG @MR2909              ; 2909
RES @MR2015              ; 2回目以降動作
CON
SET @MR2915              ; AUTO運転終了
CON
ENDS
;ｴﾗｰ表示ｻﾌﾞﾙｰﾁﾝ  /  Erorr Subroutine
;
;***** ｻｰﾎﾞﾌﾟﾚｽ準備要求  ERROR NO 21  *****
;
STG @MR100               ; ｻｰﾎﾞﾌﾟﾚｽ準備要求
ANB R50008               ; 全体ERROR
SET @MR201               ; ｴﾗｰ23
CON
SET R50008               ; 全体ERROR
CON
SET R50113               ; ST3部ｴﾗｰ発生中
CON
SET R50605               ; Err21
CON
JMP @MR102
MOV #21 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR102
AND R50008               ; 全体ERROR
JMP @MR103
STG @MR103
ANB R50008               ; 全体ERROR
RES @MR201               ; ｴﾗｰ23
CON
SET @MR107               ; ｴﾗｰ20解除
CON
ENDS
;***** ﾜｰｸ浮き異常表示  ERROR NO 22  *****
;
STG @MR108               ; ｴﾗｰ21
ANB R50008               ; 全体ERROR
SET @MR109               ; ｴﾗｰ21
CON
SET R50008               ; 全体ERROR
CON
SET R50113               ; ST3部ｴﾗｰ発生中
CON
SET R50606               ; Err22
CON
JMP @MR110
MOV #22 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR110
AND R50008               ; 全体ERROR
JMP @MR111
STG @MR111
ANB R50008               ; 全体ERROR
RES @MR109               ; ｴﾗｰ21
CON
SET @MR115               ; ｴﾗｰ21解除
CON
ENDS
;***** ｻｰﾎﾞﾌﾟﾚｽ自動運転不可  ERROR NO 22  *****
;
STG @MR200               ; ｴﾗｰ23
ANB R50008               ; 全体ERROR
SET @MR201               ; ｴﾗｰ23
CON
SET R50008               ; 全体ERROR
CON
SET R50113               ; ST3部ｴﾗｰ発生中
CON
SET R50607               ; Err23
CON
JMP @MR202               ; 202
MOV #23 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR202               ; 202
AND R50008               ; 全体ERROR
JMP @MR203               ; 203
STG @MR203               ; 203
ANB R50008               ; 全体ERROR
RES @MR201               ; ｴﾗｰ23
CON
SET @MR207               ; ｴﾗｰ23解除
CON
ENDS
;一時停止禁止処理
;
LD @MR2215               ; 一時停止禁止
OUT R50103               ; PACK UT3
END
ENDH
