DEVICE:51
;MODULE:Master
;MODULE_TYPE:0
LD R50010                ; Emargency　Stop
ZRES @MR000 @MR915       ; AUTO PLS
;ﾒｲﾝ ﾀｽｸ制御
LD R50001                ; AUTO　MODE
DIFU @MR000              ; AUTO PLS
LD @MR000                ; AUTO PLS
ORP @MR004               ; AUTO 1CYCLE　PLS
ORP R50003               ; 原点復帰
ANB R50209               ; 動作開始
RES @MR004               ; AUTO 1CYCLE　PLS
CON
SET R50209               ; 動作開始
;ﾀｽｸ制御
LDP R50209               ; 動作開始
LD R50001                ; AUTO　MODE
OR R50003                ; 原点復帰
ANL
MDSTRT UT1
MDSTRT UT2
MDSTRT UT3
MDSTRT UT4
RES R50409               ; ｻｲｸﾙ完了
CON
SET @MR001               ; 001
STG @MR001               ; 001
AND R50411               ; ST1        1ｻｲｸﾙ終了
AND R50412               ; ST2        1ｻｲｸﾙ終了
AND R50413               ; ST3        1ｻｲｸﾙ終了
AND R50414               ; ST4        1ｻｲｸﾙ終了
TMH @2 #20               ; ｳｴｲﾄﾀｲﾏｰ02
CON
AND @T2                  ; ｳｴｲﾄﾀｲﾏｰ02
JMP @MR002               ; 002
MDSTRT Index
STG @MR002               ; 002
RES R50411               ; ST1        1ｻｲｸﾙ終了
CON
RES R50412               ; ST2        1ｻｲｸﾙ終了
CON
RES R50413               ; ST3        1ｻｲｸﾙ終了
CON
RES R50414               ; ST4        1ｻｲｸﾙ終了
CON
RES R50209               ; 動作開始
CON
AND R50410               ; INDEX     　 1ｻｲｸﾙ終了
JMP @MR003               ; 003
MDSTOP Index
STG @MR003               ; 003
RES R50410               ; INDEX     　 1ｻｲｸﾙ終了
CON
SET R50409               ; ｻｲｸﾙ完了
CON
ANB _Index
TMH @0 #50               ; Start SW(L)確認ﾀｲﾏｰ
CON
AND @T0                  ; Start SW(L)確認ﾀｲﾏｰ
RES R50200               ; INDEX Do
CON
JMP @MR005
STG @MR005
MPS
LD R50001                ; AUTO　MODE
ANB R50000               ; HOLD
ANL
SET @MR004               ; AUTO 1CYCLE　PLS
CON
ENDS
MPP
ENDS
;運転停止処理
LD R50002                ; STEP
LDP R1003                ; 操作BOX  停止ｽｲｯﾁ
ORP R1001                ; 操作BOX  手動運転選択
ORP R50009               ; HOLDRQ
ANL
ORP R50003               ; 原点復帰
SET R50000               ; HOLD
LD R50001                ; AUTO　MODE
LDP R1003                ; 操作BOX  停止ｽｲｯﾁ
ORP R1001                ; 操作BOX  手動運転選択
ORP R50009               ; HOLDRQ
ANL
LDA #0
CON
STA DM834                ; 定停止時 ｲﾝﾃﾞｯｸｽ回転数
CON
SET R50014               ; 停止SW
CON
SET R49915               ; ﾛｰﾀｺｱ供給停止
LD R49915                ; ﾛｰﾀｺｱ供給停止
AND>= DM834 #6           ; 定停止時 ｲﾝﾃﾞｯｸｽ回転数
SET R51205               ; 定停止ﾌﾗｸﾞ
LD R50001                ; AUTO　MODE
AND R51205               ; 定停止ﾌﾗｸﾞ
LDA #0
CON
STA DM834                ; 定停止時 ｲﾝﾃﾞｯｸｽ回転数
CON
SET R50215               ; AUTO停止補助
CON
SET R50000               ; HOLD
LDP R50000               ; HOLD
RES R51205               ; 定停止ﾌﾗｸﾞ
CON
RES R49915               ; ﾛｰﾀｺｱ供給停止
CON
RES R50006               ; 自動運転可能
CON
RES R50009               ; HOLDRQ
LDB R50004               ; TASKDO
OR R50308                ; タスク停止待ち
RES R50014               ; 停止SW
CON
RES R50001               ; AUTO　MODE
CON
RES R50002               ; STEP
LD R50106                ; 停止表示
TMR #301 #10
CON
AND T301
RES R50106               ; 停止表示
LD R50003                ; 原点復帰
LDB R50004               ; TASKDO
OR R50308                ; タスク停止待ち
ANL
TMR #302 #5
CON
AND T302
RES R50003               ; 原点復帰
CON
RES R50409               ; ｻｲｸﾙ完了
CON
SET R50005               ; 原点復帰完了
CON
SET R50007               ; 原点復帰　完了
;各ﾕﾆｯﾄ停止
LD R50001                ; AUTO　MODE
AND R50409               ; ｻｲｸﾙ完了
AND R50000               ; HOLD
LD R50002                ; STEP
OR R50003                ; 原点復帰
AND R50409               ; ｻｲｸﾙ完了
ORL
RES R50409               ; ｻｲｸﾙ完了
CON
RES R50209               ; 動作開始
CON
SET R50308               ; タスク停止待ち
LD R50308                ; タスク停止待ち
ANB R50201               ; ST1 Do
ANB R50202               ; ST2 Do
ANB R50203               ; ST3 Do
ANB R50204               ; ST4 Do
RES R50308               ; タスク停止待ち
CON
RES R50004               ; TASKDO
CON
RES R50000               ; HOLD
CON
DIFU @MR103              ; 103
STG @MR103               ; 103
MPS
AND R50215               ; AUTO停止補助
JMP @MR104               ; 104
MRD
ANB R50215               ; AUTO停止補助
JMP @MR105
MRD
MDSTOP UT1
MRD
MDSTOP UT2
MRD
MDSTOP UT3
MRD
MDSTOP UT4
MPP
MDSTOP Index
STG @MR104               ; 104
ANB _UT1
ANB _UT2
ANB _UT3
ANB _UT4
ANB _Index
SET MR1900               ; ｺﾝﾍﾞｱ停止ｳｪｲﾄ
CON
RES R50409               ; ｻｲｸﾙ完了
CON
RES R50205               ; INDEX Do　   (STEP)
CON
ENDS
STG @MR105
ANB _UT1
ANB _UT2
ANB _UT3
ANB _UT4
ANB _Index
RES R50409               ; ｻｲｸﾙ完了
CON
RES R50205               ; INDEX Do　   (STEP)
CON
ENDS
LD MR1900                ; ｺﾝﾍﾞｱ停止ｳｪｲﾄ
ANB R1712                ; ｽﾃｰﾀ排出CV　除材位置ﾜｰｸ有無
TMR #125 #100
LD MR1900                ; ｺﾝﾍﾞｱ停止ｳｪｲﾄ
LDB R1714                ; 取り出し位置ﾜｰｸ有無
OR MR915                 ; ﾀﾞﾐｰ
ORB T48                  ; 次工程搬送CV部　ﾛｰﾀ満杯ﾃﾞｨﾚｲ
ANL
TMR #126 #100
LD R1712                 ; ｽﾃｰﾀ排出CV　除材位置ﾜｰｸ有無
OR MR1800                ; 除材位置ﾜｰｸ有無OFFﾃﾞｨﾚｲ
OUT MR1805               ; ｽﾃｰﾀｺﾝﾍﾞｱ停止
LD R1714                 ; 取り出し位置ﾜｰｸ有無
OR MR1801                ; 取り出し位置ﾜｰｸ有無OFFﾃﾞｨﾚｲ
AND CR2003               ; 常時OFF
OUT MR1806               ; ﾛｰﾀｺﾝﾍﾞｱ停止
LD T125
AND T126
RES MR1900               ; ｺﾝﾍﾞｱ停止ｳｪｲﾄ
CON
RES R50215               ; AUTO停止補助
LDF R1712                ; ｽﾃｰﾀ排出CV　除材位置ﾜｰｸ有無
OR MR1800                ; 除材位置ﾜｰｸ有無OFFﾃﾞｨﾚｲ
ANB T211
OUT MR1800               ; 除材位置ﾜｰｸ有無OFFﾃﾞｨﾚｲ
TMR #211 #10
LDF R1714                ; 取り出し位置ﾜｰｸ有無
AND MR915                ; ﾀﾞﾐｰ
OR T48                   ; 次工程搬送CV部　ﾛｰﾀ満杯ﾃﾞｨﾚｲ
OR MR1801                ; 取り出し位置ﾜｰｸ有無OFFﾃﾞｨﾚｲ
ANB T212
OUT MR1801               ; 取り出し位置ﾜｰｸ有無OFFﾃﾞｨﾚｲ
TMR #212 #10
;原点復帰
LDP R1001                ; 操作BOX  手動運転選択
OR R50210                ; 原点復帰待ち　点滅
ANB R14915               ; 手動操作BOXより有効ｽｲｯﾁ
AND R1001                ; 操作BOX  手動運転選択
LDB R50005               ; 原点復帰完了
ORB R50007               ; 原点復帰　完了
ANL
ANB R50003               ; 原点復帰
OUT R50210               ; 原点復帰待ち　点滅
LD R50210                ; 原点復帰待ち　点滅
ANP R1000                ; 操作BOX  原点復帰ｽｲｯﾁ
DIFU @MR006              ; 006
LD @MR006                ; 006
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50300               ; 一時停止中
ANB R50010               ; Emargency　Stop
AND R1715                ; 元圧確認
AND R1015                ; ﾄﾞｱﾛｯｸ信号
ZRES MR6112 MR6115       ; 投入側ｽﾃｰﾀC/V　回転OFF指令  排出側ﾛｰﾀC/V　回転OFF指令
CON
SET R50003               ; 原点復帰
CON
SET R50004               ; TASKDO
;自動運転
LD R50006                ; 自動運転可能
AND R50007               ; 原点復帰　完了
AND R50005               ; 原点復帰完了
ANB R1001                ; 操作BOX  手動運転選択
@RES R55000              ; TP 回転中表示
CON
@SET R55001              ; TP 停止中表示
CON
@RES R55011              ; TP 1ST供給中
CON
@SET R55012              ; TP　1ST停止中表示
CON
@RES R55009              ; TP 2ST供給中
CON
@SET R55010              ; TP　2ST停止中表示
CON
@RES R55007              ; TP 3ST動作中表示
CON
@SET R55008              ; TP 3ST停止中表示
CON
ANP R1002                ; 操作BOX  運転開始
AND= DM4000 #2           ; 現在表示中画面
ANB R50014               ; 停止SW
MPS
AND CR3213               ; ﾒﾓﾘｶｰﾄﾞあり
MPS
ANB CR3215               ; ﾒﾓﾘｶｰﾄﾞﾗｲﾄﾌﾟﾛﾃｸﾄ
MPS
LDB CR009                ; ﾛｷﾞﾝｸﾞ0ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
ANB CR109                ; ﾛｷﾞﾝｸﾞ1ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
ANL
SET @MR008               ; 008
MPP
LD CR009                 ; ﾛｷﾞﾝｸﾞ0ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
OR CR109                 ; ﾛｷﾞﾝｸﾞ1ﾒﾓﾘｶｰﾄﾞ容量なしｴﾗｰ
ANB @MR102               ; ﾒﾓﾘｶｰﾄﾞ無し
ANB @MR101               ; ﾒﾓﾘｶｰﾄﾞ ﾗｲﾄﾌﾟﾛﾃｸﾄONｴﾗｰ
ANL
SET @MR100               ; ﾒﾓﾘｶｰﾄﾞ 容量無しｴﾗｰ
MPP
LD CR3215                ; ﾒﾓﾘｶｰﾄﾞﾗｲﾄﾌﾟﾛﾃｸﾄ
ANB @MR102               ; ﾒﾓﾘｶｰﾄﾞ無し
ANB @MR100               ; ﾒﾓﾘｶｰﾄﾞ 容量無しｴﾗｰ
ANL
SET @MR101               ; ﾒﾓﾘｶｰﾄﾞ ﾗｲﾄﾌﾟﾛﾃｸﾄONｴﾗｰ
MPP
LDB CR3213               ; ﾒﾓﾘｶｰﾄﾞあり
ANB @MR101               ; ﾒﾓﾘｶｰﾄﾞ ﾗｲﾄﾌﾟﾛﾃｸﾄONｴﾗｰ
ANB @MR100               ; ﾒﾓﾘｶｰﾄﾞ 容量無しｴﾗｰ
ANL
SET @MR102               ; ﾒﾓﾘｶｰﾄﾞ無し
STG @MR101               ; ﾒﾓﾘｶｰﾄﾞ ﾗｲﾄﾌﾟﾛﾃｸﾄONｴﾗｰ
SET R50008               ; 全体ERROR
CON
SET R50115               ; ﾒﾓﾘｶｰﾄﾞ　ｴﾗｰ発生中
CON
SET R50714               ; Err46
CON
JMP @MR200
MOV #46 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR200
AND R50008               ; 全体ERROR
JMP @MR202
STG @MR202
ANB R50008               ; 全体ERROR
ENDS
STG @MR100               ; ﾒﾓﾘｶｰﾄﾞ 容量無しｴﾗｰ
SET R50008               ; 全体ERROR
CON
SET R50115               ; ﾒﾓﾘｶｰﾄﾞ　ｴﾗｰ発生中
CON
SET R50713               ; Err45
CON
JMP @MR203
MOV #45 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR203
AND R50008               ; 全体ERROR
JMP @MR204
STG @MR204
ANB R50008               ; 全体ERROR
ENDS
STG @MR102               ; ﾒﾓﾘｶｰﾄﾞ無し
SET R50008               ; 全体ERROR
CON
SET R50115               ; ﾒﾓﾘｶｰﾄﾞ　ｴﾗｰ発生中
CON
SET R50715               ; Err47
CON
JMP @MR205
MOV #47 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR205
AND R50008               ; 全体ERROR
JMP @MR206
STG @MR206
ANB R50008               ; 全体ERROR
@SET @MR008              ; 008
CON
ENDS
LD @MR008                ; 008
AND R50007               ; 原点復帰　完了
AND R50005               ; 原点復帰完了
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50300               ; 一時停止中
ANB R50010               ; Emargency　Stop
AND R1715                ; 元圧確認
AND R1015                ; ﾄﾞｱﾛｯｸ信号
ANB R50014               ; 停止SW
SET R50001               ; AUTO　MODE
CON
SET R50004               ; TASKDO
CON
RES @MR008               ; 008
;手動／ｽﾃｯﾌﾟ運転
LDB LR100                ; STEP ﾛｰﾀ給材-0選択ﾗﾝﾌﾟ
ANB LR101                ; STEP ﾛｰﾀ給材-1選択ﾗﾝﾌﾟ
ANB LR102                ; STEP ﾛｰﾀ給材-2選択ﾗﾝﾌﾟ
ANB LR103                ; STEP ﾛｰﾀ給材-3選択ﾗﾝﾌﾟ
ANB LR104                ; STEP ﾛｰﾀ給材-4選択ﾗﾝﾌﾟ
ANB LR105                ; STEP ﾛｰﾀ給材-5選択ﾗﾝﾌﾟ
ANB LR200                ; STEP ｼｬﾌﾄ給材-0選択ﾗﾝﾌﾟ
ANB LR201                ; STEP ｼｬﾌﾄ給材-1選択ﾗﾝﾌﾟ
ANB LR202                ; STEP ｼｬﾌﾄ給材-2選択ﾗﾝﾌﾟ
ANB LR203                ; STEP ｼｬﾌﾄ給材-3選択ﾗﾝﾌﾟ
ANB LR204                ; STEP ｼｬﾌﾄ給材-4選択ﾗﾝﾌﾟ
ANB LR205                ; STEP ｼｬﾌﾄ給材-5選択ﾗﾝﾌﾟ
ANB LR400                ; STEP 完成品除材-0 選択ﾗﾝﾌﾟ
ANB LR401                ; STEP 完成品除材-1 選択ﾗﾝﾌﾟ
ANB LR402                ; STEP 完成品除材-2 選択ﾗﾝﾌﾟ
ANB LR403                ; STEP 完成品除材-3 選択ﾗﾝﾌﾟ
ANB LR404                ; STEP 完成品除材-4 選択ﾗﾝﾌﾟ
ANB LR405                ; STEP 完成品除材-5 選択ﾗﾝﾌﾟ
INV
OUT R50207               ; STEP選択
LD= DM4000 #410          ; 現在表示中画面
OR= DM4000 #420          ; 現在表示中画面
OR= DM4000 #440          ; 現在表示中画面
AND R50007               ; 原点復帰　完了
AND R50207               ; STEP選択
ANB R50004               ; TASKDO
ANB R50008               ; 全体ERROR
ANB R50300               ; 一時停止中
ANB R50010               ; Emargency　Stop
AND R1715                ; 元圧確認
AND R1015                ; ﾄﾞｱﾛｯｸ信号
OUT @MR010               ; 010
LD @MR010                ; 010
ANP R1002                ; 操作BOX  運転開始
SET R50002               ; STEP
CON
SET R50004               ; TASKDO
;STEP動作
LD R50002                ; STEP
MPS
AND LR000                ; STEP ﾛｰﾀ給材　選択ﾗﾝﾌﾟ
MPS
ANB _UT1
MDSTRT UT1
MPP
AND R50411               ; ST1        1ｻｲｸﾙ終了
SET R50409               ; ｻｲｸﾙ完了
CON
RES R50411               ; ST1        1ｻｲｸﾙ終了
MRD
AND LR001                ; STEP ｼｬﾌﾄ給材 選択ﾗﾝﾌﾟ
MPS
ANB _UT2
MDSTRT UT2
MPP
AND R50412               ; ST2        1ｻｲｸﾙ終了
SET R50409               ; ｻｲｸﾙ完了
CON
RES R50412               ; ST2        1ｻｲｸﾙ終了
MPP
AND LR003                ; STEP 完成品除材 選択ﾗﾝﾌﾟ
MPS
ANB _UT4
MDSTRT UT4
MPP
AND R50414               ; ST4        1ｻｲｸﾙ終了
SET R50409               ; ｻｲｸﾙ完了
CON
RES R50414               ; ST4        1ｻｲｸﾙ終了
;1ｽﾃｯﾌﾟ処理
LDB R50002               ; STEP
ZRES R50403 R50405       ; 1ｽﾃｯﾌﾟ停止中
STG R50400               ; 1ｽﾃｯﾌﾟ停止
ANB R50403               ; 1ｽﾃｯﾌﾟ停止中
ANB R1002                ; 操作BOX  運転開始
AND R50002               ; STEP
SET R50403               ; 1ｽﾃｯﾌﾟ停止中
CON
JMP R50404
STG R50404
ANP R1002                ; 操作BOX  運転開始
ANB R50008               ; 全体ERROR
ANB R50300               ; 一時停止中
ANB R50010               ; Emargency　Stop
AND R1715                ; 元圧確認
JMP R50405
STG R50405
ANB R50400               ; 1ｽﾃｯﾌﾟ停止
RES R50403               ; 1ｽﾃｯﾌﾟ停止中
CON
ENDS
LD R50400                ; 1ｽﾃｯﾌﾟ停止
AND R50404
OUT R50401               ; 1ｽﾃｯﾌﾟ停止中
LD R50002                ; STEP
AND R50405
ORB R50002               ; STEP
OUT R50402               ; 1ｽﾃｯﾌﾟ停止要求可
;Error Release Delay Management / エラー解除遅延処理
LDP R50107               ; ｴﾗｰ中　非常停止
SET R50109               ; ｴﾗｰ解除
LDB R50008               ; 全体ERROR
OR R50109                ; ｴﾗｰ解除
TMR @3 #15               ; ｳｴｲﾄﾀｲﾏｰ03
LD @T3                   ; ｳｴｲﾄﾀｲﾏｰ03
SET @MR300               ; 300
CON
RES R50109               ; ｴﾗｰ解除
CON
RES R50107               ; ｴﾗｰ中　非常停止
;Error Release Manegment / エラー解除処理
LD R50008                ; 全体ERROR
AND R50108               ; ｴﾗｰ中
TMR @4 #15               ; ｳｴｲﾄﾀｲﾏｰ04
LD R50008                ; 全体ERROR
AND R50108               ; ｴﾗｰ中
AND R50015               ; ｴﾗｰﾘｾｯﾄSWON
ANP R40006               ; ｴﾗｰﾘｾｯﾄSW
AND @T4                  ; ｳｴｲﾄﾀｲﾏｰ04
ANB R50300               ; 一時停止中
MPS
SET R50206
CON
SET R50109               ; ｴﾗｰ解除
CON
RES R50108               ; ｴﾗｰ中
CON
RES R50008               ; 全体ERROR
MPP
ZRES R50111 R50115       ; ST1部ｴﾗｰ発生中  ﾒﾓﾘｶｰﾄﾞ　ｴﾗｰ発生中
CON
ZRES R50900 R50915       ; ST1ｴﾗｰ発生
CON
ZRES R50500 R50815       ; Err63
CON
ZRES R46000 R47015       ; 2UT治具ｴｱｰ供給上昇ｴﾗｰ
LDP R50008               ; 全体ERROR
SET @MR301               ; 301
STG @MR301               ; 301
AND @MR300               ; 300
RES @MR300               ; 300
CON
SET R50108               ; ｴﾗｰ中
CON
ENDS
;サイクルタイム計測
;Total  =  DM7020
;UT1    =  DM7010
;UT2    =  DM7012
;UT3    =  DM7014
;UT4    =  DM7016
;Index  =  DM7018
LD R50209                ; 動作開始
OR R50200                ; INDEX Do
AND CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
@INC DM7020
LD R50209                ; 動作開始
AND CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
@INC DM7010
CON
@INC DM7012
CON
@INC DM7014
CON
@INC DM7016
LD R50200                ; INDEX Do
AND CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
@INC DM7018
LDP R50411               ; ST1        1ｻｲｸﾙ終了
MOV DM7010 DM7011
LDP R50412               ; ST2        1ｻｲｸﾙ終了
MOV DM7012 DM7013
LDP R50413               ; ST3        1ｻｲｸﾙ終了
MOV DM7014 DM7015
LDP R50414               ; ST4        1ｻｲｸﾙ終了
MOV DM7016 DM7017
LDF R50200               ; INDEX Do
MOV DM7018 DM7019
MOV DM7020 DM7021
MOV #0 DM7010
MOV #0 DM7012
MOV #0 DM7014
MOV #0 DM7016
LDF @MR004               ; AUTO 1CYCLE　PLS
MOV #0 DM7018
MOV #0 DM7020
END
ENDH
