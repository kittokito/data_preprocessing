DEVICE:51
;MODULE:Index
;MODULE_TYPE:0
;Index 制御
;
;非常停止
;Emergency Stop
LD R50010                ; Emargency　Stop
OR @MR001                ; 001
ZRES @MR002 @MR3915
CON
OUT @MR001               ; 001
TMR @0 #5                ; Wait timer00
LD @T0                   ; Wait timer00
MDSTOP Index
;原点復帰
LD R50003                ; 原点復帰
ANB R50200               ; INDEX Do
SET R50200               ; INDEX Do
CON
SET @MR1003              ; INDEX 原点復帰開始
LD MR3004                ; INDEX原点復帰
ANB R50200               ; INDEX Do
SET R50200               ; INDEX Do
CON
SET @MR1003              ; INDEX 原点復帰開始
STG @MR1003              ; INDEX 原点復帰開始
ANB R50300               ; 一時停止中
ANB R50110               ; INDEX部ｴﾗｰ発生中
RES MR3004               ; INDEX原点復帰
CON
ZRES DM600 DM607         ; prohibit use of DM600  prohibit use of DM607
CON
JMP @MR1004              ; 1004
STG @MR1004              ; 1004
ANB R50300               ; 一時停止中
ANB R50110               ; INDEX部ｴﾗｰ発生中
SET R50408               ; ｻｲｸﾙ動作中
CON
JMP @MR1005              ; 1005
STG @MR1005              ; 1005
ANB R50300               ; 一時停止中
ANB R50110               ; INDEX部ｴﾗｰ発生中
JMP @MR1006              ; 1006
STG @MR1006              ; 1006
SET R50100               ; PACK INDEX
CON
SET MR7915               ; MAIN INDEX回転中
CON
SET MR1000               ; INDEX原点回転sig
CON
JMP @MR1007              ; 1007
STG @MR1007              ; 1007
AND MR1001               ; INDEX原点復帰完了
JMP @MR1008              ; 1008
STG @MR1008              ; 1008
MPS
ANB MR3001               ; 原点復帰動作中
RES MR1001               ; INDEX原点復帰完了
CON
RES R50408               ; ｻｲｸﾙ動作中
CON
JMP @MR1009              ; 1009
MPP
AND MR3001               ; 原点復帰動作中
RES MR1001               ; INDEX原点復帰完了
CON
RES R50408               ; ｻｲｸﾙ動作中
CON
JMP @MR1011              ; 1011
STG @MR1009              ; 1009
RES R50408               ; ｻｲｸﾙ動作中
CON
TMH @1 #50               ; Wait timer01
CON
AND @T1                  ; Wait timer01
RES MR7915               ; MAIN INDEX回転中
CON
RES R50100               ; PACK INDEX
CON
JMP @MR1011              ; 1011
STG @MR1011              ; 1011
TMH @6 #50               ; Wait timer06
CON
AND @T6                  ; Wait timer06
MPS
ANB MR3001               ; 原点復帰動作中
JMP @MR1010              ; 1010
MPP
AND MR3001               ; 原点復帰動作中
RES R50100               ; PACK INDEX
CON
RES MR7915               ; MAIN INDEX回転中
CON
JMP @MR1202              ; 原点復帰完了
;ワークチェック
;Check the SUS　on the INDEX
STG @MR1010              ; 1010
ANB R50300               ; 一時停止中
ANB R50110               ; INDEX部ｴﾗｰ発生中
MPS
LDB R1400                ; 1ST部　ﾛｰﾀｺｱ有無検出
ANB R1404                ; 2ST部　ﾛｰﾀｺｱ有無検出
ANB R1409                ; 3ST部　ﾛｰﾀｺｱ有無検出
ANB R1412                ; 4ST部　ﾛｰﾀｺｱ有無検出
ANL
JMP @MR1202              ; 原点復帰完了
MRD
AND R1412                ; 4ST部　ﾛｰﾀｺｱ有無検出
SET @MR100               ; 完成品除材位置ﾜｰｸ残り
CON
JMP @MR1203              ; 1203
MPP
LDB R1412                ; 4ST部　ﾛｰﾀｺｱ有無検出
LD R1400                 ; 1ST部　ﾛｰﾀｺｱ有無検出
OR R1404                 ; 2ST部　ﾛｰﾀｺｱ有無検出
OR R1409                 ; 3ST部　ﾛｰﾀｺｱ有無検出
ANL
ANL
JMP @MR1206              ; 完成品除材位置意外にﾜｰｸ残り
STG @MR1202              ; 原点復帰完了
MPS
ANB MR3001               ; 原点復帰動作中
SET R50410               ; INDEX     　 1ｻｲｸﾙ終了
CON
ENDS
MPP
AND MR3001               ; 原点復帰動作中
SET R50410               ; INDEX     　 1ｻｲｸﾙ終了
CON
RES R50200               ; INDEX Do
CON
SET MR3010               ; 原点復帰完了
CON
ENDS
;ｲﾝﾃﾞｯｸｽ上　完成品除材位置　にてﾜｰｸ除材する
STG @MR1203              ; 1203
TMR #400 #2              ; ｳｪｲﾄﾀｲﾏ
CON
AND T400                 ; ｳｪｲﾄﾀｲﾏ
AND @MR107               ; ｴﾗｰ解除
JMP @MR1204              ; 1204
STG @MR1204              ; 1204
RES @MR107               ; ｴﾗｰ解除
CON
JMP @MR1010              ; 1010
STG @MR1206              ; 完成品除材位置意外にﾜｰｸ残り
SET R50100               ; PACK INDEX
CON
SET MR7915               ; MAIN INDEX回転中
CON
JMP @MR1207
STG @MR1207
SET MR1002               ; INDEX回転sig
CON
JMP @MR1208
STG @MR1208
AND MR1003               ; INDEX回転完了
JMP @MR1209
STG @MR1209
RES MR1003               ; INDEX回転完了
CON
RES R50408               ; ｻｲｸﾙ動作中
CON
JMP @MR1210
STG @MR1210
TMH #401 #10
CON
AND T401
RES MR7915               ; MAIN INDEX回転中
CON
JMP @MR1211
STG @MR1211
RES R50100               ; PACK INDEX
CON
JMP @MR1212
STG @MR1212
MPS
AND R1412                ; 4ST部　ﾛｰﾀｺｱ有無検出
SET @MR100               ; 完成品除材位置ﾜｰｸ残り
CON
JMP @MR1213
MPP
ANB R1412                ; 4ST部　ﾛｰﾀｺｱ有無検出
MPS
AND= #1 DM609            ; INDEX位置記憶
JMP @MR1010              ; 1010
MPP
AND<> #1 DM609           ; INDEX位置記憶
JMP @MR1206              ; 完成品除材位置意外にﾜｰｸ残り
;ｲﾝﾃﾞｯｸｽ上　完成品除材位置　にてﾜｰｸ除材する
STG @MR1213
TMR #402 #2
CON
AND T402
AND @MR107               ; ｴﾗｰ解除
JMP @MR1214
STG @MR1214
RES @MR107               ; ｴﾗｰ解除
CON
JMP @MR1212
;AUTO
LD R50001                ; AUTO　MODE
ANB R50200               ; INDEX Do
SET R50200               ; INDEX Do
CON
SET @MR2000              ; INDEX AUTO開始
;動作パラメーター確認
;0通常動作
;1払い出し
STG @MR2000              ; INDEX AUTO開始
JMP @MR2101              ; 2101
STG @MR2101              ; 2101
JMP @MR2111              ; 2111
STG @MR2111              ; 2111
SET R50100               ; PACK INDEX
CON
SET MR7915               ; MAIN INDEX回転中
CON
JMP @MR2102              ; 2102
STG @MR2102              ; 2102
SET MR1002               ; INDEX回転sig
CON
JMP @MR2103              ; 2103
STG @MR2103              ; 2103
AND MR1003               ; INDEX回転完了
JMP @MR2104              ; 2104
STG @MR2104              ; 2104
RES MR1003               ; INDEX回転完了
CON
RES R50408               ; ｻｲｸﾙ動作中
CON
JMP @MR2105              ; 2105
STG @MR2105              ; 2105
TMH @7 #10               ; Wait timer07
CON
AND @T7                  ; Wait timer07
RES MR7915               ; MAIN INDEX回転中
CON
JMP @MR2113              ; 2113
STG @MR2113              ; 2113
RES R50100               ; PACK INDEX
CON
JMP @MR2106              ; 2106
STG @MR2106              ; 2106
JMP @MR2107              ; 2107
STG @MR2107              ; 2107
ANB R50300               ; 一時停止中
ANB R50110               ; INDEX部ｴﾗｰ発生中
RES R50408               ; ｻｲｸﾙ動作中
CON
SET R50410               ; INDEX     　 1ｻｲｸﾙ終了
CON
ENDS
;サブルーチン
;Subroutine
;INDEX 原点復帰動作
;INDEX HOME
;The starting point return of an index is program No.5.  
;By 4 division specification, it moves to a starting point position by the shortest. 
;/ ｲﾝﾃﾞｯｸｽの原点復帰は、ﾌﾟﾛｸﾞﾗﾑNo.５　4分割指定で、近周りで原点位置へ移動する
STG MR1000               ; INDEX原点回転sig
SET MR6109               ; ｲﾝﾃﾞｯｸｽ　非常停止入力
CON
TMH @3 #30               ; Wait timer03
CON
AND @T3                  ; Wait timer03
SET MR6008               ; ｲﾝﾃﾞｯｸｽ電源ON
CON
JMP @MR1108              ; 1108
STG @MR1108              ; 1108
AND R1107                ; INDEX  起動入力待ち
SET MR6105               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ設定　一桁目
CON
SET MR6100               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0
CON
RES MR6101               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT1
CON
SET MR6102               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT2
CON
RES MR6103               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT3
CON
TMH @4 #10               ; Wait timer04
CON
AND @T4                  ; Wait timer04
SET MR6107               ; ｲﾝﾃﾞｯｸｽ　起動入力
CON
JMP @MR1109              ; 1109
STG @MR1109              ; 1109
TMH @9 #5                ; Wait timer09
CON
AND @T9                  ; Wait timer09
ANB R1107                ; INDEX  起動入力待ち
RES MR6107               ; ｲﾝﾃﾞｯｸｽ　起動入力
CON
ZRES MR6100 MR6105       ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0  ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ設定　一桁目
CON
JMP @MR1110              ; 1110
STG @MR1110              ; 1110
AND R1106                ; INDEX　位置決完了
SET MR6108               ; ｲﾝﾃﾞｯｸｽ　ｱﾝｻｰ入力
CON
JMP @MR1111              ; 1111
STG @MR1111              ; 1111
ANB R1106                ; INDEX　位置決完了
RES MR6108               ; ｲﾝﾃﾞｯｸｽ　ｱﾝｻｰ入力
CON
DW #1 DM609              ; INDEX位置記憶
CON
JMP @MR1112              ; 1112
STG @MR1112              ; 1112
SET MR1001               ; INDEX原点復帰完了
CON
ENDS
;90 degrees positive rotation of an index chooses program No.0 to 3 in order, and starts it. 
;By 4 division specification, it moves to the following position of four positions. 
;If movement is completed, the following specification will be written in DM. 
; / ｲﾝﾃﾞｯｸｽの90度正回転は、ﾌﾟﾛｸﾞﾗﾑNo．０から３を順に選択し起動する
;4分割指定で、4位置の次位置へ移動する、移動が完了したらDMに次の指定を書込む
STG MR1002               ; INDEX回転sig
ZRES MR6100 MR6105       ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0  ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ設定　一桁目
CON
SET MR1011               ; INDEX監視
CON
JMP @MR3000              ; 3000
STG MR3104               ; INDEX回転
SET MR1011               ; INDEX監視
CON
JMP @MR3000              ; 3000
STG @MR3000              ; 3000
AND R1107                ; INDEX  起動入力待ち
MPS
AND= DM609 #1            ; INDEX位置記憶
SET MR6100               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0
CON
RES MR6101               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT1
CON
RES MR6102               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT2
CON
RES MR6103               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT3
CON
RES MR3010               ; 原点復帰完了
CON
JMP @MR3001              ; 3001
MRD
AND= DM609 #2            ; INDEX位置記憶
RES MR6100               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0
CON
SET MR6101               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT1
CON
RES MR6102               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT2
CON
RES MR6103               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT3
CON
RES MR3010               ; 原点復帰完了
CON
JMP @MR3001              ; 3001
MRD
AND= DM609 #3            ; INDEX位置記憶
SET MR6100               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0
CON
SET MR6101               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT1
CON
RES MR6102               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT2
CON
RES MR6103               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT3
CON
RES MR3010               ; 原点復帰完了
CON
JMP @MR3001              ; 3001
MPP
AND= DM609 #4            ; INDEX位置記憶
RES MR6100               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0
CON
RES MR6101               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT1
CON
RES MR6102               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT2
CON
RES MR6103               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT3
CON
SET MR3010               ; 原点復帰完了
CON
JMP @MR3001              ; 3001
STG @MR3001              ; 3001
TMH #351 #2
CON
AND T351
SET MR6105               ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ設定　一桁目
CON
JMP @MR3002              ; 3002
STG @MR3002              ; 3002
TMH @5 #10               ; Wait timer05
CON
AND @T5                  ; Wait timer05
ZRES MR6100 MR6105       ; ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ選択　BIT0  ｲﾝﾃﾞｯｸｽ　ﾌﾟﾛｸﾞﾗﾑ設定　一桁目
CON
TMH #352 #2
CON
AND T352
SET MR6107               ; ｲﾝﾃﾞｯｸｽ　起動入力
CON
RES R55001               ; TP 停止中表示
CON
SET R55000               ; TP 回転中表示
CON
JMP @MR3003              ; 3003
STG @MR3003              ; 3003
TMH @8 #10               ; Wait timer08
CON
AND @T8                  ; Wait timer08
ANB R1107                ; INDEX  起動入力待ち
RES MR6107               ; ｲﾝﾃﾞｯｸｽ　起動入力
CON
JMP @MR3004              ; 3004
STG @MR3004              ; 3004
AND R1106                ; INDEX　位置決完了
RES R55000               ; TP 回転中表示
CON
SET R55001               ; TP 停止中表示
CON
SET MR6108               ; ｲﾝﾃﾞｯｸｽ　ｱﾝｻｰ入力
CON
JMP @MR3005              ; 3005
STG @MR3005              ; 3005
ANB R1104                ; INDEX　Mｺｰﾄﾞ出力BIT4
RES MR6108               ; ｲﾝﾃﾞｯｸｽ　ｱﾝｻｰ入力
CON
RES MR1011               ; INDEX監視
CON
MPS
LD>= DM609 #1            ; INDEX位置記憶
AND<= DM609 #3           ; INDEX位置記憶
ANL
JMP @MR3006              ; 3006
MPP
AND>= DM609 #4           ; INDEX位置記憶
JMP @MR3007              ; 3007
STG @MR3006              ; 3006
@INC DM609               ; INDEX位置記憶
CON
JMP @MR3008
STG @MR3007              ; 3007
DW #1 DM609              ; INDEX位置記憶
CON
JMP @MR3008
STG @MR3008
TMH #350 #5
CON
AND T350
@LDA.L DM6802
CON
@STA.L DM6804            ; ﾌﾗﾝｼﾞ厚み
CON
@LDA.L DM6800
CON
@STA.L DM6802
CON
LDA.L +0
CON
@STA.L DM6800
CON
@LDA DM29010             ; 圧入範囲勘合MAX値
CON
@STA DM29012
CON
@LDA DM29020             ; 圧入範囲勘合MIN値
CON
@STA DM29022
CON
MPS
ANB MR3101               ; INDEX回転中
SET MR1003               ; INDEX回転完了
CON
ENDS
MPP
AND MR3101               ; INDEX回転中
SET MR3110               ; INDEX回転完了
CON
ENDS
;STEP
LD R50002                ; STEP
ANB R50205               ; INDEX Do　   (STEP)
SET R50205               ; INDEX Do　   (STEP)
CON
SET @MR2502              ; INDEX STEP開始
;動作パラメーター確認
;0通常動作
STG @MR2502              ; INDEX STEP開始
SET R21800               ; ｲﾝﾃﾞｯｸｽ回転準備可表示
CON
SET R21900               ; 表示切替え　ｽﾀｰﾄ待ち
CON
JMP @MR2600              ; 2600
STG @MR2600              ; 2600
ANB R50300               ; 一時停止中
ANB R50110               ; INDEX部ｴﾗｰ発生中
ANB _UT1
ANB _UT2
ANB _UT3
ANB _UT4
JMP @MR2601              ; 2601
STG @MR2601              ; 2601
ANB R50300               ; 一時停止中
ANB R50110               ; INDEX部ｴﾗｰ発生中
SET R50406               ; ｽﾀｰﾄSWﾗﾝﾌﾟ 点滅
CON
ANP R1002                ; 操作BOX  運転開始
JMP @MR2602              ; 2602
STG @MR2602              ; 2602
SET R50100               ; PACK INDEX
CON
RES R50406               ; ｽﾀｰﾄSWﾗﾝﾌﾟ 点滅
CON
SET R50408               ; ｻｲｸﾙ動作中
CON
RES R21900               ; 表示切替え　ｽﾀｰﾄ待ち
CON
SET R21901               ; 表示切り替え　回転中
CON
SET MR7915               ; MAIN INDEX回転中
CON
SET MR1002               ; INDEX回転sig
CON
JMP @MR2603              ; 2603
STG @MR2603              ; 2603
AND MR1003               ; INDEX回転完了
JMP @MR2604              ; 2604
STG @MR2604              ; 2604
RES MR1003               ; INDEX回転完了
CON
RES R50408               ; ｻｲｸﾙ動作中
CON
JMP @MR2605              ; 2605
STG @MR2605              ; 2605
TMH @10 #50              ; Wait timer10
CON
AND @T10                 ; Wait timer10
RES MR7915               ; MAIN INDEX回転中
CON
JMP @MR2613              ; 2613
STG @MR2613              ; 2613
RES R21800               ; ｲﾝﾃﾞｯｸｽ回転準備可表示
CON
RES R21901               ; 表示切り替え　回転中
CON
RES R50100               ; PACK INDEX
CON
JMP @MR2607              ; 2607
STG @MR2607              ; 2607
RES R21800               ; ｲﾝﾃﾞｯｸｽ回転準備可表示
CON
SET R50410               ; INDEX     　 1ｻｲｸﾙ終了
CON
ENDS
;***** ERROR NO 40  / ｲﾝﾃﾞｯｸｽﾜｰｸ残り　除材要求  *****
;
STG @MR100               ; 完成品除材位置ﾜｰｸ残り
ANB R50008               ; 全体ERROR
SET @MR101               ; ｴﾗｰ発生中
CON
SET R50008               ; 全体ERROR
CON
SET R50904               ; INDEXｴﾗｰ発生
CON
SET R50708               ; Err40
CON
JMP @MR102
MOV #40 DM400            ; ﾒｯｾｰｼﾞNo.
STG @MR102
AND R50008               ; 全体ERROR
RES MR6513               ; 完成品排出　完成品搬送　IDX側
CON
SET MR6512               ; 完成品排出　完成品搬送　CV側
CON
AND R1702                ; 完成品排出　完成品搬送　CV側限
JMP @MR103
STG @MR103
ANB R50008               ; 全体ERROR
RES MR6512               ; 完成品排出　完成品搬送　CV側
CON
SET MR6513               ; 完成品排出　完成品搬送　IDX側
CON
AND R1703                ; 完成品排出　完成品搬送　IDX側限
RES @MR101               ; ｴﾗｰ発生中
CON
SET @MR107               ; ｴﾗｰ解除
CON
ENDS
END
ENDH
