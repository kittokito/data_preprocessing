DEVICE:53
;MODULE:MAIN
;MODULE_TYPE:0
;SCRIPT_TYPE:
;＊＊＊　Version information　＊＊＊
;＊＊＊　バージョン情報　＊＊＊
LD CR2002                ; 常時ON
MOV.D #140803 DM90       ; Version information/YearMonthDay
MOV.D #1 DM92            ; Version information/revision
LD CR2002                ; 常時ON
MOV.D #140803 DM94       ; TP_Version information/Year
MOV #1 DM96              ; TP_Version information/revision
;装置ﾓｰﾄﾞ設定
LDB LR115                ; 言語切替(ON=英語)
MOV #0 DM20              ; TP.文字表示切替
LD LR115                 ; 言語切替(ON=英語)
MOV #1 DM20              ; TP.文字表示切替
;<h1/>2014/11/29修正
;手動ﾓｰﾄﾞに切り替わらない為
;<h1/>運転ﾓｰﾄﾞ選択
LD B0C1                  ; 手動SW
AND MR015                ; 全停止
OR MR100                 ; 手動ﾓｰﾄﾞ
ANB MR101                ; 自動ﾓｰﾄﾞ
LD R62800                ; ML16動作可能
AND R82800               ; MC20V 動作可能
ORB CR2002               ; 常時ON
ANL
OUT MR100                ; 手動ﾓｰﾄﾞ
;＊＊＊追加・修正終わり＊＊＊
LD R62800                ; ML16動作可能
AND R82800               ; MC20V 動作可能
TMH @1 #100              ; ｳｪｲﾄﾀｲﾏｰ1
LD B0C2                  ; 自動SW
AND MR015                ; 全停止
ORP @T1                  ; ｳｪｲﾄﾀｲﾏｰ1
OR MR101                 ; 自動ﾓｰﾄﾞ
ANB B0C1                 ; 手動SW
AND @T1                  ; ｳｪｲﾄﾀｲﾏｰ1
OUT MR101                ; 自動ﾓｰﾄﾞ
;<h1/>ﾃﾞｨﾊﾞｯｸﾓｰﾄﾞ
LD B01D4                 ; ﾏｽﾀｰﾛｸﾞｲﾝ中PL
AND B0FF                 ; SW.ﾃﾞﾊﾞｯｸﾞﾓｰﾄﾞ
TMR @3 #20               ; ｳｪｲﾄﾀｲﾏ-3
CON
AND @T3                  ; ｳｪｲﾄﾀｲﾏ-3
OUT @MR002               ; ﾃﾞﾊﾞｯｸﾞﾓｰﾄﾞ
LD @MR002                ; ﾃﾞﾊﾞｯｸﾞﾓｰﾄﾞ
OR MR000                 ; ﾃﾞﾊﾞｯｸﾞﾓｰﾄﾞ
OUT MR000                ; ﾃﾞﾊﾞｯｸﾞﾓｰﾄﾞ
LD B0DA                  ; SW.ﾃﾞﾊﾞｯｸﾞﾓｰﾄﾞ
AND MR000                ; ﾃﾞﾊﾞｯｸﾞﾓｰﾄﾞ
@MOV #603 DM8            ; TPｼｽﾃﾑｴﾘｱ(切替ﾍﾟｰｼﾞNo)
;<h1/>全原点
LD MR1114                ; 給材X軸 全原点
AND MR1314               ; 給材Y軸 全原点
AND MR1514               ; 給材Z軸 全原点
AND MR1712               ; 給材θ軸 原点復帰記憶
AND MR1714               ; 給材θ軸 全原点
AND MR6114               ; 除材X軸 全原点
AND MR6314               ; 除材Y軸 全原点
AND MR6514               ; 除材Z軸 全原点
AND MR6712               ; 除材θ軸 原点復帰記憶
AND MR6714               ; 除材θ軸 全原点
AND MR6914               ; 検査Z軸 全原点
AND MR2014               ; 画像全原点
AND MR2114               ; その他全原点
AND MR2214               ; ｼﾘﾝﾀﾞ全原点
OUT MR014                ; 全原点
;<h1/>全停止
LD MR1115                ; 給材X軸 全停止
AND MR1315               ; 給材Y軸 全停止
AND MR1515               ; 給材Z軸 全停止
AND MR1715               ; 給材θ軸 全停止
AND MR6115               ; 除材X軸 全停止
AND MR6315               ; 除材Y軸 全停止
AND MR6515               ; 除材Z軸 全停止
AND MR6715               ; 除材θ軸 全停止
AND MR6915               ; 検査Z軸 全停止
AND MR2015               ; 画像全停止
AND MR2115               ; その他全停止
AND MR2215               ; ｼﾘﾝﾀﾞ全停止
OUT MR015                ; 全停止
;<h1/>全異常
LDB MR103                ; 即停止異常 (原点復帰有)
ANB MR104                ; 即停止異常 (原点復帰無)
ANB MR105                ; 全警報
INV
OUT MR013                ; 全異常、警報
LDB MR7000               ; ERR00 給材X軸ﾄﾞﾗｲﾊﾞｰ異常
ANB MR7001               ; ERR01 給材X軸軸ｴﾗｰ
ANB MR7002               ; ERR02 給材Y軸ﾄﾞﾗｲﾊﾞｰ異常
ANB MR7003               ; ERR03 給材Y軸軸ｴﾗｰ
ANB MR7004               ; ERR04 給材Z軸ﾄﾞﾗｲﾊﾞｰ異常
ANB MR7005               ; ERR05 給材Z軸軸ｴﾗｰ
ANB MR7006               ; ERR06 給材θ軸 位置決め異常
ANB MR7100               ; ERR10 除材X軸ﾄﾞﾗｲﾊﾞｰ異常
ANB MR7101               ; ERR11 除材X軸軸ｴﾗｰ
ANB MR7102               ; ERR12 除材Y軸ﾄﾞﾗｲﾊﾞｰ異常
ANB MR7103               ; ERR13 除材Y軸軸ｴﾗｰ
ANB MR7104               ; ERR14 除材Z軸ﾄﾞﾗｲﾊﾞｰ異常
ANB MR7105               ; ERR15 除材Z軸軸ｴﾗｰ
ANB MR7106               ; ERR16 除材θ軸 位置決め異常
ANB MR7200               ; ERR20 検査Z軸 ﾄﾞﾗｲﾊﾞｰ異常
ANB MR7201               ; ERR21 検査Z軸軸ｴﾗｰ
ANB MR7208               ; ERR28 ﾓｰｼｮﾝﾕﾆｯﾄ1 動作許可異常
ANB MR7209               ; ERR29 ﾓｰｼｮﾝﾕﾆｯﾄ2 動作許可異常
ANB MR7300               ; ERR30 PC機種ｴﾗｰ
ANB MR7301               ; ERR31　PC通信異常
ANB MR7308               ; ERR38 給材画像 ｺﾝﾄﾛｰﾗ異常
ANB MR7309               ; ERR39 検査画像 ｺﾝﾄﾛｰﾗ異常
ANB MR7310               ; ERR3A 除材画像 ｺﾝﾄﾛｰﾗ異常
ANB MR7400               ; ERR40 元圧異常
ANB MR7401               ; ERR41 真空圧異常
ANB MR7402               ; ERR42 給材側 ｲｵﾅｲｻﾞ異常
ANB MR7403               ; ERR43 除材側 ｲｵﾅｲｻﾞ異常
ANB MR7408               ; ERR48 ｽﾌﾟﾚｯﾄﾞ盤XY異常
ANB MR7409               ; ERR49 ｽﾌﾟﾚｯﾄﾞ盤Z異常
ANB MR7500               ; ERR50 受取ﾗﾌｶﾞｲﾄﾞ上昇異常
ANB MR7501               ; ERR51 受取ﾗﾌｶﾞｲﾄﾞ下降異常
ANB MR7502               ; ERR52 落し込み 回収上昇異常
ANB MR7503               ; ERR53 落し込み 回収下降異常
ANB MR7504               ; ERR54 落し込み 回収切替 押込側異
ANB MR7505               ; ERR55 落し込み 回収切替 回収側異
ANB MR7506               ; ERR56 落し込み 回収ｽﾗｲﾄﾞ 前進異
ANB MR7507               ; ERR57 落し込み 回収ｽﾗｲﾄﾞ 後退異
ANB MR7508               ; ERR58 除材移動 前進異常
ANB MR7509               ; ERR59 除材移動 後退異常
ANB MR7510               ; ERR5A 除材移動 上昇異常
ANB MR7511               ; ERR5B 除材移動 下降異常
ANB MR7512               ; ERR5C 除材反転 ﾕﾆｯﾄ開異常
ANB MR7513               ; ERR5D 除材反転 ﾕﾆｯﾄ閉異常
INV
OUT MR103                ; 即停止異常 (原点復帰有)
LDB MR7600               ; ERR60 ﾊﾟﾚｯﾄ1無し異常
ANB MR7601               ; ERR60 ﾊﾟﾚｯﾄ2無し異常
ANB MR7602               ; ERR62 ﾊﾟﾚｯﾄ1未交換
ANB MR7603               ; ERR63 ﾊﾟﾚｯﾄ2未交換
ANB MR7604               ; ERR64 ﾄﾞｱ1開
ANB MR7605               ; ERR65 ﾄﾞｱ2開
ANB MR7606               ; ERR66 ﾄﾞｱ3開
ANB MR7607               ; ERR67 ﾄﾞｱ4開
ANB MR7608               ; ERR68 ﾄﾞｱ5開
ANB MR7609               ; ERR69 ﾄﾞｱ6開
ANB MR7610               ; ERR6A　自動運転中ﾊﾟﾚｯﾄ1無し異常
ANB MR7611               ; ERR6B　自動運転中ﾊﾟﾚｯﾄ2無し異常
ANB MR7702               ; ERR72 連続回収異常
ANB MR7708               ; ERR78 ﾄﾞｱﾛｯｸ1ｼﾘﾝﾀﾞ異常
ANB MR7709               ; ERR79 ﾄﾞｱﾛｯｸ2ｼﾘﾝﾀﾞ異常
ANB MR7710               ; ERR7A ﾄﾞｱﾛｯｸ3ｼﾘﾝﾀﾞ異常
ANB MR7711               ; ERR7B ﾄﾞｱﾛｯｸ4ｼﾘﾝﾀﾞ異常
ANB MR7712               ; ERR7C ﾄﾞｱﾛｯｸ5ｼﾘﾝﾀﾞ異常
ANB MR7713               ; ERR7D ﾄﾞｱﾛｯｸ6ｼﾘﾝﾀﾞ異常
INV
OUT MR104                ; 即停止異常 (原点復帰無)
LDB MR7700               ; ERR70 ﾎｯﾊﾟｰｴﾝﾌﾟﾃｨｰ
ANB MR7701               ; ERR71 振動盤上 ﾜｰｸ量
ANB MR7703               ; ERR73 給材連続吸着異常
ANB MR7704               ; ERR74 給材連続NG排出異常 
ANB MR7705               ; ERR75 検査NG品連続排出異常
INV
OUT MR105                ; 全警報
LDB MR37515              ; ｸﾞﾛｰﾊﾞﾙ ｳｨﾝﾄﾞｳ#20 表示
ANB MR34515              ; ｸﾞﾛｰﾊﾞﾙ ｳｨﾝﾄﾞｳ#21 表示
ANB MR34514              ; ｸﾞﾛｰﾊﾞﾙ ｳｨﾝﾄﾞｳ#22 表示
ANB MR36515              ; ｸﾞﾛｰﾊﾞﾙ ｳｨﾝﾄﾞｳ#23 表示
ANB MR37514              ; ｸﾞﾛｰﾊﾞﾙ ｳｨﾝﾄﾞｳ#25 表示
INV
OUT MR106                ; ﾎﾟｯﾌﾟｱｯﾌﾟ警報
;<h1/>1ﾊﾟﾚｯﾄ ｻｲｸﾙﾀｲﾑ表示
LDB MR3200               ; 自動運転中
ANB MR206                ; ｻｲｸﾙ停止完了継続中
DW.D #0 DM5000           ; 1ﾊﾟﾚｯﾄ ｻｲｸﾙﾀｲﾑ計測
LDP MR3200               ; 自動運転中
OR @MR000                ; 1ﾊﾟﾚｯﾄ ｻｲｸﾙﾀｲﾑ 計測中
AND MR3200               ; 自動運転中
MPS
OUT @MR000               ; 1ﾊﾟﾚｯﾄ ｻｲｸﾙﾀｲﾑ 計測中
MPP
LD CR2004                ; 10msｸﾛｯｸﾊﾟﾙｽ
AND MR203                ; 自動歩進可
ANL
@INC.D DM5000            ; 1ﾊﾟﾚｯﾄ ｻｲｸﾙﾀｲﾑ計測
;1ｻｲｸﾙﾀｲﾑ表示
LDP MR33500              ; ﾜｰｸ押込 動作要求
OR MR410                 ; ｻｲｸﾙﾀｲﾑ計測開始
AND MR3200               ; 自動運転中
OUT MR410                ; ｻｲｸﾙﾀｲﾑ計測開始
LDP MR33500              ; ﾜｰｸ押込 動作要求
MOV.D DM5004 DM5006      ; 1ｻｲｸﾙﾀｲﾑ計測  1ｻｲｸﾙﾀｲﾑ計測
LDP MR33500              ; ﾜｰｸ押込 動作要求
ORB MR3200               ; 自動運転中
DW.D #0 DM5004           ; 1ｻｲｸﾙﾀｲﾑ計測
LD MR410                 ; ｻｲｸﾙﾀｲﾑ計測開始
AND CR2004               ; 10msｸﾛｯｸﾊﾟﾙｽ
AND<.D DM5004 #99999     ; 1ｻｲｸﾙﾀｲﾑ計測
@INC.D DM5004            ; 1ｻｲｸﾙﾀｲﾑ計測
;<h1/>ｶｳﾝﾀﾘｾｯﾄ・演算
LD B0DC                  ; ｶｳﾝﾀﾘｾｯﾄSW
MPS
OUT B01DC                ; ｶｳﾝﾀﾘｾｯﾄPL
CON
TMR @2 #20               ; ｶｳﾝﾀﾘｾｯﾄ
MPP
ANP @T2                  ; ｶｳﾝﾀﾘｾｯﾄ
DW.D #0 DM420            ; 検査OK数
CON
DW.D #0 DM422            ; 検査投入数
CON
DW.D #0 DM424            ; OK品整列数
CON
DW.D #0 DM426            ; 検査NG数
CON
DW.D #0 DM428            ; NG品整列数
CON
DW.D #0 DM430            ; 検査回収数
CON
DW.D #0 DM432            ; NG品廃棄数
CON
DW.D #0 DM434            ; 不明数
;'不明数計算
;DM434.L = DM420.D - DM424.D - DM426.D - DM428.D - DM430.D
LD CR2002                ; 常時ON
NCJ #1001
;'不明数計算
;
;DM434.L = DM420.D - DM424.D - DM426.D - DM428.D - DM430.D
LD CR2002                ; 常時ON
LDA.L DM420              ; 検査OK数
CON
SUB.L DM424              ; OK品整列数
CON
SUB.L DM426              ; 検査NG数
CON
SUB.L DM428              ; NG品整列数
CON
SUB.L DM430              ; 検査回収数
CON
STA.L DM434              ; 不明数
LABEL #1001
;
;'歩留り計算
;DM408.D = DM424.D *10000 / DM422.D
LD CR2002                ; 常時ON
AND<>.D DM422 #0         ; 検査投入数
AND<>.D DM424 #0         ; OK品整列数
NCJ #1000
;'歩留り計算
;
;DM408.D = DM424.D *10000 / DM422.D
LD CR2002                ; 常時ON
LDA.L DM424              ; OK品整列数
CON
MUL.L +10000
CON
DIV.L DM422              ; 検査投入数
CON
STA.D DM408              ; 歩留まり
LABEL #1000
;
;<h1/>PC-PLC　ﾊﾝﾄﾞｼｪｰｸ
LD CR2002                ; 常時ON
MPS
AND W2500.15             ; PC→PLC 接続ﾁｪｯｸ
TMR #10 #50              ; PC→PLC 接続ﾁｪｯｸ1
MRD
ANB W2500.15             ; PC→PLC 接続ﾁｪｯｸ
TMR #11 #50              ; PC→PLC 接続ﾁｪｯｸ2
MPP
LDB T10                  ; PC→PLC 接続ﾁｪｯｸ1
ANB T11                  ; PC→PLC 接続ﾁｪｯｸ2
ANL
TMR #12 #30              ; PC→PLC 接続ﾁｪｯｸ
CON
AND T12                  ; PC→PLC 接続ﾁｪｯｸ
OUT MR003                ; PCｵﾝﾗｲﾝ
LD CR2002                ; 常時ON
MOV EM40020 W2002        ; ﾜｰｸﾚｼﾋﾟ選択No  PLC→PC ﾚｼﾋﾟ番号
LDP MR003                ; PCｵﾝﾗｲﾝ
OR CR2008                ; 運転開始時1ｽｷｬﾝON
LDB W2500.1              ; PC→PLC 機種ｴﾗｰ
ANB W2500.2              ; PC→PLC 自動可
ORL
ORP B02F2                ; ﾚｼﾋﾟ番号 設定通知
OR W2000.0               ; PLC→PC ﾚｼﾋﾟ番号書込
ANB W2500.0              ; PC→PLC ﾚｼﾋﾟ番号書込完了
ANB MR7300               ; ERR30 PC機種ｴﾗｰ
AND MR003                ; PCｵﾝﾗｲﾝ
OUT W2000.0              ; PLC→PC ﾚｼﾋﾟ番号書込
LD W2500.0               ; PC→PLC ﾚｼﾋﾟ番号書込完了
RES B02F2                ; ﾚｼﾋﾟ番号 設定通知
LDP W2500.1              ; PC→PLC 機種ｴﾗｰ
LDP MR005                ; 起動SW
AND W2500.1              ; PC→PLC 機種ｴﾗｰ
ORL
OR MR7300                ; ERR30 PC機種ｴﾗｰ
ANB MR004                ; ﾘｾｯﾄSW
OUT MR7300               ; ERR30 PC機種ｴﾗｰ
LDP MR005                ; 起動SW
OR MR3200                ; 自動運転中
ANB MR003                ; PCｵﾝﾗｲﾝ
OR MR7301                ; ERR31　PC通信異常
ANB MR004                ; ﾘｾｯﾄSW
OUT MR7301               ; ERR31　PC通信異常
LD MR3200                ; 自動運転中
OUT W2000.1              ; PLC→PC 自動中
LD<> MR35000 #0          ; 検査STEP00
OUT W2000.2              ; PLC→PC 検査中
LD MR35200               ; 検査STEP32
OUT W2000.3              ; PLC→PC 検査ﾃﾞｰﾀ確定
LD MR37206               ; 除材搬送 STEP38
OUT W2000.4              ; PLC→PC ﾊﾟﾚｯﾄ確定
LD B0610                 ; 検査Z軸 ﾃﾞｰﾀ書込PL
OUT W2000.6              ; PLC→PC ﾃﾞｰﾀ書込要求
LD MR36104               ; 除材反転 STEP20
OUT W2000.7              ; PLC→PC ﾃﾞｰﾀ移動1
LD MR37201               ; 除材搬送 STEP33
OUT W2000.8              ; PLC→PC ﾃﾞｰﾀ移動2
LDB MR3315               ; ﾊﾟﾚｯﾄ2整列
LDB MR37800              ; 検査NGﾌﾗｸﾞ
OR LR010                 ; ﾊﾟﾚｯﾄ2OK/NG選択 ON:OK OFF:NG
ANL
MOV DM328 W2003          ; 自動 X軸ﾊﾟﾚｯﾄ1 枠番号ASCII  PLC→PC X軸ﾊﾟﾚｯﾄ枠番号ASCII
MOV DM348 W2004          ; 自動 Y軸ﾊﾟﾚｯﾄ1 枠番号ASCII  PLC→PC Y軸ﾊﾟﾚｯﾄ枠番号ASCII
MOV DM330 W2005          ; 自動 X軸ﾊﾟﾚｯﾄ1 枠位置ASCII  PLC→PC X軸ﾊﾟﾚｯﾄ枠位置ASCII
MOV #1 W2006             ; PLC→PC ﾊﾟﾚｯﾄ置き位置番号
MOV DM350 W2007          ; 自動 Y軸ﾊﾟﾚｯﾄ1 枠位置ASCII  PLC→PC Y軸ﾊﾟﾚｯﾄ枠位置ASCII
LD MR3315                ; ﾊﾟﾚｯﾄ2整列
LD MR37800               ; 検査NGﾌﾗｸﾞ
ANB LR010                ; ﾊﾟﾚｯﾄ2OK/NG選択 ON:OK OFF:NG
ORL
MOV DM368 W2003          ; 自動 X軸ﾊﾟﾚｯﾄ2 枠番号ASCII  PLC→PC X軸ﾊﾟﾚｯﾄ枠番号ASCII
MOV DM388 W2004          ; 自動 Y軸ﾊﾟﾚｯﾄ2 枠番号ASCII  PLC→PC Y軸ﾊﾟﾚｯﾄ枠番号ASCII
MOV DM370 W2005          ; 自動 X軸ﾊﾟﾚｯﾄ2 枠位置ASCII  PLC→PC X軸ﾊﾟﾚｯﾄ枠位置ASCII
MOV #2 W2006             ; PLC→PC ﾊﾟﾚｯﾄ置き位置番号
MOV DM390 W2007          ; 自動 Y軸ﾊﾟﾚｯﾄ2 枠位置ASCII  PLC→PC Y軸ﾊﾟﾚｯﾄ枠位置ASCII
LD CR2002                ; 常時ON
BMOV FM9100 W2020 #6     ; ﾊﾟﾚｯﾄﾚｼﾋﾟ(名称)  PLC→PC ﾊﾟﾚｯﾄ1名称
BMOV FM9100 W2030 #6     ; ﾊﾟﾚｯﾄﾚｼﾋﾟ(名称)  PLC→PC ﾊﾟﾚｯﾄ2名称
END
ENDH
