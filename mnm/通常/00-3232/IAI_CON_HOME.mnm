DEVICE:53
;MODULE:IAI_CON_HOME
;MODULE_TYPE:1
;SupportMacro
;
;-----------------------------------------
;Macro Name 	: 	IAI_CON_HOME
;Macro Type	:	Self Holding
;Function	:	IAI CON系原点復帰ﾏｸﾛ
;-----------------------------------------
;引数：
;	P0  =   現在位置格納番地		DM番号で指定	P1 = Current Position Address 
;	P1	=	RB入力先頭番地			DM番号で指定	P2 = Input Leading Address for RB
;	P2  =	RB出力先頭番地			DM番号で指定	P3 = Output Leading Address for RB
;	P3  =   完了フラグ
;	P4  =   完了コード								P4 = Macro Complete Code
;			#20 	= 正常終了							#20 = No Error
;			#21 	= RB応答なし						#21 = Non Responce
;			#22 	= ｽﾃｰﾀｽ異常							#22 = Status Abnormal
;			#1-16	= RBｱﾗｰﾑ(取説PIOｱﾗｰﾑｺｰﾄﾞ参照)		#1-16 = RB Alarm(Refer the Controller Manual)
;機能：
;	ACON/PCON/SCON用原点復帰指令ﾏｸﾛ/ Robot Homimng Macro for Numerical Move Mode
LD @CR2008
DW K0 P4                 ; C_CODE
CON
ZRES @M2 @M15
CON
SET @M0
;RBｽﾃｰﾀｽﾓﾆﾀｰ / Status Monitoring
BLD P1:#7 K3             ; RB_IN
OUT @M14                 ; ｱﾗｰﾑ発生
BLD P1:#7 K4             ; RB_IN
BANB P1:#7 K8            ; RB_IN
BAND P1:#7 K14           ; RB_IN
BANB P1:#7 K15           ; RB_IN
OUT @M1                  ; RB移動許可
;ｱﾗｰﾑ処理
LDP @M14                 ; ｱﾗｰﾑ発生
MOV P1:#6 P4             ; RB_IN  C_CODE
ZRES @M0 @M15
CON
SET P3                   ; END_FLAG
;RB状態ﾁｪｯｸ /　Robot Status Check
STG @M0
MPS
AND @M1                  ; RB移動許可
BRES P2:#7 K0            ; RB_OUT
CON
BANB P1:#7 K2            ; RB_IN
TMR @4 K2
CON
AND @T4
JMP @M2
MPP
LDB @M1                  ; RB移動許可
AND CR2003               ; 常時OFF
ANL
DW K22 P4                ; C_CODE
CON
JMP @M15
STG @M2
BSET P2:#7 K1            ; RB_OUT
CON
MPS
BAND P1:#7 K0            ; RB_IN
JMP @M3
MPP
BANB P1:#7 K0            ; RB_IN
JMP @M4
STG @M3
MPS
BANB P1:#7 K0            ; RB_IN
BRES P2:#7 K1            ; RB_OUT
CON
JMP @M5
MPP
BAND P1:#7 K0            ; RB_IN
TMR @1 V0                ; TIMEOUT
CON
AND @T1
AND CR2003               ; 常時OFF
BRES P2:#7 K1            ; RB_OUT
CON
DW K21 P4                ; C_CODE
CON
JMP @M15
STG @M4
MPS
BAND P1:#7 K2            ; RB_IN
BRES P2:#7 K1            ; RB_OUT
CON
JMP @M5
MPP
BAND P1:#7 K0            ; RB_IN
TMR @3 V0                ; TIMEOUT
CON
AND @T3
AND CR2003               ; 常時OFF
BRES P2:#7 K1            ; RB_OUT
CON
DW K21 P4                ; C_CODE
CON
JMP @M15
STG @M5
MPS
BLDB P1:#7 K2            ; RB_IN
BAND P1:#7 K0            ; RB_IN
ANL
BRES P2:#7 K1            ; RB_OUT
CON
JMP @M6
MPP
BAND P1:#7 K0            ; RB_IN
TMR @2 V0                ; TIMEOUT
CON
AND @T2
AND CR2003               ; 常時OFF
BRES P2:#7 K1            ; RB_OUT
CON
DW K21 P4                ; C_CODE
CON
JMP @M15
STG @M6
DW K20 P4                ; C_CODE
CON
JMP @M15
STG @M15
SET P3                   ; END_FLAG
CON
ENDS
;終了処理
LD P5                    ; EMG_FLAG
ZRES @M0 @M15
LD P3                    ; END_FLAG
OR P5                    ; EMG_FLAG
MEND
END
ENDH
