DEVICE:53
;MODULE:ORIGIN_K
;MODULE_TYPE:1
;SCRIPT_TYPE:
LD @CR2008
ZRES @M0 @M15            ; 押し当て原点復帰開始
FMOV K0 @D0 K4           ; Type No.
RES P1                   ; MC MACRO END
ADRSET UR0 @E0           ; UT No.  Axis Head address
MPS
LDA V0                   ; AXIX No.
CON
SUB K1
CON
MUL K128
CON
ADD K640
CON
STA @E4                  ; Axis select offset
CON
ADRADD.S @E4 @E0         ; Axis select offset  Axis Head address
MRD
RES @M1                  ; 原点復帰方法設定完了
MRD
AND CR2003               ; 常時OFF
SET *@E0:#2              ; Axis Head address
MPP
SET @M0                  ; 押し当て原点復帰開始
LD CR2003                ; 常時OFF
RES P0                   ; ERROR No.
;押し当て原点復帰
STG @M0                  ; 押し当て原点復帰開始
AND @M1                  ; 原点復帰方法設定完了
JMP @M2
;@D0 = 14192 + 50*(V0-1)                 '原点復帰方法を押し当てに
;UWRIT(#4,@D0,#200,#1)
;
;@D1 = 14174 + 50*(V0-1)                 '原点復帰方向を負方向に
;UREAD(#4,@D1,@d2,#1)          
;BRES(@D2,#15)
;UWRIT(#4,@D1,@D2,#1)
;
;SET(@M1)
LD @M0                   ; 押し当て原点復帰開始
NCJ K1000
;@D0 = 14192 + 50*(V0-1)                 '原点復帰方法を押し当てに
;
LD CR2002                ; 常時ON
LDA V0                   ; AXIX No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +50
CON
ADD.L +14192
CON
STA @D0                  ; Type No.
;UWRIT(#4,@D0,#200,#1)
;
LD CR2002                ; 常時ON
UWRIT K4 @D0 K200 K1     ; Type No.
;@D1 = 14174 + 50*(V0-1)                 '原点復帰方向を負方向に
;
LD CR2002                ; 常時ON
LDA V0                   ; AXIX No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +50
CON
ADD.L +14174
CON
STA @D1                  ; POSITION No.
;UREAD(#4,@D1,@d2,#1)          
;
LD CR2002                ; 常時ON
UREAD K4 @D1 @D2 K1      ; POSITION No.
;BRES(@D2,#15)
;
LD CR2002                ; 常時ON
BRES @D2 K15
;UWRIT(#4,@D1,@D2,#1)
;
LD CR2002                ; 常時ON
UWRIT K4 @D1 @D2 K1      ; POSITION No.
;SET(@M1)
LD CR2002                ; 常時ON
SET @M1                  ; 原点復帰方法設定完了
LABEL K1000
;
STG @M2
RES @M1                  ; 原点復帰方法設定完了
CON
SET *@E0:#12             ; Axis Head address
CON
JMP @M3
STG @M3
AND *@E0:#68             ; Axis Head address
JMP @M4
STG @M4
ANB *@E0:#68             ; Axis Head address
AND *@E0:#76             ; Axis Head address
RES *@E0:#12             ; Axis Head address
CON
JMP @M5
STG @M5
ANB *@E0:#76             ; Axis Head address
SET P1                   ; MC MACRO END
CON
ENDS
;即Z相原点復帰
STG @M6
AND @M7                  ; 原点復帰方法設定完了
JMP @M8
;@D0 = 14192 + 50*(V0-1)                 '原点復帰方法を即Z相原点復帰に
;UWRIT(#4,@D0,#5,#1)
;
;@D1 = 14174 + 50*(V0-1)                 '原点復帰方向を正方向に
;UREAD(#4,@D1,@D2,#1)          
;BSET(@D2,#15)
;UWRIT(#4,@D1,@D2,#1)
;
;SET(@M7)
LD @M6
NCJ K1001
;@D0 = 14192 + 50*(V0-1)                 '原点復帰方法を即Z相原点復帰に
;
LD CR2002                ; 常時ON
LDA V0                   ; AXIX No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +50
CON
ADD.L +14192
CON
STA @D0                  ; Type No.
;UWRIT(#4,@D0,#5,#1)
;
LD CR2002                ; 常時ON
UWRIT K4 @D0 K5 K1       ; Type No.
;@D1 = 14174 + 50*(V0-1)                 '原点復帰方向を正方向に
;
LD CR2002                ; 常時ON
LDA V0                   ; AXIX No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +50
CON
ADD.L +14174
CON
STA @D1                  ; POSITION No.
;UREAD(#4,@D1,@D2,#1)          
;
LD CR2002                ; 常時ON
UREAD K4 @D1 @D2 K1      ; POSITION No.
;BSET(@D2,#15)
;
LD CR2002                ; 常時ON
BSET @D2 K15
;UWRIT(#4,@D1,@D2,#1)
;
LD CR2002                ; 常時ON
UWRIT K4 @D1 @D2 K1      ; POSITION No.
;SET(@M7)
LD CR2002                ; 常時ON
SET @M7                  ; 原点復帰方法設定完了
LABEL K1001
;
STG @M8
RES @M7                  ; 原点復帰方法設定完了
CON
SET *@E0:#652            ; Axis Head address
CON
JMP @M9
STG @M9
AND *@E0:#708            ; Axis Head address
JMP @M10
STG @M10
ANB *@E0:#708            ; Axis Head address
AND *@E0:#716            ; Axis Head address
RES *@E0:#652            ; Axis Head address
CON
JMP @M11
STG @M11
ANB *@E0:#716            ; Axis Head address
JMP @M12
;設定を押し付けに戻します
STG @M12
AND @M13                 ; 原点復帰方法設定完了
JMP @M14
;@D0 = 14192 + 50*(V0-1)                 '原点復帰方法を押し当てに
;UWRIT(#4,@D0,#200,#1)
;
;@D1 = 14174 + 50*(V0-1)                 '原点復帰方向を負方向に
;UREAD(#4,@D1,@D2,#1)          
;BRES(@D2,#15)
;UWRIT(#4,@D1,@D2,#1)
;
;SET(@M13)
LD @M0                   ; 押し当て原点復帰開始
NCJ K1002
;@D0 = 14192 + 50*(V0-1)                 '原点復帰方法を押し当てに
;
LD CR2002                ; 常時ON
LDA V0                   ; AXIX No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +50
CON
ADD.L +14192
CON
STA @D0                  ; Type No.
;UWRIT(#4,@D0,#200,#1)
;
LD CR2002                ; 常時ON
UWRIT K4 @D0 K200 K1     ; Type No.
;@D1 = 14174 + 50*(V0-1)                 '原点復帰方向を負方向に
;
LD CR2002                ; 常時ON
LDA V0                   ; AXIX No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +50
CON
ADD.L +14174
CON
STA @D1                  ; POSITION No.
;UREAD(#4,@D1,@D2,#1)          
;
LD CR2002                ; 常時ON
UREAD K4 @D1 @D2 K1      ; POSITION No.
;BRES(@D2,#15)
;
LD CR2002                ; 常時ON
BRES @D2 K15
;UWRIT(#4,@D1,@D2,#1)
;
LD CR2002                ; 常時ON
UWRIT K4 @D1 @D2 K1      ; POSITION No.
;SET(@M13)
LD CR2002                ; 常時ON
SET @M13                 ; 原点復帰方法設定完了
LABEL K1002
;
STG @M14
RES @M13                 ; 原点復帰方法設定完了
CON
SET P1                   ; MC MACRO END
CON
ENDS
END
ENDH
