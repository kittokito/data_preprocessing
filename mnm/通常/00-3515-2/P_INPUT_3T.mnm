DEVICE:53
;MODULE:P_INPUT_3T
;MODULE_TYPE:1
;SCRIPT_TYPE:
LD @CR2008
ZRES @M0 @M15            ; 転送開始
FMOV K0 @D0 K16          ; Type No.
MOV V0 @D0               ; TYPE_No  Type No.
MPS
MOV V1 @D1               ; POSITION_No  POSITION No.
MPP
LD>= V0 K1               ; TYPE_No
AND<= V0 K10             ; TYPE_No
AND>= V1 K61             ; POSITION_No
AND<= V1 K100            ; POSITION_No
ANL
SET @M0                  ; 転送開始
;IF @D1 <= 80 THEN                       'Y AXIX No. SELECT
;  @D2 = 1
;ELSE
;  @D2 = 2
;END IF
; 
;'@D3 = (@D0 - 1) * 4                     'Type別保存用
;@D3 = 0                                 '1-100保存用
;@D4 = (@D1-1) / 25
;@D5 = @D3 + @D4                         'BANK No.
;@D6 = @D1 - @D4 * 25                    'P-No. in BANK
;
;UWRIT(#5,#98,@D5,#1)                    'BANK CHANGE
;
;@D7 = 18016 + 512*(@D6-1)               'POSITION DATA ADDRESS
;@D8 = 18048 + 512*(@D6-1)
;@D9 = 18048 + 32*@D2 + 512*(@D6-1)
;
;
;IF (@D1 <> 61)AND(@D1 <> 81) THEN
;  @D10 = 18028 + 512*(@D6-1)              'SPEED DATA ADDRESS 
;  @D11 = 18060 + 512*(@D6-1)
;  @D12 = 18060 + 32*@D2 + 512*(@D6-1)
;END IF
;
;
;@D13 = 18013 + 512*(@D6-1)              'ARC DATA ADDRESS
;
;Z1 = 10*(@D1 - 61)
;Z2 = Z1 +4
;Z3 = Z1 +2
;Z4 = Z1 +6
;Z5 = @D1 -61
;
;UWRIT(#5,@D7,E2000:Z1,#2)               'POSITION X WRITE
;UWRIT(#5,@D8,E2000:Z2,#2)               'POSITION Z WRITE
;UWRIT(#5,@D9,E2000:Z3,#2)               'POSITION Y1 WRITE
;
;UWRIT(#5,@D10,E2000:Z4,#2)              'SPEED X WRITE
;UWRIT(#5,@D11,E2000:Z4,#2)              'SPEED Z WRITE
;UWRIT(#5,@D12,E2000:Z4,#2)              'SPEED Y1 WRITE
;
;@D14 = E3200:Z5
;
;IF @D14.2 = 1 THEN                      'ARC WRITE
;  UWRIT(#5,@D13,#3,#1)
;ELSE
;  UWRIT(#5,@D13,#0,#1)
;END IF
;
;UWRIT(#5,#98,#0,#1)
;
;RES(@M0)
;SET(@M1)
;
LD @M0                   ; 転送開始
NCJ K1000
;IF @D1 <= 80 THEN                       'Y AXIX No. SELECT
;
LD<= @D1 K80             ; POSITION No.
NCJ K2000
;  @D2 = 1
;
LD CR2002                ; 常時ON
MOV K1 @D2
;ELSE
;
LD CR2002                ; 常時ON
CJ K2001
LABEL K2000
;  @D2 = 2
;
LD CR2002                ; 常時ON
MOV K2 @D2
;END IF
;
LABEL K2001
;'@D3 = (@D0 - 1) * 4                     'Type別保存用
;
;@D3 = 0                                 '1-100保存用
;
LD CR2002                ; 常時ON
MOV K0 @D3
;@D4 = (@D1-1) / 25
;
LD CR2002                ; 常時ON
LDA @D1                  ; POSITION No.
CON
EXT
CON
SUB.L +1
CON
EXT.L
CON
DIV.L +25
CON
STA @D4
;@D5 = @D3 + @D4                         'BANK No.
;
LD CR2002                ; 常時ON
LDA @D4
CON
EXT
CON
STA.L @VM0
CON
LDA @D3
CON
EXT
CON
ADD.L @VM0
CON
STA @D5
;@D6 = @D1 - @D4 * 25                    'P-No. in BANK
;
LD CR2002                ; 常時ON
LDA @D4
CON
EXT
CON
MUL.L +25
CON
STA.L @VM2
CON
LDA @D1                  ; POSITION No.
CON
EXT
CON
SUB.L @VM2
CON
STA @D6
;UWRIT(#5,#98,@D5,#1)                    'BANK CHANGE
;
LD CR2002                ; 常時ON
UWRIT K5 K98 @D5 K1
;@D7 = 18016 + 512*(@D6-1)               'POSITION DATA ADDRESS
;
LD CR2002                ; 常時ON
LDA @D6
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @D7
;@D8 = 18048 + 512*(@D6-1)
;
LD CR2002                ; 常時ON
LDA @D6
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @D8
;@D9 = 18048 + 32*@D2 + 512*(@D6-1)
;
LD CR2002                ; 常時ON
LDA @D6
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
STA.L @VM4
CON
LDA @D2
CON
EXT
CON
MUL.L +32
CON
ADD.L +18048
CON
ADD.L @VM4
CON
STA @D9
;IF (@D1 <> 61)AND(@D1 <> 81) THEN
;
LD<> @D1 K61             ; POSITION No.
OUT @VB00
LD<> @D1 K81             ; POSITION No.
AND @VB00
NCJ K2002
;  @D10 = 18028 + 512*(@D6-1)              'SPEED DATA ADDRESS 
;
LD CR2002                ; 常時ON
LDA @D6
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @D10
;  @D11 = 18060 + 512*(@D6-1)
;
LD CR2002                ; 常時ON
LDA @D6
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @D11
;  @D12 = 18060 + 32*@D2 + 512*(@D6-1)
;
LD CR2002                ; 常時ON
LDA @D6
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
STA.L @VM6
CON
LDA @D2
CON
EXT
CON
MUL.L +32
CON
ADD.L +18060
CON
ADD.L @VM6
CON
STA @D12
;END IF
;
LABEL K2002
;@D13 = 18013 + 512*(@D6-1)              'ARC DATA ADDRESS
;
LD CR2002                ; 常時ON
LDA @D6
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18013
CON
STA @D13
;Z1 = 10*(@D1 - 61)
;
LD CR2002                ; 常時ON
LDA @D1                  ; POSITION No.
CON
EXT
CON
SUB.L +61
CON
MUL.L +10
CON
STA.L Z1
;Z2 = Z1 +4
;
LD CR2002                ; 常時ON
LDA.L Z1
CON
ADD.L +4
CON
STA.L Z2
;Z3 = Z1 +2
;
LD CR2002                ; 常時ON
LDA.L Z1
CON
ADD.L +2
CON
STA.L Z3
;Z4 = Z1 +6
;
LD CR2002                ; 常時ON
LDA.L Z1
CON
ADD.L +6
CON
STA.L Z4
;Z5 = @D1 -61
;
LD CR2002                ; 常時ON
LDA @D1                  ; POSITION No.
CON
EXT
CON
SUB.L +61
CON
STA.L Z5
;UWRIT(#5,@D7,E2000:Z1,#2)               'POSITION X WRITE
;
LD CR2002                ; 常時ON
UWRIT K5 @D7 E2000:Z1 K2 ; X_P61
;UWRIT(#5,@D8,E2000:Z2,#2)               'POSITION Z WRITE
;
LD CR2002                ; 常時ON
UWRIT K5 @D8 E2000:Z2 K2 ; X_P61
;UWRIT(#5,@D9,E2000:Z3,#2)               'POSITION Y1 WRITE
;
LD CR2002                ; 常時ON
UWRIT K5 @D9 E2000:Z3 K2 ; X_P61
;UWRIT(#5,@D10,E2000:Z4,#2)              'SPEED X WRITE
;
LD CR2002                ; 常時ON
UWRIT K5 @D10 E2000:Z4 K2; X_P61
;UWRIT(#5,@D11,E2000:Z4,#2)              'SPEED Z WRITE
;
LD CR2002                ; 常時ON
UWRIT K5 @D11 E2000:Z4 K2; X_P61
;UWRIT(#5,@D12,E2000:Z4,#2)              'SPEED Y1 WRITE
;
LD CR2002                ; 常時ON
UWRIT K5 @D12 E2000:Z4 K2; X_P61
;@D14 = E3200:Z5
;
LD CR2002                ; 常時ON
MOV E3200:Z5 @D14        ; P61 FLG
;IF @D14.2 = 1 THEN                      'ARC WRITE
;
LD @D14.2
NCJ K2003
;  UWRIT(#5,@D13,#3,#1)
;
LD CR2002                ; 常時ON
UWRIT K5 @D13 K3 K1
;ELSE
;
LD CR2002                ; 常時ON
CJ K2004
LABEL K2003
;  UWRIT(#5,@D13,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT K5 @D13 K0 K1
;END IF
;
LABEL K2004
;UWRIT(#5,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT K5 K98 K0 K1
;RES(@M0)
;
LD CR2002                ; 常時ON
RES @M0                  ; 転送開始
;SET(@M1)
;
LD CR2002                ; 常時ON
SET @M1                  ; 転送終了
LABEL K1000
;
LD @M1                   ; 転送終了
SET P0                   ; END_FLG
CON
RES @M1                  ; 転送終了
END
ENDH
