DEVICE:53
;MODULE:D_INPUT_CHUK
;MODULE_TYPE:1
;SMC Chuck ﾃﾞｰﾀ書き込み
;Data input to SMC chuck controller
;Acceleration 
;  1000 → 59395
;　1500 → 56325 
;  2000 → 53255
;　3000 → 47115
LD @CR2008
ZRES @M0 @M15            ; ﾃﾞｰﾀ変換
FMOV K0 @D0 K10          ; Axis No.
MOV V0 @D0               ; Axix_No.  Axis No.
MPS
LDA @D0                  ; Axis No.
CON
SUB K1
CON
MUL K9
CON
STA Z1
MRD
ADRSET D32516:Z1 @E0     ; ID1 起動ﾌﾗｸﾞ/ｽﾃｯﾌﾟNo./動作方法  Axis INPUT Head address
MRD
ADRSET D32324:Z1 @E2     ; ID1 ｺﾝﾄﾛｰﾗIF状態ﾌﾗｸﾞ
MRD
MOV V1 @D1               ; Point_No.  書き込み動作方法
MRD
MOV V3 @D2               ; Vel._Data  書き込み速度ﾃﾞｰﾀ
MRD
MOV.D V2 @D3             ; Pos_Data  書き込み位置ﾃﾞｰﾀ1
MRD
MOV.D V4 @D8             ; P_Power  押当推力
MRD
MOV.D V5 @D9             ; Threshold  閾値
MPP
SET @M0                  ; ﾃﾞｰﾀ変換
LD CR2002                ; 常時ON
MOV *@E2 @D6             ; ｺﾝﾄﾛｰﾗIF状態ﾌﾗｸﾞ
STG @M0                  ; ﾃﾞｰﾀ変換
BSWAP @D2 K3             ; 書き込み速度ﾃﾞｰﾀ
XCH @D3 @D4              ; 書き込み位置ﾃﾞｰﾀ1  書き込み位置ﾃﾞｰﾀ2
MPS
AND CR2002               ; 常時ON
MPS
LDA @D9                  ; 閾値
CON
SWAP
CON
STA @D10                 ; 閾値書込用計算ﾃﾞｰﾀ
MPP
CAL+ @D10 @D8 @D12       ; 閾値書込用計算ﾃﾞｰﾀ  押当推力  #6書込ﾃﾞｰﾀ
MRD
AND CR2002               ; 常時ON
MPS
LDA K10
CON
SWAP
CON
STA @D14                 ; 位置決め推力書込用計算ﾃﾞｰﾀ
MPP
CAL+ @D14 K5 @D16        ; 位置決め推力書込用計算ﾃﾞｰﾀ  #7書込ﾃﾞｰﾀ
MRD
LDA K500
CON
SWAP
CON
STA @D20                 ; #8書込ﾃﾞｰﾀ
MPP
JMP @M1                  ; ﾃﾞｰﾀ書き込み
;#0･････動作方法,Point No.,     #5･････Deceleration
;#1･････Velocity                #6･････Push power,Threshold
;#2,3･･･Position                #7･････Push speed,Positioning thrust
;#4･････Acceleration            #8･････Inposition
STG @M1                  ; ﾃﾞｰﾀ書き込み
BMOV @D1 *@E0 K4         ; 書き込み動作方法  Axis INPUT Head address
MOV K56325 *@E0:#4       ; Axis INPUT Head address
MOV K47115 *@E0:#5       ; Axis INPUT Head address
MOV @D12 *@E0:#6         ; #6書込ﾃﾞｰﾀ  Axis INPUT Head address
MOV @D16 *@E0:#7         ; #7書込ﾃﾞｰﾀ  Axis INPUT Head address
MOV @D20 *@E0:#8         ; #8書込ﾃﾞｰﾀ  Axis INPUT Head address
JMP @M2                  ; ﾃﾞｰﾀ転送
STG @M2                  ; ﾃﾞｰﾀ転送
ANPB @M2                 ; ﾃﾞｰﾀ転送
BSET *@E0 K8             ; Axis INPUT Head address
CON
JMP @M3                  ; 転送完了待ち
STG @M3                  ; 転送完了待ち
AND @D6.8
BRES *@E0 K8             ; Axis INPUT Head address
CON
JMP @M4                  ; 転送完了
STG @M4                  ; 転送完了
ANB @D6.8
SET P0                   ; End_FLG.
CON
ENDS
END
ENDH
