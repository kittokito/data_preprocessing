DEVICE:53
;MODULE:Communication
;MODULE_TYPE:0
;<h1/>ＰＣ動作チェック
LD W00.0                 ; PC動作中
TMR K2500 K50            ; PC正常確認ﾀｲﾏ
LDB W00.0                ; PC動作中
TMR K2501 K50            ; PC正常確認ﾀｲﾏ
LDB T2500                ; PC正常確認ﾀｲﾏ
ANB T2501                ; PC正常確認ﾀｲﾏ
OR M3                    ; OFFLINE_MODE
OUT M300                 ; PC通信正常
;<h1/>ｴﾗｰｺｰﾄﾞ送信（ｴﾗｰﾛｸﾞ用)
LD CR2008                ; 運転開始時1ｽｷｬﾝON
FMOV K0 D900 K64         ; FIFO_DATA_VALUE
DW K0 D900               ; FIFO_DATA_VALUE
CON
DW K64 D901              ; 格納異常数
LD<> D902 K0             ; ｴﾗｰｺｰﾄﾞ最終
ANB M14520               ; 異常ﾛｸﾞ通信開始
AND= D13000 K0           ; 通信STEP
ANB W00.4                ; ｴﾗｰﾛｸﾞ完了
OR M14520                ; 異常ﾛｸﾞ通信開始
ANB M14515               ; ｴﾗｰﾛｸﾞ完了
OUT M14520               ; 異常ﾛｸﾞ通信開始
LD CR2002                ; 常時ON
FMOV K0 M14500 K1        ; 異常ﾛｸﾞ通信中
LDB M14520               ; 異常ﾛｸﾞ通信開始
MOV K0 D13000            ; 通信STEP
LD M14520                ; 異常ﾛｸﾞ通信開始
MOV D13000 Z2            ; 通信STEP
OUT M14500:Z2            ; 異常ﾛｸﾞ通信中
LD M14500                ; 異常ﾛｸﾞ通信中
INC D13000               ; 通信STEP
LD M14501                ; 異常内容読出し
@FIFOR D900 D13102       ; FIFO_DATA_VALUE  ｴﾗｰｺｰﾄﾞ(ﾛｸﾞ保存用)
CAL+ D13102 K0 W0112     ; ｴﾗｰｺｰﾄﾞ(ﾛｸﾞ保存用)  ｴﾗｰｺｰﾄﾞ(ﾛｸﾞ保存用)
INC D13000               ; 通信STEP
LD M14502                ; ｴﾗｰﾛｸﾞ読込み要求ON
MPS
LDB M3                   ; OFFLINE_MODE
AND M300                 ; PC通信正常
ANL
MPS
OUT W0100.5              ; ｴﾗｰﾛｸﾞ要求
MPP
AND W00.4                ; ｴﾗｰﾛｸﾞ完了
INC D13000               ; 通信STEP
MPP
LD M3                    ; OFFLINE_MODE
ORB M300                 ; PC通信正常
ANL
INC D13000               ; 通信STEP
LD M14503                ; ﾃﾞｰﾀｸﾘｱｰ
LDB M3                   ; OFFLINE_MODE
AND M300                 ; PC通信正常
ANB W00.4                ; ｴﾗｰﾛｸﾞ完了
OR M3                    ; OFFLINE_MODE
ORB M300                 ; PC通信正常
ANL
@MOV K0 W0112            ; ｴﾗｰｺｰﾄﾞ(ﾛｸﾞ保存用)
INC D13000               ; 通信STEP
LD M14504                ; ｴﾗｰﾛｸﾞ完了確認
MOV K15 D13000           ; 通信STEP
;<h1/>ｴﾗｰｺｰﾄﾞ送信（表示用）
LD CR2002                ; 常時ON
ANB M14620               ; 異常発生Bitｻｰﾁ開始ON
AND= D13100 K0
OR M14620                ; 異常発生Bitｻｰﾁ開始ON
ANB M14615               ; 異常発生Bitｻｰﾁ終了
OUT M14620               ; 異常発生Bitｻｰﾁ開始ON
LD CR2002                ; 常時ON
FMOV K0 M14600 K1        ; 異常発生Bitｻｰﾁ開始
LDB M14620               ; 異常発生Bitｻｰﾁ開始ON
MOV K0 D13100
LD M14620                ; 異常発生Bitｻｰﾁ開始ON
MOV D13100 Z2
OUT M14600:Z2            ; 異常発生Bitｻｰﾁ開始
LD M14600                ; 異常発生Bitｻｰﾁ開始
INC D13100
LD M14601                ; ｻｰﾁ番号ﾘｾｯﾄ
MOV K0 Z6
INC D13100
LD M14602                ; ﾙｰﾌﾟ開始/ｴﾗｰBitON確認
MPS
AND B00:Z6               ; B000_001)非常停止異常
INC D13100
MPP
ANB B00:Z6               ; B000_001)非常停止異常
MOV K5 D13100
LD M14603                ; ｴﾗｰｺｰﾄﾞｾｯﾄ
MOV Z6 W0111             ; ｴﾗｰｺｰﾄﾞ(表示用)
CAL+ Z6 K1 W0111         ; ｴﾗｰｺｰﾄﾞ(表示用)
INC D13100
LD M14604                ; 表示中
MPS
TMR K2504 K20            ; 表示時間
MPP
AND T2504                ; 表示時間
INC D13100
LD M14605                ; 最終Bit確認
MPS
AND>= Z6 K800
@MOV K7 D13100
MPP
AND< Z6 K800
INC D13100
LD M14606                ; ｻｰﾁ番号ｶｳﾝﾄｱｯﾌﾟﾙｰﾌﾟ開始へ
@INC Z6
MOV K2 D13100
LD M14607                ; 異常発生Bitｻｰﾁ終了
MOV K15 D13100
;ｴﾗｰ発生判定ﾌﾗｸﾞ追加(ｴﾗｰ発生中はPCに0を送らない対策)
LD CR2002                ; 常時ON
WSUM B00 K40             ; B000_001)非常停止異常
CON
STA D13110               ; ｴﾗｰ発生判定(0で無し)
LDB M14604               ; 表示中
MPS
TMR K2505 K25            ; 表示無し確認
MPP
LD T2505                 ; 表示無し確認
AND= D13110 K0           ; ｴﾗｰ発生判定(0で無し)
ANL
@MOV K0 W0111            ; ｴﾗｰｺｰﾄﾞ(表示用)
;<h1/>PCからﾌﾞｻﾞｰ要求
LD W00.2                 ; PC Busy
OR M14630                ; PC　BUSY　受付
ANB M14633               ; PC　BUSY　OFF確認
AND M300                 ; PC通信正常
OUT M14630               ; PC　BUSY　受付
LDP M14630               ; PC　BUSY　受付
OR M14631                ; ﾌﾞｻﾞｰON
ANB M14632               ; PCへReset sw　ON
AND M14630               ; PC　BUSY　受付
OUT M14631               ; ﾌﾞｻﾞｰON
LD M14631                ; ﾌﾞｻﾞｰON
ANP M110                 ; ﾌﾞｻﾞｰ停止ﾊﾟﾙｽ
OR M14635                ; BZ停止
ANB M14633               ; PC　BUSY　OFF確認
AND M14630               ; PC　BUSY　受付
OUT M14635               ; BZ停止
LD M14631                ; ﾌﾞｻﾞｰON
LDP M111                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
ORB W00.2                ; PC Busy
ANL
OR M14632                ; PCへReset sw　ON
ANB M14633               ; PC　BUSY　OFF確認
AND M14630               ; PC　BUSY　受付
OUT M14632               ; PCへReset sw　ON
LD M14632                ; PCへReset sw　ON
ANB W00.2                ; PC Busy
OR M14633                ; PC　BUSY　OFF確認
AND M14630               ; PC　BUSY　受付
OUT M14633               ; PC　BUSY　OFF確認
;<h1/>ＰＣ　Ｅｒｒｏｒ　処理
LDB M71                  ; 自動運転開始BZ
ANP M111                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
OR M14640                ; PCへReset SW　ON
AND W00.1                ; PC Error
AND M300                 ; PC通信正常
OUT M14640               ; PCへReset SW　ON
LDP B1023                ; 基板取出確認TP-PB
ORP B1024                ; ﾘﾄﾗｲ確認TP-PB
ORP B1025                ; 確認TP_PB
OR M14641                ; PCへReset SW ON
ANB T2506                ; ﾘｾｯﾄ信号ﾀｲﾏ
TMR K2506 K5             ; ﾘｾｯﾄ信号ﾀｲﾏ
OUT M14641               ; PCへReset SW ON
;<h1/>停止ﾓｰﾄﾞ処理
LD M71                   ; 自動運転開始BZ
OR M14650                ; 自動運転中保持
ANB M14653               ; 停止ﾓｰﾄﾞ処理終了
OUT M14650               ; 自動運転中保持
LD M14650                ; 自動運転中保持
AND<> W010 K0            ; 停止ﾓｰﾄﾞ(PC)
@MOV W010 W0110          ; 停止ﾓｰﾄﾞ(PC)  停止ﾓｰﾄﾞ(PLC)
OUT M14651               ; PC→自動運転停止ﾌﾗｸﾞ
LDB T15                  ; 強制停止
ANB M51                  ; 即停止異常(緊急停止)
INV
MEP
OR M14660                ; 即停止異常(緊急停止)記憶
AND M14650               ; 自動運転中保持
OUT M14660               ; 即停止異常(緊急停止)記憶
LDP M56                  ; 自動起動停止指令(ｻｲｸﾙ停止)
AND M52                  ; ｻｲｸﾙ停止異常(ｻｲｸﾙ停止)
OR M14661                ; ｻｲｸﾙ停止異常(ｻｲｸﾙ停止)記憶
AND M14650               ; 自動運転中保持
OUT M14661               ; ｻｲｸﾙ停止異常(ｻｲｸﾙ停止)記憶
LDP M56                  ; 自動起動停止指令(ｻｲｸﾙ停止)
AND M57                  ; 全ﾕﾆｯﾄ払出完了
OR M14662                ; 自動起動停止指令(払出停止)記憶
AND M14650               ; 自動運転中保持
OUT M14662               ; 自動起動停止指令(払出停止)記憶
LD M14650                ; 自動運転中保持
ANF M71                  ; 自動運転開始BZ
OR M14652                ; PCﾃﾞｰﾀ送信
AND M14650               ; 自動運転中保持
OUT M14652               ; PCﾃﾞｰﾀ送信
MPS
LD M14660                ; 即停止異常(緊急停止)記憶
OR M14661                ; ｻｲｸﾙ停止異常(ｻｲｸﾙ停止)記憶
ANL
@MOV K2 W0110            ; 停止ﾓｰﾄﾞ(PLC)
MPP
LD M14662                ; 自動起動停止指令(払出停止)記憶
ANB M14651               ; PC→自動運転停止ﾌﾗｸﾞ
ANL
@MOV K1 W0110            ; 停止ﾓｰﾄﾞ(PLC)
LD M14652                ; PCﾃﾞｰﾀ送信
ANB W0100.2              ; 自動/手動
OR M14653                ; 停止ﾓｰﾄﾞ処理終了
AND M14650               ; 自動運転中保持
MPS
OUT M14653               ; 停止ﾓｰﾄﾞ処理終了
MPP
AND CR2003               ; 常時OFF
@MOV K0 W0110            ; 停止ﾓｰﾄﾞ(PLC)
;<h1/>ＰＣへの出力
LD CR2002                ; 常時ON
ANB T2503                ; PLC起動ﾀｲﾏ2
TMR K2502 K15            ; PLC起動ﾀｲﾏ1
LD T2502                 ; PLC起動ﾀｲﾏ1
TMR K2503 K15            ; PLC起動ﾀｲﾏ2
LD M1                    ; CPU正常
ANB T2502                ; PLC起動ﾀｲﾏ1
OUT W0100.0              ; PLC動作中
LDB M51                  ; 即停止異常(緊急停止)
ANB T15                  ; 強制停止
INV
OUT W0100.1              ; PLC Error
LD M41                   ; ﾕﾆｯﾄ_起動中
OUT W0100.2              ; 自動/手動
LDB M14632               ; PCへReset sw　ON
ANB M14640               ; PCへReset SW　ON
ANB M14641               ; PCへReset SW ON
INV
OUT W0100.3              ; Reset SW受付
LD CR2003                ; 常時OFF
OUT W0100.4              ; ﾀﾞｲｱﾛｸﾞ要求
LD Y203C                 ; ｼｸﾞﾅﾙﾀﾜｰ赤
OUT W0100.8              ; ﾀﾜｰﾗｲﾄ赤
LD Y203D                 ; ｼｸﾞﾅﾙﾀﾜｰ黄
OUT W0100.9              ; ﾀﾜｰﾗｲﾄ黄
LD Y203E                 ; ｼｸﾞﾅﾙﾀﾜｰ緑
OUT W0100.10             ; ﾀﾜｰﾗｲﾄ緑
END
ENDH
