DEVICE:51
;MODULE:UNIT2_Silicon
;MODULE_TYPE:0
;SCRIPT_TYPE:
;設定
;Settings
;Rev12  材料プッシャピッチストロークを２（0.2mm）→４（0.4mm）に変更
;D140.s = 60                                          '制御圧力固定上限値【×0.01MPa】
;D141.s = 5                                           '制御圧力固定下限値【×0.01MPa】
;D160 = 4                                             '材料ﾌﾟｯｼｬﾋﾟｯﾁｽﾄﾛｰｸ(×0.1mm) 【P-CONの設定値と同じ値を入力してください。】
;D161 = 1600	                                         '材料ﾌﾟｯｼｬ異粘度捨出し領域(×0.1mm)【P-CONのZone1と同じ値を入力してください。】
;D140.s = 60                                          '制御圧力固定上限値【×0.01MPa】
;
LD CR2002                ; 常時ON
MOV.S +60 D140           ; 制御圧力固定上限値
;D141.s = 5                                           '制御圧力固定下限値【×0.01MPa】
;
LD CR2002                ; 常時ON
MOV.S +5 D141            ; 制御圧力固定下限値
;D160 = 4                                             '材料ﾌﾟｯｼｬﾋﾟｯﾁｽﾄﾛｰｸ(×0.1mm) 【P-CONの設定値と同じ値を入力してください。】
;
LD CR2002                ; 常時ON
MOV K4 D160              ; 材料ﾌﾟｯｼｬﾋﾟｯﾁｽﾄﾛｰｸ(×0.1mm)
;D161 = 1600	                                         '材料ﾌﾟｯｼｬ異粘度捨出し領域(×0.1mm)【P-CONのZone1と同じ値を入力してください。】
LD CR2002                ; 常時ON
MOV K1600 D161           ; 材料ﾌﾟｯｼｬ異粘度捨出域(×0.1mm)
;
;D124 = E998 + E1002                                  '制御目標圧
;D132 = D124 + E999                                   '上限値設定
;D134 = D124 - E999                                   '下限値設定
;D126 = D132                                          '減圧目標
;D128 = D132                                          '初期加圧目標値
;D136.S = D140.S - E998.S                             'OFFSET入力上限値
;D137.S = D141.S - E998.S                             'OFFSET入力上限値
;
;IF (D140 - E998) <= (E998 - D141) THEN               '制御範囲上限（+側か-側の小さい方）
;  D139 = (D140 - E998)                               '
;ELSE                                                 '
;  D139 = (E998 - D141)                               '
;END IF                                               '
;
;D142 = D140-E999                                     'ﾚﾝｼﾞを加味した制御圧力固定上限値【×0.01MPa】
;D143 = D141+E999                                     'ﾚﾝｼﾞを加味した制御圧力固定下限値【×0.01MPa】
;
;D163 = E1032 / 2                                      '同粘度予想捨出しｶｳﾝﾄ
;D164 = (D161 - E1006 - 150) / 2                      '異粘度予想捨出しｶｳﾝﾄ
;
;D124 = E998 + E1002                                  '制御目標圧
;
LD CR2002                ; 常時ON
LDA E1002                ; ｼﾘｺﾝ圧OFFSET【0.00MPa】
CON
EXT
CON
STA.L @VM0
CON
LDA E998                 ; ｼﾘｺﾝ制御圧目標値【0.00MPa】
CON
EXT
CON
ADD.L @VM0
CON
STA D124                 ; 材料ﾌﾟｯｼｬ +ﾋﾟｯﾁ目標値
;D132 = D124 + E999                                   '上限値設定
;
LD CR2002                ; 常時ON
LDA E999                 ; ｼﾘｺﾝ圧許容範囲【0.00MPa】
CON
EXT
CON
STA.L @VM2
CON
LDA D124                 ; 材料ﾌﾟｯｼｬ +ﾋﾟｯﾁ目標値
CON
EXT
CON
ADD.L @VM2
CON
STA D132                 ; ｼﾘｺﾝ圧上限値【0.00MPa】
;D134 = D124 - E999                                   '下限値設定
;
LD CR2002                ; 常時ON
LDA E999                 ; ｼﾘｺﾝ圧許容範囲【0.00MPa】
CON
EXT
CON
STA.L @VM4
CON
LDA D124                 ; 材料ﾌﾟｯｼｬ +ﾋﾟｯﾁ目標値
CON
EXT
CON
SUB.L @VM4
CON
STA D134                 ; ｼﾘｺﾝ圧下限値【0.00MPa】
;D126 = D132                                          '減圧目標
;
LD CR2002                ; 常時ON
MOV D132 D126            ; ｼﾘｺﾝ圧上限値【0.00MPa】  材料ﾌﾟｯｼｬ -ﾋﾟｯﾁ目標値
;D128 = D132                                          '初期加圧目標値
;
LD CR2002                ; 常時ON
MOV D132 D128            ; ｼﾘｺﾝ圧上限値【0.00MPa】  材料ﾌﾟｯｼｬ -初期加圧終了圧
;D136.S = D140.S - E998.S                             'OFFSET入力上限値
;
LD CR2002                ; 常時ON
LDA.S E998               ; ｼﾘｺﾝ制御圧目標値【0.00MPa】
CON
EXT.S
CON
STA.L @VM6
CON
LDA.S D140               ; 制御圧力固定上限値
CON
EXT.S
CON
SUB.L @VM6
CON
STA.S D136               ; OFFSET入力上限
;D137.S = D141.S - E998.S                             'OFFSET入力上限値
;
LD CR2002                ; 常時ON
LDA.S E998               ; ｼﾘｺﾝ制御圧目標値【0.00MPa】
CON
EXT.S
CON
STA.L @VM8
CON
LDA.S D141               ; 制御圧力固定下限値
CON
EXT.S
CON
SUB.L @VM8
CON
STA.S D137               ; OFFSET入力下限
;IF (D140 - E998) <= (E998 - D141) THEN               '制御範囲上限（+側か-側の小さい方）
;
LD CR2002                ; 常時ON
LDA E998                 ; ｼﾘｺﾝ制御圧目標値【0.00MPa】
CON
EXT
CON
STA.L @VM10
CON
LDA D140                 ; 制御圧力固定上限値
CON
EXT
CON
SUB.L @VM10
CON
STA.L @VM12
CON
LDA D141                 ; 制御圧力固定下限値
CON
EXT
CON
STA.L @VM14
CON
LDA E998                 ; ｼﾘｺﾝ制御圧目標値【0.00MPa】
CON
EXT
CON
SUB.L @VM14
CON
CMP.L @VM12
LDB CR2009               ; 演算結果が負
NCJ K2000
;  D139 = (D140 - E998)                               '
;
LD CR2002                ; 常時ON
LDA E998                 ; ｼﾘｺﾝ制御圧目標値【0.00MPa】
CON
EXT
CON
STA.L @VM16
CON
LDA D140                 ; 制御圧力固定上限値
CON
EXT
CON
SUB.L @VM16
CON
STA D139                 ; ｼﾘｺﾝ圧許容範囲限度【0.00MPa】
;ELSE                                                 '
;
LD CR2002                ; 常時ON
CJ K2001
LABEL K2000
;  D139 = (E998 - D141)                               '
;
LD CR2002                ; 常時ON
LDA D141                 ; 制御圧力固定下限値
CON
EXT
CON
STA.L @VM18
CON
LDA E998                 ; ｼﾘｺﾝ制御圧目標値【0.00MPa】
CON
EXT
CON
SUB.L @VM18
CON
STA D139                 ; ｼﾘｺﾝ圧許容範囲限度【0.00MPa】
;END IF                                               '
;
LABEL K2001
;D142 = D140-E999                                     'ﾚﾝｼﾞを加味した制御圧力固定上限値【×0.01MPa】
;
LD CR2002                ; 常時ON
LDA E999                 ; ｼﾘｺﾝ圧許容範囲【0.00MPa】
CON
EXT
CON
STA.L @VM20
CON
LDA D140                 ; 制御圧力固定上限値
CON
EXT
CON
SUB.L @VM20
CON
STA D142                 ; ﾚﾝｼﾞ込制御圧力固定上限値
;D143 = D141+E999                                     'ﾚﾝｼﾞを加味した制御圧力固定下限値【×0.01MPa】
;
LD CR2002                ; 常時ON
LDA E999                 ; ｼﾘｺﾝ圧許容範囲【0.00MPa】
CON
EXT
CON
STA.L @VM22
CON
LDA D141                 ; 制御圧力固定下限値
CON
EXT
CON
ADD.L @VM22
CON
STA D143                 ; ﾚﾝｼﾞ込制御圧力固定下限値
;D163 = E1032 / 2                                      '同粘度予想捨出しｶｳﾝﾄ
;
LD CR2002                ; 常時ON
LDA E1032
CON
EXT
CON
EXT.L
CON
DIV.L +2
CON
STA D163                 ; 同粘度予想捨出しｶｳﾝﾄ数
;D164 = (D161 - E1006 - 150) / 2                      '異粘度予想捨出しｶｳﾝﾄ
;
LD CR2002                ; 常時ON
LDA E1006                ; 予測接触点位置(×0.1mm)
CON
EXT
CON
STA.L @VM24
CON
LDA D161                 ; 材料ﾌﾟｯｼｬ異粘度捨出域(×0.1mm)
CON
EXT
CON
SUB.L @VM24
CON
SUB.L +150
CON
EXT.L
CON
DIV.L +2
CON
STA D164                 ; 異粘度予想捨出しｶｳﾝﾄ数
;
LD= D12000 K401          ; 表示画面No.
MEP
BMOV E998 D998 K2        ; ｼﾘｺﾝ制御圧目標値【0.00MPa】  ｼﾘｺﾝ制御圧目標値記憶
LD= E998 D998            ; ｼﾘｺﾝ制御圧目標値【0.00MPa】  ｼﾘｺﾝ制御圧目標値記憶
AND= D999 E999           ; ｼﾘｺﾝ圧許容範囲記憶  ｼﾘｺﾝ圧許容範囲【0.00MPa】
INV
MPS
RES M40                  ; Dispence Daily check OK
CON
DW K0 E1002              ; ｼﾘｺﾝ圧OFFSET【0.00MPa】
MPP
BMOV E998 D998 K2        ; ｼﾘｺﾝ制御圧目標値【0.00MPa】  ｼﾘｺﾝ制御圧目標値記憶
;動作可能条件
;Operation status
LD T1201                 ; 捨て打ちｶｯﾌﾟ検出
OR M25                   ; 吐出無し
AND T1200                ; 封止ｶｯﾌﾟ検出
ANB M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
AND M2701                ; 加圧開始
AND R3000                ; ｼﾘｺﾝ圧力　正常
OUT R3011                ; ﾎﾟｯﾃｨﾝｸﾞ部準備OK
;<h1/>状態監視
;Status check
;圧力監視
;Resin pressure check
LD=.S D132 D12225        ; ｼﾘｺﾝ圧上限値【0.00MPa】  ch0_AD ｺﾝﾊﾟﾚｰﾀ上限値ONﾚﾍﾞﾙ
AND=.S D134 D12227       ; ｼﾘｺﾝ圧下限値【0.00MPa】  ch0_AD ｺﾝﾊﾟﾚｰﾀ下限値OFFﾚﾍﾞﾙ
INV
FMOV D132 D12225 K2      ; ｼﾘｺﾝ圧上限値【0.00MPa】  ch0_AD ｺﾝﾊﾟﾚｰﾀ上限値ONﾚﾍﾞﾙ
FMOV D134 D12227 K2      ; ｼﾘｺﾝ圧下限値【0.00MPa】  ch0_AD ｺﾝﾊﾟﾚｰﾀ下限値OFFﾚﾍﾞﾙ
OUT Y3041                ; AD設定更新要求
;Rev12  T0288をK50からK90に変更
LD CR2002                ; 常時ON
MPS
LDB X3083                ; ch0_AD ｺﾝﾊﾟﾚｰﾀ上限
ANB X3084                ; ch0_AD ｺﾝﾊﾟﾚｰﾀ下限
ANL
OUT R3000                ; ｼﾘｺﾝ圧力　正常
MRD
LDB M25                  ; 吐出無し
AND M2701                ; 加圧開始
ANL
TMR K280 K70             ; 加圧後1ｻｲｸﾙ分ｳｪｲﾄ
CON
AND T280                 ; 加圧後1ｻｲｸﾙ分ｳｪｲﾄ
ANB M2706                ; 圧上昇監視中
AND M81                  ; 自動運転開始BZ
ANB M39                  ; 日常点検ﾓｰﾄﾞ
MPS
LD X3084                 ; ch0_AD ｺﾝﾊﾟﾚｰﾀ下限
ANB X103                 ; RB OUT 3  BUSY
ANL
TMR K288 K90             ; ｼﾘｺﾝ圧力下限異常(設定値)
MPP
AND< D12201 D141         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  制御圧力固定下限値
TMH K287 K200            ; ｼﾘｺﾝ圧力下限異常(固定値)
MRD
AND X3083                ; ch0_AD ｺﾝﾊﾟﾚｰﾀ上限
MPS
ANB M2701                ; 加圧開始
TMH K291 K20             ; ｼﾘｺﾝ圧力上限異常
MPP
LD M2701                 ; 加圧開始
AND>= D2210 K3           ; 連続－ﾋﾟｯﾁ送り回数
ANL
TMH K294 K50             ; ｼﾘｺﾝ圧力上限異常(-3ﾋﾟｯﾁ動作後)
MPP
AND>= D12201 D140        ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  制御圧力固定上限値
TMH K289 K20             ; 固定上限圧力異常
;吐出後圧力変化監視
;Pressure check after dispense
LD Y20F                  ; RB IN 15 手動:吐出ﾊﾞﾙﾌﾞON
@ZRES @M140 @M149        ; 吐出圧監視開始  圧力変化異常2       (復帰圧小)
@SET @M140               ; 吐出圧監視開始
LDB M71                  ; All Error PAUSE
MPS
AND @M148                ; 圧力変化異常1       (下降圧小)
RES @M148                ; 圧力変化異常1       (下降圧小)
CON
DW K343 D148             ; 警報No.
CON
SET M2923                ; Err343:吐出圧変化異常1(下降圧小)
MPP
AND @M149                ; 圧力変化異常2       (復帰圧小)
RES @M149                ; 圧力変化異常2       (復帰圧小)
CON
DW K344 D148             ; 警報No.
CON
SET M2924                ; Err344:吐出圧変化異常2(復帰圧小)
STG @M140                ; 吐出圧監視開始
MOV D12201 D2340         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  吐出開始圧
LDA D2340                ; 吐出開始圧
CON
SUB E1020                ; 吐出開始後変化量
CON
STA D2341                ; 吐出中圧　上限
CON
JMP @M141                ; Wait
STG @M141                ; Wait
TMH K285 D1096           ; 吐出後圧計測開始待ち  吐出開始後変化確認時間
CON
AND T285                 ; 吐出後圧計測開始待ち
MOV D12201 D2342         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  吐出中圧①
MPS
LD>= D2342 D2341         ; 吐出中圧①  吐出中圧　上限
AND<> E1020 K0           ; 吐出開始後変化量
ANL
SET @M148                ; 圧力変化異常1       (下降圧小)
MPP
JMP @M142                ; 吐出終了待ち
STG @M142                ; 吐出終了待ち
MPS
ANB Y20F                 ; RB IN 15 手動:吐出ﾊﾞﾙﾌﾞON
MPS
AND T284                 ; 吐出終了時計測可能時間
MOV D12201 D2343         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  吐出終了時圧
LDA D2343                ; 吐出終了時圧
CON
ADD E1021                ; 吐出終了後変化量
CON
STA D2344                ; 吐出後圧　下限
CON
JMP @M143                ; Wait
MPP
ANB T284                 ; 吐出終了時計測可能時間
ENDS
MPP
TMH K284 K250            ; 吐出終了時計測可能時間
STG @M143                ; Wait
MPS
TMH K286 D1098           ; 吐出終了後Wait  吐出終了後変化確認時間
CON
AND T286                 ; 吐出終了後Wait
MOV D12201 D2345         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  吐出1s後圧
MPS
LD<= D2345 D2344         ; 吐出1s後圧  吐出後圧　下限
AND<> E1021 K0           ; 吐出終了後変化量
ANL
SET @M149                ; 圧力変化異常2       (復帰圧小)
MPP
ENDS
MPP
AND Y20F                 ; RB IN 15 手動:吐出ﾊﾞﾙﾌﾞON
ENDS
;残量監視
;Resin Tank check
LD M5                    ; 運転準備補助
ANB M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
AND<> D2106 K0           ; 加圧方法Ver.
MPS
LD M2922                 ; Err342:ｼﾘｺﾝ剤残量警告
OR M232                  ; ｼﾘｺﾝ剤残量警告記憶
ANB T65                  ; ｼﾘｺﾝ剤残量警報間隔
ANL
OUT M232                 ; ｼﾘｺﾝ剤残量警告記憶
TMR K65 K6000            ; ｼﾘｺﾝ剤残量警報間隔
MRD
LDB M25                  ; 吐出無し
ANB X135                 ; 材料ﾌﾟｯｼｬ ZONE2(残量警報)
ANB M232                 ; ｼﾘｺﾝ剤残量警告記憶
ANB M81                  ; 自動運転開始BZ
ANL
TMR K64 K10              ; ｺｰﾃｨﾝｸﾞ剤残量警報
MPP
LD M103                  ; 原点復帰OK
ANB M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
AND T64                  ; ｺｰﾃｨﾝｸﾞ剤残量警報
ANB M71                  ; All Error PAUSE
ANL
RES L100                 ; ｼﾘｺﾝ 準備OK
CON
DW K342 D148             ; 警報No.
CON
SET M2922                ; Err342:ｼﾘｺﾝ剤残量警告
;ﾄﾞﾚﾝﾊﾝﾄﾞﾙ監視
;Drain handle check
LD M2701                 ; 加圧開始
ANB T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
TMR K295 K10             ; 加圧中ﾄﾞﾚﾝﾊﾝﾄﾞﾙ開
;<h1/>装置状態・動作条件
LDB X134                 ; 材料ﾌﾟｯｼｬ MOVE
AND X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
LD M2701                 ; 加圧開始
LD M2700                 ; ｶｰﾄﾘｯｼﾞ交換　開始
ANB L100                 ; ｼﾘｺﾝ 準備OK
ORL
ANL
OUT M2900                ; ﾕﾆｯﾄ2原点
LDB B040                 ; ｼﾘｺﾝ圧力上限異常
ANB B041                 ; ｼﾘｺﾝ圧力下限異常
ANB B042                 ; 材料ﾌﾟｯｼｬRB異常
ANB B043                 ; 材料ﾌﾟｯｼｬRB MANIALﾓｰﾄﾞ
ANB B044                 ; 加圧中ﾄﾞﾚﾝﾊﾝﾄﾞﾙ開
ANB B045                 ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
INV
OUT M2901                ; ﾕﾆｯﾄ2全異常
RES M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
LDB M64                  ; 運転準備
OR M65                   ; 即停止異常(緊急停止)
OR M2901                 ; ﾕﾆｯﾄ2全異常
OR T15                   ; 強制停止
OUT M2903                ; ﾕﾆｯﾄ2起動OFF
LD M98                   ; 原点復帰開始
ANB M2904                ; ﾕﾆｯﾄ2原点復帰中
OR M2904                 ; ﾕﾆｯﾄ2原点復帰中
ANB M2903                ; ﾕﾆｯﾄ2起動OFF
ANB M2579                ; ﾕﾆｯﾄ2原点復帰完了確認
OUT M2904                ; ﾕﾆｯﾄ2原点復帰中
LDB M2901                ; ﾕﾆｯﾄ2全異常
ANB M160                 ; ALL PAUSE
ANB M2908                ; ﾕﾆｯﾄ2警報補助
ANB M2912                ; UNIT2 ｴﾗｰ
OUT M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
LD CR2002                ; 常時ON
MPS
PMOV.D M2920 K0 D2100 K0 K20;Err340:ｶｰﾄﾘｯｼﾞ未検出
MPP
AND<> D2100 K0
OUT M2912                ; UNIT2 ｴﾗｰ
;
LDB X134                 ; 材料ﾌﾟｯｼｬ MOVE
AND X139                 ; 材料ﾌﾟｯｼｬ SV
AND X13A                 ; 材料ﾌﾟｯｼｬ EMGS
AND X13B                 ; 材料ﾌﾟｯｼｬ ALM
ANB M2800                ; 材料ﾌﾟｯｼｬ 移動完了
ANB M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
ANB M2810                ; 材料ﾌﾟｯｼｬ 原点復帰完了
AND T1202                ; 材料ﾌﾟｯｼｬｰｶﾊﾞｰ閉検出
OUT M2960                ; 材料ﾌﾟｯｼｬ 原点復帰可能
LD M2960                 ; 材料ﾌﾟｯｼｬ 原点復帰可能
AND X137                 ; 材料ﾌﾟｯｼｬ HEND
ANB X134                 ; 材料ﾌﾟｯｼｬ MOVE
ANB Y219                 ; 材料ﾌﾟｯｼｬ CSTR/PWRT
TMH K205 K50             ; 交換開始ｳｪｲﾄ
CON
AND T205                 ; 交換開始ｳｪｲﾄ
OUT M2961                ; 材料ﾌﾟｯｼｬ 動作可能
;<h1/>■加圧
;Pressure control
LDB M2701                ; 加圧開始
ZRES @M100 @M119         ; 押し付け 制御ｷｬﾝｾﾙ
;'   PID用初期値設定
;D2110 = D120
;D2112 = 0
;BSET(D2112,4)
;D2113 = 0
;BSET(D2113,9)
;D2114 = 1000
;@D0 = D2114
;D2121 = -1
;D2122 = +1
;D2124 = 50
;D2125 = 200
;D2126 = 1
;D2127 = 20
LD CR2008                ; 運転開始時1ｽｷｬﾝON
NCJ K1000
;'   PID用初期値設定
;
;D2110 = D120
;
LD CR2002                ; 常時ON
MOV D120 D2110           ; 材料ﾌﾟｯｼｬ　動作指示No.  PID設定値
;D2112 = 0
;
LD CR2002                ; 常時ON
MOV K0 D2112             ; PID動作制御ﾌﾗｸﾞ
;BSET(D2112,4)
;
LD CR2002                ; 常時ON
BSET D2112 K4            ; PID動作制御ﾌﾗｸﾞ
;D2113 = 0
;
LD CR2002                ; 常時ON
MOV K0 D2113             ; PID動作設定
;BSET(D2113,9)
;
LD CR2002                ; 常時ON
BSET D2113 K9            ; PID動作設定
;D2114 = 1000
;
LD CR2002                ; 常時ON
MOV K1000 D2114          ; PIDｻﾝﾌﾟﾘﾝｸﾞ周期
;@D0 = D2114
;
LD CR2002                ; 常時ON
MOV D2114 @D0            ; PIDｻﾝﾌﾟﾘﾝｸﾞ周期  PIDｻﾝﾌﾟﾘﾝｸﾞ周期
;D2121 = -1
;
LD CR2002                ; 常時ON
MOV K65535 D2121         ; PID操作量下限
;D2122 = +1
;
LD CR2002                ; 常時ON
MOV K1 D2122             ; PID操作量上限
;D2124 = 50
;
LD CR2002                ; 常時ON
MOV K50 D2124            ; PID測定値変化幅
;D2125 = 200
;
LD CR2002                ; 常時ON
MOV K200 D2125           ; PIDAT調整ﾊﾟﾗﾒｰﾀ
;D2126 = 1
;
LD CR2002                ; 常時ON
MOV K1 D2126             ; PIDATﾋｽﾃﾘｼｽ
;D2127 = 20
LD CR2002                ; 常時ON
MOV K20 D2127            ; PIDATﾀｲﾑｱｳﾄ
LABEL K1000
;
;'   立ち上げの1回用
;D2115 = 1
;SET(L120)
LD CR2008                ; 運転開始時1ｽｷｬﾝON
ANB L120                 ; PID初期設定ﾌﾗｸﾞ
NCJ K1001
;'   立ち上げの1回用
;
;D2115 = 1
;
LD CR2002                ; 常時ON
MOV K1 D2115             ; PID比例定数
;SET(L120)
LD CR2002                ; 常時ON
SET L120                 ; PID初期設定ﾌﾗｸﾞ
LABEL K1001
;
LD CR2002                ; 常時ON
MPS
AND @M150                ; PID ｵｰﾄﾁｭｰﾆﾝｸﾞ
BSET D2112 K2            ; PID動作制御ﾌﾗｸﾞ
MPP
BANB D2112 K2            ; PID動作制御ﾌﾗｸﾞ
RES @M150                ; PID ｵｰﾄﾁｭｰﾆﾝｸﾞ
LD>=.D @M100 K2          ; 押し付け 制御ｷｬﾝｾﾙ
MPS
PIDAT D12201 D2110 D2170 ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  PID設定値  PID操作量
MPP
ANB @T15                 ; 材料ﾌﾟｯｼｬ起動ﾀｲﾐﾝｸﾞ
TMH @15 @D0              ; 材料ﾌﾟｯｼｬ起動ﾀｲﾐﾝｸﾞ  PIDｻﾝﾌﾟﾘﾝｸﾞ周期
LD M2701                 ; 加圧開始
LD= D2106 K1             ; 加圧方法Ver.
OR= D2106 K2             ; 加圧方法Ver.
ANL
MC
LD M2701                 ; 加圧開始
@SET @M100               ; 押し付け 制御ｷｬﾝｾﾙ
;押し付け動作ｷｬﾝｾﾙ
;Push move cancel
STG @M100                ; 押し付け 制御ｷｬﾝｾﾙ
MPS
OUT @M80                 ; 一時停止
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
OUT @M81                 ; RESET
TMR @12 K5               ; Reset時間
CON
AND @T12                 ; Reset時間
JMP @M101                ; 待機
;動作環境確認
;Status check
STG @M101                ; 待機
MPS
AND= D2106 K1            ; 加圧方法Ver.
TMH @18 E1004            ; ﾋﾟｯﾁ送りｻｲｸﾙ  加圧ｻｲｸﾙ時間(s)
CON
AND @T18                 ; ﾋﾟｯﾁ送りｻｲｸﾙ
MPS
AND< D12201 D124         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  材料ﾌﾟｯｼｬ +ﾋﾟｯﾁ目標値
TMH @13 K20              ; +ﾋﾟｯﾁ送り  ｲﾝﾀｰﾊﾞﾙ
CON
AND @T13                 ; +ﾋﾟｯﾁ送り  ｲﾝﾀｰﾊﾞﾙ
JMP @M102                ; +ﾋﾟｯﾁ送り
MPP
AND> D12201 D126         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  材料ﾌﾟｯｼｬ -ﾋﾟｯﾁ目標値
TMH @14 K20              ; -ﾋﾟｯﾁ送り  ｲﾝﾀｰﾊﾞﾙ
CON
AND @T14                 ; -ﾋﾟｯﾁ送り  ｲﾝﾀｰﾊﾞﾙ
JMP @M110                ; -ﾋﾟｯﾁ送り
MRD
LD= D2106 K2             ; 加圧方法Ver.
AND @T15                 ; 材料ﾌﾟｯｼｬ起動ﾀｲﾐﾝｸﾞ
ANL
MPS
AND>=.S D2170 +1         ; PID操作量
JMP @M102                ; +ﾋﾟｯﾁ送り
MPP
AND<=.S D2170 -1         ; PID操作量
JMP @M110                ; -ﾋﾟｯﾁ送り
MPP
OUT M2830                ; 待機中 ｻｰﾎﾞOFF
;+ﾋﾟｯﾁ送り
;+pitch move
STG @M102                ; +ﾋﾟｯﾁ送り
AND M2961                ; 材料ﾌﾟｯｼｬ 動作可能
DW K0 D2210              ; 連続－ﾋﾟｯﾁ送り回数
CON
SET M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
JMP @M103                ; P4 move   start
STG @M103                ; P4 move   start
MPS
DW K4 D120               ; 材料ﾌﾟｯｼｬ　動作指示No.
CON
OUT @M13                 ; P4 move
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
JMP @M104                ; P4 move
STG @M104                ; P4 move
ANB X134                 ; 材料ﾌﾟｯｼｬ MOVE
AND X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
MPS
RES M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
JMP @M101                ; 待機
MPP
ANB M1970                ; 初期加圧ｻｲｸﾙ
INC D130                 ; 材料ﾌﾟｯｼｬーﾋﾟｯﾁ送り回数
;-ﾋﾟｯﾁ送り
;-pitch move
STG @M110                ; -ﾋﾟｯﾁ送り
AND M2961                ; 材料ﾌﾟｯｼｬ 動作可能
INC D2210                ; 連続－ﾋﾟｯﾁ送り回数
CON
SET M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
JMP @M111                ; P5 move start
STG @M111                ; P5 move start
MPS
DW K5 D120               ; 材料ﾌﾟｯｼｬ　動作指示No.
CON
OUT @M14                 ; P5 move
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
JMP @M112                ; P5 move
STG @M112                ; P5 move
ANB X134                 ; 材料ﾌﾟｯｼｬ MOVE
AND X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
DEC D130                 ; 材料ﾌﾟｯｼｬーﾋﾟｯﾁ送り回数
CON
RES M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
JMP @M101                ; 待機
MCR
;<h1/>■ｶｰﾄﾘｯｼﾞ交換
;■Cartridge change
LD CR2002                ; 常時ON
ZRES M2000 M2299         ; ｶｰﾄﾘｯｼﾞ交換開始確認
LDB M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
MOV K0 D2000             ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2700                 ; ｶｰﾄﾘｯｼﾞ交換　開始
MOV D2000 Z4             ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
SET M2000:Z4             ; ｶｰﾄﾘｯｼﾞ交換開始確認
;ｶｰﾄﾘｯｼﾞ交換開始
;Cartridge change start
LD M2000                 ; ｶｰﾄﾘｯｼﾞ交換開始確認
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2001                 ; ｶｰﾄﾘｯｼﾞ交換開始
RES M2701                ; 加圧開始
CON
MPS
ANB M2904                ; ﾕﾆｯﾄ2原点復帰中
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
AND M2904                ; ﾕﾆｯﾄ2原点復帰中
MOV K3 D2000             ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2002                 ; 押し付け 制御ｷｬﾝｾﾙ
MPS
OUT @M82                 ; 一時停止
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
OUT @M83                 ; RESET
TMR @19 K5               ; Reset時間
CON
AND @T19                 ; Reset時間
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2003                 ; 原点移動
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
AND M2961                ; 材料ﾌﾟｯｼｬ 動作可能
TMR @9 K30
CON
AND @T9
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2004                 ; P1 move start
MPS
DW K1 D120               ; 材料ﾌﾟｯｼｬ　動作指示No.
CON
OUT @M15                 ; P1 move
MPP
LDB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
OR X134                  ; 材料ﾌﾟｯｼｬ MOVE
ANL
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2005                 ; P1 move
ANB X134                 ; 材料ﾌﾟｯｼｬ MOVE
AND X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
MOV K100 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;*** ERR.341 Cartridge channge request
LD M2006                 ; ｴﾗｰ発生
ANB M71                  ; All Error PAUSE
DW K341 D148             ; 警報No.
CON
SET M2921                ; Err341:ｶｰﾄﾘｯｼﾞ交換要求
CON
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2007                 ; ｴﾗｰ中
AND M71                  ; All Error PAUSE
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2008                 ; ｴﾗｰ解除確認
AND T130                 ; ｴﾗｰﾘﾄﾗｲｳｪｲﾄ
MOV K100 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;***
;ｶﾊﾞｰ開待ち
;Cover open wait
LD M2100                 ; ｶﾊﾞｰ開待ち
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
ANB T1202                ; 材料ﾌﾟｯｼｬｰｶﾊﾞｰ閉検出
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;交換完了待ち
;Cartridge change wait
LD M2101                 ; 交換完了待ち
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
AND T1202                ; 材料ﾌﾟｯｼｬｰｶﾊﾞｰ閉検出
AND M2961                ; 材料ﾌﾟｯｼｬ 動作可能
MPS
AND= D120 K1             ; 材料ﾌﾟｯｼｬ　動作指示No.
MPS
LD T1223                 ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉じてない検出
ANP T1415                ; ﾌﾟｯｼｬ下降sw
ANL
SET M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
MOV K120 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANP B1088                ; 材料ﾌﾟｯｼｬ ﾒﾝﾃ移動PB
MOV K105 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
LD= D120 K15             ; 材料ﾌﾟｯｼｬ　動作指示No.
ANP B1088                ; 材料ﾌﾟｯｼｬ ﾒﾝﾃ移動PB
ANL
MOV K106 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;ﾒﾝﾃﾅﾝｽ位置移動
;Meintenance position move
LD M2105                 ; RB起動
MPS
DW K15 D120              ; 材料ﾌﾟｯｼｬ　動作指示No.
CON
OUT @M20                 ; ﾒﾝﾃ移動
MPP
LDB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
OR X134                  ; 材料ﾌﾟｯｼｬ MOVE
ANL
MOV K107 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2106                 ; RB起動
MPS
DW K1 D120               ; 材料ﾌﾟｯｼｬ　動作指示No.
CON
OUT @M21                 ; P1 move
MPP
LDB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
OR X134                  ; 材料ﾌﾟｯｼｬ MOVE
ANL
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2107                 ; ﾒﾝﾃ移動
ANB X134                 ; 材料ﾌﾟｯｼｬ MOVE
AND X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
MOV K101 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;押し込み開始点検索（押し付け動作）
;Push start point check
LD M2120                 ; P2 move   start
MPS
DW K2 D120               ; 材料ﾌﾟｯｼｬ　動作指示No.
CON
OUT @M16                 ; P2 move
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2121                 ; P2 move
MPS
ANB X134                 ; 材料ﾌﾟｯｼｬ MOVE
MPS
LD X138                  ; 材料ﾌﾟｯｼｬ PEND/WEND
AND= D122 K2             ; 材料ﾌﾟｯｼｬ　受付動作No.
ANL
MPS
SET @M1                  ; ｽﾄﾛｰｸ数確認
CON
RES M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
MPP
MOV K190 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
TMR @17 K30              ; 空振り検出ﾃﾞｨﾚｲ
CON
AND @T17                 ; 空振り検出ﾃﾞｨﾚｲ
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
AND CR2004               ; 10msｸﾛｯｸﾊﾟﾙｽ
@INC D2221               ; 接触点走査時間積算
;*** ERR.340 No cartridge
LD M2122                 ; ｴﾗｰ発生
ANB M71                  ; All Error PAUSE
RES M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
DW K340 D148             ; 警報No.
CON
SET M2920                ; Err340:ｶｰﾄﾘｯｼﾞ未検出
CON
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2123                 ; ｴﾗｰ中
AND M71                  ; All Error PAUSE
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2124                 ; ｴﾗｰ解除確認
AND T130                 ; ｴﾗｰﾘﾄﾗｲｳｪｲﾄ
MOV K1 D2000             ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;***
;押し付け動作ｷｬﾝｾﾙ
;Push move cancel
LD M2190                 ; 押付け動作ｷｬﾝｾﾙ
MPS
OUT @M84                 ; 一時停止
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
OUT @M85                 ; RESET
MPS
TMR @16 K5               ; Reset時間
CON
AND @T16                 ; Reset時間
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
AND CR2002               ; 常時ON
MOV D12201 D2200         ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  捨て出し前圧力
MPS
LDA D12201               ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ
CON
SUB K5
CON
STA D2201                ; 確認用圧力値下限
MPP
LDA D12201               ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ
CON
ADD K5
CON
STA D2202                ; 確認用圧力値上限
;ピストン安定化wait
;Piston stabity waiting
LD M2191                 ; 10s待ち
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
TMR K206 K100            ; ﾋﾟｽﾄﾝ安定化時間
CON
AND T206                 ; ﾋﾟｽﾄﾝ安定化時間
MOV K201 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
LDP B1524                ; ｴｱ抜きｷｬﾝｾﾙ隠し
AND T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
ANL
MOV K260 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;作業者捨て出し開始待ち
;Discharge start wait
LD M2201                 ; 捨出し開始待ち
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
AND M2961                ; 材料ﾌﾟｯｼｬ 動作可能
MPS
LDP T1415                ; ﾌﾟｯｼｬ下降sw
AND T1223                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉じてない検出
ANL
SET M2804                ; 材料ﾌﾟｯｼｬ 移動開始
CON
MOV K210 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANP B1524                ; ｴｱ抜きｷｬﾝｾﾙ隠し
MPS
AND T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
MOV K260 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANB T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;*** ERR.346 Drain handle open
LD M2202                 ; ｴﾗｰ発生
ANB M71                  ; All Error PAUSE
RES M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
DW K346 D148             ; 警報No.
CON
SET M2926                ; Err346:ﾄﾞﾚﾝﾊﾝﾄﾞﾙ 開き
CON
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2203                 ; ｴﾗｰ中
AND M71                  ; All Error PAUSE
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2204                 ; ｴﾗｰ解除確認
AND T130                 ; ｴﾗｰﾘﾄﾗｲｳｪｲﾄ
MOV K201 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;エア抜き　定量吐出(ｽﾄﾛｰｸ)動作
;Air drain Discharge
LD M2210                 ; P3 move start
MPS
DW K3 D120               ; 材料ﾌﾟｯｼｬ　動作指示No.
CON
OUT @M17                 ; P3 move
MPP
ANB X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2211                 ; P3 move
ANB X134                 ; 材料ﾌﾟｯｼｬ MOVE
AND X138                 ; 材料ﾌﾟｯｼｬ PEND/WEND
RES M2804                ; 材料ﾌﾟｯｼｬ 移動開始
CON
MOV K250 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LDB M2210                ; P3 move start
ANB M2211                ; P3 move
INV
OUT M2820                ; 定量吐出中
;作業者選択　完了待ち
;Operator selection wait
LD M2250                 ; 作業完了待ち
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
AND B201A                ; Cartridge change end sw
MPS
AND T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
MOV K260 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANB T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
LD M2961                 ; 材料ﾌﾟｯｼｬ 動作可能
ANP T1415                ; ﾌﾟｯｼｬ下降sw
AND T1223                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉じてない検出
AND M28                  ; 仮 NAT
ANL
SET M2804                ; 材料ﾌﾟｯｼｬ 移動開始
CON
MOV K210 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;*** ERR.346 Drain handle open
LD M2251                 ; ｴﾗｰ発生
ANB M71                  ; All Error PAUSE
RES M2802                ; 材料ﾌﾟｯｼｬ 指示移動中
CON
DW K346 D148             ; 警報No.
CON
SET M2926                ; Err346:ﾄﾞﾚﾝﾊﾝﾄﾞﾙ 開き
CON
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2252                 ; ｴﾗｰ中
AND M71                  ; All Error PAUSE
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2253                 ; ｴﾗｰ解除確認
AND T130                 ; ｴﾗｰﾘﾄﾗｲｳｪｲﾄ
MOV K250 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;交換完了
;Change end
LD M2260                 ; 圧確認ｻｲｸﾙ開始待ち
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
OUT M2705                ; 交換後圧上昇監視開始
CON
LD M2706                 ; 圧上昇監視中
ORB X3084                ; ch0_AD ｺﾝﾊﾟﾚｰﾀ下限
ANL
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;'接触点検索時間が長いときのｶｳﾝﾄ数推定
;D2220 = D2221
;D2221 = 0
;D2226 = (D2220 - 920) * 5 / (D160 * 10)
;IF D2220 > 1500 THEN                       '15s以上かかったら書き換え
;  D130 = D2226
;ELSE
;  D130 = 0
;END IF
LD M2261                 ; 圧力監視開始確認　　加圧開始
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
SET M2701                ; 加圧開始
CON
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MRD
BMOV D2300 D2301 K29     ; ｶｰﾄﾘｯｼﾞﾋﾟｯﾁ送り回数ﾛｸﾞ  ｶｰﾄﾘｯｼﾞﾋﾟｯﾁ送り回数ﾛｸﾞ
MRD
MOV D130 D2300           ; 材料ﾌﾟｯｼｬーﾋﾟｯﾁ送り回数  ｶｰﾄﾘｯｼﾞﾋﾟｯﾁ送り回数ﾛｸﾞ
MPP
NCJ K1004
;'接触点検索時間が長いときのｶｳﾝﾄ数推定
;
;D2220 = D2221
;
LD CR2002                ; 常時ON
MOV D2221 D2220          ; 接触点走査時間積算  接触点走査時間
;D2221 = 0
;
LD CR2002                ; 常時ON
MOV K0 D2221             ; 接触点走査時間積算
;D2226 = (D2220 - 920) * 5 / (D160 * 10)
;
LD CR2002                ; 常時ON
LDA D160                 ; 材料ﾌﾟｯｼｬﾋﾟｯﾁｽﾄﾛｰｸ(×0.1mm)
CON
EXT
CON
MUL.L +10
CON
STA.L @VM26
CON
LDA D2220                ; 接触点走査時間
CON
EXT
CON
SUB.L +920
CON
MUL.L +5
CON
DIV.L @VM26
CON
STA D2226                ; 予想ﾋﾟｯﾁ送り数
;IF D2220 > 1500 THEN                       '15s以上かかったら書き換え
;
LD> D2220 K1500          ; 接触点走査時間
NCJ K2002
;  D130 = D2226
;
LD CR2002                ; 常時ON
MOV D2226 D130           ; 予想ﾋﾟｯﾁ送り数  材料ﾌﾟｯｼｬーﾋﾟｯﾁ送り回数
;ELSE
;
LD CR2002                ; 常時ON
CJ K2003
LABEL K2002
;  D130 = 0
;
LD CR2002                ; 常時ON
MOV K0 D130              ; 材料ﾌﾟｯｼｬーﾋﾟｯﾁ送り回数
;END IF
LABEL K2003
LABEL K1004
;
;交換完了後圧力上昇待ち
;Waiting for Pressure up 
LD M2705                 ; 交換後圧上昇監視開始
OR M2706                 ; 圧上昇監視中
AND X3084                ; ch0_AD ｺﾝﾊﾟﾚｰﾀ下限
ANB B045                 ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
OUT M2706                ; 圧上昇監視中
TMR K296 K2400           ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
;Rev12  圧力比較をD00124（制御目標圧））からD00134（下限値設定）に変更
LD M2261                 ; 圧力監視開始確認　　加圧開始
OR M2707                 ; 加圧安定化中
AND M2701                ; 加圧開始
ANB T281                 ; 加圧安定化
MPS
OUT M2707                ; 加圧安定化中
MPP
AND>= D12201 D134        ; ｼﾘｺﾝ圧力ﾃﾞｰﾀ  ｼﾘｺﾝ圧下限値【0.00MPa】
TMR K281 D1080           ; 加圧安定化  加圧安定化時間【×0.1s】
;交換ｶｰﾄﾘｯｼﾞ粘度確認
;Viscosity check by Operater
LD M2262                 ; 粘度確認
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
ANP B10A0                ; 規定内sw
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MRD
ANP B10A1                ; 規定外sw
MOV K264 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANP B1525                ; 測定ﾓｰﾄﾞｷｬﾝｾﾙ隠しｽｲｯﾁ
MOV K272 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2263                 ; 同粘度再確認
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
ANP B10A2                ; はいsw
MOV K270 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANP B10A3                ; いいえsw
MOV K262 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2264                 ; 異粘度再確認
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
ANP B10A2                ; はいsw
MOV K271 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANP B10A3                ; いいえsw
MOV K262 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
;捨て出し　＆　吐出量点検ﾓｰﾄﾞ
;Discharge & Mesurement mode
LD M2270                 ; 吐出量点検ﾓｰﾄﾞ起動(同粘度交換)
ANB M2707                ; 加圧安定化中
MPS
OUT M2970                ; 吐出量点検ﾓｰﾄﾞ起動(同粘度交換中)
MPP
AND M1907                ; ﾕﾆｯﾄ1ｻﾌﾞﾙｰﾁﾝ完了
MOV K272 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2271                 ; 吐出量点検ﾓｰﾄﾞ起動(異粘度交換)
ANB M2707                ; 加圧安定化中
MPS
OUT M2971                ; 吐出量点検ﾓｰﾄﾞ起動(異粘度交換中)
MPP
AND M1907                ; ﾕﾆｯﾄ1ｻﾌﾞﾙｰﾁﾝ完了
@INC D2000               ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
LD M2272                 ; 結果確認
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
LD M40                   ; Dispence Daily check OK
LDB M40                  ; Dispence Daily check OK
LD M70                   ; 自動起動停止指令(ｻｲｸﾙ停止)
ORB M49                  ; 全ﾕﾆｯﾄ起動中
ANL
ORL
ANL
SET L100                 ; ｼﾘｺﾝ 準備OK
CON
MOV K290 D2000           ; ﾕﾆｯﾄ2自動運転ｽﾃｯﾌﾟ
MPP
ANB M40                  ; Dispence Daily check OK
OUT M2972                ; 吐出量NG  (ｻｲｸﾙ停止)
;交換完了
;Change end
LD M2290                 ; 終了処理
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
RES M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
;★★★★★
;<h1/>■原点復帰回路
;
;運転開始・ステッパ初期化・補助接点へ展開
LD CR2002                ; 常時ON
ZRES M2500 M2589         ; ﾕﾆｯﾄ2原点復帰開始
LDB M2904                ; ﾕﾆｯﾄ2原点復帰中
MOV K0 D2010             ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
LD M2904                 ; ﾕﾆｯﾄ2原点復帰中
MOV D2010 Z5             ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
SET M2500:Z5             ; ﾕﾆｯﾄ2原点復帰開始
;原点復帰ステップ開始
;Origin start
LD M2500                 ; ﾕﾆｯﾄ2原点復帰開始
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
RES M2701                ; 加圧開始
CON
RES M2810                ; 材料ﾌﾟｯｼｬ 原点復帰完了
CON
@INC D2010               ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
;捨て出し確認
;Discharge check
LD M2501                 ; 捨て出し確認
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
AND L100                 ; ｼﾘｺﾝ 準備OK
MOV K71 D2010            ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
MPP
ANB L100                 ; ｼﾘｺﾝ 準備OK
MOV K60 D2010            ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
;ｶｰﾄﾘｯｼﾞ交換へ　そしてHOME終了へ
;Cartridge cahnge & HOME end
LD M2560                 ; 交換ﾙｰﾁﾝ起動
AND M2913                ; UNIT2     ｴﾗｰ・PAUSE無し
MPS
RES L100                 ; ｼﾘｺﾝ 準備OK
CON
SET M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
MPP
MOV K77 D2010            ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
;加圧開始
;Push start
LD M2571                 ; 加圧開始
MPS
AND T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
SET M2701                ; 加圧開始
MOV K77 D2010            ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
MPP
ANB T1203                ; ﾄﾞﾚﾝﾊﾝﾄﾞﾙ閉検出
@INC D2010               ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
;*** ERR.346 Drain handle open
LD M2572                 ; ｴﾗｰ発生
ANB M71                  ; All Error PAUSE
DW K346 D148             ; 警報No.
CON
SET M2926                ; Err346:ﾄﾞﾚﾝﾊﾝﾄﾞﾙ 開き
CON
@INC D2010               ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
LD M2573                 ; ｴﾗｰ中
AND M71                  ; All Error PAUSE
@INC D2010               ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
LD M2574                 ; ｴﾗｰ解除確認
AND T130                 ; ｴﾗｰﾘﾄﾗｲｳｪｲﾄ
MOV K71 D2010            ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
;原点復帰終了
LD M2577                 ; 原点復帰動作完了
AND M2900                ; ﾕﾆｯﾄ2原点
OUT M2578                ; ﾕﾆｯﾄ2原点復帰完了
LD M2578                 ; ﾕﾆｯﾄ2原点復帰完了
ANB M98                  ; 原点復帰開始
@MOV K79 D2010           ; ﾕﾆｯﾄ2原点復帰ｽﾃｯﾌﾟ
;<h1/>■手動回路 
;
LDP B109A                ; ｶｰﾄﾘｯｼﾞ交換PB
RES L100                 ; ｼﾘｺﾝ 準備OK
CON
RES M2701                ; 加圧開始
CON
SET M2700                ; ｶｰﾄﾘｯｼﾞ交換　開始
;<h1/>出力回路
;Output
LD @M10                  ; 材料ﾌﾟｯｼｬ　HOME
OUT Y217                 ; 材料ﾌﾟｯｼｬ home
LD T1202                 ; 材料ﾌﾟｯｼｬｰｶﾊﾞｰ閉検出
ANB @M80                 ; 一時停止
ANB @M82                 ; 一時停止
ANB @M84                 ; 一時停止
ANB @M86                 ; 一時停止
ANB @M88                 ; 一時停止
OUT Y218                 ; 材料ﾌﾟｯｼｬ STP
LDB @M12                 ; P2 move
ANB @M13                 ; P4 move
ANB @M14                 ; P5 move
ANB @M15                 ; P1 move
ANB @M16                 ; P2 move
ANB @M17                 ; P3 move
ANB @M18                 ; P10 Write
ANB @M19                 ; P10 move
ANB @M20                 ; ﾒﾝﾃ移動
ANB @M21                 ; P1 move
INV
TMH @10 K2               ; 起動ﾃﾞｨﾚｲ
CON
AND @T10                 ; 起動ﾃﾞｨﾚｲ
OUT Y219                 ; 材料ﾌﾟｯｼｬ CSTR/PWRT
LDB M411                 ; 材料ﾌﾟｯｼｬ Reset
ANB @M81                 ; RESET
ANB @M83                 ; RESET
ANB @M85                 ; RESET
ANB @M87                 ; RESET
ANB @M89                 ; RESET
ANB M2819                ; ｺﾝﾄﾛｰﾗRESET
INV
OUT Y21A                 ; 材料ﾌﾟｯｼｬ RES
;<h1/>異常検出
;
LD CR2002                ; 常時ON
MPS
LD T291                  ; ｼﾘｺﾝ圧力上限異常
OR T294                  ; ｼﾘｺﾝ圧力上限異常(-3ﾋﾟｯﾁ動作後)
OR T289                  ; 固定上限圧力異常
LDB B0540                ; ﾕﾆｯﾄ2_異常1BZ停止
ORB M123                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
AND B040                 ; ｼﾘｺﾝ圧力上限異常
ORL
ANL
RES L100                 ; ｼﾘｺﾝ 準備OK
CON
OUT B040                 ; ｼﾘｺﾝ圧力上限異常
MPP
LD M122                  ; ﾌﾞｻﾞｰ停止ﾊﾟﾙｽ
OR B0540                 ; ﾕﾆｯﾄ2_異常1BZ停止
AND B040                 ; ｼﾘｺﾝ圧力上限異常
ANL
OUT B0540                ; ﾕﾆｯﾄ2_異常1BZ停止
LD CR2002                ; 常時ON
MPS
LD T287                  ; ｼﾘｺﾝ圧力下限異常(固定値)
OR T288                  ; ｼﾘｺﾝ圧力下限異常(設定値)
LDB B0541                ; ﾕﾆｯﾄ2_異常2BZ停止
ORB M123                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
AND B041                 ; ｼﾘｺﾝ圧力下限異常
ORL
ANL
RES L100                 ; ｼﾘｺﾝ 準備OK
CON
OUT B041                 ; ｼﾘｺﾝ圧力下限異常
MPP
LD M122                  ; ﾌﾞｻﾞｰ停止ﾊﾟﾙｽ
OR B0541                 ; ﾕﾆｯﾄ2_異常2BZ停止
AND B041                 ; ｼﾘｺﾝ圧力下限異常
ANL
OUT B0541                ; ﾕﾆｯﾄ2_異常2BZ停止
LD X13A                  ; 材料ﾌﾟｯｼｬ EMGS
AND X13B                 ; 材料ﾌﾟｯｼｬ ALM
INV
TMR K298 K10             ; 材料ﾌﾟｯｼｬRB異常
LD CR2002                ; 常時ON
MPS
LD T298                  ; 材料ﾌﾟｯｼｬRB異常
LDB B0542                ; ﾕﾆｯﾄ2_異常3BZ停止
ORB M123                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
AND B042                 ; 材料ﾌﾟｯｼｬRB異常
ORL
ANL
RES L100                 ; ｼﾘｺﾝ 準備OK
CON
OUT B042                 ; 材料ﾌﾟｯｼｬRB異常
OUT M2819                ; ｺﾝﾄﾛｰﾗRESET
MPP
LD M122                  ; ﾌﾞｻﾞｰ停止ﾊﾟﾙｽ
OR B0542                 ; ﾕﾆｯﾄ2_異常3BZ停止
AND B042                 ; 材料ﾌﾟｯｼｬRB異常
ANL
OUT B0542                ; ﾕﾆｯﾄ2_異常3BZ停止
LDB X136                 ; 材料ﾌﾟｯｼｬ RMDS
INV
TMR K297 K10             ; 材料ﾌﾟｯｼｬMANUALﾓｰﾄﾞ
LD CR2002                ; 常時ON
MPS
LD T297                  ; 材料ﾌﾟｯｼｬMANUALﾓｰﾄﾞ
LDB B0543                ; ﾕﾆｯﾄ2_異常4BZ停止
ORB M123                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
AND B043                 ; 材料ﾌﾟｯｼｬRB MANIALﾓｰﾄﾞ
ORL
ANL
OUT B043                 ; 材料ﾌﾟｯｼｬRB MANIALﾓｰﾄﾞ
MPP
LD M122                  ; ﾌﾞｻﾞｰ停止ﾊﾟﾙｽ
OR B0543                 ; ﾕﾆｯﾄ2_異常4BZ停止
AND B043                 ; 材料ﾌﾟｯｼｬRB MANIALﾓｰﾄﾞ
ANL
OUT B0543                ; ﾕﾆｯﾄ2_異常4BZ停止
LD CR2002                ; 常時ON
MPS
LD T295                  ; 加圧中ﾄﾞﾚﾝﾊﾝﾄﾞﾙ開
LDB B0544                ; ﾕﾆｯﾄ2_異常5BZ停止
ORB M123                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
AND B044                 ; 加圧中ﾄﾞﾚﾝﾊﾝﾄﾞﾙ開
ORL
ANL
OUT B044                 ; 加圧中ﾄﾞﾚﾝﾊﾝﾄﾞﾙ開
MPP
LD M122                  ; ﾌﾞｻﾞｰ停止ﾊﾟﾙｽ
OR B0544                 ; ﾕﾆｯﾄ2_異常5BZ停止
AND B044                 ; 加圧中ﾄﾞﾚﾝﾊﾝﾄﾞﾙ開
ANL
OUT B0544                ; ﾕﾆｯﾄ2_異常5BZ停止
LD CR2002                ; 常時ON
MPS
LD T296                  ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
LDB B0545                ; ﾕﾆｯﾄ2_異常6BZ停止
ORB M123                 ; 異常ﾘｾｯﾄﾊﾟﾙｽ
AND B045                 ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
ORL
ANL
OUT B045                 ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
MPP
LD M122                  ; ﾌﾞｻﾞｰ停止ﾊﾟﾙｽ
OR B0545                 ; ﾕﾆｯﾄ2_異常6BZ停止
AND B045                 ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
ANL
OUT B0545                ; ﾕﾆｯﾄ2_異常6BZ停止
;異常ﾌﾞｻﾞｰまとめ
LD B040                  ; ｼﾘｺﾝ圧力上限異常
ANB B0540                ; ﾕﾆｯﾄ2_異常1BZ停止
LD B041                  ; ｼﾘｺﾝ圧力下限異常
ANB B0541                ; ﾕﾆｯﾄ2_異常2BZ停止
ORL
LD B042                  ; 材料ﾌﾟｯｼｬRB異常
ANB B0542                ; ﾕﾆｯﾄ2_異常3BZ停止
ORL
LD B043                  ; 材料ﾌﾟｯｼｬRB MANIALﾓｰﾄﾞ
ANB B0543                ; ﾕﾆｯﾄ2_異常4BZ停止
ORL
LD B044                  ; 加圧中ﾄﾞﾚﾝﾊﾝﾄﾞﾙ開
ANB B0544                ; ﾕﾆｯﾄ2_異常5BZ停止
ORL
LD B045                  ; 交換後圧力上昇待ちﾀｲﾑｵｰﾊﾞｰ
ANB B0545                ; ﾕﾆｯﾄ2_異常6BZ停止
ORL
OUT M2909                ; ﾕﾆｯﾄ2異常BZ補助
@RES M2701               ; 加圧開始
END
ENDH
