DEVICE:53
;MODULE:AlwaysSignal
;MODULE_TYPE:0
;OneSystem Sub-Module
;
;---------------------------------------
;ModuleName	:	Always_Signal
;ModuleType	:	Sub Module
;Function	:	条件生成
;---------------------------------------
;<使用方法>
;ﾌﾟﾛｼﾞｪｸﾄ全体に関わる条件ｼｸﾞﾅﾙ生成は本ﾓｼﾞｭｰﾙに記述して下さい
;・ﾓｰｼｮﾝｺﾝﾄﾛｰﾙ動作許可
;・ｺﾐｭﾆｹｰｼｮﾝﾕﾆｯﾄ通信許可
;・ﾋｰﾀｰ電源ON
;など
LD CR2008                ; 運転開始時1ｽｷｬﾝON
OR MR10100               ; 運転開始時1ｽｷｬﾝON　保持
ANB R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OUT MR10100              ; 運転開始時1ｽｷｬﾝON　保持
LD CR2002                ; 常時ON
MOV.D DM4200 DM4502      ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  離脱量(0.01mm)(U1)
;<h1/>中間バッファ関連
LDB R41009               ; _Grp1_Task9_起動中ﾌﾗｸﾞ
MPS
ANP DM2000.13            ; 中間ﾊﾞｯﾌｧ 貯蔵ﾓｰﾄﾞ
DW #1 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
MRD
ANP DM2000.14            ; 中間ﾊﾞｯﾌｧ 吐出しﾓｰﾄﾞ
DW #2 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
MRD
ANP DM2000.12            ; 中間ﾊﾞｯﾌｧ ｽﾙｰﾓｰﾄﾞ
DW #3 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
MPP
ANB CR2002               ; 常時ON
DW #4 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
;自動中の変更
LD R41009                ; _Grp1_Task9_起動中ﾌﾗｸﾞ
MPS
ANP B030                 ; 貯蔵固定ﾓｰﾄﾞ
DW #1 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
MRD
ANP B031                 ; 排出固定ﾓｰﾄﾞ
DW #2 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
MRD
ANP B032                 ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
DW #3 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
MPP
ANP B033                 ; ﾓｰﾄﾞ自動切換え
DW #4 DM20000            ; 1:貯_2:排　3:ｽﾙｰ4:自替
;<h1/>　ﾓｰﾄﾞ変更選択記憶回路
LDP B030                 ; 貯蔵固定ﾓｰﾄﾞ
LD MR14304               ; 貯蔵固定ﾓｰﾄﾞﾞ　選択記憶
ANPB B030                ; 貯蔵固定ﾓｰﾄﾞ
ANPB B031                ; 排出固定ﾓｰﾄﾞ
ANPB B032                ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
ORL
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OUT MR14304              ; 貯蔵固定ﾓｰﾄﾞﾞ　選択記憶
LDP B031                 ; 排出固定ﾓｰﾄﾞ
LD MR14305               ; 排出固定ﾓｰﾄﾞ　選択記憶
ANPB B030                ; 貯蔵固定ﾓｰﾄﾞ
ANPB B031                ; 排出固定ﾓｰﾄﾞ
ANPB B032                ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
ORL
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OUT MR14305              ; 排出固定ﾓｰﾄﾞ　選択記憶
LDP B032                 ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
LD MR14306               ; ｽﾙｰﾓｰﾄﾞ　選択記憶
ANPB B030                ; 貯蔵固定ﾓｰﾄﾞ
ANPB B031                ; 排出固定ﾓｰﾄﾞ
ANPB B032                ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
ORL
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OUT MR14306              ; ｽﾙｰﾓｰﾄﾞ　選択記憶
;<h1/>　貯蔵ﾓｰﾄﾞからの移行
LD MR14310               ; 貯蔵固定ﾓｰﾄﾞ
ANB CR2002               ; 常時ON
TMR #10 #600
LD MR14310               ; 貯蔵固定ﾓｰﾄﾞ
LDP B031                 ; 排出固定ﾓｰﾄﾞ
ORP B032                 ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
ORP T10
ANL
OR MR14410               ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
AND<>.D R41007 #0        ; _Grp1_Task7_起動中ﾌﾗｸﾞ
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB MR14413              ; ﾓｰﾄﾞ変更移行条件OK　(貯蔵)
OUT MR14410              ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
MPS
AND MR14305              ; 排出固定ﾓｰﾄﾞ　選択記憶
SET B0305                ; ﾓｰﾄﾞ変更　移行中　(排出)LP
MPP
AND MR14306              ; ｽﾙｰﾓｰﾄﾞ　選択記憶
SET B0307                ; ﾓｰﾄﾞ変更　移行中　(ｽﾙｰ)LP
LD MR14410               ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
AND MR14411              ; RB19　ﾓｰﾄﾞ変更OK(貯蔵)
AND MR14412              ; RB23　ﾓｰﾄﾞ変更OK(貯蔵)
ANB B0414                ; RB21　ﾊﾝﾄﾞﾜｰｸ有
AND= DM10860 #1          ; RB21Target Pos
OUT MR14413              ; ﾓｰﾄﾞ変更移行条件OK　(貯蔵)
CON
MPS
AND MR14305              ; 排出固定ﾓｰﾄﾞ　選択記憶
@DW #2 DM20000           ; 1:貯_2:排　3:ｽﾙｰ4:自替
MPP
AND MR14306              ; ｽﾙｰﾓｰﾄﾞ　選択記憶
@DW #3 DM20000           ; 1:貯_2:排　3:ｽﾙｰ4:自替
LDF MR14410              ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
RES B0305                ; ﾓｰﾄﾞ変更　移行中　(排出)LP
CON
RES B0307                ; ﾓｰﾄﾞ変更　移行中　(ｽﾙｰ)LP
;<h1/>　排出ﾓｰﾄﾞからの移行
LD MR14311               ; 排出固定ﾓｰﾄﾞ
ANB CR2002               ; 常時ON
TMR #11 #600
LD MR14311               ; 排出固定ﾓｰﾄﾞ
LDP B030                 ; 貯蔵固定ﾓｰﾄﾞ
ORP B032                 ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
ORP T11
ANL
OR MR14400               ; ﾓｰﾄﾞ変更　移行中　(排出)
AND<>.D R41007 #0        ; _Grp1_Task7_起動中ﾌﾗｸﾞ
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB MR14403              ; ﾓｰﾄﾞ変更移行条件OK
OUT MR14400              ; ﾓｰﾄﾞ変更　移行中　(排出)
MPS
AND MR14304              ; 貯蔵固定ﾓｰﾄﾞﾞ　選択記憶
SET B0306                ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
MPP
AND MR14306              ; ｽﾙｰﾓｰﾄﾞ　選択記憶
SET B0307                ; ﾓｰﾄﾞ変更　移行中　(ｽﾙｰ)LP
LD MR14400               ; ﾓｰﾄﾞ変更　移行中　(排出)
AND MR14402              ; RB19 ﾓｰﾄﾞ変更OK(排出)
AND MR14401              ; RB23　ﾓｰﾄﾞ変更OK(排出)
ANB B0414                ; RB21　ﾊﾝﾄﾞﾜｰｸ有
AND= DM10860 #1          ; RB21Target Pos
OUT MR14403              ; ﾓｰﾄﾞ変更移行条件OK
CON
MPS
AND MR14304              ; 貯蔵固定ﾓｰﾄﾞﾞ　選択記憶
@DW #1 DM20000           ; 1:貯_2:排　3:ｽﾙｰ4:自替
MPP
AND MR14306              ; ｽﾙｰﾓｰﾄﾞ　選択記憶
@DW #3 DM20000           ; 1:貯_2:排　3:ｽﾙｰ4:自替
LDF MR14400              ; ﾓｰﾄﾞ変更　移行中　(排出)
RES B0306                ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
CON
RES B0307                ; ﾓｰﾄﾞ変更　移行中　(ｽﾙｰ)LP
;<h1/>　ｽﾙｰﾓｰﾄﾞからの移行
LD MR14312               ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
ANB CR2002               ; 常時ON
TMR #12 #600
LD MR14312               ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
LDP B030                 ; 貯蔵固定ﾓｰﾄﾞ
ORP B031                 ; 排出固定ﾓｰﾄﾞ
ORP T12
ANL
OR MR14500               ; ﾓｰﾄﾞ変更移行中 (ｽﾙｰ)
AND<>.D R41007 #0        ; _Grp1_Task7_起動中ﾌﾗｸﾞ
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB MR14503              ; ﾓｰﾄﾞ変更移行条件OK
OUT MR14500              ; ﾓｰﾄﾞ変更移行中 (ｽﾙｰ)
MPS
AND MR14304              ; 貯蔵固定ﾓｰﾄﾞﾞ　選択記憶
SET B0306                ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
MPP
AND MR14305              ; 排出固定ﾓｰﾄﾞ　選択記憶
SET B0305                ; ﾓｰﾄﾞ変更　移行中　(排出)LP
LD MR14500               ; ﾓｰﾄﾞ変更移行中 (ｽﾙｰ)
AND MR14502              ; RB19 ﾓｰﾄﾞ変更OK(ｽﾙｰ)
ANB B0414                ; RB21　ﾊﾝﾄﾞﾜｰｸ有
AND= DM10860 #1          ; RB21Target Pos
OUT MR14503              ; ﾓｰﾄﾞ変更移行条件OK
CON
MPS
AND MR14304              ; 貯蔵固定ﾓｰﾄﾞﾞ　選択記憶
@DW #1 DM20000           ; 1:貯_2:排　3:ｽﾙｰ4:自替
MPP
AND MR14305              ; 排出固定ﾓｰﾄﾞ　選択記憶
@DW #2 DM20000           ; 1:貯_2:排　3:ｽﾙｰ4:自替
LDF MR14500              ; ﾓｰﾄﾞ変更移行中 (ｽﾙｰ)
RES B0305                ; ﾓｰﾄﾞ変更　移行中　(排出)LP
CON
RES B0306                ; ﾓｰﾄﾞ変更　移行中　(貯蔵)
;<h1/>　動作ﾓｰﾄﾞ
LD CR2002                ; 常時ON
MPS
AND= #1 DM20000          ; 1:貯_2:排　3:ｽﾙｰ4:自替
OUT MR14310              ; 貯蔵固定ﾓｰﾄﾞ
MRD
AND= #2 DM20000          ; 1:貯_2:排　3:ｽﾙｰ4:自替
OUT MR14311              ; 排出固定ﾓｰﾄﾞ
MRD
AND= #3 DM20000          ; 1:貯_2:排　3:ｽﾙｰ4:自替
OUT MR14312              ; ｽﾙｰﾓｰﾄﾞ　(中間ﾊﾞｯﾌｧ未使用)
MPP
AND= #4 DM20000          ; 1:貯_2:排　3:ｽﾙｰ4:自替
OUT MR14313              ; ﾓｰﾄﾞ自動切換え
;ﾍｯﾄﾞｻﾌﾞ→ﾎﾙﾀﾞｰｻﾌﾞの先入れ先だし回路
;<h1/>FIFOテーブル　読出し回路
LD MR401                 ; FIFO読出し　Trig
SET MR17200              ; 読出し開始
STG MR17200              ; 読出し開始
MPS
LDB CR2002               ; 常時ON
ANB MR17301              ; 書き込み実行中
ANL
SET MR17201              ; 読出し実行中
CON
JMP MR17202              ; START
MPP
AND CR2002               ; 常時ON
SET MR17201              ; 読出し実行中
CON
JMP MR17202              ; START
STG MR17202              ; START
MPS
AND<> DM50 #0            ; ﾎﾙﾀﾞｻﾌﾞ指定No.
MPS
AND= DM50 DM60           ; ﾎﾙﾀﾞｻﾌﾞ指定No.  ﾎﾙﾀﾞｻﾌﾞ指定No.
JMP MR17206              ; 取出しOK
MPP
MOV DM50 DM60            ; ﾎﾙﾀﾞｻﾌﾞ指定No.  ﾎﾙﾀﾞｻﾌﾞ指定No.
MPP
AND= DM50 #0             ; ﾎﾙﾀﾞｻﾌﾞ指定No.
JMP MR17203              ; ﾃﾞｰﾀシフト開始
STG MR17203              ; ﾃﾞｰﾀシフト開始
LDA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
STA DM50                 ; ﾎﾙﾀﾞｻﾌﾞ指定No.
CON
LDA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
STA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
LDA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
STA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
LDA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
STA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
LDA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
STA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
LDA DM56                 ; FIFOﾃｰﾌﾞﾙ 6個目
CON
STA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
LDA #0
CON
STA DM56                 ; FIFOﾃｰﾌﾞﾙ 6個目
CON
JMP MR17204
STG MR17204
MPS
LD= DM51 #0              ; FIFOﾃｰﾌﾞﾙ 1個目
AND= DM52 #0             ; FIFOﾃｰﾌﾞﾙ 2個目
AND= DM53 #0             ; FIFOﾃｰﾌﾞﾙ 3個目
AND= DM54 #0             ; FIFOﾃｰﾌﾞﾙ 4個目
AND= DM55 #0             ; FIFOﾃｰﾌﾞﾙ 5個目
AND= DM56 #0             ; FIFOﾃｰﾌﾞﾙ 6個目
ANL
OUT MR17210              ; 全てO
CON
SET MR403                ; FIFO読出し完了なし
CON
JMP MR17208
MPP
ANB MR17210              ; 全てO
JMP MR17202              ; START
;<<行コメント編集：Ctrl+Enter/Escで確定>>
STG MR17206              ; 取出しOK
LDA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
STA DM50                 ; ﾎﾙﾀﾞｻﾌﾞ指定No.
CON
LDA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
STA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
LDA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
STA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
LDA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
STA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
LDA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
STA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
LDA DM56                 ; FIFOﾃｰﾌﾞﾙ 6個目
CON
STA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
MPS
LD= DM60 #1              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11211.0            ; RB13 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11211.15           ; RB13 排出品 記憶FLG
LD= DM60 #2              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11212.0            ; RB14 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11212.15           ; RB14 不良品 記憶FLG
ORL
LD= DM60 #3              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11213.0            ; RB15 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11213.15           ; RB15 不良品 記憶FLG
ORL
LD= DM60 #4              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11214.0            ; RB16 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11214.15           ; RB16 不良品FLG
ORL
LD= DM60 #5              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11215.0            ; RB17 ﾍｯﾄﾞSub　受取完了　記憶
ANB DM11215.15           ; RB17 不良品 記憶FLG
ORL
LD= DM60 #6              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11216.0            ; RB18 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11216.15           ; RB18 不良品 記憶FLG
ORL
ANL
SET MR402                ; FIFO読出し完了OK
CON
JMP MR17208
MPP
ANB MR402                ; FIFO読出し完了OK
JMP MR17208
STG MR17208
ANB MR402                ; FIFO読出し完了OK
ANB MR403                ; FIFO読出し完了なし
RES MR17201              ; 読出し実行中
CON
ENDS
;<h1/>FIFOテーブル　書き込み回路
LD MR405                 ; FIFO書き込みTrig
SET MR17300              ; 書き込み開始
STG MR17300              ; 書き込み開始
ANB MR17201              ; 読出し実行中
RES MR17310              ; 書き込みOK　DM50へ
CON
RES MR17311              ; 書き込みOK　DM51へ
CON
RES MR17312              ; 書き込みOK　DM52へ
CON
RES MR17313              ; 書き込みOK　DM53へ
CON
RES MR17314              ; 書き込みOK　DM54へ
CON
RES MR17315              ; 書き込みOK　DM55へ
CON
RES MR17400              ; 書き込みOK　DM56へ
CON
SET MR17301              ; 書き込み実行中
CON
JMP MR17302              ; START
STG MR17302              ; START
MPS
AND= DM50 #0             ; ﾎﾙﾀﾞｻﾌﾞ指定No.
SET MR17310              ; 書き込みOK　DM50へ
CON
JMP MR17303
MPP
AND<> DM50 #0            ; ﾎﾙﾀﾞｻﾌﾞ指定No.
MPS
AND= DM51 #0             ; FIFOﾃｰﾌﾞﾙ 1個目
SET MR17311              ; 書き込みOK　DM51へ
CON
JMP MR17303
MPP
AND<> DM51 #0            ; FIFOﾃｰﾌﾞﾙ 1個目
MPS
AND= DM52 #0             ; FIFOﾃｰﾌﾞﾙ 2個目
SET MR17312              ; 書き込みOK　DM52へ
CON
JMP MR17303
MPP
AND<> DM52 #0            ; FIFOﾃｰﾌﾞﾙ 2個目
MPS
AND= DM53 #0             ; FIFOﾃｰﾌﾞﾙ 3個目
SET MR17313              ; 書き込みOK　DM53へ
CON
JMP MR17303
MPP
AND<> DM53 #0            ; FIFOﾃｰﾌﾞﾙ 3個目
MPS
AND= DM54 #0             ; FIFOﾃｰﾌﾞﾙ 4個目
SET MR17314              ; 書き込みOK　DM54へ
CON
JMP MR17303
MPP
AND<> DM54 #0            ; FIFOﾃｰﾌﾞﾙ 4個目
MPS
AND= DM55 #0             ; FIFOﾃｰﾌﾞﾙ 5個目
SET MR17315              ; 書き込みOK　DM55へ
CON
JMP MR17303
MPP
LD<> DM55 #0             ; FIFOﾃｰﾌﾞﾙ 5個目
AND= DM56 #0             ; FIFOﾃｰﾌﾞﾙ 6個目
ANL
SET MR17400              ; 書き込みOK　DM56へ
CON
JMP MR17303
STG MR17303
ANB MR17310              ; 書き込みOK　DM50へ
ANB MR17311              ; 書き込みOK　DM51へ
ANB MR17312              ; 書き込みOK　DM52へ
ANB MR17313              ; 書き込みOK　DM53へ
ANB MR17314              ; 書き込みOK　DM54へ
ANB MR17315              ; 書き込みOK　DM55へ
ANB MR17400              ; 書き込みOK　DM56へ
RES MR17301              ; 書き込み実行中
CON
ENDS
;TPｶﾚﾝﾀﾞﾀｲﾏ自動同期
LD= CM703 #8             ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
AND= CM704 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
AND= CM705 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（秒）
SET @R010
STG @R010
MPS
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
CON
ADD #32768
CON
TBCD
CON
STA DM3010               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
CON
TBCD
CON
STA DM3011               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
CON
TBCD
CON
STA DM3012               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM703                ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
CON
TBCD
CON
STA @DM21
MRD
LDA CM704                ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
CON
TBCD
CON
STA @DM20
MRD
UNIB @DM20 DM3013 #2     ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MPP
JMP @R011
STG @R011
TMH @1 #5
CON
AND @T1
BRES DM3010 #15          ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
CON
ENDS
END
ENDH
