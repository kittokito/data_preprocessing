DEVICE:53
;MODULE:RB_out
;MODULE_TYPE:0
;SCRIPT_TYPE:
;非常停止
;Emergency Stop
LD R50010                ; 非常停止
ZRES MR2200 MR2205
CON
ZRES @MR000 @MR3015      ; 電源投入開始
LDB R50010               ; 非常停止
ANB R50415               ; TRAP
OUT R61600               ; 動作許可
CON
OUT R71600               ; 動作許可
CON
OUT R81600               ; 動作許可
;ALL ROBOT 電源ON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
@SET @MR000              ; 電源投入開始
STG @MR000               ; 電源投入開始
SET MR3003               ; DRV-T1 Emergency Stop
CON
SET MR3004               ; DRV-T2 Emergency Stop
CON
SET MR3005               ; DRV-T3 Emergency Stop
CON
SET MR3006               ; DRV-T4 Emergency Stop
CON
SET MR3007               ; DRV-T8 Emergency Stop
CON
JMP @MR001
STG @MR001
TMR @0 #20
CON
AND @T0
SET MR3100               ; DRV-T1 Power ON
CON
JMP @MR002
STG @MR002
TMR @1 #4
CON
AND @T1
SET MR3101               ; DRV-T2 Power ON
CON
JMP @MR003
STG @MR003
TMR @2 #4
CON
AND @T2
SET MR3102               ; DRV-T3 Power ON
CON
JMP @MR004
STG @MR004
TMR @3 #4
CON
AND @T3
SET MR3103               ; DRV-T4 Power ON
CON
JMP @MR005
STG @MR005
TMR @4 #4
CON
AND @T4
SET MR3104               ; DRV-T5 Power ON
CON
JMP @MR006
STG @MR006
TMR @5 #4
CON
AND @T5
SET MR3105               ; DRV-T6 Power ON
CON
JMP @MR007
STG @MR007
TMR @6 #4
CON
AND @T6
SET MR3106               ; DRV-T7 Power ON
CON
JMP @MR008
STG @MR008
TMR @7 #4
CON
AND @T7
SET MR3107               ; DRV-T8 Power ON
CON
JMP @MR009
STG @MR009
TMR @8 #4
CON
AND @T8
SET MR3108               ; DRV-T9 Power ON
CON
JMP @MR010
STG @MR010
TMR @9 #4
CON
AND @T9
SET MR3109               ; DRV-T10 Power ON
CON
JMP @MR011
STG @MR011
TMR @10 #4
CON
AND @T10
SET @MR015               ; 全軸ｻｰﾎﾞON完了
CON
ENDS
;<h1/>RB1
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3100                ; DRV-T1 Power ON
ANB R20001               ; TCa Y軸_ｻｰﾎﾞｵﾝ完了
TMR @13 #10
CON
AND @T13
@SET @MR200
STG @MR200
SET R64305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR201               ; 002
STG @MR201               ; 002
ANB R64705               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R64305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR202               ; 003
STG @MR202               ; 003
SET R64000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR203               ; 002
STG @MR203               ; 002
ANB R64400               ; 軸1 軸ｴﾗｰ中
RES R64000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR204               ; 003
STG @MR204               ; 003
TMR @11 #30              ; 軸1_ｻｰﾎﾞｵﾝ遅延
CON
AND @T11                 ; 軸1_ｻｰﾎﾞｵﾝ遅延
SET R64113               ; 軸1 ｻｰﾎﾞON
CON
JMP @MR205
STG @MR205
TMR @12 #30              ; 軸1_ｻｰﾎﾞｵﾝ確認遅延
CON
AND @T12                 ; 軸1_ｻｰﾎﾞｵﾝ確認遅延
AND R64513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
SET R20001               ; TCa Y軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R64513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
RES R20001               ; TCa Y軸_ｻｰﾎﾞｵﾝ完了
;ﾄﾚｲﾁｪﾝｼﾞｬA Y軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R20200               ; 書き込みOK SW
ORP R20206               ; ﾄﾚｲA計算結果ROM書込み
@SET @MR300              ; TCa Y軸_ﾌﾗｯｼｭﾛﾑ書込み
STG @MR300               ; TCa Y軸_ﾌﾗｯｼｭﾛﾑ書込み
ANB R62812               ; ﾌﾗｯｼｭROM書込完了
SET R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR301
STG @MR301
AND R62812               ; ﾌﾗｯｼｭROM書込完了
UREAD #2 #105 @DM1 #1    ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
RES R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR302
STG @MR302
RES R20206               ; ﾄﾚｲA計算結果ROM書込み
CON
MPS
AND= @DM1 #0             ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
ENDS
MPP
AND<> @DM1 #0            ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
SET R20002               ; TCa Y軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;ﾄﾚｲﾁｪﾝｼﾞｬA Y軸_移動可条件
LDB R64404               ; 軸1 軸制御中
ANB R65204               ; 軸2 軸制御中
AND R21500               ; TCa Z軸 P1 位置　表示
LD R25500                ; 除材 OK Z軸 P1 位置　表示
AND R26500               ; 除材 NG Z軸 P1 位置　表示
ORB R24901               ; 除材P&P_X軸_A級品収納領域
ANL
OUT R20003               ; TCa Y軸_移動可
LDB R65204               ; 軸2 軸制御中
OUT R20004               ; TCa Y軸_移動可(JOG)
;ﾄﾚｲﾁｪﾝｼﾞｬA Y軸_ﾎﾟｼﾞｼｮﾝ表示
;DM4008.L = DM12290.L
;DM4012.L = DM12298.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM24=1 TO 50 STEP 1 
;  Z1 = @DM24 * 2
;  Z2 = @DM24 - 1
;  IF DM4020.L:Z1 = DM4008.L THEN
;    R20500:Z2 = 1
;    DM502 = @DM24                   '比較用現在位置No.表示
;  ELSE
;    R20500:Z2 = 0
;  END IF
;NEXT
;DM4006 = DM4000 + 2100 
;DM4008.L = DM12290.L
;
LD CR2002                ; 常時ON
MOV.L DM12290 DM4008     ; 軸1 現在座標  TCa Y軸_現在座標読出し
;DM4012.L = DM12298.L
;
LD CR2002                ; 常時ON
MOV.L DM12298 DM4012     ; 軸1 現在速度  TCa Y軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM24=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM24
LABEL #2000
LD> @DM24 #50
CJ #2001
;  Z1 = @DM24 * 2
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM24 - 1
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM4020.L:Z1 = DM4008.L THEN
;
LD=.L DM4020:Z1 DM4008   ; TCa Y軸_変更位置表示(TP)  TCa Y軸_現在座標読出し
NCJ #2002
;    R20500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R20500:Z2            ; TCa Y軸 P1 位置　表示
;    DM502 = @DM24                   '比較用現在位置No.表示
;
LD CR2002                ; 常時ON
MOV @DM24 DM502          ; RB1現在Position No.
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;    R20500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R20500:Z2            ; TCa Y軸 P1 位置　表示
;  END IF
;
LABEL #2003
;NEXT
;
LD CR2002                ; 常時ON
INC @DM24
LDB CR2009
CJ #2000
LABEL #2001
;DM4006 = DM4000 + 2100 
LD CR2002                ; 常時ON
LDA DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2100
CON
STA DM4006
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	ﾜｰｸ受取位置1
;2	ﾜｰｸ受取位置2
;3	ﾜｰｸ受取位置3
;4	ﾜｰｸ受取位置4
;5	ﾜｰｸ受取位置5
;6	ﾜｰｸ受取位置6
;7	ﾜｰｸ受取位置7
;8	空ﾄﾚｲ受取位置
;9	実ﾄﾚｲ受渡位置
LD= DM3000 #203          ; 表示画面
OUT R20015               ; RBﾎﾟｲﾝﾄ設定4画面表示中(TP)
LDB R64404               ; 軸1 軸制御中
OUT R20406               ; TCa Y軸_位置取込み可PL(TP)
CON
OUT R20407               ; TCa Y軸_位置書込み可PL(TP)
LD R20205                ; ﾄﾚｲA自動計算(TP)
TMR @15 #10
CON
AND @T15
OUT R20405               ; ﾄﾚｲA自動計算PL(TP)
LDP R20304               ; TCa Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
LDP R20305               ; TCa Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM4000 #9            ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
DW #9 DM4000             ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM4000 #1            ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM4000             ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM4002.L = DM12290.L   
;DM4004.L = DM4150.L
LDP R20306               ; TCa Y軸_位置取込みPB(TP)
AND R20406               ; TCa Y軸_位置取込み可PL(TP)
NCJ #1001
;DM4002.L = DM12290.L   
;
LD CR2002                ; 常時ON
MOV.L DM12290 DM4002     ; 軸1 現在座標  TCa Y軸_変更位置表示計算用
;DM4004.L = DM4150.L
LD CR2002                ; 常時ON
MOV.L DM4150 DM4004      ; TCa Y軸_変更速度表示(TP)  TCa Y軸_変更速度表示計算用
LABEL #1001
;
;
;DM4002.L = DM4020.L   
;DM4004.L = DM4150.L
LD R20307                ; TCa Y軸_位置書込みPB(TP)
AND R20407               ; TCa Y軸_位置書込み可PL(TP)
NCJ #1002
;DM4002.L = DM4020.L   
;
LD CR2002                ; 常時ON
MOV.L DM4020 DM4002      ; TCa Y軸_変更位置表示(TP)  TCa Y軸_変更位置表示計算用
;DM4004.L = DM4150.L
LD CR2002                ; 常時ON
MOV.L DM4150 DM4004      ; TCa Y軸_変更速度表示(TP)  TCa Y軸_変更速度表示計算用
LABEL #1002
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM20 = 18016 + 512*(DM4000-1)
;@DM22 = 18028 + 512*(DM4000-1)
;Z1 = DM4000 * 2
;DM4020.L:Z1 = DM4002.L   
;DM4150.L:Z1 = DM4004.L
;UWRIT(#2,@DM20,DM4002,#2)
;'UWRIT(#2,@DM22,DM4004,#2)       :速度変更しない
;
;
;
LDP R20200               ; 書き込みOK SW
LD R20406                ; TCa Y軸_位置取込み可PL(TP)
OR R20407                ; TCa Y軸_位置書込み可PL(TP)
ANL
NCJ #1003
;@DM20 = 18016 + 512*(DM4000-1)
;
LD CR2002                ; 常時ON
LDA DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM20
;@DM22 = 18028 + 512*(DM4000-1)
;
LD CR2002                ; 常時ON
LDA DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM22
;Z1 = DM4000 * 2
;
LD CR2002                ; 常時ON
LDA DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM4020.L:Z1 = DM4002.L   
;
LD CR2002                ; 常時ON
MOV.L DM4002 DM4020:Z1   ; TCa Y軸_変更位置表示計算用  TCa Y軸_変更位置表示(TP)
;DM4150.L:Z1 = DM4004.L
;
LD CR2002                ; 常時ON
MOV.L DM4004 DM4150:Z1   ; TCa Y軸_変更速度表示計算用  TCa Y軸_変更速度表示(TP)
;UWRIT(#2,@DM20,DM4002,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM20 DM4002 #2 ; TCa Y軸_変更位置表示計算用
;'UWRIT(#2,@DM22,DM4004,#2)       :速度変更しない
;
LABEL #1003
;
;  @DM20 = 18016 + 512*(DM4000-1)
;  @DM22 = 18028 + 512*(DM4000-1)
;  UREAD(#2,@DM20,DM4020,#2)
;  UREAD(#2,@DM22,DM4150,#2)
;
LDP R20304               ; TCa Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R20305               ; TCa Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R20200               ; 書き込みOK SW
NCJ #1004
;  @DM20 = 18016 + 512*(DM4000-1)
;
LD CR2002                ; 常時ON
LDA DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM20
;  @DM22 = 18028 + 512*(DM4000-1)
;
LD CR2002                ; 常時ON
LDA DM4000               ; TCa Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM22
;  UREAD(#2,@DM20,DM4020,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM20 DM4020 #2 ; TCa Y軸_変更位置表示(TP)
;  UREAD(#2,@DM22,DM4150,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM22 DM4150 #2 ; TCa Y軸_変更速度表示(TP)
LABEL #1004
;
;UWRIT(#2,#98,#0,#1)
;
;
;FOR @DM24=1 TO 25 STEP 1 
;  @DM20 = 18016 + 512*(@DM24-1)
;  @DM22 = 18028 + 512*(@DM240-1)
;  Z1 = @DM24 * 2
;  UWRIT(#2,@DM20,DM4020:Z1,#2)
;'  UWRIT(#2,@DM22,DM4150:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#2,#98,#1,#1)
;
;FOR @DM24=1 TO 25 STEP 1 
;  @DM20 = 18016 + 512*(@DM24-1)
;  @DM22 = 18028 + 512*(@DM240-1)
;  Z1 = @DM24 * 2
;  UWRIT(#2,@DM20,DM4070:Z1,#2)
;'  UWRIT(#2,@DM22,DM4200:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#2,#98,#0,#1)
;
;
LDF R20015               ; RBﾎﾟｲﾝﾄ設定4画面表示中(TP)
NCJ #1005
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
;FOR @DM24=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM24
LABEL #2004
LD> @DM24 #25
CJ #2005
;  @DM20 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM20
;  @DM22 = 18028 + 512*(@DM240-1)
;
LD CR2002                ; 常時ON
LDA @DM240
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM22
;  Z1 = @DM24 * 2
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM20,DM4020:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM20 DM4020:Z1 #2;TCa Y軸_変更位置表示(TP)
;'  UWRIT(#2,@DM22,DM4150:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM24
LDB CR2009
CJ #2004
LABEL #2005
;UWRIT(#2,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #1 #1
;FOR @DM24=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM24
LABEL #2006
LD> @DM24 #25
CJ #2007
;  @DM20 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM20
;  @DM22 = 18028 + 512*(@DM240-1)
;
LD CR2002                ; 常時ON
LDA @DM240
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM22
;  Z1 = @DM24 * 2
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM20,DM4070:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM20 DM4070:Z1 #2;TCa Y軸_P25:位置
;'  UWRIT(#2,@DM22,DM4200:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM24
LDB CR2009
CJ #2006
LABEL #2007
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
LABEL #1005
;
;1番と6番から2〜5番を自動計算
;@DM26.L = 18016 + 512*(1-1)         '1番目ﾎﾟｲﾝﾄNo.
;@DM28.L = 18016 + 512*(6-1)         '6番目ﾎﾟｲﾝﾄNo.
;UREAD(#2,@DM26,@DM30,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;UREAD(#2,@DM28,@DM32,#2)            '6番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;for @DM34 =2  to 5
;  Z1 = @DM34 * 2
;  DM4020.L:Z1 = FLOAT(@DM30.L) + ((FLOAT(@DM32.L)-FLOAT(@DM30.L))/5) * (@DM34-1)
;  @DM20 = 18016 + 512*(@DM34-1)  
;  UWRIT(#2,@DM20,DM4020.L:Z1,#2)
;NEXT
;SET(R20206)
LDP R20205               ; ﾄﾚｲA自動計算(TP)
NCJ #1055
;@DM26.L = 18016 + 512*(1-1)         '1番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +18016 @DM26
;@DM28.L = 18016 + 512*(6-1)         '6番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +20576 @DM28
;UREAD(#2,@DM26,@DM30,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #2 @DM26 @DM30 #2
;UREAD(#2,@DM28,@DM32,#2)            '6番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #2 @DM28 @DM32 #2
;for @DM34 =2  to 5
;
LD CR2002                ; 常時ON
MOV #2 @DM34
LABEL #2008
LD> @DM34 #5
CJ #2009
;  Z1 = @DM34 * 2
;
LD CR2002                ; 常時ON
LDA @DM34
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM4020.L:Z1 = FLOAT(@DM30.L) + ((FLOAT(@DM32.L)-FLOAT(@DM30.L))/5) * (@DM34-1)
;
LD CR2002                ; 常時ON
LDA @DM34
CON
EXT
CON
SUB.L +1
CON
STA.L @VM0
CON
LDA.L @DM30
CON
FLOAT.L
CON
STA.F @VM2
CON
LDA.L @DM32
CON
FLOAT.L
CON
SUB.F @VM2
CON
DIV.F +5
CON
STA.F @VM4
CON
LDA.L @VM0
CON
FLOAT.L
CON
MUL.F @VM4
CON
STA.F @VM6
CON
LDA.L @DM30
CON
FLOAT.L
CON
ADD.F @VM6
CON
INTG.L
CON
STA.L DM4020:Z1          ; TCa Y軸_変更位置表示(TP)
;  @DM20 = 18016 + 512*(@DM34-1)  
;
LD CR2002                ; 常時ON
LDA @DM34
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM20
;  UWRIT(#2,@DM20,DM4020.L:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT.L #2 @DM20 DM4020:Z1 #2;TCa Y軸_変更位置表示(TP)
;NEXT
;
LD CR2002                ; 常時ON
INC @DM34
LDB CR2009
CJ #2008
LABEL #2009
;SET(R20206)
LD CR2002                ; 常時ON
SET R20206               ; ﾄﾚｲA計算結果ROM書込み
LABEL #1055
;
;原点復帰動作
LDP R20201               ; TCa Y軸 隠し原点復帰SW
ORP R20202               ; TCa Y軸RB原点復帰要求
ANB R20104               ; TCa Y軸_原点復帰中
ANB @MR308
RES R20105               ; TCa Y軸原点復帰完了
CON
RES MR3200               ; RB1_HOME
CON
SET @MR308
STG @MR308
MPS
AND R20105               ; TCa Y軸原点復帰完了
JMP @MR309
MPP
MCALL GENTEN1 #2 #1 MR3200 R1000 R20105;RB1_HOME  RB1 HOME  END  TCa Y軸原点復帰完了
STG @MR309
RES R20105               ; TCa Y軸原点復帰完了
CON
RES MR3200               ; RB1_HOME
CON
ANB R20105               ; TCa Y軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R20203               ; TCa Y軸RB原点復帰完了
CON
ENDS
;<h1/>RB2
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3101                ; DRV-T2 Power ON
ANB R21001               ; TCa Z軸_ｻｰﾎﾞｵﾝ完了
TMR @23 #10
CON
AND @T23
@SET @MR500
STG @MR500
SET R65105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR501               ; 002
STG @MR501               ; 002
ANB R65505               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R65105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR502               ; 003
STG @MR502               ; 003
SET R64800               ; 軸2 軸ｴﾗｰｸﾘｱ
CON
JMP @MR503               ; 002
STG @MR503               ; 002
ANB R65200               ; 軸2 軸ｴﾗｰ中
RES R64800               ; 軸2 軸ｴﾗｰｸﾘｱ
CON
JMP @MR504               ; 003
STG @MR504               ; 003
TMR @21 #30
CON
AND @T21
SET R64913               ; 軸2 ｻｰﾎﾞON
CON
JMP @MR505
STG @MR505
TMR @22 #30
CON
AND @T22
AND R65313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
SET R21001               ; TCa Z軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R65313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
RES R21001               ; TCa Z軸_ｻｰﾎﾞｵﾝ完了
;ﾄﾚｲﾁｪﾝｼﾞｬA Z軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R21200               ; 書き込みOK SW
@SET @MR600              ; TCa Y軸_ﾌﾗｯｼｭﾛﾑ書込み
STG @MR600               ; TCa Y軸_ﾌﾗｯｼｭﾛﾑ書込み
ANB R62812               ; ﾌﾗｯｼｭROM書込完了
SET R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR601
STG @MR601
AND R62812               ; ﾌﾗｯｼｭROM書込完了
UREAD #2 #105 @DM2 #1    ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
RES R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR602
STG @MR602
MPS
AND= @DM2 #0             ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
ENDS
MPP
AND<> @DM2 #0            ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
SET R21002               ; TCa Z軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;ﾄﾚｲﾁｪﾝｼﾞｬA Z軸_移動可条件
LDB R20500               ; TCa Y軸 P1 位置　表示
ANB R20501               ; TCa Y軸 P2 位置　表示
ANB R20502               ; TCa Y軸 P3 位置　表示
ANB R20503               ; TCa Y軸 P4 位置　表示
ANB R20504               ; TCa Y軸 P5 位置　表示
ANB R20505               ; TCa Y軸 P6 位置　表示
ANB R20507               ; TCa Y軸 P8 位置　表示
ANB R20508               ; TCa Y軸 P9 位置　表示
ANB R50003               ; 原点復帰中
INV
ANB R64404               ; 軸1 軸制御中
ANB R65204               ; 軸2 軸制御中
OUT R21003               ; TCa Z軸_移動可
LDB R64404               ; 軸1 軸制御中
OUT R21004               ; TCa Z軸_移動可(JOG)
;ﾄﾚｲﾁｪﾝｼﾞｬA Z軸_ﾎﾟｼﾞｼｮﾝ表示
;DM4308.L = DM12350.L
;DM4312.L = DM12358.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM44=1 TO 50 STEP 1 
;  Z1 = @DM44 * 2
;  Z2 = @DM44 - 1
;  IF DM4320.L:Z1 = DM4308.L THEN
;    R21500:Z2 = 1
;  ELSE
;    R21500:Z2 = 0
;  END IF
;NEXT
;DM4306 = DM4300 +2150
;DM4308.L = DM12350.L
;
LD CR2002                ; 常時ON
MOV.L DM12350 DM4308     ; 軸2 現在座標  TCa Z軸_現在座標読出し
;DM4312.L = DM12358.L
;
LD CR2002                ; 常時ON
MOV.L DM12358 DM4312     ; 軸2 現在速度  TCa Z軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM44=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM44
LABEL #2010
LD> @DM44 #50
CJ #2011
;  Z1 = @DM44 * 2
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM44 - 1
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM4320.L:Z1 = DM4308.L THEN
;
LD=.L DM4320:Z1 DM4308   ; TCa Z軸_変更位置表示(TP)  TCa Z軸_現在座標読出し
NCJ #2012
;    R21500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R21500:Z2            ; TCa Z軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2013
LABEL #2012
;    R21500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R21500:Z2            ; TCa Z軸 P1 位置　表示
;  END IF
;
LABEL #2013
;NEXT
;
LD CR2002                ; 常時ON
INC @DM44
LDB CR2009
CJ #2010
LABEL #2011
;DM4306 = DM4300 +2150
LD CR2002                ; 常時ON
LDA DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2150
CON
STA DM4306
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	ﾜｰｸ受取高さ
;2	空ﾄﾚｲ段ばらし下位置
;3	空ﾄﾚｲ段ばらし上位置
;4	実ﾄﾚｲ段ばらし下位置
;5	実ﾄﾚｲ段ばらし上位置
LD= DM3000 #203          ; 表示画面
OUT R21015               ; RBﾎﾟｲﾝﾄ設定4画面表示中(TP)
LDB R65204               ; 軸2 軸制御中
OUT R21406               ; TCa Z軸_位置取込み可PL(TP)
CON
OUT R21407               ; TCa Z軸_位置書込み可PL(TP)
LDP R21304               ; TCa Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
LDP R21305               ; TCa Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM4300 #6            ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #6 DM4300             ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM4300 #1            ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM4300             ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM4302.L = DM12350.L   
;DM4304.L = DM4450.L
LDP R21306               ; TCa Z軸_位置取込みPB(TP)
AND R21406               ; TCa Z軸_位置取込み可PL(TP)
NCJ #1000
;DM4302.L = DM12350.L   
;
LD CR2002                ; 常時ON
MOV.L DM12350 DM4302     ; 軸2 現在座標  TCa Z軸_変更位置表示計算用
;DM4304.L = DM4450.L
LD CR2002                ; 常時ON
MOV.L DM4450 DM4304      ; TCa Z軸_変更速度表示(TP)  TCa Z軸_変更速度表示計算用
LABEL #1000
;
;
;DM4302.L = DM4320.L   
;DM4304.L = DM4450.L
LD R21307                ; TCa Z軸_位置書込みPB(TP)
AND R21407               ; TCa Z軸_位置書込み可PL(TP)
NCJ #1006
;DM4302.L = DM4320.L   
;
LD CR2002                ; 常時ON
MOV.L DM4320 DM4302      ; TCa Z軸_変更位置表示(TP)  TCa Z軸_変更位置表示計算用
;DM4304.L = DM4450.L
LD CR2002                ; 常時ON
MOV.L DM4450 DM4304      ; TCa Z軸_変更速度表示(TP)  TCa Z軸_変更速度表示計算用
LABEL #1006
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM40 = 18048 + 512*(DM4300-1)
;@DM42 = 18060 + 512*(DM4300-1)
;Z1 = DM4300 * 2
;DM4320.L:Z1 = DM4302.L   
;DM4450.L:Z1 = DM4304.L
;UWRIT(#2,@DM40,DM4302,#2)
;'UWRIT(#2,@DM42,DM4304,#2)       :速度変更しない
LDP R21200               ; 書き込みOK SW
LD R21406                ; TCa Z軸_位置取込み可PL(TP)
OR R21407                ; TCa Z軸_位置書込み可PL(TP)
ANL
NCJ #1007
;@DM40 = 18048 + 512*(DM4300-1)
;
LD CR2002                ; 常時ON
LDA DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM40
;@DM42 = 18060 + 512*(DM4300-1)
;
LD CR2002                ; 常時ON
LDA DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM42
;Z1 = DM4300 * 2
;
LD CR2002                ; 常時ON
LDA DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM4320.L:Z1 = DM4302.L   
;
LD CR2002                ; 常時ON
MOV.L DM4302 DM4320:Z1   ; TCa Z軸_変更位置表示計算用  TCa Z軸_変更位置表示(TP)
;DM4450.L:Z1 = DM4304.L
;
LD CR2002                ; 常時ON
MOV.L DM4304 DM4450:Z1   ; TCa Z軸_変更速度表示計算用  TCa Z軸_変更速度表示(TP)
;UWRIT(#2,@DM40,DM4302,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM40 DM4302 #2 ; TCa Z軸_変更位置表示計算用
;'UWRIT(#2,@DM42,DM4304,#2)       :速度変更しない
LABEL #1007
;
;  @DM40 = 18048 + 512*(DM4300-1)
;  @DM42 = 18060 + 512*(DM4300-1)
;  UREAD(#2,@DM40,DM4320,#2)
;  UREAD(#2,@DM42,DM4450,#2)
LDP R21304               ; TCa Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R21305               ; TCa Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R21200               ; 書き込みOK SW
NCJ #1008
;  @DM40 = 18048 + 512*(DM4300-1)
;
LD CR2002                ; 常時ON
LDA DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM40
;  @DM42 = 18060 + 512*(DM4300-1)
;
LD CR2002                ; 常時ON
LDA DM4300               ; TCa Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM42
;  UREAD(#2,@DM40,DM4320,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM40 DM4320 #2 ; TCa Z軸_変更位置表示(TP)
;  UREAD(#2,@DM42,DM4450,#2)
LD CR2002                ; 常時ON
UREAD #2 @DM42 DM4450 #2 ; TCa Z軸_変更速度表示(TP)
LABEL #1008
;
;
;UWRIT(#2,#98,#0,#1)
;
;
;FOR @DM44=1 TO 25 STEP 1 
;  @DM40 = 18048 + 512*(@DM44-1)
;  @DM42 = 18060 + 512*(@DM44-1)
;  Z1 = @DM44 * 2
;  UWRIT(#2,@DM40,DM4320:Z1,#2)
; '  UWRIT(#2,@DM42,DM4450:Z1,#2)       :速度変更しない
;NEXT
;
;
;UWRIT(#2,#98,#1,#1)
;
;FOR @DM44=1 TO 25 STEP 1 
;  @DM40 = 18048 + 512*(@DM44-1)
;  @DM42 = 18060 + 512*(@DM44-1)
;  Z1 = @DM44 * 2
;  UWRIT(#2,@DM40,DM4370:Z1,#2)
;'  UWRIT(#2,@DM42,DM4500:Z1,#2)       :速度変更しない
;NEXT
;
;
;UWRIT(#2,#98,#0,#1)
;
LDF R21015               ; RBﾎﾟｲﾝﾄ設定4画面表示中(TP)
NCJ #1009
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
;FOR @DM44=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM44
LABEL #2014
LD> @DM44 #25
CJ #2015
;  @DM40 = 18048 + 512*(@DM44-1)
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM40
;  @DM42 = 18060 + 512*(@DM44-1)
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM42
;  Z1 = @DM44 * 2
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM40,DM4320:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM40 DM4320:Z1 #2;TCa Z軸_変更位置表示(TP)
; '  UWRIT(#2,@DM42,DM4450:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM44
LDB CR2009
CJ #2014
LABEL #2015
;UWRIT(#2,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #1 #1
;FOR @DM44=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM44
LABEL #2016
LD> @DM44 #25
CJ #2017
;  @DM40 = 18048 + 512*(@DM44-1)
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM40
;  @DM42 = 18060 + 512*(@DM44-1)
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM42
;  Z1 = @DM44 * 2
;
LD CR2002                ; 常時ON
LDA @DM44
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM40,DM4370:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM40 DM4370:Z1 #2;TCa Z軸_P25:位置
;'  UWRIT(#2,@DM42,DM4500:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM44
LDB CR2009
CJ #2016
LABEL #2017
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
LABEL #1009
;
;原点復帰動作
LDP R21201               ; TCa Z軸 隠し原点復帰SW
ORP R21202               ; TCa Z軸RB原点復帰要求
ANB R21104               ; TCa Z軸_原点復帰中
ANB @MR608
RES R21105               ; TCa Z軸原点復帰完了
CON
RES MR3202               ; RB2_HOME
CON
SET @MR608
STG @MR608
MPS
AND R21105               ; TCa Z軸原点復帰完了
JMP @MR609
MPP
MCALL GENTEN1 #2 #2 MR3202 R1001 R21105;RB2_HOME  RB2 HOME  END  TCa Z軸原点復帰完了
STG @MR609
RES R21105               ; TCa Z軸原点復帰完了
CON
RES MR3202               ; RB2_HOME
CON
ANB R21105               ; TCa Z軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R21203               ; TCa Z軸RB原点復帰完了
CON
ENDS
;<h1/>RB3
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3102                ; DRV-T3 Power ON
ANB R22001               ; TCb Y軸_ｻｰﾎﾞｵﾝ完了
TMR @33 #10
CON
AND @T33
@SET @MR800
STG @MR800
SET R65905               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR801
STG @MR801
ANB R66305               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R65905               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR802
STG @MR802
SET R65600               ; 軸3 軸ｴﾗｰｸﾘｱ
CON
JMP @MR803
STG @MR803
ANB R66000               ; 軸3 軸ｴﾗｰ中
RES R65600               ; 軸3 軸ｴﾗｰｸﾘｱ
CON
JMP @MR804
STG @MR804
TMR @31 #30
CON
AND @T31
SET R65713               ; 軸3 ｻｰﾎﾞON
CON
JMP @MR805
STG @MR805
TMR @32 #30
CON
AND @T32
AND R66113               ; 軸3 ｻｰﾎﾞﾚﾃﾞｨ
SET R22001               ; TCb Y軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R66113               ; 軸3 ｻｰﾎﾞﾚﾃﾞｨ
RES R22001               ; TCb Y軸_ｻｰﾎﾞｵﾝ完了
;ﾄﾚｲﾁｪﾝｼﾞｬB Y軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R22200               ; 書き込みOK SW
ORP R22206               ; ﾄﾚｲB計算結果ROM書込み
@SET @MR900
STG @MR900
ANB R62812               ; ﾌﾗｯｼｭROM書込完了
SET R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR901
STG @MR901
AND R62812               ; ﾌﾗｯｼｭROM書込完了
UREAD #2 #105 @DM3 #1    ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
RES R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR902
STG @MR902
RES R22206               ; ﾄﾚｲB計算結果ROM書込み
CON
MPS
AND= @DM3 #0             ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
ENDS
MPP
AND<> @DM3 #0            ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
SET R22002               ; TCb Y軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;ﾄﾚｲﾁｪﾝｼﾞｬB Y軸_移動可条件
LDB R66004               ; 軸3 軸制御中
ANB R66804               ; 軸4 軸制御中
AND R23500               ; TCb Z軸 P1 位置　表示
LD R25500                ; 除材 OK Z軸 P1 位置　表示
AND R26500               ; 除材 NG Z軸 P1 位置　表示
ORB R24902               ; 除材P&P_X軸_B級品収納領域
ANL
OUT R22003               ; TCb Y軸_移動可
LDB R66804               ; 軸4 軸制御中
OUT R22004               ; TCb Y軸_移動可(JOG)
;ﾄﾚｲﾁｪﾝｼﾞｬB Y軸_ﾎﾟｼﾞｼｮﾝ表示
;DM4608.L = DM12410.L
;DM4612.L = DM12418.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM64=1 TO 50 STEP 1 
;  Z1 = @DM64 * 2
;  Z2 = @DM64 - 1
;  IF DM4620.L:Z1 = DM4608.L THEN
;    R22500:Z2 = 1
;    DM512 = @DM64                   '比較用現在位置No.表示
;  ELSE
;    R22500:Z2 = 0
;  END IF
;NEXT
;DM4606 = DM4600 +2200
;DM4608.L = DM12410.L
;
LD CR2002                ; 常時ON
MOV.L DM12410 DM4608     ; 軸3 現在座標  TCb Y軸_現在座標読出し
;DM4612.L = DM12418.L
;
LD CR2002                ; 常時ON
MOV.L DM12418 DM4612     ; 軸3 現在速度  TCb Y軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM64=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM64
LABEL #2018
LD> @DM64 #50
CJ #2019
;  Z1 = @DM64 * 2
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM64 - 1
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM4620.L:Z1 = DM4608.L THEN
;
LD=.L DM4620:Z1 DM4608   ; TCb Y軸_変更位置表示(TP)  TCb Y軸_現在座標読出し
NCJ #2020
;    R22500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R22500:Z2            ; TCb Y軸 P1 位置　表示
;    DM512 = @DM64                   '比較用現在位置No.表示
;
LD CR2002                ; 常時ON
MOV @DM64 DM512          ; RB3現在Position No.
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2021
LABEL #2020
;    R22500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R22500:Z2            ; TCb Y軸 P1 位置　表示
;  END IF
;
LABEL #2021
;NEXT
;
LD CR2002                ; 常時ON
INC @DM64
LDB CR2009
CJ #2018
LABEL #2019
;DM4606 = DM4600 +2200
LD CR2002                ; 常時ON
LDA DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2200
CON
STA DM4606
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	ﾜｰｸ受取位置1
;2	ﾜｰｸ受取位置2
;3	ﾜｰｸ受取位置3
;4	ﾜｰｸ受取位置4
;5	ﾜｰｸ受取位置5
;6	ﾜｰｸ受取位置6
;7	ﾜｰｸ受取位置7
;8	空ﾄﾚｲ受取位置
;9	実ﾄﾚｲ受渡位置
LD= DM3000 #204          ; 表示画面
OUT R22015               ; RBﾎﾟｲﾝﾄ設定5画面表示中(TP)
LDB R66004               ; 軸3 軸制御中
OUT R22406               ; TCb Y軸_位置取込み可PL(TP)
CON
OUT R22407               ; TCb Y軸_位置書込み可PL(TP)
LD R22205                ; ﾄﾚｲB自動計算(TP)
TMR @35 #10
CON
AND @T35
OUT R22405               ; ﾄﾚｲB自動計算PL(TP)
LDP R22304               ; TCb Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
LDP R22305               ; TCb Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM4600 #9            ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
DW #9 DM4600             ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM4600 #1            ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM4600             ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM4602.L = DM12410.L   
;DM4604.L = DM4750.L
LDP R22306               ; TCb Y軸_位置取込みPB(TP)
AND R22406               ; TCb Y軸_位置取込み可PL(TP)
NCJ #1010
;DM4602.L = DM12410.L   
;
LD CR2002                ; 常時ON
MOV.L DM12410 DM4602     ; 軸3 現在座標  TCb Y軸_変更位置表示計算用
;DM4604.L = DM4750.L
LD CR2002                ; 常時ON
MOV.L DM4750 DM4604      ; TCb Y軸_変更速度表示(TP)  TCb Y軸_変更速度表示計算用
LABEL #1010
;
;
;DM4602.L = DM4620.L   
;DM4604.L = DM4750.L
LD R22307                ; TCb Y軸_位置書込みPB(TP)
AND R22407               ; TCb Y軸_位置書込み可PL(TP)
NCJ #1011
;DM4602.L = DM4620.L   
;
LD CR2002                ; 常時ON
MOV.L DM4620 DM4602      ; TCb Y軸_変更位置表示(TP)  TCb Y軸_変更位置表示計算用
;DM4604.L = DM4750.L
LD CR2002                ; 常時ON
MOV.L DM4750 DM4604      ; TCb Y軸_変更速度表示(TP)  TCb Y軸_変更速度表示計算用
LABEL #1011
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM60 = 18080 + 512*(DM4600-1)
;@DM62 = 18092 + 512*(DM4600-1)
;Z1 = DM4600 * 2
;DM4620.L:Z1 = DM4602.L   
;DM4750.L:Z1 = DM4604.L
;UWRIT(#2,@DM60,DM4602,#2)
;'UWRIT(#2,@DM62,DM4604,#2)       :速度変更しない
LDP R22200               ; 書き込みOK SW
LD R22406                ; TCb Y軸_位置取込み可PL(TP)
OR R22407                ; TCb Y軸_位置書込み可PL(TP)
ANL
NCJ #1012
;@DM60 = 18080 + 512*(DM4600-1)
;
LD CR2002                ; 常時ON
LDA DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM60
;@DM62 = 18092 + 512*(DM4600-1)
;
LD CR2002                ; 常時ON
LDA DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM62
;Z1 = DM4600 * 2
;
LD CR2002                ; 常時ON
LDA DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM4620.L:Z1 = DM4602.L   
;
LD CR2002                ; 常時ON
MOV.L DM4602 DM4620:Z1   ; TCb Y軸_変更位置表示計算用  TCb Y軸_変更位置表示(TP)
;DM4750.L:Z1 = DM4604.L
;
LD CR2002                ; 常時ON
MOV.L DM4604 DM4750:Z1   ; TCb Y軸_変更速度表示計算用  TCb Y軸_変更速度表示(TP)
;UWRIT(#2,@DM60,DM4602,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM60 DM4602 #2 ; TCb Y軸_変更位置表示計算用
;'UWRIT(#2,@DM62,DM4604,#2)       :速度変更しない
LABEL #1012
;
;  @DM60 = 18080 + 512*(DM4600-1)
;  @DM62 = 18092 + 512*(DM4600-1)
;  UREAD(#2,@DM60,DM4620,#2)
;  UREAD(#2,@DM62,DM4750,#2)
;
LDP R22304               ; TCb Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R22305               ; TCb Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R22200               ; 書き込みOK SW
NCJ #1013
;  @DM60 = 18080 + 512*(DM4600-1)
;
LD CR2002                ; 常時ON
LDA DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM60
;  @DM62 = 18092 + 512*(DM4600-1)
;
LD CR2002                ; 常時ON
LDA DM4600               ; TCb Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM62
;  UREAD(#2,@DM60,DM4620,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM60 DM4620 #2 ; TCb Y軸_変更位置表示(TP)
;  UREAD(#2,@DM62,DM4750,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM62 DM4750 #2 ; TCb Y軸_変更速度表示(TP)
LABEL #1013
;
;UWRIT(#2,#98,#0,#1)
;
;FOR @DM64=1 TO 25 STEP 1 
;  @DM60 = 18080 + 512*(@DM64-1)
;  @DM62 = 18092 + 512*(@DM64-1)
;  Z1 = @DM64 * 2
;  UWRIT(#2,@DM60,DM4620:Z1,#2)
;'  UWRIT(#2,@DM62,DM4750:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#2,#98,#1,#1)
;
;FOR @DM64=1 TO 25 STEP 1 
;  @DM60 = 18080 + 512*(@DM64-1)
;  @DM62 = 18092 + 512*(@DM64-1)
;  Z1 = @DM64 * 2
;  UWRIT(#2,@DM60,DM4670:Z1,#2)
;'  UWRIT(#2,@DM62,DM4800:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#2,#98,#0,#1)
;
LDF R22015               ; RBﾎﾟｲﾝﾄ設定5画面表示中(TP)
NCJ #1014
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
;FOR @DM64=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM64
LABEL #2022
LD> @DM64 #25
CJ #2023
;  @DM60 = 18080 + 512*(@DM64-1)
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM60
;  @DM62 = 18092 + 512*(@DM64-1)
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM62
;  Z1 = @DM64 * 2
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM60,DM4620:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM60 DM4620:Z1 #2;TCb Y軸_変更位置表示(TP)
;'  UWRIT(#2,@DM62,DM4750:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM64
LDB CR2009
CJ #2022
LABEL #2023
;UWRIT(#2,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #1 #1
;FOR @DM64=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM64
LABEL #2024
LD> @DM64 #25
CJ #2025
;  @DM60 = 18080 + 512*(@DM64-1)
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM60
;  @DM62 = 18092 + 512*(@DM64-1)
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM62
;  Z1 = @DM64 * 2
;
LD CR2002                ; 常時ON
LDA @DM64
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM60,DM4670:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM60 DM4670:Z1 #2;TCb Y軸_P25:位置
;'  UWRIT(#2,@DM62,DM4800:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM64
LDB CR2009
CJ #2024
LABEL #2025
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
LABEL #1014
;
;1番と6番から2〜5番を自動計算
;@DM66.L = 18080 + 512*(1-1)         '1番目ﾎﾟｲﾝﾄNo.
;@DM68.L = 18080 + 512*(6-1)         '6番目ﾎﾟｲﾝﾄNo.
;UREAD(#2,@DM66,@DM70,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;UREAD(#2,@DM68,@DM72,#2)            '6番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;for @DM74 =2  to 5
;  Z1 = @DM74 * 2
;  DM4620.L:Z1 = FLOAT(@DM70.L) + ((FLOAT(@DM72.L)-FLOAT(@DM70.L))/5) * (@DM74-1)
;  @DM60 = 18080 + 512*(@DM74-1)  
;  UWRIT(#2,@DM60,DM4620.L:Z1,#2)
;NEXT
;SET(R22206)
LDP R22205               ; ﾄﾚｲB自動計算(TP)
NCJ #1054
;@DM66.L = 18080 + 512*(1-1)         '1番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +18080 @DM66
;@DM68.L = 18080 + 512*(6-1)         '6番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +20640 @DM68
;UREAD(#2,@DM66,@DM70,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #2 @DM66 @DM70 #2
;UREAD(#2,@DM68,@DM72,#2)            '6番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #2 @DM68 @DM72 #2
;for @DM74 =2  to 5
;
LD CR2002                ; 常時ON
MOV #2 @DM74
LABEL #2026
LD> @DM74 #5
CJ #2027
;  Z1 = @DM74 * 2
;
LD CR2002                ; 常時ON
LDA @DM74
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM4620.L:Z1 = FLOAT(@DM70.L) + ((FLOAT(@DM72.L)-FLOAT(@DM70.L))/5) * (@DM74-1)
;
LD CR2002                ; 常時ON
LDA @DM74
CON
EXT
CON
SUB.L +1
CON
STA.L @VM8
CON
LDA.L @DM70
CON
FLOAT.L
CON
STA.F @VM10
CON
LDA.L @DM72
CON
FLOAT.L
CON
SUB.F @VM10
CON
DIV.F +5
CON
STA.F @VM12
CON
LDA.L @VM8
CON
FLOAT.L
CON
MUL.F @VM12
CON
STA.F @VM14
CON
LDA.L @DM70
CON
FLOAT.L
CON
ADD.F @VM14
CON
INTG.L
CON
STA.L DM4620:Z1          ; TCb Y軸_変更位置表示(TP)
;  @DM60 = 18080 + 512*(@DM74-1)  
;
LD CR2002                ; 常時ON
LDA @DM74
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM60
;  UWRIT(#2,@DM60,DM4620.L:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT.L #2 @DM60 DM4620:Z1 #2;TCb Y軸_変更位置表示(TP)
;NEXT
;
LD CR2002                ; 常時ON
INC @DM74
LDB CR2009
CJ #2026
LABEL #2027
;SET(R22206)
LD CR2002                ; 常時ON
SET R22206               ; ﾄﾚｲB計算結果ROM書込み
LABEL #1054
;
;原点復帰動作
LDP R22309               ; TCb Y軸_隠し原点復帰SW
AND R22003               ; TCb Y軸_移動可
ORP R22202               ; TCb Y軸RB原点復帰要求
ANB R22104               ; TCb Y軸_原点復帰中
ANB @MR908
SET R23409
CON
RES R22105               ; TCb Y軸原点復帰完了
CON
RES MR3204               ; RB3_HOME
CON
SET @MR908
STG @MR908
MPS
AND R22105               ; TCb Y軸原点復帰完了
JMP @MR909
MPP
MCALL GENTEN1 #2 #3 MR3204 R1002 R22105;RB3_HOME  RB3 HOME  END  TCb Y軸原点復帰完了
STG @MR909
RES R22105               ; TCb Y軸原点復帰完了
CON
RES MR3204               ; RB3_HOME
CON
ANB R22105               ; TCb Y軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R22203               ; TCb Y軸RB原点復帰完了
CON
ENDS
;<h1/>RB4
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3107                ; DRV-T8 Power ON
ANB R23001               ; TCb Z軸_ｻｰﾎﾞｵﾝ完了
TMR @43 #10
CON
AND @T43
@SET @MR1100
STG @MR1100
SET R66705               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR1101
STG @MR1101
ANB R67105               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R66705               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR1102
STG @MR1102
SET R66400               ; 軸4 軸ｴﾗｰｸﾘｱ
CON
JMP @MR1103
STG @MR1103
ANB R66800               ; 軸4 軸ｴﾗｰ中
RES R66400               ; 軸4 軸ｴﾗｰｸﾘｱ
CON
JMP @MR1104
STG @MR1104
TMR @41 #30
CON
AND @T41
SET R66513               ; 軸4 ｻｰﾎﾞON
CON
JMP @MR1105
STG @MR1105
TMR @42 #30
CON
AND @T42
AND R66913               ; 軸4 ｻｰﾎﾞﾚﾃﾞｨ
SET R23001               ; TCb Z軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R66913               ; 軸4 ｻｰﾎﾞﾚﾃﾞｨ
RES R23001               ; TCb Z軸_ｻｰﾎﾞｵﾝ完了
;ﾄﾚｲﾁｪﾝｼﾞｬB_Z軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R23200               ; 書き込みOK SW
@SET @MR1200
STG @MR1200
ANB R62812               ; ﾌﾗｯｼｭROM書込完了
SET R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR1201
STG @MR1201
AND R62812               ; ﾌﾗｯｼｭROM書込完了
UREAD #2 #105 @DM4 #1    ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
RES R61612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR1202
STG @MR1202
MPS
AND= @DM4 #0             ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
ENDS
MPP
AND<> @DM4 #0            ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
SET R23002               ; TCb Z軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;ﾄﾚｲﾁｪﾝｼﾞｬB_Z軸_移動可条件
LDB R22500               ; TCb Y軸 P1 位置　表示
ANB R22501               ; TCb Y軸 P2 位置　表示
ANB R22502               ; TCb Y軸 P3 位置　表示
ANB R22503               ; TCb Y軸 P4 位置　表示
ANB R22504               ; TCb Y軸 P5 位置　表示
ANB R22505               ; TCb Y軸 P6 位置　表示
ANB R22507               ; TCb Y軸 P8 位置　表示
ANB R22508               ; TCb Y軸 P9 位置　表示
ANB R50003               ; 原点復帰中
INV
ANB R66004               ; 軸3 軸制御中
ANB R66804               ; 軸4 軸制御中
OUT R23003               ; TCb Z軸_移動可
LDB R66004               ; 軸3 軸制御中
OUT R23004               ; TCb Z軸_移動可(JOG)
;ﾄﾚｲﾁｪﾝｼﾞｬB_Z軸_ﾎﾟｼﾞｼｮﾝ表示
;DM4908.L = DM12470.L
;DM4912.L = DM12478.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM84=1 TO 50 STEP 1 
;  Z1 = @DM84 * 2
;  Z2 = @DM84 - 1
;  IF DM4920.L:Z1 = DM4908.L THEN
;    R23500:Z2 = 1
;  ELSE
;    R23500:Z2 = 0
;  END IF
;NEXT
;DM4906 = DM4900 + 2250
;DM4908.L = DM12470.L
;
LD CR2002                ; 常時ON
MOV.L DM12470 DM4908     ; 軸4 現在座標  TCb Z軸_現在座標読出し
;DM4912.L = DM12478.L
;
LD CR2002                ; 常時ON
MOV.L DM12478 DM4912     ; 軸4 現在速度  TCb Z軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM84=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM84
LABEL #2028
LD> @DM84 #50
CJ #2029
;  Z1 = @DM84 * 2
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM84 - 1
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM4920.L:Z1 = DM4908.L THEN
;
LD=.L DM4920:Z1 DM4908   ; TCb Z軸_変更位置表示(TP)  TCb Z軸_現在座標読出し
NCJ #2030
;    R23500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R23500:Z2            ; TCb Z軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2031
LABEL #2030
;    R23500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R23500:Z2            ; TCb Z軸 P1 位置　表示
;  END IF
;
LABEL #2031
;NEXT
;
LD CR2002                ; 常時ON
INC @DM84
LDB CR2009
CJ #2028
LABEL #2029
;DM4906 = DM4900 + 2250
LD CR2002                ; 常時ON
LDA DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2250
CON
STA DM4906
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	ﾜｰｸ受取高さ
;2	空ﾄﾚｲ段ばらし下位置
;3	空ﾄﾚｲ段ばらし上位置
;4	実ﾄﾚｲ段ばらし下位置
;5	実ﾄﾚｲ段ばらし上位置
LD= DM3000 #204          ; 表示画面
OUT R23015               ; RBﾎﾟｲﾝﾄ設定5画面表示中(TP)
LDB R66804               ; 軸4 軸制御中
OUT R23406               ; TCb Z軸_位置取込み可PL(TP)
CON
OUT R23407               ; TCb Z軸_位置書込み可PL(TP)
LDP R23304               ; TCb Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
LDP R23305               ; TCb Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM4900 #6            ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #6 DM4900             ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM4900 #1            ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM4900             ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM4902.L = DM12470.L   
;DM4904.L = DM5050.L
LDP R23306               ; TCb Z軸_位置取込みPB(TP)
AND R23406               ; TCb Z軸_位置取込み可PL(TP)
NCJ #1015
;DM4902.L = DM12470.L   
;
LD CR2002                ; 常時ON
MOV.L DM12470 DM4902     ; 軸4 現在座標  TCb Z軸_変更位置表示計算用
;DM4904.L = DM5050.L
LD CR2002                ; 常時ON
MOV.L DM5050 DM4904      ; TCb Z軸_変更速度表示(TP)  TCb Z軸_変更速度表示計算用
LABEL #1015
;
;
;DM4902.L = DM4920.L   
;DM4904.L = DM5050.L
LD R23307                ; TCb Z軸_位置書込みPB(TP)
AND R23407               ; TCb Z軸_位置書込み可PL(TP)
NCJ #1016
;DM4902.L = DM4920.L   
;
LD CR2002                ; 常時ON
MOV.L DM4920 DM4902      ; TCb Z軸_変更位置表示(TP)  TCb Z軸_変更位置表示計算用
;DM4904.L = DM5050.L
LD CR2002                ; 常時ON
MOV.L DM5050 DM4904      ; TCb Z軸_変更速度表示(TP)  TCb Z軸_変更速度表示計算用
LABEL #1016
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM80 = 18112 + 512*(DM4900-1)
;@DM82 = 18124 + 512*(DM4900-1)
;Z1 = DM4900 * 2
;DM4920.L:Z1 = DM4902.L   
;DM5050.L:Z1 = DM4904.L
;UWRIT(#2,@DM80,DM4902,#2)
;'UWRIT(#2,@DM82,DM4904,#2)       :速度変更しない
LDP R23200               ; 書き込みOK SW
LD R23406                ; TCb Z軸_位置取込み可PL(TP)
OR R23407                ; TCb Z軸_位置書込み可PL(TP)
ANL
NCJ #1017
;@DM80 = 18112 + 512*(DM4900-1)
;
LD CR2002                ; 常時ON
LDA DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM80
;@DM82 = 18124 + 512*(DM4900-1)
;
LD CR2002                ; 常時ON
LDA DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM82
;Z1 = DM4900 * 2
;
LD CR2002                ; 常時ON
LDA DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM4920.L:Z1 = DM4902.L   
;
LD CR2002                ; 常時ON
MOV.L DM4902 DM4920:Z1   ; TCb Z軸_変更位置表示計算用  TCb Z軸_変更位置表示(TP)
;DM5050.L:Z1 = DM4904.L
;
LD CR2002                ; 常時ON
MOV.L DM4904 DM5050:Z1   ; TCb Z軸_変更速度表示計算用  TCb Z軸_変更速度表示(TP)
;UWRIT(#2,@DM80,DM4902,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM80 DM4902 #2 ; TCb Z軸_変更位置表示計算用
;'UWRIT(#2,@DM82,DM4904,#2)       :速度変更しない
LABEL #1017
;
;  @DM80 = 18112 + 512*(DM4900-1)
;  @DM82 = 18124 + 512*(DM4900-1)
;  UREAD(#2,@DM80,DM4920,#2)
;  UREAD(#2,@DM82,DM5050,#2)
;
LDP R23304               ; TCb Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R23305               ; TCb Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R23200               ; 書き込みOK SW
NCJ #1018
;  @DM80 = 18112 + 512*(DM4900-1)
;
LD CR2002                ; 常時ON
LDA DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM80
;  @DM82 = 18124 + 512*(DM4900-1)
;
LD CR2002                ; 常時ON
LDA DM4900               ; TCb Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM82
;  UREAD(#2,@DM80,DM4920,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM80 DM4920 #2 ; TCb Z軸_変更位置表示(TP)
;  UREAD(#2,@DM82,DM5050,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM82 DM5050 #2 ; TCb Z軸_変更速度表示(TP)
LABEL #1018
;
;UWRIT(#2,#98,#0,#1)
;
;FOR @DM84=1 TO 25 STEP 1 
;  @DM80 = 18112 + 512*(@DM84-1)
;  @DM82 = 18124 + 512*(@DM84-1)
;  Z1 = @DM84 * 2
;  UWRIT(#2,@DM80,DM4920:Z1,#2)
;'  UWRIT(#2,@DM82,DM5050:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#2,#98,#1,#1)
;
;FOR @DM84=1 TO 25 STEP 1 
;  @DM80 = 18112 + 512*(@DM84-1)
;  @DM82 = 18124 + 512*(@DM84-1)
;  Z1 = @DM84 * 2
;  UWRIT(#2,@DM80,DM4970:Z1,#2)
;'  UWRIT(#2,@DM82,DM5100:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#2,#98,#0,#1)
LDF R23015               ; RBﾎﾟｲﾝﾄ設定5画面表示中(TP)
NCJ #1019
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
;FOR @DM84=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM84
LABEL #2032
LD> @DM84 #25
CJ #2033
;  @DM80 = 18112 + 512*(@DM84-1)
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM80
;  @DM82 = 18124 + 512*(@DM84-1)
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM82
;  Z1 = @DM84 * 2
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM80,DM4920:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM80 DM4920:Z1 #2;TCb Z軸_変更位置表示(TP)
;'  UWRIT(#2,@DM82,DM5050:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM84
LDB CR2009
CJ #2032
LABEL #2033
;UWRIT(#2,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #1 #1
;FOR @DM84=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM84
LABEL #2034
LD> @DM84 #25
CJ #2035
;  @DM80 = 18112 + 512*(@DM84-1)
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM80
;  @DM82 = 18124 + 512*(@DM84-1)
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM82
;  Z1 = @DM84 * 2
;
LD CR2002                ; 常時ON
LDA @DM84
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#2,@DM80,DM4970:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #2 @DM80 DM4970:Z1 #2;TCb Z軸_P25:位置
;'  UWRIT(#2,@DM82,DM5100:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM84
LDB CR2009
CJ #2034
LABEL #2035
;UWRIT(#2,#98,#0,#1)
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
LABEL #1019
;
;原点復帰動作
LDP R23201               ; TCb Z軸_隠し原点復帰sw
ORP R23202               ; TCb Z軸RB原点復帰要求
ANB R23104               ; TCb Z軸_原点復帰中
ANB @MR1108
RES R23105               ; TCb Z軸原点復帰完了
CON
RES MR3206               ; RB4_HOME
CON
SET @MR1108
STG @MR1108
MPS
AND R23105               ; TCb Z軸原点復帰完了
JMP @MR1109
MPP
MCALL GENTEN1 #2 #4 MR3206 R1003 R23105;RB4_HOME  RB4 HOME  END  TCb Z軸原点復帰完了
STG @MR1109
RES R23105               ; TCb Z軸原点復帰完了
CON
RES MR3206               ; RB4_HOME
CON
ANB R23105               ; TCb Z軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R23203               ; TCb Z軸RB原点復帰完了
CON
ENDS
;<h1/>RB5
LD>.L DM13290 +20000     ; 軸1 現在座標
AND<.L DM13290 +81000    ; 軸1 現在座標
OUT R24900               ; 除材P&P_X軸_ﾜｰｸ取出領域
LD>.L DM13290 +90000     ; 軸1 現在座標
AND<.L DM13290 +104000   ; 軸1 現在座標
OUT R24901               ; 除材P&P_X軸_A級品収納領域
LD>.L DM13290 +115000    ; 軸1 現在座標
OUT R24902               ; 除材P&P_X軸_B級品収納領域
LD<.L DM13290 +18000     ; 軸1 現在座標
OUT R24903               ; 除材P&P_X軸_NG品収納領域
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3104                ; DRV-T5 Power ON
ANB R24001               ; 除材 Y軸_ｻｰﾎﾞｵﾝ完了
TMR @53 #20
CON
AND @T53
ANB R24215               ; 除材 Y軸_強制ｻｰﾎﾞOFF中
@SET @MR1400
STG @MR1400
SET R74305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR1401
STG @MR1401
ANB R74705               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R74305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR1402
STG @MR1402
SET R74000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR1403
STG @MR1403
ANB R74400               ; 軸1 軸ｴﾗｰ中
RES R74000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR1404
STG @MR1404
TMR @51 #30
CON
AND @T51
ANB R24215               ; 除材 Y軸_強制ｻｰﾎﾞOFF中
SET R74113               ; 軸1 ｻｰﾎﾞON
CON
JMP @MR1405
STG @MR1405
TMR @52 #30
CON
AND @T52
AND R74513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
SET R24001               ; 除材 Y軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R74513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
RES R24001               ; 除材 Y軸_ｻｰﾎﾞｵﾝ完了
;除材P&P　X軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R24200               ; 書き込みOK SW
ORP R24207               ; 除材Y軸計算結果ROM書込み
@SET @MR1500
STG @MR1500
ANB R72812               ; ﾌﾗｯｼｭROM書込完了
SET R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR1501
STG @MR1501
AND R72812               ; ﾌﾗｯｼｭROM書込完了
UREAD #3 #105 @DM5 #1    ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
RES R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR1502
STG @MR1502
RES R24207               ; 除材Y軸計算結果ROM書込み
CON
MPS
AND= @DM1 #0             ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
ENDS
MPP
AND<> @DM1 #0            ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
SET R24002               ; 除材 Y軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;除材P&P　X軸_移動可条件
LDB R74404               ; 軸1 軸制御中
ANB R75204               ; 軸2 軸制御中
ANB R76004               ; 軸3 軸制御中
AND R25500               ; 除材 OK Z軸 P1 位置　表示
AND R26500               ; 除材 NG Z軸 P1 位置　表示
OUT R24003               ; 除材 Y軸_移動可
LDB R75204               ; 軸2 軸制御中
ANB R76004               ; 軸3 軸制御中
OUT R24004               ; 除材 Y軸_移動可(JOG)
;除材P&P　X軸_ﾎﾟｼﾞｼｮﾝ表示
;DM5208.L = DM13290.L
;DM5212.L = DM13298.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM104=1 TO 50 STEP 1 
;  Z1 = @DM104 * 2
;  Z2 = @DM104 - 1
;  IF DM5220.L:Z1 = DM5208.L THEN
;    R24500:Z2 = 1
;  ELSE
;    R24500:Z2 = 0
;  END IF
;NEXT
;DM5206 = DM5200 + 2300
;DM5208.L = DM13290.L
;
LD CR2002                ; 常時ON
MOV.L DM13290 DM5208     ; 軸1 現在座標  除材 X軸_現在座標読出し
;DM5212.L = DM13298.L
;
LD CR2002                ; 常時ON
MOV.L DM13298 DM5212     ; 軸1 現在速度  除材 X軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM104=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM104
LABEL #2036
LD> @DM104 #50
CJ #2037
;  Z1 = @DM104 * 2
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM104 - 1
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM5220.L:Z1 = DM5208.L THEN
;
LD=.L DM5220:Z1 DM5208   ; 除材 X軸_変更位置表示(TP)  除材 X軸_現在座標読出し
NCJ #2038
;    R24500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R24500:Z2            ; 除材 Y軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2039
LABEL #2038
;    R24500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R24500:Z2            ; 除材 Y軸 P1 位置　表示
;  END IF
;
LABEL #2039
;NEXT
;
LD CR2002                ; 常時ON
INC @DM104
LDB CR2009
CJ #2036
LABEL #2037
;DM5206 = DM5200 + 2300
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2300
CON
STA DM5206
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	ﾗｲﾝ1OK受取位置	11	ﾗｲﾝ1NG受取位置	21	Aﾗﾝｸ収納位置1	31	Bﾗﾝｸ収納位置1	41	NG品収納位置1
;2	ﾗｲﾝ2OK受取位置	12	ﾗｲﾝ2NG受取位置	22	Aﾗﾝｸ収納位置2	32	Bﾗﾝｸ収納位置2	42	NG品収納位置2
;3	ﾗｲﾝ3OK受取位置	13	ﾗｲﾝ3NG受取位置	23	Aﾗﾝｸ収納位置3	33	Bﾗﾝｸ収納位置3	43	NG品収納位置3
;4	ﾗｲﾝ4OK受取位置	14	ﾗｲﾝ4NG受取位置	24	Aﾗﾝｸ収納位置4	34	Bﾗﾝｸ収納位置4	44	NG品収納位置4
;5	ﾗｲﾝ5OK受取位置	15	ﾗｲﾝ5NG受取位置	25	Aﾗﾝｸ収納位置5	35	Bﾗﾝｸ収納位置5	45	NG品収納位置5
;6	ﾗｲﾝ6OK受取位置	16	ﾗｲﾝ6NG受取位置	26	Aﾗﾝｸ収納位置6	36	Bﾗﾝｸ収納位置6	46	NG品収納位置6
;7	ﾗｲﾝ7OK受取位置	17	ﾗｲﾝ7NG受取位置	27	Aﾗﾝｸ収納位置7	37	Bﾗﾝｸ収納位置7	47	NG品収納位置7
;8		            18					28	Aﾗﾝｸ収納位置8	38	Bﾗﾝｸ収納位置8	48	NG品収納位置8
;9					19					29	Aﾗﾝｸ収納位置9	39	Bﾗﾝｸ収納位置9	49	NG品収納位置9
;10					20					30	Aﾗﾝｸ収納位置10	40	Bﾗﾝｸ収納位置10	50	NG品収納位置10
;
LD= DM3000 #201          ; 表示画面
OUT R24015               ; RBﾎﾟｲﾝﾄ設定2画面表示中(TP)
LDB R74404               ; 軸1 軸制御中
OUT R24406               ; 除材 Y軸_位置取込み可PL(TP)
CON
OUT R24407               ; 除材 Y軸_位置書込み可PL(TP)
LD R24204                ; ﾄﾚｲA自動計算(TP)
TMR @54 #12
CON
AND @T54
OUT R24403               ; ﾄﾚｲA自動計算PL(TP)
LD R24205                ; ﾄﾚｲB自動計算(TP)
TMR @55 #12
CON
AND @T55
OUT R24404               ; ﾄﾚｲB自動計算PL(TP)
LD R24206                ; NGﾄﾚｲ自動計算(TP)
TMR @56 #12
CON
AND @T56
OUT R24405               ; NGﾄﾚｲ自動計算PL(TP)
LDP R24304               ; 除材 Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
LDP R24305               ; 除材 Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM5200 #50           ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
DW #50 DM5200            ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM5200 #1            ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM5200             ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM5202.L = DM13290.L   
;DM5204.L = DM5350.L
LDP R24306               ; 除材 Y軸_位置取込みPB(TP)
AND R24406               ; 除材 Y軸_位置取込み可PL(TP)
NCJ #1020
;DM5202.L = DM13290.L   
;
LD CR2002                ; 常時ON
MOV.L DM13290 DM5202     ; 軸1 現在座標  除材 X軸_変更位置表示計算用
;DM5204.L = DM5350.L
LD CR2002                ; 常時ON
MOV.L DM5350 DM5204      ; 除材 X軸_変更速度表示(TP)  除材 X軸_変更速度表示計算用
LABEL #1020
;
;
;DM5202.L = DM5220.L   
;DM5204.L = DM5350.L
LD R24307                ; 除材 Y軸_位置書込みPB(TP)
AND R24407               ; 除材 Y軸_位置書込み可PL(TP)
NCJ #1021
;DM5202.L = DM5220.L   
;
LD CR2002                ; 常時ON
MOV.L DM5220 DM5202      ; 除材 X軸_変更位置表示(TP)  除材 X軸_変更位置表示計算用
;DM5204.L = DM5350.L
LD CR2002                ; 常時ON
MOV.L DM5350 DM5204      ; 除材 X軸_変更速度表示(TP)  除材 X軸_変更速度表示計算用
LABEL #1021
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;IF DM5200 <= #25 THEN
;  UWRIT(#3,#98,#0,#1)
;  @DM100 = 18016 + 512*(DM5200-1)
;  @DM102 = 18028 + 512*(DM5200-1)
;  Z1 = DM5200 * 2
;  DM5220.L:Z1 = DM5202.L   
;  DM5350.L:Z1 = DM5204.L
;  UWRIT(#3,@DM100,DM5202,#2)
;'  UWRIT(#3,@DM102,DM5204,#2)       :速度変更しない
;ELSE
;  UWRIT(#3,#98,#1,#1)
;  @DM100 = 18016 + 512*(DM5200-26)
;  @DM102 = 18028 + 512*(DM5200-26)
;  Z1 = DM5200 * 2
;  DM5220.L:Z1 = DM5202.L   
;  DM5350.L:Z1 = DM5204.L
;  UWRIT(#3,@DM100,DM5202,#2)
;'  UWRIT(#3,@DM102,DM5204,#2)       :速度変更しない
;  UWRIT(#3,#98,#0,#1)
;END IF
;
;
LDP R24200               ; 書き込みOK SW
LD R24406                ; 除材 Y軸_位置取込み可PL(TP)
OR R24407                ; 除材 Y軸_位置書込み可PL(TP)
ANL
NCJ #1022
;IF DM5200 <= #25 THEN
;
LD<= DM5200 #25          ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
NCJ #2040
;  UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;  @DM100 = 18016 + 512*(DM5200-1)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(DM5200-1)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  Z1 = DM5200 * 2
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM5220.L:Z1 = DM5202.L   
;
LD CR2002                ; 常時ON
MOV.L DM5202 DM5220:Z1   ; 除材 X軸_変更位置表示計算用  除材 X軸_変更位置表示(TP)
;  DM5350.L:Z1 = DM5204.L
;
LD CR2002                ; 常時ON
MOV.L DM5204 DM5350:Z1   ; 除材 X軸_変更速度表示計算用  除材 X軸_変更速度表示(TP)
;  UWRIT(#3,@DM100,DM5202,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM100 DM5202 #2; 除材 X軸_変更位置表示計算用
;'  UWRIT(#3,@DM102,DM5204,#2)       :速度変更しない
;
;ELSE
;
LD CR2002                ; 常時ON
CJ #2041
LABEL #2040
;  UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;  @DM100 = 18016 + 512*(DM5200-26)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +26
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(DM5200-26)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +26
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  Z1 = DM5200 * 2
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM5220.L:Z1 = DM5202.L   
;
LD CR2002                ; 常時ON
MOV.L DM5202 DM5220:Z1   ; 除材 X軸_変更位置表示計算用  除材 X軸_変更位置表示(TP)
;  DM5350.L:Z1 = DM5204.L
;
LD CR2002                ; 常時ON
MOV.L DM5204 DM5350:Z1   ; 除材 X軸_変更速度表示計算用  除材 X軸_変更速度表示(TP)
;  UWRIT(#3,@DM100,DM5202,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM100 DM5202 #2; 除材 X軸_変更位置表示計算用
;'  UWRIT(#3,@DM102,DM5204,#2)       :速度変更しない
;
;  UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;END IF
;
LABEL #2041
LABEL #1022
;
;IF DM5200 <= #25 THEN
;  UWRIT(#3,#98,#0,#1)
;  @DM100 = 18016 + 512*(DM5200-1)
;  @DM102 = 18028 + 512*(DM5200-1)
;  UREAD(#3,@DM100,DM5220,#2)
;  UREAD(#3,@DM102,DM5350,#2)
;ELSE
;  UWRIT(#3,#98,#1,#1)
;  @DM100 = 18016 + 512*(DM5200-26)
;  @DM102 = 18028 + 512*(DM5200-26)
;  UREAD(#3,@DM100,DM5220,#2)
;  UREAD(#3,@DM102,DM5350,#2)
;  UWRIT(#3,#98,#0,#1)
;END IF
;RES(R24314)
;
LDP R24304               ; 除材 Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R24305               ; 除材 Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R24200               ; 書き込みOK SW
ORP R24314               ; 除材 Y軸 PNo.入力確定SW
NCJ #1023
;IF DM5200 <= #25 THEN
;
LD<= DM5200 #25          ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
NCJ #2042
;  UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;  @DM100 = 18016 + 512*(DM5200-1)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(DM5200-1)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  UREAD(#3,@DM100,DM5220,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM100 DM5220 #2; 除材 X軸_変更位置表示(TP)
;  UREAD(#3,@DM102,DM5350,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM102 DM5350 #2; 除材 X軸_変更速度表示(TP)
;ELSE
;
LD CR2002                ; 常時ON
CJ #2043
LABEL #2042
;  UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;  @DM100 = 18016 + 512*(DM5200-26)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +26
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(DM5200-26)
;
LD CR2002                ; 常時ON
LDA DM5200               ; 除材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +26
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  UREAD(#3,@DM100,DM5220,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM100 DM5220 #2; 除材 X軸_変更位置表示(TP)
;  UREAD(#3,@DM102,DM5350,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM102 DM5350 #2; 除材 X軸_変更速度表示(TP)
;  UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;END IF
;
LABEL #2043
;RES(R24314)
;
LD CR2002                ; 常時ON
RES R24314               ; 除材 Y軸 PNo.入力確定SW
LABEL #1023
;
;UWRIT(#3,#98,#0,#1)
;
;FOR @DM104=1 TO 25 STEP 1 
;  @DM100 = 18016 + 512*(@DM104-1)
;  @DM102 = 18028 + 512*(@DM104-1)
;  Z1 = @DM104 * 2
;  UWRIT(#3,@DM100,DM5220:Z1,#2)
;'  UWRIT(#3,@DM102,DM5350:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#1,#1)
;
;
;FOR @DM104=1 TO 25 STEP 1 
;  @DM100 = 18016 + 512*(@DM104-1)
;  @DM102 = 18028 + 512*(@DM104-1)
;  Z1 = @DM104 * 2
;  UWRIT(#3,@DM100,DM5270:Z1,#2)
;'  UWRIT(#3,@DM102,DM5400:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#0,#1)
;
LDF R24015               ; RBﾎﾟｲﾝﾄ設定2画面表示中(TP)
NCJ #1024
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;FOR @DM104=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM104
LABEL #2044
LD> @DM104 #25
CJ #2045
;  @DM100 = 18016 + 512*(@DM104-1)
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(@DM104-1)
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  Z1 = @DM104 * 2
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM100,DM5220:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM100 DM5220:Z1 #2;除材 X軸_変更位置表示(TP)
;'  UWRIT(#3,@DM102,DM5350:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM104
LDB CR2009
CJ #2044
LABEL #2045
;UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;FOR @DM104=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM104
LABEL #2046
LD> @DM104 #25
CJ #2047
;  @DM100 = 18016 + 512*(@DM104-1)
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(@DM104-1)
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  Z1 = @DM104 * 2
;
LD CR2002                ; 常時ON
LDA @DM104
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM100,DM5270:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM100 DM5270:Z1 #2;除材 X軸_P25:位置
;'  UWRIT(#3,@DM102,DM5400:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM104
LDB CR2009
CJ #2046
LABEL #2047
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
LABEL #1024
;
;1番と10番から2〜9番を自動計算
;UWRIT(#3,#98,#1,#1)
;@DM108.L = 18016 + 512*(30-26)        '10番目ﾎﾟｲﾝﾄNo.
;UREAD(#3,@DM108,@DM112,#2)            '10番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;UWRIT(#3,#98,#0,#1)
;@DM106.L = 18016 + 512*(21-1)         '1番目ﾎﾟｲﾝﾄNo.
;UREAD(#3,@DM106,@DM110,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;for @DM114 =22  to 29
;  Z1 = @DM114 * 2
;  DM5220.L:Z1 = FLOAT(@DM110.L) + ((FLOAT(@DM112.L)-FLOAT(@DM110.L))/9) * (@DM114-21)
;  IF @DM114 <= #25 THEN
;    UWRIT(#3,#98,#0,#1)
;    @DM100 = 18016 + 512*(@DM114-1)
;    UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;  ELSE
;    UWRIT(#3,#98,#1,#1)
;    @DM100 = 18016 + 512*(@DM114-26)  
;    UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;    UWRIT(#3,#98,#0,#1)
;  END IF
;NEXT
;SET(R24207)                            'ﾌﾗｯｼｭﾛMROM書込みﾌﾗｸﾞON
LDP R24204               ; ﾄﾚｲA自動計算(TP)
NCJ #1051
;UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;@DM108.L = 18016 + 512*(30-26)        '10番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +20064 @DM108
;UREAD(#3,@DM108,@DM112,#2)            '10番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM108 @DM112 #2
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;@DM106.L = 18016 + 512*(21-1)         '1番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +28256 @DM106
;UREAD(#3,@DM106,@DM110,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM106 @DM110 #2
;for @DM114 =22  to 29
;
LD CR2002                ; 常時ON
MOV #22 @DM114
LABEL #2048
LD> @DM114 #29
CJ #2049
;  Z1 = @DM114 * 2
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM5220.L:Z1 = FLOAT(@DM110.L) + ((FLOAT(@DM112.L)-FLOAT(@DM110.L))/9) * (@DM114-21)
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
SUB.L +21
CON
STA.L @VM16
CON
LDA.L @DM110
CON
FLOAT.L
CON
STA.F @VM18
CON
LDA.L @DM112
CON
FLOAT.L
CON
SUB.F @VM18
CON
DIV.F +9
CON
STA.F @VM20
CON
LDA.L @VM16
CON
FLOAT.L
CON
MUL.F @VM20
CON
STA.F @VM22
CON
LDA.L @DM110
CON
FLOAT.L
CON
ADD.F @VM22
CON
INTG.L
CON
STA.L DM5220:Z1          ; 除材 X軸_変更位置表示(TP)
;  IF @DM114 <= #25 THEN
;
LD<= @DM114 #25
NCJ #2050
;    UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;    @DM100 = 18016 + 512*(@DM114-1)
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;    UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT.L #3 @DM100 DM5220:Z1 #2;除材 X軸_変更位置表示(TP)
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2051
LABEL #2050
;    UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;    @DM100 = 18016 + 512*(@DM114-26)  
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
SUB.L +26
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;    UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT.L #3 @DM100 DM5220:Z1 #2;除材 X軸_変更位置表示(TP)
;    UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;  END IF
;
LABEL #2051
;NEXT
;
LD CR2002                ; 常時ON
INC @DM114
LDB CR2009
CJ #2048
LABEL #2049
;SET(R24207)                            'ﾌﾗｯｼｭﾛMROM書込みﾌﾗｸﾞON
LD CR2002                ; 常時ON
SET R24207               ; 除材Y軸計算結果ROM書込み
LABEL #1051
;
;UWRIT(#3,#98,#1,#1)                   'P26以上はｴﾘｱ2です
;@DM106.L = 18016 + 512*(31-26)         '1番目ﾎﾟｲﾝﾄNo.
;@DM108.L = 18016 + 512*(40-26)         '10番目ﾎﾟｲﾝﾄNo.
;UREAD(#3,@DM106,@DM110,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;UREAD(#3,@DM108,@DM112,#2)            '10番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;for @DM114 =32  to 39
;  Z1 = @DM114 * 2
;  DM5220.L:Z1 = FLOAT(@DM110.L) + ((FLOAT(@DM112.L)-FLOAT(@DM110.L))/9) * (@DM114-31)
;  @DM100 = 18016 + 512*(@DM114-26)  
;  UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;NEXT
;UWRIT(#3,#98,#0,#1)                    'ｴﾘｱ1に戻す
;SET(R24207)                            'ﾌﾗｯｼｭﾛMROM書込みﾌﾗｸﾞON
LDP R24205               ; ﾄﾚｲB自動計算(TP)
NCJ #1052
;UWRIT(#3,#98,#1,#1)                   'P26以上はｴﾘｱ2です
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;@DM106.L = 18016 + 512*(31-26)         '1番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +20576 @DM106
;@DM108.L = 18016 + 512*(40-26)         '10番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +25184 @DM108
;UREAD(#3,@DM106,@DM110,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM106 @DM110 #2
;UREAD(#3,@DM108,@DM112,#2)            '10番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM108 @DM112 #2
;for @DM114 =32  to 39
;
LD CR2002                ; 常時ON
MOV #32 @DM114
LABEL #2052
LD> @DM114 #39
CJ #2053
;  Z1 = @DM114 * 2
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM5220.L:Z1 = FLOAT(@DM110.L) + ((FLOAT(@DM112.L)-FLOAT(@DM110.L))/9) * (@DM114-31)
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
SUB.L +31
CON
STA.L @VM24
CON
LDA.L @DM110
CON
FLOAT.L
CON
STA.F @VM26
CON
LDA.L @DM112
CON
FLOAT.L
CON
SUB.F @VM26
CON
DIV.F +9
CON
STA.F @VM28
CON
LDA.L @VM24
CON
FLOAT.L
CON
MUL.F @VM28
CON
STA.F @VM30
CON
LDA.L @DM110
CON
FLOAT.L
CON
ADD.F @VM30
CON
INTG.L
CON
STA.L DM5220:Z1          ; 除材 X軸_変更位置表示(TP)
;  @DM100 = 18016 + 512*(@DM114-26)  
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
SUB.L +26
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT.L #3 @DM100 DM5220:Z1 #2;除材 X軸_変更位置表示(TP)
;NEXT
;
LD CR2002                ; 常時ON
INC @DM114
LDB CR2009
CJ #2052
LABEL #2053
;UWRIT(#3,#98,#0,#1)                    'ｴﾘｱ1に戻す
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;SET(R24207)                            'ﾌﾗｯｼｭﾛMROM書込みﾌﾗｸﾞON
LD CR2002                ; 常時ON
SET R24207               ; 除材Y軸計算結果ROM書込み
LABEL #1052
;
;UWRIT(#3,#98,#1,#1)                   'P26以上はｴﾘｱ2です
;@DM106.L = 18016 + 512*(41-26)         '1番目ﾎﾟｲﾝﾄNo.
;@DM108.L = 18016 + 512*(50-26)         '10番目ﾎﾟｲﾝﾄNo.
;UREAD(#3,@DM106,@DM110,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;UREAD(#3,@DM108,@DM112,#2)            '10番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;for @DM114 =42  to 49
;  Z1 = @DM114 * 2
;  DM5220.L:Z1 = FLOAT(@DM110.L) + ((FLOAT(@DM112.L)-FLOAT(@DM110.L))/9) * (@DM114-41)
;  @DM100 = 18016 + 512*(@DM114-26)  
;  UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;NEXT
;UWRIT(#3,#98,#0,#1)                    'ｴﾘｱ1に戻す
;SET(R24207)                            'ﾌﾗｯｼｭﾛMROM書込みﾌﾗｸﾞON
LDP R24206               ; NGﾄﾚｲ自動計算(TP)
NCJ #1053
;UWRIT(#3,#98,#1,#1)                   'P26以上はｴﾘｱ2です
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;@DM106.L = 18016 + 512*(41-26)         '1番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +25696 @DM106
;@DM108.L = 18016 + 512*(50-26)         '10番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +30304 @DM108
;UREAD(#3,@DM106,@DM110,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM106 @DM110 #2
;UREAD(#3,@DM108,@DM112,#2)            '10番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM108 @DM112 #2
;for @DM114 =42  to 49
;
LD CR2002                ; 常時ON
MOV #42 @DM114
LABEL #2054
LD> @DM114 #49
CJ #2055
;  Z1 = @DM114 * 2
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM5220.L:Z1 = FLOAT(@DM110.L) + ((FLOAT(@DM112.L)-FLOAT(@DM110.L))/9) * (@DM114-41)
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
SUB.L +41
CON
STA.L @VM32
CON
LDA.L @DM110
CON
FLOAT.L
CON
STA.F @VM34
CON
LDA.L @DM112
CON
FLOAT.L
CON
SUB.F @VM34
CON
DIV.F +9
CON
STA.F @VM36
CON
LDA.L @VM32
CON
FLOAT.L
CON
MUL.F @VM36
CON
STA.F @VM38
CON
LDA.L @DM110
CON
FLOAT.L
CON
ADD.F @VM38
CON
INTG.L
CON
STA.L DM5220:Z1          ; 除材 X軸_変更位置表示(TP)
;  @DM100 = 18016 + 512*(@DM114-26)  
;
LD CR2002                ; 常時ON
LDA @DM114
CON
EXT
CON
SUB.L +26
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  UWRIT(#3,@DM100,DM5220.L:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT.L #3 @DM100 DM5220:Z1 #2;除材 X軸_変更位置表示(TP)
;NEXT
;
LD CR2002                ; 常時ON
INC @DM114
LDB CR2009
CJ #2054
LABEL #2055
;UWRIT(#3,#98,#0,#1)                    'ｴﾘｱ1に戻す
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;SET(R24207)                            'ﾌﾗｯｼｭﾛMROM書込みﾌﾗｸﾞON
LD CR2002                ; 常時ON
SET R24207               ; 除材Y軸計算結果ROM書込み
LABEL #1053
;
;原点復帰動作
LDP R24201               ; 除材 Y軸_隠し原点復帰sw
AND R25500               ; 除材 OK Z軸 P1 位置　表示
AND R26500               ; 除材 NG Z軸 P1 位置　表示
ORP R24202               ; 除材 Y軸RB原点復帰要求
ANB R24104               ; 除材 Y軸_原点復帰中
ANB @MR1508
RES R24105               ; 除材 Y軸原点復帰完了
CON
RES MR3208               ; RB5_HOME
CON
SET @MR1508
STG @MR1508
MPS
AND R24105               ; 除材 Y軸原点復帰完了
JMP @MR1509
MPP
MCALL GENTEN1 #3 #1 MR3208 R1004 R24105;RB5_HOME  RB5 HOME  END  除材 Y軸原点復帰完了
STG @MR1509
RES R24105               ; 除材 Y軸原点復帰完了
CON
RES MR3208               ; RB5_HOME
CON
ANB R24105               ; 除材 Y軸原点復帰完了
SET R24109               ; 除材 Y軸_原点復帰完了
CON
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R24203               ; 除材 Y軸RB原点復帰完了
CON
ENDS
;<h1/>RB6
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3105                ; DRV-T6 Power ON
ANB R25001               ; 除材 OK Z軸_ｻｰﾎﾞｵﾝ完了
TMR @63 #20
CON
AND @T63
@SET @MR1700
STG @MR1700
SET R75105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR1701
STG @MR1701
ANB R75505               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R75105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR1702
STG @MR1702
SET R74800               ; 軸2 軸ｴﾗｰｸﾘｱ
CON
JMP @MR1703
STG @MR1703
ANB R75200               ; 軸2 軸ｴﾗｰ中
RES R74800               ; 軸2 軸ｴﾗｰｸﾘｱ
CON
JMP @MR1704
STG @MR1704
TMR @61 #30
CON
AND @T61
SET R74913               ; 軸2 ｻｰﾎﾞON
CON
JMP @MR1705
STG @MR1705
TMR @62 #30
CON
AND @T62
AND R75313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
SET R25001               ; 除材 OK Z軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R75313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
RES R25001               ; 除材 OK Z軸_ｻｰﾎﾞｵﾝ完了
;除材P&P OK Z軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R25200               ; 書き込みOK SW
@SET @MR1800
STG @MR1800
ANB R72812               ; ﾌﾗｯｼｭROM書込完了
SET R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR1801
STG @MR1801
AND R72812               ; ﾌﾗｯｼｭROM書込完了
UREAD #3 #105 @DM6 #1    ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
RES R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR1802
STG @MR1802
MPS
AND= @DM6 #0             ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
ENDS
MPP
AND<> @DM6 #0            ; ﾌﾗｯｼｭROM書込完了ｺｰﾄﾞ
SET R25002               ; 除材 OK Z軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;除材P&P OK Z軸_移動可条件
LDB R74404               ; 軸1 軸制御中
ANB R75204               ; 軸2 軸制御中
ANB R76004               ; 軸3 軸制御中
LD R24500                ; 除材 Y軸 P1 位置　表示
AND R4414                ; 治具1 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4413                ; 治具1 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4407                ; 治具1 ﾌﾟﾛｰﾌﾞ 下降限
LD R24501                ; 除材 Y軸 P2 位置　表示
AND R4508                ; 治具2 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4507                ; 治具2 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4501                ; 治具2 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24502                ; 除材 Y軸 P3 位置　表示
AND R4602                ; 治具3 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4601                ; 治具3 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4511                ; 治具3 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24503                ; 除材 Y軸 P4 位置　表示
AND R4612                ; 治具4 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4611                ; 治具4 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4605                ; 治具4 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24504                ; 除材 Y軸 P5 位置　表示
AND R4706                ; 治具5 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4705                ; 治具5 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4615                ; 治具5 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24505                ; 除材 Y軸 P6 位置　表示
AND R4800                ; 治具6 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4715                ; 治具6 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4709                ; 治具6 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24506                ; 除材 Y軸 P7 位置　表示
AND R4810                ; 治具7 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4809                ; 治具7 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4803                ; 治具7 ﾌﾟﾛｰﾌﾞ 下降限
ORL
ANB R4302                ; 除材P&P OK品 旋回限(ﾊﾟﾚｯﾄ移載側)
AND R4303                ; 除材P&P OK品 戻し限(測定側)
LD R24901                ; 除材P&P_X軸_A級品収納領域
ANB R64404               ; 軸1 軸制御中
ANB R65204               ; 軸2 軸制御中
LD R52905                ; ﾄﾚｲ押さえ有り
AND R21505               ; TCa Z軸 P6 位置　表示
LDB R52905               ; ﾄﾚｲ押さえ有り
AND R21500               ; TCa Z軸 P1 位置　表示
ORL
ANL
LD R24902                ; 除材P&P_X軸_B級品収納領域
ANB R66004               ; 軸3 軸制御中
ANB R66804               ; 軸4 軸制御中
LD R52905                ; ﾄﾚｲ押さえ有り
AND R23505               ; TCb Z軸 P6 位置　表示
LDB R52905               ; ﾄﾚｲ押さえ有り
AND R23500               ; TCb Z軸 P1 位置　表示
ORL
ANL
ORL
AND R4302                ; 除材P&P OK品 旋回限(ﾊﾟﾚｯﾄ移載側)
ORL
OR R50003                ; 原点復帰中
ANL
OUT R25003               ; 除材 OK Z軸_移動可
LDB R74404               ; 軸1 軸制御中
ANB R76804               ; 軸4 軸制御中
OUT R25004               ; 除材 OK Z軸_移動可(JOG)
;除材P&P OK Z軸_ﾎﾟｼﾞｼｮﾝ表示
;DM5508.L = DM13350.L
;DM5512.L = DM13358.L
;' 位置ﾌﾗｸﾞ制御
;FOR @DM124=1 TO 50 STEP 1 
;  Z1 = @DM124 * 2
;  Z2 = @DM124 - 1
;  IF DM5520.L:Z1 = DM5508.L THEN
;    R25500:Z2 = 1
;  ELSE
;    R25500:Z2 = 0
;  END IF
;NEXT
;DM5506 = DM5500 + 2350 
;DM5508.L = DM13350.L
;
LD CR2002                ; 常時ON
MOV.L DM13350 DM5508     ; 軸2 現在座標  除材 OK Z軸_現在座標読出し
;DM5512.L = DM13358.L
;
LD CR2002                ; 常時ON
MOV.L DM13358 DM5512     ; 軸2 現在速度  除材 OK Z軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM124=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM124
LABEL #2056
LD> @DM124 #50
CJ #2057
;  Z1 = @DM124 * 2
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM124 - 1
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM5520.L:Z1 = DM5508.L THEN
;
LD=.L DM5520:Z1 DM5508   ; 除材 OK Z軸_変更位置表示(TP)  除材 OK Z軸_現在座標読出し
NCJ #2058
;    R25500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R25500:Z2            ; 除材 OK Z軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2059
LABEL #2058
;    R25500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R25500:Z2            ; 除材 OK Z軸 P1 位置　表示
;  END IF
;
LABEL #2059
;NEXT
;
LD CR2002                ; 常時ON
INC @DM124
LDB CR2009
CJ #2056
LABEL #2057
;DM5506 = DM5500 + 2350 
LD CR2002                ; 常時ON
LDA DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2350
CON
STA DM5506
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	待機位置
;2	ﾗｲﾝ1取出高さ
;3	ﾗｲﾝ2取出高さ
;4	ﾗｲﾝ3取出高さ
;5	ﾗｲﾝ4取出高さ
;6	ﾗｲﾝ5取出高さ
;7	ﾗｲﾝ6取出高さ
;8	ﾗｲﾝ7取出高さ
;9	
;10	
;11	Aﾗﾝｸ収納高さ
;12	Bﾗﾝｸ収納高さ
;13	
LD= DM3000 #201          ; 表示画面
OUT R25015               ; RBﾎﾟｲﾝﾄ設定2画面表示中(TP)
LDB R75204               ; 軸2 軸制御中
OUT R25406               ; 除材 OK Z軸_位置取込み可PL(TP)
CON
OUT R25407               ; 除材 OK Z軸_位置書込み可PL(TP)
LDP R25304               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
LDP R25305               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM5500 #20           ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #20 DM5500            ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM5500 #1            ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM5500             ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM5502.L = DM13350.L   
;DM5504.L = DM5650.L
LDP R25306               ; 除材 OK Z軸_位置取込みPB(TP)
AND R25406               ; 除材 OK Z軸_位置取込み可PL(TP)
NCJ #1025
;DM5502.L = DM13350.L   
;
LD CR2002                ; 常時ON
MOV.L DM13350 DM5502     ; 軸2 現在座標  除材 OK Z軸_変更位置表示計算用
;DM5504.L = DM5650.L
LD CR2002                ; 常時ON
MOV.L DM5650 DM5504      ; 除材 OK Z軸_変更速度表示(TP)  除材 OK Z軸_変更速度表示計算用
LABEL #1025
;
;
;DM5502.L = DM5520.L   
;DM5504.L = DM5650.L
LD R25307                ; 除材 OK Z軸_位置書込みPB(TP)
AND R25407               ; 除材 OK Z軸_位置書込み可PL(TP)
NCJ #1026
;DM5502.L = DM5520.L   
;
LD CR2002                ; 常時ON
MOV.L DM5520 DM5502      ; 除材 OK Z軸_変更位置表示(TP)  除材 OK Z軸_変更位置表示計算用
;DM5504.L = DM5650.L
LD CR2002                ; 常時ON
MOV.L DM5650 DM5504      ; 除材 OK Z軸_変更速度表示(TP)  除材 OK Z軸_変更速度表示計算用
LABEL #1026
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM120 = 18048 + 512*(DM5500-1)
;@DM122 = 18060 + 512*(DM5500-1)
;Z1 = DM5500 * 2
;DM5520.L:Z1 = DM5502.L   
;DM5650.L:Z1 = DM5504.L
;UWRIT(#3,@DM120,DM5502,#2)
;'UWRIT(#3,@DM122,DM5504,#2)       :速度変更しない
;
;
;
LDP R25200               ; 書き込みOK SW
LD R25406                ; 除材 OK Z軸_位置取込み可PL(TP)
OR R25407                ; 除材 OK Z軸_位置書込み可PL(TP)
ANL
NCJ #1027
;@DM120 = 18048 + 512*(DM5500-1)
;
LD CR2002                ; 常時ON
LDA DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM120
;@DM122 = 18060 + 512*(DM5500-1)
;
LD CR2002                ; 常時ON
LDA DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM122
;Z1 = DM5500 * 2
;
LD CR2002                ; 常時ON
LDA DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM5520.L:Z1 = DM5502.L   
;
LD CR2002                ; 常時ON
MOV.L DM5502 DM5520:Z1   ; 除材 OK Z軸_変更位置表示計算用  除材 OK Z軸_変更位置表示(TP)
;DM5650.L:Z1 = DM5504.L
;
LD CR2002                ; 常時ON
MOV.L DM5504 DM5650:Z1   ; 除材 OK Z軸_変更速度表示計算用  除材 OK Z軸_変更速度表示(TP)
;UWRIT(#3,@DM120,DM5502,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM120 DM5502 #2; 除材 OK Z軸_変更位置表示計算用
;'UWRIT(#3,@DM122,DM5504,#2)       :速度変更しない
;
LABEL #1027
;
;  @DM120 = 18048 + 512*(DM5500-1)
;  @DM122 = 18060 + 512*(DM5500-1)
;  UREAD(#3,@DM120,DM5520,#2)
;  UREAD(#3,@DM122,DM5650,#2)
;
LDP R25304               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R25305               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R25200               ; 書き込みOK SW
NCJ #1028
;  @DM120 = 18048 + 512*(DM5500-1)
;
LD CR2002                ; 常時ON
LDA DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM120
;  @DM122 = 18060 + 512*(DM5500-1)
;
LD CR2002                ; 常時ON
LDA DM5500               ; 除材 OK Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM122
;  UREAD(#3,@DM120,DM5520,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM120 DM5520 #2; 除材 OK Z軸_変更位置表示(TP)
;  UREAD(#3,@DM122,DM5650,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM122 DM5650 #2; 除材 OK Z軸_変更速度表示(TP)
LABEL #1028
;
;UWRIT(#3,#98,#0,#1)
;
;FOR @DM124=1 TO 25 STEP 1 
;  @DM120 = 18048 + 512*(@DM124-1)
;  @DM122 = 18060 + 512*(@DM124-1)
;  Z1 = @DM124 * 2
;  UWRIT(#3,@DM120,DM5520:Z1,#2)
;'  UWRIT(#3,@DM122,DM5650:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#1,#1)
;
;FOR @DM124=1 TO 25 STEP 1 
;  @DM120 = 18048 + 512*(@DM124-1)
;  @DM122 = 18060 + 512*(@DM124-1)
;  Z1 = @DM124 * 2
;  UWRIT(#3,@DM120,DM5570:Z1,#2)
;'  UWRIT(#3,@DM122,DM5700:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#0,#1)
;
LDF R25015               ; RBﾎﾟｲﾝﾄ設定2画面表示中(TP)
NCJ #1029
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;FOR @DM124=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM124
LABEL #2060
LD> @DM124 #25
CJ #2061
;  @DM120 = 18048 + 512*(@DM124-1)
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM120
;  @DM122 = 18060 + 512*(@DM124-1)
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM122
;  Z1 = @DM124 * 2
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM120,DM5520:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM120 DM5520:Z1 #2;除材 OK Z軸_変更位置表示(TP)
;'  UWRIT(#3,@DM122,DM5650:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM124
LDB CR2009
CJ #2060
LABEL #2061
;UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;FOR @DM124=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM124
LABEL #2062
LD> @DM124 #25
CJ #2063
;  @DM120 = 18048 + 512*(@DM124-1)
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM120
;  @DM122 = 18060 + 512*(@DM124-1)
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM122
;  Z1 = @DM124 * 2
;
LD CR2002                ; 常時ON
LDA @DM124
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM120,DM5570:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM120 DM5570:Z1 #2;除材 OK Z軸_P25:位置
;'  UWRIT(#3,@DM122,DM5700:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM124
LDB CR2009
CJ #2062
LABEL #2063
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
LABEL #1029
;
;原点復帰動作
LDP R25201               ; 除材 OK Z軸_隠し原点復帰sw
ORP R25202               ; 除材 OK Z軸RB原点復帰要求
ANB R25104               ; 除材 OK Z軸_原点復帰中
ANB @MR1808
RES R25105               ; 除材 OK Z軸原点復帰完了
CON
RES MR3210               ; RB6_HOME
CON
SET @MR1808
STG @MR1808
MPS
AND R25105               ; 除材 OK Z軸原点復帰完了
JMP @MR1809
MPP
MCALL GENTEN1 #3 #2 MR3210 R1006 R25105;RB6_HOME  RB6 HOME  END  除材 OK Z軸原点復帰完了
STG @MR1809
RES R25105               ; 除材 OK Z軸原点復帰完了
CON
RES MR3210               ; RB6_HOME
CON
ANB R25105               ; 除材 OK Z軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R25203               ; 除材 OK Z軸RB原点復帰完了
CON
ENDS
;<h1/>RB7
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3106                ; DRV-T7 Power ON
ANB R26001               ; 除材 NG Z軸_ｻｰﾎﾞｵﾝ完了
TMR @73 #20
CON
AND @T73
@SET @MR2000
STG @MR2000
SET R75905               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2001
STG @MR2001
ANB R76305               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R75905               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2002
STG @MR2002
SET R75600               ; 軸3 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2003
STG @MR2003
ANB R76000               ; 軸3 軸ｴﾗｰ中
RES R75600               ; 軸3 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2004
STG @MR2004
TMR @71 #30
CON
AND @T71
SET R75713               ; 軸3 ｻｰﾎﾞON
CON
JMP @MR2005
STG @MR2005
TMR @72 #30
CON
AND @T72
AND R76113               ; 軸3 ｻｰﾎﾞﾚﾃﾞｨ
SET R26001               ; 除材 NG Z軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R76113               ; 軸3 ｻｰﾎﾞﾚﾃﾞｨ
RES R26001               ; 除材 NG Z軸_ｻｰﾎﾞｵﾝ完了
;除材P&P NG Z軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R26200               ; 書き込みOK SW
@SET @MR2100
STG @MR2100
ANB R72812               ; ﾌﾗｯｼｭROM書込完了
SET R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR2101
STG @MR2101
AND R72812               ; ﾌﾗｯｼｭROM書込完了
UREAD #3 #105 @DM7 #1
RES R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR2102
STG @MR2102
MPS
AND= @DM7 #0
ENDS
MPP
AND<> @DM7 #0
SET R26002               ; 除材 NG Z軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;除材P&P NG Z軸_移動可条件
LDB R74404               ; 軸1 軸制御中
ANB R75204               ; 軸2 軸制御中
ANB R76004               ; 軸3 軸制御中
LD R24510                ; 除材 Y軸 P11 位置　表示
AND R4414                ; 治具1 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4413                ; 治具1 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4407                ; 治具1 ﾌﾟﾛｰﾌﾞ 下降限
LD R24511                ; 除材 Y軸 P12 位置　表示
AND R4508                ; 治具2 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4507                ; 治具2 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4501                ; 治具2 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24512                ; 除材 Y軸 P13 位置　表示
AND R4602                ; 治具3 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4601                ; 治具3 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4511                ; 治具3 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24513                ; 除材 Y軸 P14 位置　表示
AND R4612                ; 治具4 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4611                ; 治具4 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4605                ; 治具4 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24514                ; 除材 Y軸 P15 位置　表示
AND R4706                ; 治具5 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4705                ; 治具5 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4615                ; 治具5 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24515                ; 除材 Y軸 P16 位置　表示
AND R4800                ; 治具6 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4715                ; 治具6 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4709                ; 治具6 ﾌﾟﾛｰﾌﾞ 下降限
ORL
LD R24600                ; 除材 Y軸 P17 位置　表示
AND R4810                ; 治具7 治具ｽﾗｲﾄﾞ 前進限(測定側)
AND R4809                ; 治具7 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4803                ; 治具7 ﾌﾟﾛｰﾌﾞ 下降限
ORL
ANB R4300                ; 除材P&P NG品 旋回限(ﾊﾟﾚｯﾄ移載側)
AND R4301                ; 除材P&P NG品 戻し限(測定側)
LD R24901                ; 除材P&P_X軸_A級品収納領域
ANB R64404               ; 軸1 軸制御中
ANB R65204               ; 軸2 軸制御中
LD R24902                ; 除材P&P_X軸_B級品収納領域
ANB R66004               ; 軸3 軸制御中
ANB R66804               ; 軸4 軸制御中
ORL
LD R24903                ; 除材P&P_X軸_NG品収納領域
ANB R76804               ; 軸4 軸制御中
ORL
ANB R4301                ; 除材P&P NG品 戻し限(測定側)
AND R4300                ; 除材P&P NG品 旋回限(ﾊﾟﾚｯﾄ移載側)
ORL
OR R50003                ; 原点復帰中
ANL
OUT R26003               ; 除材 NG Z軸_移動可
LDB R74404               ; 軸1 軸制御中
ANB R76804               ; 軸4 軸制御中
OUT R26004               ; 除材 NG Z軸_移動可(JOG)
;除材P&P NG Z軸_ﾎﾟｼﾞｼｮﾝ表示
;DM5808.L = DM13410.L
;DM5812.L = DM13418.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM144=1 TO 50 STEP 1 
;  Z1 = @DM144 * 2
;  Z2 = @DM144 - 1
;  IF DM5820.L:Z1 = DM5808.L THEN
;    R26500:Z2 = 1
;  ELSE
;    R26500:Z2 = 0
;  END IF
;NEXT
;DM5806 = DM5800 + 2400
;DM5808.L = DM13410.L
;
LD CR2002                ; 常時ON
MOV.L DM13410 DM5808     ; 軸3 現在座標  除材 NG Z軸_現在座標読出し
;DM5812.L = DM13418.L
;
LD CR2002                ; 常時ON
MOV.L DM13418 DM5812     ; 軸3 現在速度  除材 NG Z軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM144=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM144
LABEL #2064
LD> @DM144 #50
CJ #2065
;  Z1 = @DM144 * 2
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM144 - 1
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM5820.L:Z1 = DM5808.L THEN
;
LD=.L DM5820:Z1 DM5808   ; 除材 NG Z軸_変更位置表示(TP)  除材 NG Z軸_現在座標読出し
NCJ #2066
;    R26500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R26500:Z2            ; 除材 NG Z軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2067
LABEL #2066
;    R26500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R26500:Z2            ; 除材 NG Z軸 P1 位置　表示
;  END IF
;
LABEL #2067
;NEXT
;
LD CR2002                ; 常時ON
INC @DM144
LDB CR2009
CJ #2064
LABEL #2065
;DM5806 = DM5800 + 2400
LD CR2002                ; 常時ON
LDA DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2400
CON
STA DM5806
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	待機位置
;2	ﾗｲﾝ1取出高さ
;3	ﾗｲﾝ2取出高さ
;4	ﾗｲﾝ3取出高さ
;5	ﾗｲﾝ4取出高さ
;6	ﾗｲﾝ5取出高さ
;7	ﾗｲﾝ6取出高さ
;8	ﾗｲﾝ7取出高さ
;9	
;10	
;11	
;12	
;13	NG品収納高さ
LD= DM3000 #202          ; 表示画面
OUT R26015               ; RBﾎﾟｲﾝﾄ設定3画面表示中(TP)
LDB R76004               ; 軸3 軸制御中
OUT R26406               ; 除材 NG Z軸_位置取込み可PL(TP)
CON
OUT R26407               ; 除材 NG Z軸_位置書込み可PL(TP)
LDP R26304               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
LDP R26305               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM5800 #20           ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #20 DM5800            ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM5800 #1            ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM5800             ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM5802.L = DM13410.L   
;DM5804.L = DM5950.L
LDP R26306               ; 除材 NG Z軸_位置取込みPB(TP)
AND R26406               ; 除材 NG Z軸_位置取込み可PL(TP)
NCJ #1030
;DM5802.L = DM13410.L   
;
LD CR2002                ; 常時ON
MOV.L DM13410 DM5802     ; 軸3 現在座標  除材 NG Z軸_変更位置表示計算用
;DM5804.L = DM5950.L
LD CR2002                ; 常時ON
MOV.L DM5950 DM5804      ; 除材 NG Z軸_変更速度表示(TP)  除材 NG Z軸_変更速度表示計算用
LABEL #1030
;
;
;DM5802.L = DM5820.L   
;DM5804.L = DM5950.L
LD R26307                ; 除材 NG Z軸_位置書込みPB(TP)
AND R26407               ; 除材 NG Z軸_位置書込み可PL(TP)
NCJ #1031
;DM5802.L = DM5820.L   
;
LD CR2002                ; 常時ON
MOV.L DM5820 DM5802      ; 除材 NG Z軸_変更位置表示(TP)  除材 NG Z軸_変更位置表示計算用
;DM5804.L = DM5950.L
LD CR2002                ; 常時ON
MOV.L DM5950 DM5804      ; 除材 NG Z軸_変更速度表示(TP)  除材 NG Z軸_変更速度表示計算用
LABEL #1031
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM140 = 18080 + 512*(DM5800-1)
;@DM142 = 18092 + 512*(DM5800-1)
;Z1 = DM5800 * 2
;DM5820.L:Z1 = DM5802.L   
;DM5950.L:Z1 = DM5804.L
;UWRIT(#3,@DM140,DM5802,#2)
;'UWRIT(#3,@DM142,DM5804,#2)       :速度変更しない
;
;
;
LDP R26200               ; 書き込みOK SW
LD R26406                ; 除材 NG Z軸_位置取込み可PL(TP)
OR R26407                ; 除材 NG Z軸_位置書込み可PL(TP)
ANL
NCJ #1032
;@DM140 = 18080 + 512*(DM5800-1)
;
LD CR2002                ; 常時ON
LDA DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM140
;@DM142 = 18092 + 512*(DM5800-1)
;
LD CR2002                ; 常時ON
LDA DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM142
;Z1 = DM5800 * 2
;
LD CR2002                ; 常時ON
LDA DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM5820.L:Z1 = DM5802.L   
;
LD CR2002                ; 常時ON
MOV.L DM5802 DM5820:Z1   ; 除材 NG Z軸_変更位置表示計算用  除材 NG Z軸_変更位置表示(TP)
;DM5950.L:Z1 = DM5804.L
;
LD CR2002                ; 常時ON
MOV.L DM5804 DM5950:Z1   ; 除材 NG Z軸_変更速度表示計算用  除材 NG Z軸_変更速度表示(TP)
;UWRIT(#3,@DM140,DM5802,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM140 DM5802 #2; 除材 NG Z軸_変更位置表示計算用
;'UWRIT(#3,@DM142,DM5804,#2)       :速度変更しない
;
LABEL #1032
;
;  @DM140 = 18080 + 512*(DM5800-1)
;  @DM142 = 18092 + 512*(DM5800-1)
;  UREAD(#3,@DM140,DM5820,#2)
;  UREAD(#3,@DM142,DM5950,#2)
;
LDP R26304               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R26305               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R26200               ; 書き込みOK SW
NCJ #1033
;  @DM140 = 18080 + 512*(DM5800-1)
;
LD CR2002                ; 常時ON
LDA DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM140
;  @DM142 = 18092 + 512*(DM5800-1)
;
LD CR2002                ; 常時ON
LDA DM5800               ; 除材 NG Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM142
;  UREAD(#3,@DM140,DM5820,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM140 DM5820 #2; 除材 NG Z軸_変更位置表示(TP)
;  UREAD(#3,@DM142,DM5950,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM142 DM5950 #2; 除材 NG Z軸_変更速度表示(TP)
LABEL #1033
;
;UWRIT(#3,#98,#0,#1)
;
;FOR @DM144=1 TO 25 STEP 1 
;  @DM140 = 18080 + 512*(@DM144-1)
;  @DM142 = 18092 + 512*(@DM144-1)
;  Z1 = @DM144 * 2
;  UWRIT(#3,@DM140,DM5820:Z1,#2)
;'  UWRIT(#3,@DM142,DM5950:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#1,#1)
;
;FOR @DM144=1 TO 25 STEP 1 
;  @DM140 = 18080 + 512*(@DM144-1)
;  @DM142 = 18092 + 512*(@DM144-1)
;  Z1 = @DM144 * 2
;  UWRIT(#3,@DM140,DM5870:Z1,#2)
;'  UWRIT(#3,@DM142,DM6000:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#0,#1)
;
LDF R26015               ; RBﾎﾟｲﾝﾄ設定3画面表示中(TP)
NCJ #1034
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;FOR @DM144=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM144
LABEL #2068
LD> @DM144 #25
CJ #2069
;  @DM140 = 18080 + 512*(@DM144-1)
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM140
;  @DM142 = 18092 + 512*(@DM144-1)
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM142
;  Z1 = @DM144 * 2
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM140,DM5820:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM140 DM5820:Z1 #2;除材 NG Z軸_変更位置表示(TP)
;'  UWRIT(#3,@DM142,DM5950:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM144
LDB CR2009
CJ #2068
LABEL #2069
;UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;FOR @DM144=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM144
LABEL #2070
LD> @DM144 #25
CJ #2071
;  @DM140 = 18080 + 512*(@DM144-1)
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM140
;  @DM142 = 18092 + 512*(@DM144-1)
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM142
;  Z1 = @DM144 * 2
;
LD CR2002                ; 常時ON
LDA @DM144
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM140,DM5870:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM140 DM5870:Z1 #2;除材 NG Z軸_P25:位置
;'  UWRIT(#3,@DM142,DM6000:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM144
LDB CR2009
CJ #2070
LABEL #2071
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
LABEL #1034
;
;原点復帰動作
LDP R26201               ; 除材 NG Z軸_隠し原点復帰sw
ORP R26202               ; 除材 NG Z軸RB原点復帰要求
ANB R26104               ; 除材 NG Z軸_原点復帰中
ANB @MR2108
RES R26105               ; 除材 NG Z軸原点復帰完了
CON
RES MR3212               ; RB7_HOME
CON
SET @MR2108
STG @MR2108
MPS
AND R26105               ; 除材 NG Z軸原点復帰完了
JMP @MR2109
MPP
MCALL GENTEN1 #3 #3 MR3212 R1008 R26105;RB7_HOME  RB7 HOME  END  除材 NG Z軸原点復帰完了
STG @MR2109
RES R26105               ; 除材 NG Z軸原点復帰完了
CON
RES MR3212               ; RB7_HOME
CON
ANB R26105               ; 除材 NG Z軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R26203               ; 除材 NG Z軸RB原点復帰完了
CON
ENDS
;<h1/>RB8
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3107                ; DRV-T8 Power ON
ANB R27001               ; NGﾄﾚｲ Y軸_ｻｰﾎﾞｵﾝ完了
TMR @83 #20
CON
AND @T83
@SET @MR2300
STG @MR2300
SET R76705               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2301
STG @MR2301
ANB R77105               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R76705               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2302
STG @MR2302
SET R76400               ; 軸4 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2303
STG @MR2303
ANB R76800               ; 軸4 軸ｴﾗｰ中
RES R76400               ; 軸4 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2304
STG @MR2304
TMR @81 #30
CON
AND @T81
SET R76513               ; 軸4 ｻｰﾎﾞON
CON
JMP @MR2305
STG @MR2305
TMR @82 #30
CON
AND @T82
AND R76913               ; 軸4 ｻｰﾎﾞﾚﾃﾞｨ
SET R27001               ; NGﾄﾚｲ Y軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R76913               ; 軸4 ｻｰﾎﾞﾚﾃﾞｨ
RES R27001               ; NGﾄﾚｲ Y軸_ｻｰﾎﾞｵﾝ完了
;NGﾄﾚｲ　Y軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R27200               ; 書き込みOK SW
ORP R27206               ; NGﾄﾚｲ計算結果ROM書込み
@SET @MR2400
STG @MR2400
ANB R72812               ; ﾌﾗｯｼｭROM書込完了
SET R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR2401
STG @MR2401
AND R72812               ; ﾌﾗｯｼｭROM書込完了
UREAD #3 #105 @DM8 #1
RES R71612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR2402
STG @MR2402
RES R27206               ; NGﾄﾚｲ計算結果ROM書込み
CON
MPS
AND= @DM8 #0
ENDS
MPP
AND<> @DM8 #0
SET R27002               ; NGﾄﾚｲ Y軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;NGﾄﾚｲ　Y軸_移動可条件
LDB R75204               ; 軸2 軸制御中
ANB R76004               ; 軸3 軸制御中
ANB R76804               ; 軸4 軸制御中
AND R25500               ; 除材 OK Z軸 P1 位置　表示
AND R26500               ; 除材 NG Z軸 P1 位置　表示
OUT R27003               ; NGﾄﾚｲ Y軸_移動可
LDB R75204               ; 軸2 軸制御中
ANB R76004               ; 軸3 軸制御中
OUT R27004               ; NGﾄﾚｲ Y軸_移動可(JOG)
;NGﾄﾚｲ　Y軸_ﾎﾟｼﾞｼｮﾝ表示
;DM6108.L = DM13470.L 
;DM6112.L = DM13478.L 
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM164=1 TO 50 STEP 1 
;  Z1 = @DM164 * 2
;  Z2 = @DM164 - 1
;  IF DM6120.L:Z1 = DM6108.L THEN
;    R27500:Z2 = 1
;  ELSE
;    R27500:Z2 = 0
;  END IF
;NEXT
;DM6106 = DM6100 + 2450
;DM6108.L = DM13470.L 
;
LD CR2002                ; 常時ON
MOV.L DM13470 DM6108     ; 軸4 現在座標  NGﾄﾚｲ Y軸_現在座標読出し
;DM6112.L = DM13478.L 
;
LD CR2002                ; 常時ON
MOV.L DM13478 DM6112     ; 軸4 現在速度  NGﾄﾚｲ Y軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM164=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM164
LABEL #2072
LD> @DM164 #50
CJ #2073
;  Z1 = @DM164 * 2
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM164 - 1
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM6120.L:Z1 = DM6108.L THEN
;
LD=.L DM6120:Z1 DM6108   ; NGﾄﾚｲ Y軸_変更位置表示(TP)  NGﾄﾚｲ Y軸_現在座標読出し
NCJ #2074
;    R27500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R27500:Z2            ; NGﾄﾚｲ Y軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2075
LABEL #2074
;    R27500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R27500:Z2            ; NGﾄﾚｲ Y軸 P1 位置　表示
;  END IF
;
LABEL #2075
;NEXT
;
LD CR2002                ; 常時ON
INC @DM164
LDB CR2009
CJ #2072
LABEL #2073
;DM6106 = DM6100 + 2450
LD CR2002                ; 常時ON
LDA DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2450
CON
STA DM6106
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	ﾜｰｸ受取高さ
;2	空ﾄﾚｲ段ばらし下位置
;3	空ﾄﾚｲ段ばらし上位置
;4	実ﾄﾚｲ段ばらし下位置
;5	実ﾄﾚｲ段ばらし上位置
LD= DM3000 #202          ; 表示画面
OUT R27015               ; RBﾎﾟｲﾝﾄ設定3画面表示中(TP)
LDB R76804               ; 軸4 軸制御中
OUT R27406               ; NGﾄﾚｲ Y軸_位置取込み可PL(TP)
CON
OUT R27407               ; NGﾄﾚｲ Y軸_位置書込み可PL(TP)
LD R27205                ; NGﾄﾚｲ自動計算(TP)
TMR @85 #10
CON
AND @T85
OUT R27405               ; NGﾄﾚｲ自動計算PL(TP)
LDP R27304               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
LDP R27305               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM6100 #9            ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
DW #9 DM6100             ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM6100 #1            ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM6100             ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM6102.L = DM13470.L   
;DM6104.L = DM6250.L
LDP R27306               ; NGﾄﾚｲ Y軸_位置取込みPB(TP)
AND R27406               ; NGﾄﾚｲ Y軸_位置取込み可PL(TP)
NCJ #1035
;DM6102.L = DM13470.L   
;
LD CR2002                ; 常時ON
MOV.L DM13470 DM6102     ; 軸4 現在座標  NGﾄﾚｲ Y軸_変更位置表示計算用
;DM6104.L = DM6250.L
LD CR2002                ; 常時ON
MOV.L DM6250 DM6104      ; NGﾄﾚｲ Y軸_変更速度表示(TP)  NGﾄﾚｲ Y軸_変更速度表示計算用
LABEL #1035
;
;
;DM6102.L = DM6120.L   
;DM6104.L = DM6250.L
LD R27307                ; NGﾄﾚｲ Y軸_位置書込みPB(TP)
AND R27407               ; NGﾄﾚｲ Y軸_位置書込み可PL(TP)
NCJ #1036
;DM6102.L = DM6120.L   
;
LD CR2002                ; 常時ON
MOV.L DM6120 DM6102      ; NGﾄﾚｲ Y軸_変更位置表示(TP)  NGﾄﾚｲ Y軸_変更位置表示計算用
;DM6104.L = DM6250.L
LD CR2002                ; 常時ON
MOV.L DM6250 DM6104      ; NGﾄﾚｲ Y軸_変更速度表示(TP)  NGﾄﾚｲ Y軸_変更速度表示計算用
LABEL #1036
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM160 = 18112 + 512*(DM6100-1)
;@DM162 = 18124 + 512*(DM6100-1)
;Z1 = DM6100 * 2
;DM6120.L:Z1 = DM6102.L   
;DM6250.L:Z1 = DM6104.L
;UWRIT(#3,@DM160,DM6102,#2)
;'UWRIT(#3,@DM162,DM6104,#2)       :速度変更しない
LDP R27200               ; 書き込みOK SW
LD R27406                ; NGﾄﾚｲ Y軸_位置取込み可PL(TP)
OR R27407                ; NGﾄﾚｲ Y軸_位置書込み可PL(TP)
ANL
NCJ #1037
;@DM160 = 18112 + 512*(DM6100-1)
;
LD CR2002                ; 常時ON
LDA DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM160
;@DM162 = 18124 + 512*(DM6100-1)
;
LD CR2002                ; 常時ON
LDA DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM162
;Z1 = DM6100 * 2
;
LD CR2002                ; 常時ON
LDA DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM6120.L:Z1 = DM6102.L   
;
LD CR2002                ; 常時ON
MOV.L DM6102 DM6120:Z1   ; NGﾄﾚｲ Y軸_変更位置表示計算用  NGﾄﾚｲ Y軸_変更位置表示(TP)
;DM6250.L:Z1 = DM6104.L
;
LD CR2002                ; 常時ON
MOV.L DM6104 DM6250:Z1   ; NGﾄﾚｲ Y軸_変更速度表示計算用  NGﾄﾚｲ Y軸_変更速度表示(TP)
;UWRIT(#3,@DM160,DM6102,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM160 DM6102 #2; NGﾄﾚｲ Y軸_変更位置表示計算用
;'UWRIT(#3,@DM162,DM6104,#2)       :速度変更しない
LABEL #1037
;
;  @DM160 = 18112 + 512*(DM6100-1)
;  @DM162 = 18124 + 512*(DM6100-1)
;  UREAD(#3,@DM160,DM6120,#2)
;  UREAD(#3,@DM162,DM6250,#2)
;
LDP R27304               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R27305               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R27200               ; 書き込みOK SW
NCJ #1038
;  @DM160 = 18112 + 512*(DM6100-1)
;
LD CR2002                ; 常時ON
LDA DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM160
;  @DM162 = 18124 + 512*(DM6100-1)
;
LD CR2002                ; 常時ON
LDA DM6100               ; NGﾄﾚｲ Y軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM162
;  UREAD(#3,@DM160,DM6120,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM160 DM6120 #2; NGﾄﾚｲ Y軸_変更位置表示(TP)
;  UREAD(#3,@DM162,DM6250,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM162 DM6250 #2; NGﾄﾚｲ Y軸_変更速度表示(TP)
LABEL #1038
;
;UWRIT(#3,#98,#0,#1)
;
;FOR @DM164=1 TO 25 STEP 1 
;  @DM160 = 18112 + 512*(@DM164-1)
;  @DM162 = 18124 + 512*(@DM164-1)
;  Z1 = @DM164 * 2
;  UWRIT(#3,@DM160,DM6120:Z1,#2)
;'  UWRIT(#3,@DM162,DM6250:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#1,#1)
;
;FOR @DM164=1 TO 25 STEP 1 
;  @DM160 = 18112 + 512*(@DM164-1)
;  @DM162 = 18124 + 512*(@DM164-1)
;  Z1 = @DM164 * 2
;  UWRIT(#3,@DM160,DM6170:Z1,#2)
;'  UWRIT(#3,@DM162,DM6300:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#3,#98,#0,#1)
;
;
LDF R27015               ; RBﾎﾟｲﾝﾄ設定3画面表示中(TP)
NCJ #1039
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;FOR @DM164=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM164
LABEL #2076
LD> @DM164 #25
CJ #2077
;  @DM160 = 18112 + 512*(@DM164-1)
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM160
;  @DM162 = 18124 + 512*(@DM164-1)
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM162
;  Z1 = @DM164 * 2
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM160,DM6120:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM160 DM6120:Z1 #2;NGﾄﾚｲ Y軸_変更位置表示(TP)
;'  UWRIT(#3,@DM162,DM6250:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM164
LDB CR2009
CJ #2076
LABEL #2077
;UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;FOR @DM164=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM164
LABEL #2078
LD> @DM164 #25
CJ #2079
;  @DM160 = 18112 + 512*(@DM164-1)
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM160
;  @DM162 = 18124 + 512*(@DM164-1)
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM162
;  Z1 = @DM164 * 2
;
LD CR2002                ; 常時ON
LDA @DM164
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#3,@DM160,DM6170:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #3 @DM160 DM6170:Z1 #2;NGﾄﾚｲ Y軸_P25:位置
;'  UWRIT(#3,@DM162,DM6300:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM164
LDB CR2009
CJ #2078
LABEL #2079
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
LABEL #1039
;
;1番と6番から2〜5番を自動計算
;@DM166.L = 18112 + 512*(1-1)         '1番目ﾎﾟｲﾝﾄNo.
;@DM168.L = 18112 + 512*(6-1)         '6番目ﾎﾟｲﾝﾄNo.
;UREAD(#3,@DM166,@DM170,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;UREAD(#3,@DM168,@DM172,#2)            '6番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;for @DM174 =2  to 5
;  Z1 = @DM174 *2
;  DM6120.L:Z1 = FLOAT(@DM170.L) + ((FLOAT(@DM172.L)-FLOAT(@DM170.L))/5) * (@DM174-1)
;  @DM160 = 18112 + 512*(@DM174-1)  
;  UWRIT(#3,@DM160,DM6120.L:Z1,#2)
;NEXT
;SET(R27206)
LDP R27205               ; NGﾄﾚｲ自動計算(TP)
NCJ #1056
;@DM166.L = 18112 + 512*(1-1)         '1番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +18112 @DM166
;@DM168.L = 18112 + 512*(6-1)         '6番目ﾎﾟｲﾝﾄNo.
;
LD CR2002                ; 常時ON
MOV.L +20672 @DM168
;UREAD(#3,@DM166,@DM170,#2)            '1番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM166 @DM170 #2
;UREAD(#3,@DM168,@DM172,#2)            '6番目ﾎﾟｲﾝﾄﾃﾞｰﾀ
;
LD CR2002                ; 常時ON
UREAD #3 @DM168 @DM172 #2
;for @DM174 =2  to 5
;
LD CR2002                ; 常時ON
MOV #2 @DM174
LABEL #2080
LD> @DM174 #5
CJ #2081
;  Z1 = @DM174 *2
;
LD CR2002                ; 常時ON
LDA @DM174
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  DM6120.L:Z1 = FLOAT(@DM170.L) + ((FLOAT(@DM172.L)-FLOAT(@DM170.L))/5) * (@DM174-1)
;
LD CR2002                ; 常時ON
LDA @DM174
CON
EXT
CON
SUB.L +1
CON
STA.L @VM40
CON
LDA.L @DM170
CON
FLOAT.L
CON
STA.F @VM42
CON
LDA.L @DM172
CON
FLOAT.L
CON
SUB.F @VM42
CON
DIV.F +5
CON
STA.F @VM44
CON
LDA.L @VM40
CON
FLOAT.L
CON
MUL.F @VM44
CON
STA.F @VM46
CON
LDA.L @DM170
CON
FLOAT.L
CON
ADD.F @VM46
CON
INTG.L
CON
STA.L DM6120:Z1          ; NGﾄﾚｲ Y軸_変更位置表示(TP)
;  @DM160 = 18112 + 512*(@DM174-1)  
;
LD CR2002                ; 常時ON
LDA @DM174
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM160
;  UWRIT(#3,@DM160,DM6120.L:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT.L #3 @DM160 DM6120:Z1 #2;NGﾄﾚｲ Y軸_変更位置表示(TP)
;NEXT
;
LD CR2002                ; 常時ON
INC @DM174
LDB CR2009
CJ #2080
LABEL #2081
;SET(R27206)
LD CR2002                ; 常時ON
SET R27206               ; NGﾄﾚｲ計算結果ROM書込み
LABEL #1056
;
;原点復帰動作
LDP R27201               ; NGﾄﾚｲ Y軸_隠し原点復帰sw
ORP R27202               ; NGﾄﾚｲ Y軸RB原点復帰要求
ANB R27104               ; NGﾄﾚｲ Y軸_原点復帰中
ANB @MR2408
RES R27105               ; NGﾄﾚｲ Y軸原点復帰完了
CON
RES MR3214               ; RB8_HOME
CON
SET @MR2408
STG @MR2408
MPS
AND R27105               ; NGﾄﾚｲ Y軸原点復帰完了
JMP @MR2409
MPP
MCALL GENTEN1 #3 #4 MR3214 R1010 R27105;RB8_HOME  RB8 HOME  END  NGﾄﾚｲ Y軸原点復帰完了
STG @MR2409
RES R27105               ; NGﾄﾚｲ Y軸原点復帰完了
CON
RES MR3214               ; RB8_HOME
CON
ANB R27105               ; NGﾄﾚｲ Y軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R27203               ; NGﾄﾚｲ Y軸RB原点復帰完了
CON
ENDS
;<h1/>RB9
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3108                ; DRV-T9 Power ON
ANB R28001               ; 給材 X軸_ｻｰﾎﾞｵﾝ完了
TMR @93 #20
CON
AND @T93
@SET @MR2600
STG @MR2600
SET R84305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2601
STG @MR2601
ANB R84705               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R84305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2602
STG @MR2602
SET R84000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2603
STG @MR2603
ANB R84400               ; 軸1 軸ｴﾗｰ中
RES R84000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2604
STG @MR2604
TMR @91 #30
CON
AND @T91
SET R84113               ; 軸1 ｻｰﾎﾞON
CON
JMP @MR2605
STG @MR2605
TMR @92 #30
CON
AND @T92
AND R84513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
SET R28001               ; 給材 X軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R84513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
RES R28001               ; 給材 X軸_ｻｰﾎﾞｵﾝ完了
;給材P&P_X軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R28200               ; 書き込みOK SW
@SET @MR2700
STG @MR2700
ANB R82812               ; ﾌﾗｯｼｭROM書込完了
SET R81612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR2701
STG @MR2701
AND R82812               ; ﾌﾗｯｼｭROM書込完了
UREAD #4 #105 @DM9 #1
RES R81612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR2702
STG @MR2702
MPS
AND= @DM9 #0
ENDS
MPP
AND<> @DM9 #0
SET R28002               ; 給材 X軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;給材P&P_X軸_移動可条件
LDB R84404               ; 軸1 軸制御中
ANB R65204               ; 軸2 軸制御中
AND R29500               ; 給材 Z軸 P1 位置　表示
OUT R28003               ; 給材 X軸_移動可
LDB R65204               ; 軸2 軸制御中
OUT R28004               ; 給材 X軸_移動可(JOG)
;給材P&P_X軸_ﾎﾟｼﾞｼｮﾝ表示
;DM6408.L = DM14290.L
;DM6412.L = DM14298.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM184=1 TO 50 STEP 1 
;  Z1 = @DM184 * 2
;  Z2 = @DM184 - 1
;  IF DM6420.L:Z1 = DM6408.L THEN
;    R28500:Z2 = 1
;  ELSE
;    R28500:Z2 = 0
;  END IF
;NEXT
;DM6406 = DM6400 + 2500
;DM6408.L = DM14290.L
;
LD CR2002                ; 常時ON
MOV.L DM14290 DM6408     ; 軸1 現在座標  給材 X軸_現在座標読出し
;DM6412.L = DM14298.L
;
LD CR2002                ; 常時ON
MOV.L DM14298 DM6412     ; 軸1 現在速度  給材 X軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM184=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM184
LABEL #2082
LD> @DM184 #50
CJ #2083
;  Z1 = @DM184 * 2
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM184 - 1
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM6420.L:Z1 = DM6408.L THEN
;
LD=.L DM6420:Z1 DM6408   ; 給材 X軸_変更位置表示(TP)  給材 X軸_現在座標読出し
NCJ #2084
;    R28500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R28500:Z2            ; 給材 X軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2085
LABEL #2084
;    R28500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R28500:Z2            ; 給材 X軸 P1 位置　表示
;  END IF
;
LABEL #2085
;NEXT
;
LD CR2002                ; 常時ON
INC @DM184
LDB CR2009
CJ #2082
LABEL #2083
;DM6406 = DM6400 + 2500
LD CR2002                ; 常時ON
LDA DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2500
CON
STA DM6406
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	ﾜｰｸ取出位置
;2	ﾗｲﾝ1ﾜｰｸｾｯﾄ位置
;3	ﾗｲﾝ2ﾜｰｸｾｯﾄ位置
;4	ﾗｲﾝ3ﾜｰｸｾｯﾄ位置
;5	ﾗｲﾝ4ﾜｰｸｾｯﾄ位置
;6	ﾗｲﾝ5ﾜｰｸｾｯﾄ位置
;7	ﾗｲﾝ6ﾜｰｸｾｯﾄ位置
;8	ﾗｲﾝ7ﾜｰｸｾｯﾄ位置
LD= DM3000 #200          ; 表示画面
OUT R28015               ; RBﾎﾟｲﾝﾄ設定1画面表示中(TP)
LDB R84404               ; 軸1 軸制御中
OUT R28406               ; 給材 X軸_位置取込み可PL(TP)
CON
OUT R28407               ; 給材 X軸_位置書込み可PL(TP)
LDP R28304               ; 給材 X軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
LDP R28305               ; 給材 X軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM6400 #9            ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
DW #9 DM6400             ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM6400 #1            ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM6400             ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM6402.L = DM14290.L
;DM6404.L = DM6550.L
LDP R28306               ; 給材 X軸_位置取込みPB(TP)
AND R28406               ; 給材 X軸_位置取込み可PL(TP)
NCJ #1040
;DM6402.L = DM14290.L
;
LD CR2002                ; 常時ON
MOV.L DM14290 DM6402     ; 軸1 現在座標  給材 X軸_変更位置表示計算用
;DM6404.L = DM6550.L
LD CR2002                ; 常時ON
MOV.L DM6550 DM6404      ; 給材 X軸_変更速度表示(TP)  給材 X軸_変更速度表示計算用
LABEL #1040
;
;
;DM6402.L = DM6420.L
;DM6404.L = DM6550.L
LD R28307                ; 給材 X軸_位置書込みPB(TP)
AND R28407               ; 給材 X軸_位置書込み可PL(TP)
NCJ #1041
;DM6402.L = DM6420.L
;
LD CR2002                ; 常時ON
MOV.L DM6420 DM6402      ; 給材 X軸_変更位置表示(TP)  給材 X軸_変更位置表示計算用
;DM6404.L = DM6550.L
LD CR2002                ; 常時ON
MOV.L DM6550 DM6404      ; 給材 X軸_変更速度表示(TP)  給材 X軸_変更速度表示計算用
LABEL #1041
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM180 = 18016 + 512*(DM6400-1)
;@DM182 = 18028 + 512*(DM6400-1)
;Z1 = DM6400 * 2
;DM6420.L:Z1 = DM6402.L   
;DM6550.L:Z1 = DM6404.L
;UWRIT(#4,@DM180,DM6402,#2)
;'UWRIT(#4,@DM182,DM6404,#2)       :速度変更しない
;
;
;
LDP R28200               ; 書き込みOK SW
LD R28406                ; 給材 X軸_位置取込み可PL(TP)
OR R28407                ; 給材 X軸_位置書込み可PL(TP)
ANL
NCJ #1042
;@DM180 = 18016 + 512*(DM6400-1)
;
LD CR2002                ; 常時ON
LDA DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM180
;@DM182 = 18028 + 512*(DM6400-1)
;
LD CR2002                ; 常時ON
LDA DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM182
;Z1 = DM6400 * 2
;
LD CR2002                ; 常時ON
LDA DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM6420.L:Z1 = DM6402.L   
;
LD CR2002                ; 常時ON
MOV.L DM6402 DM6420:Z1   ; 給材 X軸_変更位置表示計算用  給材 X軸_変更位置表示(TP)
;DM6550.L:Z1 = DM6404.L
;
LD CR2002                ; 常時ON
MOV.L DM6404 DM6550:Z1   ; 給材 X軸_変更速度表示計算用  給材 X軸_変更速度表示(TP)
;UWRIT(#4,@DM180,DM6402,#2)
;
LD CR2002                ; 常時ON
UWRIT #4 @DM180 DM6402 #2; 給材 X軸_変更位置表示計算用
;'UWRIT(#4,@DM182,DM6404,#2)       :速度変更しない
;
LABEL #1042
;
;  @DM180 = 18016 + 512*(DM6400-1)
;  @DM182 = 18028 + 512*(DM6400-1)
;  UREAD(#4,@DM180,DM6420,#2)
;  UREAD(#4,@DM182,DM6550,#2)
;
LDP R28304               ; 給材 X軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R28305               ; 給材 X軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R28200               ; 書き込みOK SW
NCJ #1050
;  @DM180 = 18016 + 512*(DM6400-1)
;
LD CR2002                ; 常時ON
LDA DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM180
;  @DM182 = 18028 + 512*(DM6400-1)
;
LD CR2002                ; 常時ON
LDA DM6400               ; 給材 X軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM182
;  UREAD(#4,@DM180,DM6420,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM180 DM6420 #2; 給材 X軸_変更位置表示(TP)
;  UREAD(#4,@DM182,DM6550,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM182 DM6550 #2; 給材 X軸_変更速度表示(TP)
LABEL #1050
;
;UWRIT(#4,#98,#0,#1)
;
;FOR @DM184=1 TO 25 STEP 1 
;  @DM180 = 18016 + 512*(@DM184-1)
;  @DM182 = 18028 + 512*(@DM184-1)
;  Z1 = @DM184 * 2
;  UWRIT(#4,@DM180,DM6420:Z1,#2)
;'  UWRIT(#4,@DM182,DM6550:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#4,#98,#1,#1)
;
;
;FOR @DM184=1 TO 25 STEP 1 
;  @DM180 = 18016 + 512*(@DM184-1)
;  @DM182 = 18028 + 512*(@DM184-1)
;  Z1 = @DM184 * 2
;  UWRIT(#4,@DM180,DM6470:Z1,#2)
;'  UWRIT(#4,@DM182,DM6600:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#4,#98,#0,#1)
LDF R28015               ; RBﾎﾟｲﾝﾄ設定1画面表示中(TP)
NCJ #1044
;UWRIT(#4,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #4 #98 #0 #1
;FOR @DM184=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM184
LABEL #2086
LD> @DM184 #25
CJ #2087
;  @DM180 = 18016 + 512*(@DM184-1)
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM180
;  @DM182 = 18028 + 512*(@DM184-1)
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM182
;  Z1 = @DM184 * 2
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#4,@DM180,DM6420:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #4 @DM180 DM6420:Z1 #2;給材 X軸_変更位置表示(TP)
;'  UWRIT(#4,@DM182,DM6550:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM184
LDB CR2009
CJ #2086
LABEL #2087
;UWRIT(#4,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #4 #98 #1 #1
;FOR @DM184=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM184
LABEL #2088
LD> @DM184 #25
CJ #2089
;  @DM180 = 18016 + 512*(@DM184-1)
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM180
;  @DM182 = 18028 + 512*(@DM184-1)
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM182
;  Z1 = @DM184 * 2
;
LD CR2002                ; 常時ON
LDA @DM184
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#4,@DM180,DM6470:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #4 @DM180 DM6470:Z1 #2;給材 X軸_P25:位置
;'  UWRIT(#4,@DM182,DM6600:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM184
LDB CR2009
CJ #2088
LABEL #2089
;UWRIT(#4,#98,#0,#1)
LD CR2002                ; 常時ON
UWRIT #4 #98 #0 #1
LABEL #1044
;
;原点復帰動作
LDP R28201               ; 給材 X軸_隠し原点復帰SW
ORP R28202               ; 給材P&P Y-RB原点復帰要求
ANB R28105               ; 給材 X軸原点復帰完了
ANB @MR2708
RES R28105               ; 給材 X軸原点復帰完了
CON
RES MR3300               ; RB9_HOME
CON
SET @MR2708
STG @MR2708
MPS
AND R28105               ; 給材 X軸原点復帰完了
JMP @MR2709
MPP
MCALL GENTEN2 #4 #1 MR3300 R1011 R28105;RB9_HOME  RB9 HOME  END  給材 X軸原点復帰完了
STG @MR2709
RES R28105               ; 給材 X軸原点復帰完了
CON
RES MR3300               ; RB9_HOME
CON
ANB R28105               ; 給材 X軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R28203               ; 給材P&P Y-RB原点復帰完了
CON
ENDS
;<h1/>RB10
;ｻｰﾎﾞON
LD T200                  ; 遅延ﾀｲﾏ−200　3s
ANB R50415               ; TRAP
AND R3109                ; DRV-T10 Power ON
ANB R29001               ; 給材 Z軸_ｻｰﾎﾞｵﾝ完了
TMR @103 #20
CON
AND @T103
@SET @MR2900
STG @MR2900
SET R65105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2901
STG @MR2901
ANB R65505               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R65105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR2902
STG @MR2902
SET R84800               ; 軸2 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2903
STG @MR2903
ANB R65200               ; 軸2 軸ｴﾗｰ中
RES R84800               ; 軸2 軸ｴﾗｰｸﾘｱ
CON
JMP @MR2904
STG @MR2904
TMR @101 #30
CON
AND @T101
SET R84913               ; 軸2 ｻｰﾎﾞON
CON
JMP @MR2905
STG @MR2905
TMR @102 #30
CON
AND @T102
AND R65313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
SET R29001               ; 給材 Z軸_ｻｰﾎﾞｵﾝ完了
CON
ENDS
LDF R65313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
RES R29001               ; 給材 Z軸_ｻｰﾎﾞｵﾝ完了
;給材P&P_Z軸_ﾌﾗｯｼｭﾛﾑ書込み
LDP R29200               ; 書き込みOK SW
@SET @MR3000
STG @MR3000
ANB R82812               ; ﾌﾗｯｼｭROM書込完了
SET R81612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR3001
STG @MR3001
AND R82812               ; ﾌﾗｯｼｭROM書込完了
UREAD #4 #105 @DM10 #1
RES R81612               ; ﾌﾗｯｼｭROM書込要求
CON
JMP @MR3002
STG @MR3002
MPS
AND= @DM10 #0
ENDS
MPP
AND<> @DM10 #0
SET R29002               ; 給材 Z軸_ﾌﾗｯｼｭﾛﾑ書込み異常
CON
ENDS
;給材P&P_Z軸_移動可条件
LDB R84404               ; 軸1 軸制御中
ANB R65204               ; 軸2 軸制御中
LD R50003                ; 原点復帰中
LD R28500                ; 給材 X軸 P1 位置　表示
ANB R4304                ; 給材P&P 旋回限(測定側)
AND R4305                ; 給材P&P 戻し限(ｺﾝﾍﾞﾔ側)
AND R4315                ; 供給部位置決め 上昇限
ORL
LD R28501                ; 給材 X軸 P2 位置　表示
AND R4415                ; 治具1 治具ｽﾗｲﾄﾞ 後退限(ｺﾝﾍﾞﾔ側)
AND R4413                ; 治具1 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4409                ; 治具1 PZT位置決めｸﾗﾝﾌﾟY 開限
AND R4411                ; 治具1 PZT位置決めｸﾗﾝﾌﾟX 開限
LD R28502                ; 給材 X軸 P3 位置　表示
AND R4509                ; 治具2 治具ｽﾗｲﾄﾞ 後退限(ｺﾝﾍﾞﾔ側)
AND R4507                ; 治具2 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4503                ; 治具2 PZT位置決めｸﾗﾝﾌﾟY 開限
AND R4505                ; 治具2 PZT位置決めｸﾗﾝﾌﾟX 開限
ORL
LD R28503                ; 給材 X軸 P4 位置　表示
AND R4603                ; 治具3 治具ｽﾗｲﾄﾞ 後退限(ｺﾝﾍﾞﾔ側)
AND R4601                ; 治具3 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4513                ; 治具3 PZT位置決めｸﾗﾝﾌﾟY 開限
AND R4515                ; 治具3 PZT位置決めｸﾗﾝﾌﾟX 開限
ORL
LD R28504                ; 給材 X軸 P5 位置　表示
AND R4613                ; 治具4 治具ｽﾗｲﾄﾞ 後退限(ｺﾝﾍﾞﾔ側)
AND R4611                ; 治具4 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4607                ; 治具4 PZT位置決めｸﾗﾝﾌﾟY 開限
AND R4609                ; 治具4 PZT位置決めｸﾗﾝﾌﾟX 開限
ORL
LD R28505                ; 給材 X軸 P6 位置　表示
AND R4707                ; 治具5 治具ｽﾗｲﾄﾞ 後退限(ｺﾝﾍﾞﾔ側)
AND R4705                ; 治具5 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4701                ; 治具5 PZT位置決めｸﾗﾝﾌﾟY 開限
AND R4703                ; 治具5 PZT位置決めｸﾗﾝﾌﾟX 開限
ORL
LD R28506                ; 給材 X軸 P7 位置　表示
AND R4801                ; 治具6 治具ｽﾗｲﾄﾞ 後退限(ｺﾝﾍﾞﾔ側)
AND R4715                ; 治具6 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4711                ; 治具6 PZT位置決めｸﾗﾝﾌﾟY 開限
AND R4713                ; 治具6 PZT位置決めｸﾗﾝﾌﾟX 開限
ORL
LD R28507                ; 給材 X軸 P8 位置　表示
AND R4811                ; 治具7 治具ｽﾗｲﾄﾞ 後退限(ｺﾝﾍﾞﾔ側)
AND R4809                ; 治具7 ﾌﾟﾛｰﾌﾞ受け 開放側限
AND R4805                ; 治具7 PZT位置決めｸﾗﾝﾌﾟY 開限
AND R4807                ; 治具7 PZT位置決めｸﾗﾝﾌﾟX 開限
ORL
ANB R4305                ; 給材P&P 戻し限(ｺﾝﾍﾞﾔ側)
AND R4304                ; 給材P&P 旋回限(測定側)
ORL
ANL
OUT R29003               ; 給材 Z軸_移動可
LDB R84404               ; 軸1 軸制御中
OUT R29004               ; 給材 Z軸_移動可(JOG)
;給材P&P_Z軸_ﾎﾟｼﾞｼｮﾝ表示
;DM6708.L = DM14350.L
;DM6712.L = DM14358.L
;
;' 位置ﾌﾗｸﾞ制御
;FOR @DM204=1 TO 50 STEP 1 
;  Z1 = @DM204 * 2
;  Z2 = @DM204 - 1
;  IF DM6720.L:Z1 = DM6708.L THEN
;    R29500:Z2 = 1
;  ELSE
;    R29500:Z2 = 0
;  END IF
;NEXT
;
;DM6706 = DM6700 + 2550
;DM6708.L = DM14350.L
;
LD CR2002                ; 常時ON
MOV.L DM14350 DM6708     ; 軸2 現在座標  給材 Z軸_現在座標読出し
;DM6712.L = DM14358.L
;
LD CR2002                ; 常時ON
MOV.L DM14358 DM6712     ; 軸2 現在速度  給材 Z軸_現在速度表示用
;' 位置ﾌﾗｸﾞ制御
;
;FOR @DM204=1 TO 50 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM204
LABEL #2090
LD> @DM204 #50
CJ #2091
;  Z1 = @DM204 * 2
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  Z2 = @DM204 - 1
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
SUB.L +1
CON
STA.L Z2
;  IF DM6720.L:Z1 = DM6708.L THEN
;
LD=.L DM6720:Z1 DM6708   ; 給材 Z軸_変更位置表示(TP)  給材 Z軸_現在座標読出し
NCJ #2092
;    R29500:Z2 = 1
;
LD CR2002                ; 常時ON
OUT R29500:Z2            ; 給材 Z軸 P1 位置　表示
;  ELSE
;
LD CR2002                ; 常時ON
CJ #2093
LABEL #2092
;    R29500:Z2 = 0
;
LD CR2003                ; 常時OFF
OUT R29500:Z2            ; 給材 Z軸 P1 位置　表示
;  END IF
;
LABEL #2093
;NEXT
;
LD CR2002                ; 常時ON
INC @DM204
LDB CR2009
CJ #2090
LABEL #2091
;DM6706 = DM6700 + 2550
LD CR2002                ; 常時ON
LDA DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
ADD.L +2550
CON
STA DM6706               ; 給材 Z軸_ﾎﾟｼﾞｼｮﾝ名称表示用
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;　　ﾎﾟｲﾝﾄﾃﾞｰﾀ
;1	待機位置
;2	ﾜｰｸ取出高さ
;3	ﾗｲﾝ1ﾜｰｸｾｯﾄ高さ
;4	ﾗｲﾝ2ﾜｰｸｾｯﾄ高さ
;5	ﾗｲﾝ3ﾜｰｸｾｯﾄ高さ
;6	ﾗｲﾝ4ﾜｰｸｾｯﾄ高さ
;7	ﾗｲﾝ5ﾜｰｸｾｯﾄ高さ
;8	ﾗｲﾝ6ﾜｰｸｾｯﾄ高さ
;9	ﾗｲﾝ7ﾜｰｸｾｯﾄ高さ
LD= DM3000 #200          ; 表示画面
OUT R29015               ; RBﾎﾟｲﾝﾄ設定1画面表示中(TP)
LDB R65204               ; 軸2 軸制御中
OUT R29406               ; 給材 Z軸_位置取込み可PL(TP)
CON
OUT R29407               ; 給材 Z軸_位置書込み可PL(TP)
LDP R29304               ; 給材 Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
INC DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
LDP R29305               ; 給材 Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
DEC DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
LD> DM6700 #9            ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #9 DM6700             ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
LD< DM6700 #1            ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
DW #1 DM6700             ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
;
;DM6702.L = DM14350.L   
;DM6704.L = DM6850.L
LDP R29306               ; 給材 Z軸_位置取込みPB(TP)
AND R29406               ; 給材 Z軸_位置取込み可PL(TP)
NCJ #1045
;DM6702.L = DM14350.L   
;
LD CR2002                ; 常時ON
MOV.L DM14350 DM6702     ; 軸2 現在座標  給材 Z軸_変更位置表示計算用
;DM6704.L = DM6850.L
LD CR2002                ; 常時ON
MOV.L DM6850 DM6704      ; 給材 Z軸_変更速度表示(TP)  給材 Z軸_変更速度表示計算用
LABEL #1045
;
;
;DM6702.L = DM6720.L   
;DM6704.L = DM6850.L
;
LD R29307                ; 給材 Z軸_位置書込みPB(TP)
AND R29407               ; 給材 Z軸_位置書込み可PL(TP)
NCJ #1046
;DM6702.L = DM6720.L   
;
LD CR2002                ; 常時ON
MOV.L DM6720 DM6702      ; 給材 Z軸_変更位置表示(TP)  給材 Z軸_変更位置表示計算用
;DM6704.L = DM6850.L
;
LD CR2002                ; 常時ON
MOV.L DM6850 DM6704      ; 給材 Z軸_変更速度表示(TP)  給材 Z軸_変更速度表示計算用
LABEL #1046
;
;
;ﾎﾟｲﾝﾄﾃﾞｰﾀ格納
;目標座標ﾊﾞｯﾌｧｴﾘｱは 18016+32*(軸番号-1)+512*(Point番号-1)
;速度ﾊﾞｯﾌｧｴﾘｱは     18028+32*(軸番号-1)+512*(Point番号-1)
;@DM200 = 18048 + 512*(DM6700-1)
;@DM202 = 18060 + 512*(DM6700-1)
;Z1 = DM6700 * 2
;DM6720.L:Z1 = DM6702.L   
;DM6850.L:Z1 = DM6704.L
;UWRIT(#4,@DM200,DM6702,#2)
;'UWRIT(#4,@DM202,DM6704,#2)       :速度変更しない
;
;
;
LDP R29200               ; 書き込みOK SW
LD R29406                ; 給材 Z軸_位置取込み可PL(TP)
OR R29407                ; 給材 Z軸_位置書込み可PL(TP)
ANL
NCJ #1047
;@DM200 = 18048 + 512*(DM6700-1)
;
LD CR2002                ; 常時ON
LDA DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM200
;@DM202 = 18060 + 512*(DM6700-1)
;
LD CR2002                ; 常時ON
LDA DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM202
;Z1 = DM6700 * 2
;
LD CR2002                ; 常時ON
LDA DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;DM6720.L:Z1 = DM6702.L   
;
LD CR2002                ; 常時ON
MOV.L DM6702 DM6720:Z1   ; 給材 Z軸_変更位置表示計算用  給材 Z軸_変更位置表示(TP)
;DM6850.L:Z1 = DM6704.L
;
LD CR2002                ; 常時ON
MOV.L DM6704 DM6850:Z1   ; 給材 Z軸_変更速度表示計算用  給材 Z軸_変更速度表示(TP)
;UWRIT(#4,@DM200,DM6702,#2)
;
LD CR2002                ; 常時ON
UWRIT #4 @DM200 DM6702 #2; 給材 Z軸_変更位置表示計算用
;'UWRIT(#4,@DM202,DM6704,#2)       :速度変更しない
;
LABEL #1047
;
;  @DM200 = 18048 + 512*(DM6700-1)
;  @DM202 = 18060 + 512*(DM6700-1)
;  UREAD(#4,@DM200,DM6720,#2)
;  UREAD(#4,@DM202,DM6850,#2)
;
LDP R29304               ; 給材 Z軸_ﾎﾟｲﾝﾄNo+PB(TP)
ORP R29305               ; 給材 Z軸_ﾎﾟｲﾝﾄNo-PB(TP)
ORP R29200               ; 書き込みOK SW
NCJ #1048
;  @DM200 = 18048 + 512*(DM6700-1)
;
LD CR2002                ; 常時ON
LDA DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM200
;  @DM202 = 18060 + 512*(DM6700-1)
;
LD CR2002                ; 常時ON
LDA DM6700               ; 給材 Z軸_ﾎﾟｲﾝﾄNo(TP)
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM202
;  UREAD(#4,@DM200,DM6720,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM200 DM6720 #2; 給材 Z軸_変更位置表示(TP)
;  UREAD(#4,@DM202,DM6850,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM202 DM6850 #2; 給材 Z軸_変更速度表示(TP)
LABEL #1048
;
;UWRIT(#4,#98,#0,#1)
;
;FOR @DM204=1 TO 25 STEP 1 
;  @DM200 = 18048 + 512*(@DM204-1)
;  @DM202 = 18060 + 512*(@DM204-1)
;  Z1 = @DM204 * 2
;  UWRIT(#4,@DM200,DM6720:Z1,#2)
;'  UWRIT(#4,@DM202,DM6850:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#4,#98,#1,#1)
;
;FOR @DM204=1 TO 25 STEP 1 
;  @DM200 = 18048 + 512*(@DM204-1)
;  @DM202 = 18060 + 512*(@DM204-1)
;  Z1 = @DM204 * 2
;  UWRIT(#4,@DM200,DM6750:Z1,#2)
;'  UWRIT(#4,@DM202,DM6900:Z1,#2)       :速度変更しない
;NEXT
;
;UWRIT(#4,#98,#0,#1)
LDF R29015               ; RBﾎﾟｲﾝﾄ設定1画面表示中(TP)
NCJ #1049
;UWRIT(#4,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #4 #98 #0 #1
;FOR @DM204=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM204
LABEL #2094
LD> @DM204 #25
CJ #2095
;  @DM200 = 18048 + 512*(@DM204-1)
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM200
;  @DM202 = 18060 + 512*(@DM204-1)
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM202
;  Z1 = @DM204 * 2
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#4,@DM200,DM6720:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #4 @DM200 DM6720:Z1 #2;給材 Z軸_変更位置表示(TP)
;'  UWRIT(#4,@DM202,DM6850:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM204
LDB CR2009
CJ #2094
LABEL #2095
;UWRIT(#4,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #4 #98 #1 #1
;FOR @DM204=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM204
LABEL #2096
LD> @DM204 #25
CJ #2097
;  @DM200 = 18048 + 512*(@DM204-1)
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM200
;  @DM202 = 18060 + 512*(@DM204-1)
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM202
;  Z1 = @DM204 * 2
;
LD CR2002                ; 常時ON
LDA @DM204
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  UWRIT(#4,@DM200,DM6750:Z1,#2)
;
LD CR2002                ; 常時ON
UWRIT #4 @DM200 DM6750:Z1 #2;給材 Z軸_P15:位置
;'  UWRIT(#4,@DM202,DM6900:Z1,#2)       :速度変更しない
;
;NEXT
;
LD CR2002                ; 常時ON
INC @DM204
LDB CR2009
CJ #2096
LABEL #2097
;UWRIT(#4,#98,#0,#1)
LD CR2002                ; 常時ON
UWRIT #4 #98 #0 #1
LABEL #1049
;
;原点復帰動作
LDP R29201               ; 給材 Z軸_隠し原点復帰SW
ORP R29202               ; 給材P&P Z-RB原点復帰要求
ANB R29104               ; 給材 Z軸_原点復帰中
ANB @MR3008
RES R29105               ; 給材 Z軸原点復帰完了
CON
RES MR3302               ; RB10_HOME
CON
SET @MR3008
STG @MR3008
MPS
AND R29105               ; 給材 Z軸原点復帰完了
JMP @MR3009
MPP
MCALL GENTEN2 #4 #2 MR3302 R1013 R29105;RB10_HOME  RB10 HOME  END  給材 Z軸原点復帰完了
STG @MR3009
RES R29105               ; 給材 Z軸原点復帰完了
CON
RES MR3302               ; RB10_HOME
CON
ANB R29105               ; 給材 Z軸原点復帰完了
MPS
ANB R50003               ; 原点復帰中
ENDS
MPP
AND R50003               ; 原点復帰中
SET R29203               ; 給材P&P Z-RB原点復帰完了
CON
ENDS
;<h1/>ﾊﾞｯﾌｧﾒﾓﾘ書込み
LDP R50001               ; 自動中
ORP R50002               ; 手動中
ORP R50003               ; 原点復帰中
ORP R28015               ; RBﾎﾟｲﾝﾄ設定1画面表示中(TP)
LDP T201                 ; 遅延ﾀｲﾏ−201　2s
ANB T200                 ; 遅延ﾀｲﾏ−200　3s
ORL
SET @MR109
;'******************
;' BANK0 
;'******************
;
;UWRIT(#2,#98,#0,#1)
;UWRIT(#3,#98,#0,#1)
;UWRIT(#4,#98,#0,#1)
;
;FOR @DM24=1 TO 25 STEP 1 
;  Z1 = @DM24 * 2
;  
;  @DM20 = 18016 + 512*(@DM24-1)
;  @DM22 = 18028 + 512*(@DM24-1)
;  UREAD(#2,@DM20,DM4020:Z1,#2)
;  UREAD(#2,@DM22,DM4150:Z1,#2)
;
;  @DM40 = 18048 + 512*(@DM24-1)
;  @DM42 = 18060 + 512*(@DM24-1)
;  UREAD(#2,@DM40,DM4320:Z1,#2)
;  UREAD(#2,@DM42,DM4450:Z1,#2)
;  
;  @DM60 = 18080 + 512*(@DM24-1)
;  @DM62 = 18092 + 512*(@DM24-1)
;  UREAD(#2,@DM60,DM4620:Z1,#2)
;  UREAD(#2,@DM62,DM4750:Z1,#2)
;
;  @DM80 = 18112 + 512*(@DM24-1)
;  @DM82 = 18124 + 512*(@DM24-1)
;  UREAD(#2,@DM80,DM4920:Z1,#2)
;  UREAD(#2,@DM82,DM5050:Z1,#2)
;
;  @DM100 = 18016 + 512*(@DM24-1)
;  @DM102 = 18028 + 512*(@DM24-1)
;  UREAD(#3,@DM100,DM5220:Z1,#2)
;  UREAD(#3,@DM102,DM5350:Z1,#2)
;
;  @DM120 = 18048 + 512*(@DM24-1)
;  @DM122 = 18060 + 512*(@DM24-1)
;  UREAD(#3,@DM120,DM5520:Z1,#2)
;  UREAD(#3,@DM122,DM5650:Z1,#2)
;
;  @DM140 = 18080 + 512*(@DM24-1)
;  @DM142 = 18092 + 512*(@DM24-1)
;  UREAD(#3,@DM140,DM5820:Z1,#2)
;  UREAD(#3,@DM142,DM5950:Z1,#2)
;
;  @DM160 = 18112 + 512*(@DM24-1)
;  @DM162 = 18124 + 512*(@DM24-1)
;  UREAD(#3,@DM160,DM6120:Z1,#2)
;  UREAD(#3,@DM162,DM6250:Z1,#2)
;
;  @DM180 = 18016 + 512*(@DM24-1)
;  @DM182 = 18028 + 512*(@DM24-1)
;  UREAD(#4,@DM180,DM6420:Z1,#2)
;  UREAD(#4,@DM182,DM6550:Z1,#2)
;
;  @DM200 = 18048 + 512*(@DM24-1)
;  @DM202 = 18060 + 512*(@DM24-1)
;  UREAD(#4,@DM200,DM6720:Z1,#2)
;  UREAD(#4,@DM202,DM6850:Z1,#2)
;
;NEXT
;
;'******************
;' BANK1 
;'******************
;
;UWRIT(#2,#98,#1,#1)
;UWRIT(#3,#98,#1,#1)
;UWRIT(#4,#98,#1,#1)
;
;FOR @DM24=1 TO 25 STEP 1 
;  Z1 = @DM24 * 2
;  
;  @DM20 = 18016 + 512*(@DM24-1)
;  @DM22 = 18028 + 512*(@DM24-1)
;  UREAD(#2,@DM20,DM4070:Z1,#2)
;  UREAD(#2,@DM22,DM4200:Z1,#2)
;
;  @DM40 = 18048 + 512*(@DM24-1)
;  @DM42 = 18060 + 512*(@DM24-1)
;  UREAD(#2,@DM40,DM4370:Z1,#2)
;  UREAD(#2,@DM42,DM4500:Z1,#2)
;  
;  @DM60 = 18080 + 512*(@DM24-1)
;  @DM62 = 18092 + 512*(@DM24-1)
;  UREAD(#2,@DM60,DM4670:Z1,#2)
;  UREAD(#2,@DM62,DM4800:Z1,#2)
;
;  @DM80 = 18112 + 512*(@DM24-1)
;  @DM82 = 18124 + 512*(@DM24-1)
;  UREAD(#2,@DM80,DM4970:Z1,#2)
;  UREAD(#2,@DM82,DM5100:Z1,#2)
;
;  @DM100 = 18016 + 512*(@DM24-1)
;  @DM102 = 18028 + 512*(@DM24-1)
;  UREAD(#3,@DM100,DM5270:Z1,#2)
;  UREAD(#3,@DM102,DM5400:Z1,#2)
;
;  @DM120 = 18048 + 512*(@DM24-1)
;  @DM122 = 18060 + 512*(@DM24-1)
;  UREAD(#3,@DM120,DM5570:Z1,#2)
;  UREAD(#3,@DM122,DM5700:Z1,#2)
;
;  @DM140 = 18080 + 512*(@DM24-1)
;  @DM142 = 18092 + 512*(@DM24-1)
;  UREAD(#3,@DM140,DM5870:Z1,#2)
;  UREAD(#3,@DM142,DM6000:Z1,#2)
;
;  @DM160 = 18112 + 512*(@DM24-1)
;  @DM162 = 18124 + 512*(@DM24-1)
;  UREAD(#3,@DM160,DM6170:Z1,#2)
;  UREAD(#3,@DM162,DM6300:Z1,#2)
;
;  @DM180 = 18016 + 512*(@DM24-1)
;  @DM182 = 18028 + 512*(@DM24-1)
;  UREAD(#4,@DM180,DM6470:Z1,#2)
;  UREAD(#4,@DM182,DM6600:Z1,#2)
;
;  @DM200 = 18048 + 512*(@DM24-1)
;  @DM202 = 18060 + 512*(@DM24-1)
;  UREAD(#4,@DM200,DM6770:Z1,#2)
;  UREAD(#4,@DM202,DM6900:Z1,#2)
;
;NEXT
;
;UWRIT(#2,#98,#0,#1)
;UWRIT(#3,#98,#0,#1)
;UWRIT(#4,#98,#0,#1)
;
;RES(@MR109)
LD @MR109
NCJ #1043
;'******************
;
;' BANK0 
;
;'******************
;
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;UWRIT(#4,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #4 #98 #0 #1
;FOR @DM24=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM24
LABEL #2098
LD> @DM24 #25
CJ #2099
;  Z1 = @DM24 * 2
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  @DM20 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM20
;  @DM22 = 18028 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM22
;  UREAD(#2,@DM20,DM4020:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM20 DM4020:Z1 #2;TCa Y軸_変更位置表示(TP)
;  UREAD(#2,@DM22,DM4150:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM22 DM4150:Z1 #2;TCa Y軸_変更速度表示(TP)
;  @DM40 = 18048 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM40
;  @DM42 = 18060 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM42
;  UREAD(#2,@DM40,DM4320:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM40 DM4320:Z1 #2;TCa Z軸_変更位置表示(TP)
;  UREAD(#2,@DM42,DM4450:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM42 DM4450:Z1 #2;TCa Z軸_変更速度表示(TP)
;  @DM60 = 18080 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM60
;  @DM62 = 18092 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM62
;  UREAD(#2,@DM60,DM4620:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM60 DM4620:Z1 #2;TCb Y軸_変更位置表示(TP)
;  UREAD(#2,@DM62,DM4750:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM62 DM4750:Z1 #2;TCb Y軸_変更速度表示(TP)
;  @DM80 = 18112 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM80
;  @DM82 = 18124 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM82
;  UREAD(#2,@DM80,DM4920:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM80 DM4920:Z1 #2;TCb Z軸_変更位置表示(TP)
;  UREAD(#2,@DM82,DM5050:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM82 DM5050:Z1 #2;TCb Z軸_変更速度表示(TP)
;  @DM100 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  UREAD(#3,@DM100,DM5220:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM100 DM5220:Z1 #2;除材 X軸_変更位置表示(TP)
;  UREAD(#3,@DM102,DM5350:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM102 DM5350:Z1 #2;除材 X軸_変更速度表示(TP)
;  @DM120 = 18048 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM120
;  @DM122 = 18060 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM122
;  UREAD(#3,@DM120,DM5520:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM120 DM5520:Z1 #2;除材 OK Z軸_変更位置表示(TP)
;  UREAD(#3,@DM122,DM5650:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM122 DM5650:Z1 #2;除材 OK Z軸_変更速度表示(TP)
;  @DM140 = 18080 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM140
;  @DM142 = 18092 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM142
;  UREAD(#3,@DM140,DM5820:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM140 DM5820:Z1 #2;除材 NG Z軸_変更位置表示(TP)
;  UREAD(#3,@DM142,DM5950:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM142 DM5950:Z1 #2;除材 NG Z軸_変更速度表示(TP)
;  @DM160 = 18112 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM160
;  @DM162 = 18124 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM162
;  UREAD(#3,@DM160,DM6120:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM160 DM6120:Z1 #2;NGﾄﾚｲ Y軸_変更位置表示(TP)
;  UREAD(#3,@DM162,DM6250:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM162 DM6250:Z1 #2;NGﾄﾚｲ Y軸_変更速度表示(TP)
;  @DM180 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM180
;  @DM182 = 18028 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM182
;  UREAD(#4,@DM180,DM6420:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM180 DM6420:Z1 #2;給材 X軸_変更位置表示(TP)
;  UREAD(#4,@DM182,DM6550:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM182 DM6550:Z1 #2;給材 X軸_変更速度表示(TP)
;  @DM200 = 18048 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM200
;  @DM202 = 18060 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM202
;  UREAD(#4,@DM200,DM6720:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM200 DM6720:Z1 #2;給材 Z軸_変更位置表示(TP)
;  UREAD(#4,@DM202,DM6850:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM202 DM6850:Z1 #2;給材 Z軸_変更速度表示(TP)
;NEXT
;
LD CR2002                ; 常時ON
INC @DM24
LDB CR2009
CJ #2098
LABEL #2099
;'******************
;
;' BANK1 
;
;'******************
;
;UWRIT(#2,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #1 #1
;UWRIT(#3,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #1 #1
;UWRIT(#4,#98,#1,#1)
;
LD CR2002                ; 常時ON
UWRIT #4 #98 #1 #1
;FOR @DM24=1 TO 25 STEP 1 
;
LD CR2002                ; 常時ON
MOV #1 @DM24
LABEL #2100
LD> @DM24 #25
CJ #2101
;  Z1 = @DM24 * 2
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
MUL.L +2
CON
STA.L Z1
;  @DM20 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM20
;  @DM22 = 18028 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM22
;  UREAD(#2,@DM20,DM4070:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM20 DM4070:Z1 #2;TCa Y軸_P25:位置
;  UREAD(#2,@DM22,DM4200:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM22 DM4200:Z1 #2;TCa Y軸_P25:移動速度
;  @DM40 = 18048 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM40
;  @DM42 = 18060 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM42
;  UREAD(#2,@DM40,DM4370:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM40 DM4370:Z1 #2;TCa Z軸_P25:位置
;  UREAD(#2,@DM42,DM4500:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM42 DM4500:Z1 #2;TCa Z軸_P25:移動速度
;  @DM60 = 18080 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM60
;  @DM62 = 18092 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM62
;  UREAD(#2,@DM60,DM4670:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM60 DM4670:Z1 #2;TCb Y軸_P25:位置
;  UREAD(#2,@DM62,DM4800:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM62 DM4800:Z1 #2;TCb Y軸_P25:移動速度
;  @DM80 = 18112 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM80
;  @DM82 = 18124 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM82
;  UREAD(#2,@DM80,DM4970:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM80 DM4970:Z1 #2;TCb Z軸_P25:位置
;  UREAD(#2,@DM82,DM5100:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #2 @DM82 DM5100:Z1 #2;TCb Z軸_P25:移動速度
;  @DM100 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM100
;  @DM102 = 18028 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM102
;  UREAD(#3,@DM100,DM5270:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM100 DM5270:Z1 #2;除材 X軸_P25:位置
;  UREAD(#3,@DM102,DM5400:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM102 DM5400:Z1 #2;除材 X軸_P25:移動速度
;  @DM120 = 18048 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM120
;  @DM122 = 18060 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM122
;  UREAD(#3,@DM120,DM5570:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM120 DM5570:Z1 #2;除材 OK Z軸_P25:位置
;  UREAD(#3,@DM122,DM5700:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM122 DM5700:Z1 #2;除材 OK Z軸_P25:移動速度
;  @DM140 = 18080 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18080
CON
STA @DM140
;  @DM142 = 18092 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18092
CON
STA @DM142
;  UREAD(#3,@DM140,DM5870:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM140 DM5870:Z1 #2;除材 NG Z軸_P25:位置
;  UREAD(#3,@DM142,DM6000:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM142 DM6000:Z1 #2;除材 NG Z軸_P25:移動速度
;  @DM160 = 18112 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18112
CON
STA @DM160
;  @DM162 = 18124 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18124
CON
STA @DM162
;  UREAD(#3,@DM160,DM6170:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM160 DM6170:Z1 #2;NGﾄﾚｲ Y軸_P25:位置
;  UREAD(#3,@DM162,DM6300:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #3 @DM162 DM6300:Z1 #2;NGﾄﾚｲ Y軸_P25:移動速度
;  @DM180 = 18016 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18016
CON
STA @DM180
;  @DM182 = 18028 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18028
CON
STA @DM182
;  UREAD(#4,@DM180,DM6470:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM180 DM6470:Z1 #2;給材 X軸_P25:位置
;  UREAD(#4,@DM182,DM6600:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM182 DM6600:Z1 #2;給材 X軸_P25:移動速度
;  @DM200 = 18048 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18048
CON
STA @DM200
;  @DM202 = 18060 + 512*(@DM24-1)
;
LD CR2002                ; 常時ON
LDA @DM24
CON
EXT
CON
SUB.L +1
CON
MUL.L +512
CON
ADD.L +18060
CON
STA @DM202
;  UREAD(#4,@DM200,DM6770:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM200 DM6770:Z1 #2;給材 Z軸_P25:位置
;  UREAD(#4,@DM202,DM6900:Z1,#2)
;
LD CR2002                ; 常時ON
UREAD #4 @DM202 DM6900:Z1 #2;給材 Z軸_P25:移動速度
;NEXT
;
LD CR2002                ; 常時ON
INC @DM24
LDB CR2009
CJ #2100
LABEL #2101
;UWRIT(#2,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #2 #98 #0 #1
;UWRIT(#3,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #3 #98 #0 #1
;UWRIT(#4,#98,#0,#1)
;
LD CR2002                ; 常時ON
UWRIT #4 #98 #0 #1
;RES(@MR109)
LD CR2002                ; 常時ON
RES @MR109
LABEL #1043
;
END
ENDH
