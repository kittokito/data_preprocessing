DEVICE:53
;MODULE:Traychanger_A
;MODULE_TYPE:0
;SCRIPT_TYPE:
;非常停止 / Emergency stop
LD R50000                ; 即停止
OR R50415                ; TRAP
OR R50010                ; 非常停止
ZRES @MR002 @MR3915
;条件ﾌﾗｸﾞ / Flug
LD R6706                 ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
AND R4906                ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
AND R4202                ; OK_A級品 ﾄﾚｲ浮き1(上流側)
AND R4203                ; OK_A級品 ﾄﾚｲ浮き2(下流側)
OUT @MR008               ; Aﾗﾝｸﾄﾚｲ有
LDB R4202                ; OK_A級品 ﾄﾚｲ浮き1(上流側)
ORB R4203                ; OK_A級品 ﾄﾚｲ浮き2(下流側)
OUT @MR009               ; Aﾗﾝｸﾄﾚｲ浮き
LDB R50300               ; PAUSE中
ANB R51001               ; 全体･ｼｽﾃﾑ部ｴﾗｰ中
ANB R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
ANB R50108               ; ｴﾗｰ発生中
OUT @MR010               ; Main部一時停止ｴﾗｰ無し
LDB R50300               ; PAUSE中
ANB R50301               ; ﾄﾚﾁｪﾝ     PAUSE中
ANB R51001               ; 全体･ｼｽﾃﾑ部ｴﾗｰ中
ANB R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
ANB R50108               ; ｴﾗｰ発生中
OUT @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
LD R6706                 ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
ANB R4906                ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
TMR @5 #30               ; ﾄﾚｲｸﾗﾝﾌﾟ閉後一定時間経過
;<h1/>■■■　AUTO動作 / AUTO OPERATION
LD R50011                ; AUTO MODE
ANB MR11300              ; ﾄﾚﾁｪﾝA_ｻｲｸﾙ中
AND MR11100              ; ﾄﾚﾁｪﾝA_ Start
MPS
LD LR41000               ; 自動ﾊﾟﾗﾒｰﾀ1　通常動作
OR LR41001               ; 自動ﾊﾟﾗﾒｰﾀ2　払い出し
ANL
RES MR11500              ; ﾄﾚﾁｪﾝA_ｻｲｸﾙ終了
CON
SET MR11300              ; ﾄﾚﾁｪﾝA_ｻｲｸﾙ中
CON
RES MR11100              ; ﾄﾚﾁｪﾝA_ Start
CON
SET @MR1900              ; 初期ﾄﾚｲ確認
MPP
AND LR41008              ; 自動ﾊﾟﾗﾒｰﾀ9  PASS
RES MR11500              ; ﾄﾚﾁｪﾝA_ｻｲｸﾙ終了
CON
RES MR11300              ; ﾄﾚﾁｪﾝA_ｻｲｸﾙ中
CON
RES MR11100              ; ﾄﾚﾁｪﾝA_ Start
CON
SET @MR2300              ; ｻｲｸﾙ終了
;初期ﾄﾚｲ確認
STG @MR1900              ; 初期ﾄﾚｲ確認
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
DW #0 @DM0               ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR1901
STG @MR1901
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
SET MR6706               ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
LD R4906                 ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
OR @T5                   ; ﾄﾚｲｸﾗﾝﾌﾟ閉後一定時間経過
ANL
@INC @DM0                ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR1902
STG @MR1902
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND>= @DM0 DM100         ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR1906
MPP
AND< @DM0 DM100          ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR1903
STG @MR1903
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @32 #3
CON
AND @T32
JMP @MR1904
STG @MR1904
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6706               ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R4907                ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 開限
JMP @MR1905
STG @MR1905
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @33 #3
CON
AND @T33
JMP @MR1901
STG @MR1906
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
DW #0 @DM0               ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR1907
STG @MR1907
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @34 #10
CON
AND @T34
MPS
ANB R52903               ; 段数ﾘｾｯﾄ無
JMP @MR2000              ; AUTO MAIN
MPP
AND R52903               ; 段数ﾘｾｯﾄ無
MPS
AND<> DM504 #0           ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
JMP @MR2000              ; AUTO MAIN
MPP
AND= DM504 #0            ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
DIFU R52300              ; TC_A 取出No.Inc
CON
JMP @MR2000              ; AUTO MAIN
;AUTO動作MAIN
STG @MR2000              ; AUTO MAIN
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
AND @MR008               ; Aﾗﾝｸﾄﾚｲ有
MPS
LD<> DM504 #0            ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
ANB R46000               ; Aﾄﾚｲﾁｪﾝｼﾞ要求
ANL
JMP @MR2100              ; 次位置へ移動
MPP
LD= DM504 #0             ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
OR R46000                ; Aﾄﾚｲﾁｪﾝｼﾞ要求
ANL
DIFU R52304              ; TC_A 取出No.ﾘｾｯﾄ2
CON
JMP @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
MPP
ANB @MR008               ; Aﾗﾝｸﾄﾚｲ有
MPS
ANB @MR009               ; Aﾗﾝｸﾄﾚｲ浮き
DIFU R52305              ; TC_A 取出No.ﾘｾｯﾄ3
CON
JMP @MR2600              ; 空ﾄﾚｲ在荷確認
MPP
AND @MR009               ; Aﾗﾝｸﾄﾚｲ浮き
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
SET @MR400               ; ERR43Aﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2001
;☆　ﾄﾚｲｸﾗﾝﾌﾟ異常 / Tray clamp error
STG @MR2001
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR407               ; ERR43解除
RES @MR407               ; ERR43解除
CON
JMP @MR2002
STG @MR2002
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
ANB R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2000              ; AUTO MAIN
MPP
AND R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2003
STG @MR2003
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
MPS
LDB @MR008               ; Aﾗﾝｸﾄﾚｲ有
ANB @MR009               ; Aﾗﾝｸﾄﾚｲ浮き
ANL
JMP @MR2000              ; AUTO MAIN
MPP
LD @MR008                ; Aﾗﾝｸﾄﾚｲ有
OR @MR009                ; Aﾗﾝｸﾄﾚｲ浮き
ANL
SET @MR400               ; ERR43Aﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2001
;<h1/>       ・次取出し位置へ移動 / Move to next pick up point
;ｸﾗﾝﾌﾟ閉じ / Close tray clamp
STG @MR2100              ; 次位置へ移動
AND @MR010               ; Main部一時停止ｴﾗｰ無し
SET MR6706               ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
TMH @11 #10
CON
AND @T11
AND R4906                ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
OUT R50400               ; Call Post
CON
AND R50402               ; Post Ok
JMP @MR2101
STG @MR2101
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2105
MPP
AND R52905               ; ﾄﾚｲ押さえ有り
MPS
AND= DM506 DM502         ; RB1取出しPosition No.  RB1現在Position No.
JMP @MR2200              ; TC_A　給材要求ON
MPP
AND<> DM506 DM502        ; RB1取出しPosition No.  RB1現在Position No.
JMP @MR2102
;移動高さへ下降 / Down to slide position
STG @MR2102
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2103
STG @MR2103
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2104
MPP
MCALL POINT_MOVE1 #2 #2 #1 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2104
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2105
;受渡位置へ移動 / Move to delivery
STG @MR2105
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R20003               ; TCa Y軸_移動可
ANB R20101               ; TCa Y軸_移動中
ANB R20102               ; TCa Y軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2106
STG @MR2106
MPS
AND R20102               ; TCa Y軸_移動完了
JMP @MR2107
MPP
MCALL POINT_MOVE1 #2 #1 DM506 R20111 R20102;RB1取出しPosition No.  TCa Y軸_位置決め異常  TCa Y軸_移動完了
STG @MR2107
RES R20102               ; TCa Y軸_移動完了
CON
ANB R20102               ; TCa Y軸_移動完了
RES @MR3900              ; 一時停止禁止
CON
MPS
AND R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2108
MPP
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2200              ; TC_A　給材要求ON
;受取高さへ上昇 / Up to resive position
STG @MR2108
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2109
STG @MR2109
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2110
MPP
MCALL POINT_MOVE1 #2 #2 #6 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2110
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21505               ; TCa Z軸 P6 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2200              ; TC_A　給材要求ON
;反転　除材完了待ち / Waiting for End of Reverser remove
STG @MR2200              ; TC_A　給材要求ON
AND @MR010               ; Main部一時停止ｴﾗｰ無し
SET R52310               ; TC_A 給材要求
CON
JMP @MR2201
STG @MR2201
MPS
ANB MR11406              ; 除材PPｻｲｸﾙ終了
MPS
AND R52311               ; TC_A 給材中
JMP @MR2203
MPP
LDB R52311               ; TC_A 給材中
AND R46000               ; Aﾄﾚｲﾁｪﾝｼﾞ要求
ANL
RES R52310               ; TC_A 給材要求
CON
JMP @MR2202
MPP
AND MR11406              ; 除材PPｻｲｸﾙ終了
RES R52310               ; TC_A 給材要求
CON
JMP @MR2301
STG @MR2202
MPS
ANB R52311               ; TC_A 給材中
TMR @40 #5
CON
AND @T40
DIFU R52301              ; TC_A 取出No.ﾘｾｯﾄ1
CON
JMP @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
MPP
AND R52311               ; TC_A 給材中
JMP @MR2203
STG @MR2203
ANB R52311               ; TC_A 給材中
AND R52312               ; TC_A 給材完了
RES R52310               ; TC_A 給材要求
CON
RES R52312               ; TC_A 給材完了
CON
JMP @MR2204
;取出しNo.+1 / Pick up No. +1
STG @MR2204
DIFU R52300              ; TC_A 取出No.Inc
CON
JMP @MR2300              ; ｻｲｸﾙ終了
;ｻｲｸﾙ終了処理 / cycle end process
STG @MR2300              ; ｻｲｸﾙ終了
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB MR11406              ; 除材PPｻｲｸﾙ終了
JMP @MR2000              ; AUTO MAIN
MPP
AND MR11406              ; 除材PPｻｲｸﾙ終了
JMP @MR2301
STG @MR2301
RES R46000               ; Aﾄﾚｲﾁｪﾝｼﾞ要求
CON
RES MR11300              ; ﾄﾚﾁｪﾝA_ｻｲｸﾙ中
CON
SET MR11500              ; ﾄﾚﾁｪﾝA_ｻｲｸﾙ終了
CON
ENDS
;<h1/>       ・ﾄﾚｲﾁｪﾝｼﾞ / Tray change
;移動高さへ下降 / Down to slide position
STG @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2403
MPP
LD R52905                ; ﾄﾚｲ押さえ有り
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
ANL
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2401
STG @MR2401
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2402
MPP
MCALL POINT_MOVE1 #2 #2 #1 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2402
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2403
;実ﾄﾚｲ排出位置へ / move to Empty tray eject point
STG @MR2403
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R20003               ; TCa Y軸_移動可
ANB R20101               ; TCa Y軸_移動中
ANB R20102               ; TCa Y軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2404
STG @MR2404
MPS
AND R20102               ; TCa Y軸_移動完了
JMP @MR2405
MPP
MCALL POINT_MOVE1 #2 #1 #9 R20111 R20102;TCa Y軸_位置決め異常  TCa Y軸_移動完了
STG @MR2405
RES R20102               ; TCa Y軸_移動完了
CON
ANB R20102               ; TCa Y軸_移動完了
AND R20508               ; TCa Y軸 P9 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2406
;実ﾄﾚｲ下位置へ / move to tray low level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2406
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
AND R20508               ; TCa Y軸 P9 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2407
STG @MR2407
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2408
MPP
MCALL POINT_MOVE1 #2 #2 #4 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2408
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21503               ; TCa Z軸 P4 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2500
;実ﾄﾚｲｾﾊﾟﾚｰﾀ　開 / Empty tray separater open
STG @MR2500
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6703               ; OK_A級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ 閉
CON
SET MR6702               ; OK_A級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ 開
CON
AND R4814                ; A級実ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 開限
AND R4900                ; A級実ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 開限
JMP @MR2501
;実ﾄﾚｲ上位置へ / move to Empty tray upper level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2501
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
AND R20508               ; TCa Y軸 P9 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2502
STG @MR2502
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2503
MPP
MCALL POINT_MOVE1 #2 #2 #5 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2503
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21504               ; TCa Z軸 P5 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2504
;ﾄﾚｲｸﾗﾝﾌﾟ 開 / Tray clamp open
STG @MR2504
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6706               ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R4907                ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 開限
JMP @MR2505
;実ﾄﾚｲｾﾊﾟﾚｰﾀ 閉 / Empty tray separater close
STG @MR2505
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6702               ; OK_A級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ 開
CON
SET MR6703               ; OK_A級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ 閉
CON
AND R4815                ; A級実ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 閉限
AND R4901                ; A級実ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 閉限
JMP @MR2506
;受渡位置へ / move to delevery point
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2506
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
AND R20508               ; TCa Y軸 P9 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2507
STG @MR2507
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2508
MPP
MCALL POINT_MOVE1 #2 #2 #1 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2508
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2509              ; 実ﾄﾚｲ満杯検出
;実ﾄﾚｲ満杯確認 / Empty tray full detection check
STG @MR2509              ; 実ﾄﾚｲ満杯検出
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND R4111                ; OK_A実ﾄﾚｲ満杯検出  OFF=満杯
JMP @MR2600              ; 空ﾄﾚｲ在荷確認
MPP
ANB R4111                ; OK_A実ﾄﾚｲ満杯検出  OFF=満杯
SET @MR300               ; ERR41実ﾄﾚｲ満杯
CON
JMP @MR2510
;実ﾄﾚｲ満杯 / Empty tray Full error
STG @MR2510
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR307               ; ERR41解除
RES @MR307               ; ERR41解除
CON
JMP @MR2509              ; 実ﾄﾚｲ満杯検出
;空在荷確認前　移動高さへ下降 / Down to slide position before empty tray check
STG @MR2600              ; 空ﾄﾚｲ在荷確認
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2603
MPP
LD R52905                ; ﾄﾚｲ押さえ有り
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
ANL
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2601
STG @MR2601
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2602
MPP
MCALL POINT_MOVE1 #2 #2 #1 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2602
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2603
;空ﾄﾚｲ在荷確認 / Enough tray check
STG @MR2603
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND R4110                ; OK_A級品 空ﾄﾚｲ検出　ON=有
JMP @MR2700              ; ﾄﾚｲﾁｪﾝｼﾞ 空ﾄﾚｲ受取
MPP
ANB R4110                ; OK_A級品 空ﾄﾚｲ検出　ON=有
SET @MR308               ; ERR42空ﾄﾚｲ残少
CON
JMP @MR2604
;実ﾄﾚｲ残少 / Supply tray low
STG @MR2604
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR315               ; ERR42解除
RES @MR315               ; ERR42解除
CON
JMP @MR2700              ; ﾄﾚｲﾁｪﾝｼﾞ 空ﾄﾚｲ受取
;空ﾄﾚｲ受取位置へ / move to tray Supply point
STG @MR2700              ; ﾄﾚｲﾁｪﾝｼﾞ 空ﾄﾚｲ受取
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES R46000               ; Aﾄﾚｲﾁｪﾝｼﾞ要求
CON
RES MR6706               ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R20003               ; TCa Y軸_移動可
ANB R20101               ; TCa Y軸_移動中
ANB R20102               ; TCa Y軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2701
STG @MR2701
MPS
AND R20102               ; TCa Y軸_移動完了
JMP @MR2702
MPP
MCALL POINT_MOVE1 #2 #1 #8 R20111 R20102;TCa Y軸_位置決め異常  TCa Y軸_移動完了
STG @MR2702
RES R20102               ; TCa Y軸_移動完了
CON
ANB R20102               ; TCa Y軸_移動完了
AND R20507               ; TCa Y軸 P8 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2703
;空ﾄﾚｲ上位置へ / move to tray supply upper level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2703
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
AND R20507               ; TCa Y軸 P8 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2704
STG @MR2704
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2705
MPP
MCALL POINT_MOVE1 #2 #2 #3 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2705
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21502               ; TCa Z軸 P3 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2706
;空ﾄﾚｲｾﾊﾟﾚｰﾀ 開 / Supply tray separater open
STG @MR2706
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6705               ; OK_A級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ 閉
CON
SET MR6704               ; OK_A級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ 開
CON
AND R4902                ; A級空ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 開限
AND R4904                ; A級空ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 開限
JMP @MR2707
;空ﾄﾚｲ下位置へ / move to tray supply lower level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2707
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
AND R20507               ; TCa Y軸 P8 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2708
STG @MR2708
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2709
MPP
MCALL POINT_MOVE1 #2 #2 #2 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2709
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21501               ; TCa Z軸 P2 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2710
;空ﾄﾚｲｾﾊﾟﾚｰﾀ 閉 / Supply tray separater close
STG @MR2710
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6704               ; OK_A級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ 開
CON
SET MR6705               ; OK_A級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ 閉
CON
AND R4903                ; A級空ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 閉限
AND R4905                ; A級空ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 閉限
JMP @MR2711
;受渡位置へ / move to delevery point
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2711
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
AND R20507               ; TCa Y軸 P8 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2712
STG @MR2712
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR2713
MPP
MCALL POINT_MOVE1 #2 #2 #1 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR2713
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2800
;ﾄﾚｲｸﾗﾝﾌﾟ操作 / Tray clamp operation
STG @MR2800
DW #0 @DM0               ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR2801
STG @MR2801
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
SET MR6706               ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
LD R4906                 ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
OR @T5                   ; ﾄﾚｲｸﾗﾝﾌﾟ閉後一定時間経過
ANL
@INC @DM0                ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR2802
STG @MR2802
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND>= @DM0 DM100         ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR2806
MPP
AND< @DM0 DM100          ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR2803
STG @MR2803
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @30 #3
CON
AND @T30
JMP @MR2804
STG @MR2804
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6706               ; OK_A級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R4907                ; A級品 ﾄﾚｲｸﾗﾝﾌﾟ 開限
JMP @MR2805
STG @MR2805
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @31 #3
CON
AND @T31
JMP @MR2801
STG @MR2806
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
DW #0 @DM0               ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR2900
;ﾄﾚｲ確認	/ Tray  check　
STG @MR2900
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @10 #10
CON
AND @T10
MPS
AND @MR008               ; Aﾗﾝｸﾄﾚｲ有
MPS
ANB R52903               ; 段数ﾘｾｯﾄ無
DIFU R52300              ; TC_A 取出No.Inc
CON
JMP @MR3000
MPP
AND R52903               ; 段数ﾘｾｯﾄ無
JMP @MR3000
MPP
ANB @MR008               ; Aﾗﾝｸﾄﾚｲ有
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
SET @MR400               ; ERR43Aﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2901
;ﾄﾚｲ未検出 / No tray
STG @MR2901
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR407               ; ERR43解除
RES @MR407               ; ERR43解除
CON
JMP @MR2902
STG @MR2902
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
ANB R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2900
MPP
AND R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2903
STG @MR2903
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
MPS
LDB @MR008               ; Aﾗﾝｸﾄﾚｲ有
ANB @MR009               ; Aﾗﾝｸﾄﾚｲ浮き
ANL
JMP @MR2600              ; 空ﾄﾚｲ在荷確認
MPP
LD @MR008                ; Aﾗﾝｸﾄﾚｲ有
OR @MR009                ; Aﾗﾝｸﾄﾚｲ浮き
ANL
SET @MR400               ; ERR43Aﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2901
;ﾜｰｸ受渡位置へ / move to tray Delivery point
STG @MR3000
AND @MR010               ; Main部一時停止ｴﾗｰ無し
TMR @41 #5
CON
AND @T41
AND R20003               ; TCa Y軸_移動可
ANB R20101               ; TCa Y軸_移動中
ANB R20102               ; TCa Y軸_移動完了
AND R21500               ; TCa Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR3001
STG @MR3001
MPS
AND R20102               ; TCa Y軸_移動完了
JMP @MR3002
MPP
MCALL POINT_MOVE1 #2 #1 DM506 R20111 R20102;RB1取出しPosition No.  TCa Y軸_位置決め異常  TCa Y軸_移動完了
STG @MR3002
RES R20102               ; TCa Y軸_移動完了
CON
ANB R20102               ; TCa Y軸_移動完了
RES @MR3900              ; 一時停止禁止
CON
MPS
AND R52905               ; ﾄﾚｲ押さえ有り
JMP @MR3003
MPP
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR3006
;受取高さへ上昇 / Up to resive position
STG @MR3003
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R21003               ; TCa Z軸_移動可
ANB R21101               ; TCa Z軸_移動中
ANB R21102               ; TCa Z軸_移動完了
SET @MR3900              ; 一時停止禁止
CON
JMP @MR3004
STG @MR3004
MPS
AND R21102               ; TCa Z軸_移動完了
JMP @MR3005
MPP
MCALL POINT_MOVE1 #2 #2 #6 R21111 R21102;TCa Z軸_位置決め異常  TCa Z軸_移動完了
STG @MR3005
RES R21102               ; TCa Z軸_移動完了
CON
ANB R21102               ; TCa Z軸_移動完了
AND R21505               ; TCa Z軸 P6 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR3006
STG @MR3006
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
AND R50001               ; 自動中
JMP @MR2200              ; TC_A　給材要求ON
MPP
AND R50002               ; 手動中
JMP @MR3801              ; STEP終了処理
;<h1/>■■■　STEP動作
LD LR41101               ; Aﾗﾝｸﾄﾚｲ]交換
ANB R50210               ; STEPｻｲｸﾙ終了
ANP R50211               ; STEP動作開始
RES R50211               ; STEP動作開始
CON
SET @MR3800
STG @MR3800
AND @MR010               ; Main部一時停止ｴﾗｰ無し
DIFU R52304              ; TC_A 取出No.ﾘｾｯﾄ2
CON
JMP @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
;・・・　ﾄﾚｲﾁｪﾝｼﾞ動作
STG @MR3801              ; STEP終了処理
AND @MR010               ; Main部一時停止ｴﾗｰ無し
SET R50210               ; STEPｻｲｸﾙ終了
CON
ENDS
;<h1/>/// ｱﾗｰﾑ処理
;ERR41
STG @MR300               ; ERR41実ﾄﾚｲ満杯
ANB R50008               ; 全体ｴﾗｰ発生
SET R50008               ; 全体ｴﾗｰ発生
CON
SET R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
CON
SET R50709               ; ERR41 
CON
JMP @MR301
MOV #41 DM400            ; 表示画面No.
STG @MR301
AND R50008               ; 全体ｴﾗｰ発生
JMP @MR302
STG @MR302
ANB R50008               ; 全体ｴﾗｰ発生
SET @MR307               ; ERR41解除
CON
ENDS
;ERR42
STG @MR308               ; ERR42空ﾄﾚｲ残少
ANB R50008               ; 全体ｴﾗｰ発生
SET R50008               ; 全体ｴﾗｰ発生
CON
SET R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
CON
SET R50710               ; ERR42
CON
JMP @MR309
MOV #42 DM400            ; 表示画面No.
STG @MR309
AND R50008               ; 全体ｴﾗｰ発生
JMP @MR310
STG @MR310
ANB R50008               ; 全体ｴﾗｰ発生
SET @MR315               ; ERR42解除
CON
ENDS
;ERR43
STG @MR400               ; ERR43Aﾗﾝｸﾄﾚｲ異常
ANB R50008               ; 全体ｴﾗｰ発生
SET R50008               ; 全体ｴﾗｰ発生
CON
SET R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
CON
SET R50711               ; ERR43 
CON
SET R210                 ; RETRY SW　目隠し解除
CON
JMP @MR401
MOV #43 DM400            ; 表示画面No.
STG @MR401
AND R50008               ; 全体ｴﾗｰ発生
JMP @MR402
STG @MR402
ANB R50008               ; 全体ｴﾗｰ発生
RES R210                 ; RETRY SW　目隠し解除
CON
SET @MR407               ; ERR43解除
CON
ENDS
;<h1/>■■■　ﾄﾚｲ取出し番号管理 / Tray Pick up No. Check
LD R52300                ; TC_A 取出No.Inc
INC DM504                ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
LD> DM504 #60            ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
LD R52301                ; TC_A 取出No.ﾘｾｯﾄ1
ANB R52903               ; 段数ﾘｾｯﾄ無
ORL
LD R52304                ; TC_A 取出No.ﾘｾｯﾄ2
ANB R52903               ; 段数ﾘｾｯﾄ無
ORL
LD R52305                ; TC_A 取出No.ﾘｾｯﾄ3
ANB R52903               ; 段数ﾘｾｯﾄ無
ORL
MPS
ANB R52903               ; 段数ﾘｾｯﾄ無
DW #0 DM504              ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
MPP
AND R52903               ; 段数ﾘｾｯﾄ無
DW #1 DM504              ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
SET R46000               ; Aﾄﾚｲﾁｪﾝｼﾞ要求
;IF DM504=0 THEN
;    DM506 =1
;    DM508 =21
;ELSE
;    DM506 = ((DM504-1)/10)+1
;    DM508 = DM504-((DM506-1)*10)+20 
;END IF
LDB R52906               ; ﾄﾚｲ移載順＝縦
NCJ #1001
;IF DM504=0 THEN
;
LD= DM504 #0             ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
NCJ #2000
;    DM506 =1
;
LD CR2002                ; 常時ON
MOV #1 DM506             ; RB1取出しPosition No.
;    DM508 =21
;
LD CR2002                ; 常時ON
MOV #21 DM508            ; TC_A RB5取出しPosition No.
;ELSE
;
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;    DM506 = ((DM504-1)/10)+1
;
LD CR2002                ; 常時ON
LDA DM504                ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L +1
CON
EXT.L
CON
DIV.L +10
CON
ADD.L +1
CON
STA DM506                ; RB1取出しPosition No.
;    DM508 = DM504-((DM506-1)*10)+20 
;
LD CR2002                ; 常時ON
LDA DM506                ; RB1取出しPosition No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +10
CON
STA.L @VM0
CON
LDA DM504                ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L @VM0
CON
ADD.L +20
CON
STA DM508                ; TC_A RB5取出しPosition No.
;END IF
LABEL #2001
LABEL #1001
;
;IF DM504=0 THEN
;  DM506 =1
;  DM508 =21
;ELSE
;  @DM1 = (DM504-1)/6
;  DM506 = DM504-(@DM1*6)
;  DM508 = @DM1+21
;END IF
LD R52906                ; ﾄﾚｲ移載順＝縦
NCJ #1000
;IF DM504=0 THEN
;
LD= DM504 #0             ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
NCJ #2002
;  DM506 =1
;
LD CR2002                ; 常時ON
MOV #1 DM506             ; RB1取出しPosition No.
;  DM508 =21
;
LD CR2002                ; 常時ON
MOV #21 DM508            ; TC_A RB5取出しPosition No.
;ELSE
;
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;  @DM1 = (DM504-1)/6
;
LD CR2002                ; 常時ON
LDA DM504                ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L +1
CON
EXT.L
CON
DIV.L +6
CON
STA @DM1                 ; 取出し段数計算
;  DM506 = DM504-(@DM1*6)
;
LD CR2002                ; 常時ON
LDA @DM1                 ; 取出し段数計算
CON
EXT
CON
MUL.L +6
CON
STA.L @VM2
CON
LDA DM504                ; TC_A ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L @VM2
CON
STA DM506                ; RB1取出しPosition No.
;  DM508 = @DM1+21
;
LD CR2002                ; 常時ON
LDA @DM1                 ; 取出し段数計算
CON
EXT
CON
ADD.L +21
CON
STA DM508                ; TC_A RB5取出しPosition No.
;END IF
LABEL #2003
LABEL #1000
;
;<h1/>/// PACK処理
LD @MR3900               ; 一時停止禁止
OUT R51112               ; ﾄﾚﾁｪﾝ_A   PACK
END
ENDH
