DEVICE:53
;MODULE:RB
;MODULE_TYPE:0
;SCRIPT_TYPE:
LD CR2008                ; 運転開始時1ｽｷｬﾝON
OR MR915                 ; ﾛｰｶﾙｸﾘｱ
ZRES @R100 @R2915
;動作MONITOR
LDB DM10807.2            ; MOVE
ANB DM10815.2            ; MOVE
INV
OUT R39900               ; RB動作中
;<h1/>RB Teaching　Dyisplay
;DATA Display
LD CR2002                ; 常時ON
MPS
LDA EM1000               ; RB1 目標値下位
CON
ADD #10
CON
STA EM2000               ; RB1_目標位置+0.1
CON
LDA EM1000               ; RB1 目標値下位
CON
SUB #10
CON
STA EM2002               ; RB1_目標位置-0.1
MPP
LD>= DM10800 EM2002      ; RB1_現在位置  RB1_目標位置-0.1
AND<= DM10800 EM2000     ; RB1_現在位置  RB1_目標位置+0.1
ANL
OUT R39910               ; RB1目標位置にいる
LD CR2002                ; 常時ON
MPS
LDA EM1008               ; RB2 目標値下位
CON
ADD #10
CON
STA EM2010               ; RB2_目標位置+0.1
CON
LDA EM1008               ; RB2 目標値下位
CON
SUB #10
CON
STA EM2012               ; RB2_目標位置-0.1
MPP
LD>= DM10808 EM2012      ; RB2_現在位置  RB2_目標位置-0.1
AND<= DM10808 EM2010     ; RB2_現在位置  RB2_目標位置+0.1
ANL
OUT R39911               ; RB2目標位置にいる
LDB LR100                ; OFF:成型部品ON:ﾌﾞｯｼｭｼｰﾙ
MPS
AND= DM50300 #6          ; Position No
MOV #1 DM50300           ; Position No
MPP
AND= DM50300 #0          ; Position No
MOV #5 DM50300           ; Position No
LD LR100                 ; OFF:成型部品ON:ﾌﾞｯｼｭｼｰﾙ
MPS
AND= DM50300 #7          ; Position No
MOV #1 DM50300           ; Position No
MPP
AND= DM50300 #0          ; Position No
MOV #6 DM50300           ; Position No
;TYPE D50300.U,D50302-D50304.L,D50406.U,D50307.U,D50312.U,DM50318.U,@DM0-@DM2.U,EM10000.L
;TYPE DM8640.U
;
;IF R44914 = ON THEN
;
;	DM50318=DM50300-1+#500 'Position Messag 表示
;	
;	'DATA表示
;	@DM0 = ((D50300-1)*6)+(D50312*54)+((DM8640-1)*130)
;	DM50302 = EM10000:(@DM0) 			'Position
;	DM50306 = EM10004:(@DM0) 			'SPEED
;	DM50307 = EM10005:(@DM0) 			'ACC/DEC
;'	D4=((D50300+@DM1-1)*6)+(D50312*600)
;	
;	RES(R44914)
;	
;END IF
LD<= DM3000 #31          ; _MainTP　表示中ﾍﾟｰｼﾞNo
AND>= DM3000 #30         ; _MainTP　表示中ﾍﾟｰｼﾞNo
NCJ #1002
;TYPE D50300.U,D50302-D50304.L,D50406.U,D50307.U,D50312.U,DM50318.U,@DM0-@DM2.U,EM10000.L
;
;TYPE DM8640.U
;
;IF R44914 = ON THEN
;
LD R44914
NCJ #2000
;	DM50318=DM50300-1+#500 'Position Messag 表示
;
LD CR2002                ; 常時ON
LDA DM50300              ; Position No
CON
EXT
CON
SUB.L +1
CON
ADD.L +500
CON
STA DM50318
;	'DATA表示
;
;	@DM0 = ((D50300-1)*6)+(D50312*54)+((DM8640-1)*130)
;
LD CR2002                ; 常時ON
LDA DM8640               ; _TP選択中機種ｺｰﾄﾞ
CON
EXT
CON
SUB.L +1
CON
MUL.L +130
CON
STA.L @VM0
CON
LDA DM50312              ; RB選択
CON
EXT
CON
MUL.L +54
CON
STA.L @VM2
CON
LDA DM50300              ; Position No
CON
EXT
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM2
CON
ADD.L @VM0
CON
STA @DM0
;	DM50302 = EM10000:(@DM0) 			'Position
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
MOV.L EM10000:Z12 DM50302; RB1目標値（下位）1  RB Position Low
;	DM50306 = EM10004:(@DM0) 			'SPEED
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
MOV EM10004:Z12 DM50306  ; RB1速度1  RB SPEED
;	DM50307 = EM10005:(@DM0) 			'ACC/DEC
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
MOV EM10005:Z12 DM50307  ; RB1加減速1  RB Acc/Dec
;'	D4=((D50300+@DM1-1)*6)+(D50312*600)
;
;	RES(R44914)
;
LD CR2002                ; 常時ON
RES R44914
;END IF
LABEL #2000
LABEL #1002
;
LDP R44915               ; Teaching End
BMOV EM10000 ZF470 #1300 ; RB1目標値（下位）1  RBPOSﾃﾞｰﾀ
SET @R2505
STG @R2505
TMR @10 #5
CON
AND @T10
ENDS
;DATA Write
;TYPE DM50300.U,DM50302.D,DM50312.U,@DM0.U,DM50320.L,DM10500.L
;TYPE EM10000.D,DM10800.D,DM10808.D
;TYPE DM50306.U,DM50307.U
;'現在値 表示
;DM50320 = DM10800:((DM50312+1)*8) 'Now Position
;
;'JOGDATA 格納
;	@DM0 = ((DM50300-1)*6)+(DM50312*54)+((DM8640-1)*130)
;IF DM50312 = 0 THEN
;	EM10000:(@DM0) = DM10800	'Position
;ELSE
;	EM10000:(@DM0) = DM10808	'Position
;END IF
;
;	EM10004:(@DM0) = DM50306	'SPEED
;    EM10005:(@DM0) = DM50307	'ACC/DEC
;    DM50302 = EM10000:(@DM0)	'表示値変更
LD<= DM3000 #31          ; _MainTP　表示中ﾍﾟｰｼﾞNo
AND>= DM3000 #30         ; _MainTP　表示中ﾍﾟｰｼﾞNo
ANP R34001               ; Teaching SW
NCJ #1004
;TYPE DM50300.U,DM50302.D,DM50312.U,@DM0.U,DM50320.L,DM10500.L
;
;TYPE EM10000.D,DM10800.D,DM10808.D
;
;TYPE DM50306.U,DM50307.U
;
;'現在値 表示
;
;DM50320 = DM10800:((DM50312+1)*8) 'Now Position
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
ADD.L +1
CON
MUL.L +8
CON
STA.L Z12
CON
MOV.L DM10800:Z12 DM50320; RB1_現在位置  RB NowPosition
;'JOGDATA 格納
;
;	@DM0 = ((DM50300-1)*6)+(DM50312*54)+((DM8640-1)*130)
;
LD CR2002                ; 常時ON
LDA DM8640               ; _TP選択中機種ｺｰﾄﾞ
CON
EXT
CON
SUB.L +1
CON
MUL.L +130
CON
STA.L @VM4
CON
LDA DM50312              ; RB選択
CON
EXT
CON
MUL.L +54
CON
STA.L @VM6
CON
LDA DM50300              ; Position No
CON
EXT
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM6
CON
ADD.L @VM4
CON
STA @DM0
;IF DM50312 = 0 THEN
;
LD= DM50312 #0           ; RB選択
NCJ #2001
;	EM10000:(@DM0) = DM10800	'Position
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
MOV.D DM10800 EM10000:Z11; RB1_現在位置  RB1目標値（下位）1
;ELSE
;
LD CR2002                ; 常時ON
CJ #2002
LABEL #2001
;	EM10000:(@DM0) = DM10808	'Position
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
MOV.D DM10808 EM10000:Z11; RB2_現在位置  RB1目標値（下位）1
;END IF
;
LABEL #2002
;	EM10004:(@DM0) = DM50306	'SPEED
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
MOV DM50306 EM10004:Z11  ; RB SPEED  RB1速度1
;    EM10005:(@DM0) = DM50307	'ACC/DEC
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
MOV DM50307 EM10005:Z11  ; RB Acc/Dec  RB1加減速1
;    DM50302 = EM10000:(@DM0)	'表示値変更
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
MOV.D EM10000:Z12 DM50302; RB1目標値（下位）1  RB Position Low
LABEL #1004
;
;TYPE DM50300.U,DM50302.D,DM50312.U,@DM0.U,DM50320.L,DM10500.L
;TYPE EM10000.D
;'現在値 表示
;DM50320 = DM10800:((D50312+1)*8) 'Now Position
;
;'POSDATA 格納
;	@DM0 = ((D50300-1)*6)+(D50312*54)+((DM8640-1)*130)
;	EM10000:(@DM0) = DM50302	'Position
;	EM10004:(@DM0) = DM50306	'SPEED
;    EM10005:(@DM0) = DM50307	'ACC/DEC
;
;RES(R34002)
LD<= DM3000 #31          ; _MainTP　表示中ﾍﾟｰｼﾞNo
AND>= DM3000 #30         ; _MainTP　表示中ﾍﾟｰｼﾞNo
ANP R34002               ; direct Teach T.P
NCJ #1007
;TYPE DM50300.U,DM50302.D,DM50312.U,@DM0.U,DM50320.L,DM10500.L
;
;TYPE EM10000.D
;
;'現在値 表示
;
;DM50320 = DM10800:((D50312+1)*8) 'Now Position
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
ADD.L +1
CON
MUL.L +8
CON
STA.L Z12
CON
LDA DM10800:Z12          ; RB1_現在位置
CON
EXT
CON
STA.L DM50320            ; RB NowPosition
;'POSDATA 格納
;
;	@DM0 = ((D50300-1)*6)+(D50312*54)+((DM8640-1)*130)
;
LD CR2002                ; 常時ON
LDA DM8640               ; _TP選択中機種ｺｰﾄﾞ
CON
EXT
CON
SUB.L +1
CON
MUL.L +130
CON
STA.L @VM8
CON
LDA DM50312              ; RB選択
CON
EXT
CON
MUL.L +54
CON
STA.L @VM10
CON
LDA DM50300              ; Position No
CON
EXT
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM10
CON
ADD.L @VM8
CON
STA @DM0
;	EM10000:(@DM0) = DM50302	'Position
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
MOV.D DM50302 EM10000:Z11; RB Position Low  RB1目標値（下位）1
;	EM10004:(@DM0) = DM50306	'SPEED
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
MOV DM50306 EM10004:Z11  ; RB SPEED  RB1速度1
;    EM10005:(@DM0) = DM50307	'ACC/DEC
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
MOV DM50307 EM10005:Z11  ; RB Acc/Dec  RB1加減速1
;RES(R34002)
LD CR2002                ; 常時ON
RES R34002               ; direct Teach T.P
LABEL #1007
;
;<h1/>Panel Control
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
MUL #16
CON
STA Z3
CON
LDA DM50312              ; RB選択
CON
MUL #8
CON
STA Z4
CON
LDA DM50312              ; RB選択
CON
MUL #2
CON
STA Z5
;Teaching MOVE
BLD DM50314 #0
MEP
ANB R35002:Z3            ; During RB1 MOVE 
LDA DM50300              ; Position No
CON
STA EM1200:Z5            ; RB1Target Pos
CON
SET R35000:Z3            ; RB1 MOVE
CON
SET @R2500
STG @R2500
AND R35001:Z3            ; RB1 MOVE END
RES R35001:Z3            ; RB1 MOVE END
CON
ENDS
;Teaching MOVE Lamp
BLDB DM10807:Z4 #2       ; RB1_状態信号
OUT MR23002              ; RB1_ｲﾝﾀｰﾛｯｸ中
;Teaching HOME
BLD DM50314 #1
MEP
ANB R35010:Z3            ; During RB1 HOME
SET R35008:Z3            ; RB1 HOME
CON
SET @MR2502
STG @MR2502
AND R35009:Z3            ; RB1 HOME END
RES R35009:Z3            ; RB1 HOME END
CON
ENDS
;Teaching HOME Lamp
BLD DM10807:Z4 #1        ; RB1_状態信号
OUT MR23005              ; Teaching HOME Lamp
;JOG/INC
LD<> DM50314 #0
LDA DM50312              ; RB選択
CON
MUL #8
CON
STA Z4
;Servo ON
BLD DM50314 #4
MEP
MPS
BAND DM10807:Z4 #4       ; RB1_状態信号
OUT @R2504
CON
BRES DM11007:Z4 #4       ; RB1_制御信号
MPP
BLDB DM10807:Z4 #4       ; RB1_状態信号
ANB @R2504
ANL
BSET DM11007:Z4 #4       ; RB1_制御信号
;Servo ON Lamp
BLD DM10807:Z4 #4        ; RB1_状態信号
OUT MR23000              ; Servo ON Lamp
;Alarm Code
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
MUL #8
CON
STA DM50330
LDP R34003               ; ｴﾗｰ表示SW_1
LDA DM10806              ; RB1_ｱﾗｰﾑｺｰﾄﾞ
CON
ADD #1000
CON
STA DM50310              ; Alarm Code
LDP R34004               ; ｴﾗｰ表示SW_2
LDA DM10814              ; RB2_ｱﾗｰﾑｺｰﾄﾞ
CON
ADD #1000
CON
STA DM50310              ; Alarm Code
;Alarm RESET
BLD DM50314 #3
OR R40001                ; ｴﾗｰﾘｾｯﾄSW
BSET DM11007 #3          ; RB1_制御信号
BLDB DM50314 #3
ANB R40001               ; ｴﾗｰﾘｾｯﾄSW
BRES DM11007 #3          ; RB1_制御信号
BLD DM50314 #3
OR R40001                ; ｴﾗｰﾘｾｯﾄSW
BSET DM11015 #3          ; RB2_制御信号
BLDB DM50314 #3
ANB R40001               ; ｴﾗｰﾘｾｯﾄSW
BRES DM11015 #3          ; RB2_制御信号
;Alarm RESET Lamp
BLD DM10807:Z4 #3        ; RB1_状態信号
OUT MR23001              ; Alarm RESET Lamp
;Brake Release
BLD DM50314 #15
MEP
MPS
BAND DM10807:Z4 #15      ; RB1_状態信号
OUT @MR2505
CON
BRES DM11007:Z4 #15      ; RB1_制御信号
MPP
BLDB DM10807:Z4 #15      ; RB1_状態信号
ANB @MR2505
ANL
BSET DM11007:Z4 #15      ; RB1_制御信号
;Brake Release Lamp
BLD DM10807:Z4 #15       ; RB1_状態信号
OUT MR23003              ; Brake Release Lamp
;<h1/>ｼﾞｮｸﾞ/ｲﾝﾁﾝｸﾞ出力
LDB B2001                ; ﾒｲﾝより非常停止
RES MR14705              ; T3_JISL_JOG/INC_切替
CON
RES MR14706              ; T3_JVEL_Lo/Hi_切替
CON
RES MR14707              ; T3_-JOG(-INC)指令
CON
RES MR14708              ; T3_+JOG(+INC)指令
LD B2001                 ; ﾒｲﾝより非常停止
OR CR2002                ; 常時ON
MC
;RB1_搬送
; #5:JISL_ｼﾞｮｸﾞ/ｲﾝﾁﾝｸﾞ切替え #6:JVEL_ｼﾞｮｸﾞ速度/ｲﾝﾁﾝｸﾞ距離切替え #7:JOG-_-ｼﾞｮｸﾞ #8:JOG+_+ｼﾞｮｸﾞ
LD= DM50312 #0           ; RB選択
MPS
AND DM50314.5            ; JISL
OUT DM11007.5            ; PCON1_JISL
MRD
AND DM50314.6            ; JVEL
OUT DM11007.6            ; PCON1_JVEL
MRD
AND DM50314.7            ; JOG−
OUT DM11007.7            ; PCON1_JOG−
MPP
AND DM50314.8            ; JOG＋
OUT DM11007.8            ; PCON1_JOG＋
;RB2_搬送
; #5:JISL_ｼﾞｮｸﾞ/ｲﾝﾁﾝｸﾞ切替え #6:JVEL_ｼﾞｮｸﾞ速度/ｲﾝﾁﾝｸﾞ距離切替え #7:JOG-_-ｼﾞｮｸﾞ #8:JOG+_+ｼﾞｮｸﾞ
LD= DM50312 #1           ; RB選択
MPS
AND DM50314.5            ; JISL
OUT DM11015.5            ; PCON2_JISL
MRD
AND DM50314.6            ; JVEL
OUT DM11015.6            ; PCON2_JVEL
MRD
AND DM50314.7            ; JOG−
OUT DM11015.7            ; PCON2_JOG−
MPP
AND DM50314.8            ; JOG＋
OUT DM11015.8            ; PCON2_JOG＋
MCR
;<h1/>RB1移動
STG R35000               ; RB1 MOVE
SET R35002               ; During RB1 MOVE 
CON
JMP @R100
STG @R100
AND @R101
DW #0 @DM10
CON
JMP @R102
;TYPE EM1000.U,EM1004.U,EM1200.U,EM10000.U   
;BMOV(EM10000:(((EM1200-1)*6)+((DM8640-1)*130)),EM1000,#6)	'指定されたPOSをEM1000へ格納
;
;IF MR3103 = ON THEN		'速度変更
;	IF EM1200 = 1 THEN	'ｾｯﾄ位置速度を変更
;		EM1004 = 50
;	END IF	
;	
;	IF EM1200 = 3 THEN	'ｴｱﾌﾞﾛｰ行き速度を変更
;		EM1004 = DM5010.U
;	END IF
;
;	IF EM1200 = 4 THEN	'ｴｱﾌﾞﾛｰ戻り速度を変更
;		EM1004 = DM5012.U
;	END IF
;END IF
;
;SET (@R101)
LD @R100
NCJ #1005
;TYPE EM1000.U,EM1004.U,EM1200.U,EM10000.U   
;
;BMOV(EM10000:(((EM1200-1)*6)+((DM8640-1)*130)),EM1000,#6)	'指定されたPOSをEM1000へ格納
;
LD CR2002                ; 常時ON
LDA DM8640               ; _TP選択中機種ｺｰﾄﾞ
CON
EXT
CON
SUB.L +1
CON
MUL.L +130
CON
STA.L @VM12
CON
LDA EM1200               ; RB1Target Pos
CON
EXT
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM12
CON
STA.L Z12
BMOV EM10000:Z12 EM1000 #6;RB1目標値（下位）1  RB1 目標値下位
;IF MR3103 = ON THEN		'速度変更
;
LD MR3103                ; Unit1_速度変更FLG
NCJ #2003
;	IF EM1200 = 1 THEN	'ｾｯﾄ位置速度を変更
;
LD= EM1200 #1            ; RB1Target Pos
NCJ #2004
;		EM1004 = 50
;
LD CR2002                ; 常時ON
MOV #50 EM1004           ; RB1 速度
;	END IF	
;
LABEL #2004
;	IF EM1200 = 3 THEN	'ｴｱﾌﾞﾛｰ行き速度を変更
;
LD= EM1200 #3            ; RB1Target Pos
NCJ #2005
;		EM1004 = DM5010.U
;
LD CR2002                ; 常時ON
MOV DM5010 EM1004        ; ｴｱﾌﾞﾛｰ行き速度設定値  RB1 速度
;	END IF
;
LABEL #2005
;	IF EM1200 = 4 THEN	'ｴｱﾌﾞﾛｰ戻り速度を変更
;
LD= EM1200 #4            ; RB1Target Pos
NCJ #2006
;		EM1004 = DM5012.U
;
LD CR2002                ; 常時ON
MOV DM5012 EM1004        ; ｴｱﾌﾞﾛｰ戻り速度設定値  RB1 速度
;	END IF
;
LABEL #2006
;END IF
;
LABEL #2003
;SET (@R101)
LD CR2002                ; 常時ON
SET @R101
LABEL #1005
;
STG @R102
MPS
RES @R101
CON
MSTRT CON_MOVE EM1000 EM1004 EM1005 DM10800 DM11000 @DM10;RB1 目標値下位  RB1 速度  RB1 G  RB1_現在位置  RB1_目標位置
MRD
AND= @DM10 #20
LDA EM1200               ; RB1Target Pos
CON
STA EM1300               ; RB1現在POS
CON
JMP @R103
MPP
LD<> @DM10 #20
AND<> @DM10 #0
ANL
SET R35003               ; RB1 Alarm
CON
JMP @R103
STG @R103
RES R35002               ; During RB1 MOVE 
CON
SET R35001               ; RB1 MOVE END
CON
ENDS
;RB1 PUSH
STG R35004               ; RB1 PUSH
SET R35006               ; During RB1 PUSH 
CON
JMP @R104
STG @R104
AND @R105
DW #0 @DM11
CON
JMP @R106
;TYPE EM1000.U,EM1200.U,EM10000.U   
;'BMOV(EM10000:((EM1200-1)*6),EM1000,#6)	'指定されたPOSをEM1000へ格納
;BMOV(EM10000:(((EM1200-1)*6)+((DM8640-1)*130)),EM1000,#6)
;SET (@R105)
LD @R104
NCJ #1000
;TYPE EM1000.U,EM1200.U,EM10000.U   
;
;'BMOV(EM10000:((EM1200-1)*6),EM1000,#6)	'指定されたPOSをEM1000へ格納
;
;BMOV(EM10000:(((EM1200-1)*6)+((DM8640-1)*130)),EM1000,#6)
;
LD CR2002                ; 常時ON
LDA DM8640               ; _TP選択中機種ｺｰﾄﾞ
CON
EXT
CON
SUB.L +1
CON
MUL.L +130
CON
STA.L @VM14
CON
LDA EM1200               ; RB1Target Pos
CON
EXT
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM14
CON
STA.L Z12
BMOV EM10000:Z12 EM1000 #6;RB1目標値（下位）1  RB1 目標値下位
;SET (@R105)
LD CR2002                ; 常時ON
SET @R105
LABEL #1000
;
;PUSH ﾏｸﾛは2種類準備しています（任意で選択して下さい）
;CON_PUSH	押付け動作用
;CON_WD_PUSH	溶着向け動作用
;
;注1)速度(SPEED)はPUSH開始位置へ移動するまでの速度。
;注2)押付け動作中速度はRBﾊﾟﾗﾒｰﾀにて設定してください。
;注3)スクリプトでPush Wideが更新される為、PUSHモードの際はマクロ直前で任意更新してください。(単位:0.01mm)
;	この値が押付け幅となります。
;注4)PUSH動作には電流値も必要です。
;	※押付け電流制限値（単位：%）
;	0〜100％　※RCP4はMAX70％まで
;	MAXを超えた値を入力するとｴﾗｰとなります。
;	→ｺﾝﾄﾛｰﾗへは0〜255で入力
;注5)WD_PUSHマクロは、Break offが入力されると位置情報(PUSH_Result)が格納され開始位置に戻り終了となります。
;
;Push_Result一時保管ﾃﾞﾊﾞｲｽ	@DM100〜@DM138(2ﾜｰﾄﾞ)
STG @R106
RES @R105
CON
MPS
LDA.D #1000
CON
STA.D EM1002             ; RB1 位置決め幅下位
MRD
LDA #70
CON
MUL #25500
CON
DIV #10000
CON
STA EM1006               ; RB1 押付け電流値(0〜255)
MRD
AND CR2002               ; 常時ON
MSTRT CON_PUSH EM1000 EM1002 EM1004 EM1005 EM1006 DM10800 DM11000 @DM11;RB1 目標値下位  RB1 位置決め幅下位  RB1 速度  RB1 G  RB1 押付け電流値(0〜255)  RB1_現在位置  RB1_目標位置
MRD
AND CR2003               ; 常時OFF
MSTRT CON_WD_PUSH EM1000 EM1002 EM1004 EM1005 EM1006 DM10800 DM11000 @DM11 @R000 @DM100;RB1 目標値下位  RB1 位置決め幅下位  RB1 速度  RB1 G  RB1 押付け電流値(0〜255)  RB1_現在位置  RB1_目標位置  RB1_Push_Result
MRD
AND= @DM11 #20
JMP @R107
MPP
LD<> @DM11 #20
AND<> @DM11 #0
ANL
SET R35003               ; RB1 Alarm
CON
JMP @R107
STG @R107
RES R35006               ; During RB1 PUSH 
CON
SET R35005               ; RB1 PUSH END
CON
ENDS
;RB1 HOME
STG R35008               ; RB1 HOME
DW #0 @DM12
CON
SET R35010               ; During RB1 HOME
CON
JMP @R108
;原点復帰ﾏｸﾛは2種類準備しています（任意で選択して下さい）
;CON_HOME	通常用
;CON_HOME2	原点確認仕様用
;			→原点ｾﾝｻｰをSensor_INに指定してください。ｾﾝｻｰはA接点を想定しています。
;			#20	=	正常終了
;			#21	=	RB応答なし
;			#22	=	ｽﾃｰﾀｽ異常
;			#25	=	原点異常
;			#26	=	原点ｾﾝｻｰ異常
STG @R108
MPS
AND CR2002               ; 常時ON
MSTRT CON_HOME DM10800 DM11000 @DM12;RB1_現在位置  RB1_目標位置
MRD
AND CR2003               ; 常時OFF
MSTRT CON_HOME2 DM10800 DM11000 @DM12 @R000;RB1_現在位置  RB1_目標位置
MRD
AND= @DM12 #20
DW #0 EM1200             ; RB1Target Pos
CON
DW #0 EM1300             ; RB1現在POS
CON
JMP @R109
MPP
LD<> @DM12 #20
AND<> @DM12 #0
ANL
SET R35003               ; RB1 Alarm
CON
JMP @R109
STG @R109
DW #0 EM1200             ; RB1Target Pos
CON
SET R35009               ; RB1 HOME END
CON
RES R35010               ; During RB1 HOME
CON
ENDS
;<h1/>RB2移動
STG R35100               ; RB2 MOVE
SET R35102               ; During RB2 MOVE
CON
JMP @R200
STG @R200
AND @R201
DW #0 @DM13
CON
JMP @R202
;TYPE EM1008.U,EM1012.U,EM1202.U,EM10600.U   
;BMOV(EM10054:(((EM1202-1)*6)+((DM8640-1)*130)),EM1008,#6)	'指定されたPOSをEM1008へ格納
;	
;IF MR3203 = ON THEN		'速度変更
;	IF EM1202 = 1 THEN	'ｾｯﾄ位置速度を変更
;		EM1012 = 50
;	END IF
;	
;	IF EM1202 = 3 THEN	'ｴｱﾌﾞﾛｰ行き速度を変更
;		EM1012 = DM5010.U
;	END IF
;
;	IF EM1202 = 4 THEN	'ｴｱﾌﾞﾛｰ戻り速度を変更
;		EM1012 = DM5012.U
;	END IF
;END IF
;
;SET (@R201)
;
LD @R200
NCJ #1001
;TYPE EM1008.U,EM1012.U,EM1202.U,EM10600.U   
;
;BMOV(EM10054:(((EM1202-1)*6)+((DM8640-1)*130)),EM1008,#6)	'指定されたPOSをEM1008へ格納
;
LD CR2002                ; 常時ON
LDA DM8640               ; _TP選択中機種ｺｰﾄﾞ
CON
EXT
CON
SUB.L +1
CON
MUL.L +130
CON
STA.L @VM16
CON
LDA EM1202               ; RB2Target Pos
CON
EXT
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM16
CON
STA.L Z12
BMOV EM10054:Z12 EM1008 #6;RB2目標値（下位）1  RB2 目標値下位
;IF MR3203 = ON THEN		'速度変更
;
LD MR3203                ; Unit2_速度変更FLG
NCJ #2007
;	IF EM1202 = 1 THEN	'ｾｯﾄ位置速度を変更
;
LD= EM1202 #1            ; RB2Target Pos
NCJ #2008
;		EM1012 = 50
;
LD CR2002                ; 常時ON
MOV #50 EM1012           ; RB2 速度
;	END IF
;
LABEL #2008
;	IF EM1202 = 3 THEN	'ｴｱﾌﾞﾛｰ行き速度を変更
;
LD= EM1202 #3            ; RB2Target Pos
NCJ #2009
;		EM1012 = DM5010.U
;
LD CR2002                ; 常時ON
MOV DM5010 EM1012        ; ｴｱﾌﾞﾛｰ行き速度設定値  RB2 速度
;	END IF
;
LABEL #2009
;	IF EM1202 = 4 THEN	'ｴｱﾌﾞﾛｰ戻り速度を変更
;
LD= EM1202 #4            ; RB2Target Pos
NCJ #2010
;		EM1012 = DM5012.U
;
LD CR2002                ; 常時ON
MOV DM5012 EM1012        ; ｴｱﾌﾞﾛｰ戻り速度設定値  RB2 速度
;	END IF
;
LABEL #2010
;END IF
;
LABEL #2007
;SET (@R201)
;
LD CR2002                ; 常時ON
SET @R201
LABEL #1001
;
STG @R202
MPS
RES @R201
CON
MSTRT CON_MOVE EM1008 EM1012 EM1013 DM10808 DM11008 @DM13;RB2 目標値下位  RB2 速度  RB2 G  RB2_現在位置  RB2_目標位置
MRD
AND= @DM13 #20
LDA EM1202               ; RB2Target Pos
CON
STA EM1302               ; RB2現在POS
CON
JMP @R203
MPP
LD<> @DM13 #20
AND<> @DM13 #0
ANL
SET R35103               ; RB2 Alarm
CON
JMP @R203
STG @R203
RES R35102               ; During RB2 MOVE
CON
SET R35101               ; RB2 MOVE END
CON
ENDS
;RB2 PUSH
STG R35104               ; RB2 PUSH
SET R35106               ; During RB2 PUSH
CON
JMP @R204
STG @R204
AND @R205
DW #0 @DM14
CON
JMP @R206
;TYPE EM1008.U,EM1202.U,EM10600.U   
;'BMOV(EM10600:((EM1202-1)*6),EM1008,#6)	'指定されたPOSをEM1008へ格納
;BMOV(EM10054:(((EM1202-1)*6)+((DM8640-1)*130)),EM1008,#6)
;SET (@R205)
LD @R204
NCJ #1023
;TYPE EM1008.U,EM1202.U,EM10600.U   
;
;'BMOV(EM10600:((EM1202-1)*6),EM1008,#6)	'指定されたPOSをEM1008へ格納
;
;BMOV(EM10054:(((EM1202-1)*6)+((DM8640-1)*130)),EM1008,#6)
;
LD CR2002                ; 常時ON
LDA DM8640               ; _TP選択中機種ｺｰﾄﾞ
CON
EXT
CON
SUB.L +1
CON
MUL.L +130
CON
STA.L @VM18
CON
LDA EM1202               ; RB2Target Pos
CON
EXT
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM18
CON
STA.L Z12
BMOV EM10054:Z12 EM1008 #6;RB2目標値（下位）1  RB2 目標値下位
;SET (@R205)
LD CR2002                ; 常時ON
SET @R205
LABEL #1023
;
STG @R206
RES @R205
CON
MPS
LDA.D #1000
CON
STA.D EM1010             ; RB2 位置決め幅下位
MRD
LDA #70
CON
MUL #25500
CON
DIV #10000
CON
STA EM1014               ; RB2 押付け電流値(0〜255)
MRD
MSTRT CON_PUSH EM1008 EM1010 EM1012 EM1013 EM1014 DM10808 DM11008 @DM14;RB2 目標値下位  RB2 位置決め幅下位  RB2 速度  RB2 G  RB2 押付け電流値(0〜255)  RB2_現在位置  RB2_目標位置
MRD
AND= @DM14 #20
JMP @R207
MPP
LD<> @DM14 #20
AND<> @DM14 #0
ANL
SET R35103               ; RB2 Alarm
CON
JMP @R207
STG @R207
RES R35106               ; During RB2 PUSH
CON
SET R35105               ; RB2 PUSH END
CON
ENDS
;RB2 HOME
STG R35108               ; RB2 HOME
DW #0 @DM15
CON
SET R35110               ; During RB2 HOME
CON
JMP @R208
STG @R208
MSTRT CON_HOME DM10808 DM11008 @DM15;RB2_現在位置  RB2_目標位置
MPS
AND= @DM15 #20
JMP @R209
MPP
LD<> @DM15 #20
AND<> @DM15 #0
ANL
SET R35103               ; RB2 Alarm
CON
JMP @R209
STG @R209
SET R35109               ; RB2 HOME END
CON
RES R35110               ; During RB2 HOME
CON
ENDS
END
ENDH
