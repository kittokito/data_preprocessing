DEVICE:53
;MODULE:Sensor
;MODULE_TYPE:0
;OneSystem UserOpen-Module
;
;-----------------------------------------
;ModuleName	:	SENSOR
;ModuleType	:	User Open Module
;Function	:	SENSOR Monitor
;-----------------------------------------
;*1送信毎に送信ﾌｧｲﾙ削除
;Copylight(C) 2011 SEIKO EPSON Corp. All rights reserved.
;<h1/>TASK 0　ｼﾘﾝﾀﾞｰ ｾﾝｻｰ監視
;
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46102                ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB R46200               ; _安全ｶﾊﾞｰ1開中
ANB R39004               ; ｴﾗｰ中
ANB R59915               ; _運転ﾓｰﾄﾞ指定
MC
;TASK0
LD MR7200                ; ﾜｰｸｸﾗﾝﾌﾟ下降
ANB MR7201               ; ﾜｰｸｸﾗﾝﾌﾟ上昇
LDB R4002                ; ﾜｰｸｸﾗﾝﾌﾟ手前側 下降端
OR R4003                 ; ﾜｰｸｸﾗﾝﾌﾟ手前側 上昇端
ANL
TMR @0 #20
CON
AND @T0
DW #4002 DM60009         ; Sensor ERROR No.
CON
SET MR4002               ; ﾜｰｸｸﾗﾝﾌﾟ手前側 下降端ERR
LDB MR7200               ; ﾜｰｸｸﾗﾝﾌﾟ下降
AND MR7201               ; ﾜｰｸｸﾗﾝﾌﾟ上昇
LD R4002                 ; ﾜｰｸｸﾗﾝﾌﾟ手前側 下降端
ORB R4003                ; ﾜｰｸｸﾗﾝﾌﾟ手前側 上昇端
ANL
TMR @1 #20
CON
AND @T1
DW #4003 DM60009         ; Sensor ERROR No.
CON
SET MR4003               ; ﾜｰｸｸﾗﾝﾌﾟ手前側 上昇端ERR
LD MR7200                ; ﾜｰｸｸﾗﾝﾌﾟ下降
ANB MR7201               ; ﾜｰｸｸﾗﾝﾌﾟ上昇
LDB R4004                ; ﾜｰｸｸﾗﾝﾌﾟ奥側 下降端
OR R4005                 ; ﾜｰｸｸﾗﾝﾌﾟ奥側 上昇端
ANL
TMR @2 #20
CON
AND @T2
DW #4004 DM60009         ; Sensor ERROR No.
CON
SET MR4004               ; ﾜｰｸｸﾗﾝﾌﾟ奥側 下降端ERR
LDB MR7200               ; ﾜｰｸｸﾗﾝﾌﾟ下降
AND MR7201               ; ﾜｰｸｸﾗﾝﾌﾟ上昇
LD R4004                 ; ﾜｰｸｸﾗﾝﾌﾟ奥側 下降端
ORB R4005                ; ﾜｰｸｸﾗﾝﾌﾟ奥側 上昇端
ANL
TMR @3 #20
CON
AND @T3
DW #4005 DM60009         ; Sensor ERROR No.
CON
SET MR4005               ; ﾜｰｸｸﾗﾝﾌﾟ奥側 上昇端ERR
LD MR7202                ; ﾜｰｸｸﾗﾝﾌﾟ前進
ANB MR7203               ; ﾜｰｸｸﾗﾝﾌﾟ後退
LDB R4006                ; ﾜｰｸｸﾗﾝﾌﾟ手前側 前進端
OR R4007                 ; ﾜｰｸｸﾗﾝﾌﾟ手前側 後退端
ANL
TMR @4 #20
CON
AND @T4
DW #4006 DM60009         ; Sensor ERROR No.
CON
SET MR4006               ; ﾜｰｸｸﾗﾝﾌﾟ手前側 前進端ERR
LDB MR7202               ; ﾜｰｸｸﾗﾝﾌﾟ前進
AND MR7203               ; ﾜｰｸｸﾗﾝﾌﾟ後退
LD R4006                 ; ﾜｰｸｸﾗﾝﾌﾟ手前側 前進端
ORB R4007                ; ﾜｰｸｸﾗﾝﾌﾟ手前側 後退端
ANL
TMR @5 #20
CON
AND @T5
DW #4007 DM60009         ; Sensor ERROR No.
CON
SET MR4007               ; ﾜｰｸｸﾗﾝﾌﾟ手前側 後退端ERR
LD MR7202                ; ﾜｰｸｸﾗﾝﾌﾟ前進
ANB MR7203               ; ﾜｰｸｸﾗﾝﾌﾟ後退
LDB R4008                ; ﾜｰｸｸﾗﾝﾌﾟ奥側 前進端
OR R4009                 ; ﾜｰｸｸﾗﾝﾌﾟ奥側 後退端
ANL
TMR @6 #20
CON
AND @T6
DW #4008 DM60009         ; Sensor ERROR No.
CON
SET MR4008               ; ﾜｰｸｸﾗﾝﾌﾟ奥側 前進端ERR
LDB MR7202               ; ﾜｰｸｸﾗﾝﾌﾟ前進
AND MR7203               ; ﾜｰｸｸﾗﾝﾌﾟ後退
LD R4008                 ; ﾜｰｸｸﾗﾝﾌﾟ奥側 前進端
ORB R4009                ; ﾜｰｸｸﾗﾝﾌﾟ奥側 後退端
ANL
TMR @7 #20
CON
AND @T7
DW #4009 DM60009         ; Sensor ERROR No.
CON
SET MR4009               ; ﾜｰｸｸﾗﾝﾌﾟ奥側 後退端ERR
;TASK1
LD MR7204                ; 接触式ｾﾝｻ下降
ANB MR7205               ; 接触式ｾﾝｻ上昇
LDB R4010                ; 接触式ｾﾝｻ 下降端
OR R4011                 ; 接触式ｾﾝｻ 上昇端
ANL
TMR @8 #20
CON
AND @T8
DW #4010 DM60009         ; Sensor ERROR No.
CON
SET MR4010               ; 接触式ｾﾝｻ 下降端ERR
LDB MR7204               ; 接触式ｾﾝｻ下降
AND MR7205               ; 接触式ｾﾝｻ上昇
LD R4010                 ; 接触式ｾﾝｻ 下降端
ORB R4011                ; 接触式ｾﾝｻ 上昇端
ANL
TMR @9 #20
CON
AND @T9
DW #4011 DM60009         ; Sensor ERROR No.
CON
SET MR4011               ; 接触式ｾﾝｻ 上昇端ERR
MCR
;TASK0 Sensor ERROR
LD>= DM60009 #4002       ; Sensor ERROR No.
AND<= DM60009 #4009      ; Sensor ERROR No.
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #0 @DM0               ; TaskNo /ERROR_DISP
CON
DW #0 @DM1               ; ErrorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2                 ; SensorNo /ERROR_DISP
CON
SET @R100                ; Task0 ERROR
CON
SET @R000
STG @R000
AND @R101                ; Task0 ERROR_End
RES @R101                ; Task0 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
ZRES MR4002 MR4009       ; ﾜｰｸｸﾗﾝﾌﾟ手前側 下降端ERR  ﾜｰｸｸﾗﾝﾌﾟ奥側 後退端ERR
CON
DW #0 DM60009            ; Sensor ERROR No.
CON
ENDS
;TASK1 Sensor ERROR
LD>= DM60009 #4010       ; Sensor ERROR No.
AND<= DM60009 #4011      ; Sensor ERROR No.
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #1 @DM0               ; TaskNo /ERROR_DISP
CON
DW #0 @DM1               ; ErrorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2                 ; SensorNo /ERROR_DISP
CON
SET @R100                ; Task0 ERROR
CON
SET @R001
STG @R001
AND @R101                ; Task0 ERROR_End
RES @R101                ; Task0 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
ZRES MR4010 MR4011       ; 接触式ｾﾝｻ 下降端ERR  接触式ｾﾝｻ 上昇端ERR
CON
DW #0 DM60009            ; Sensor ERROR No.
CON
ENDS
;MyTask Error Process Substance/エラー処理実体
STG @R100                ; Task0 ERROR
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @R105 @R108         ; SW1  SW4
CON
DISN @DM9 @DM3 #4        ; ReturnSW /ERROR_DISP
MRD
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP  TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @R102                ; Task0 ERROR Busy
CON
JMP @R103
STG @R103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP  ErrorNo /ERROR_DISP
JMP @R104
STG @R104
ANB R39002               ; ERROR_DISP Busy
RES @R102                ; Task0 ERROR Busy
CON
SET @R101                ; Task0 ERROR_End
CON
ENDS
END
ENDH
