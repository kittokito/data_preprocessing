DEVICE:53
;MODULE:QRID_SR_COM
;MODULE_TYPE:1
;SR_COM  Macro
;
;-----------------------------------------
;Macro Name 	: 	QRID_SR_READ/WRITE
;Macro Type	:	Self Holding
;Ver.		:	1.0
;Function	:	
;-----------------------------------------
;引数：
;	P0	=	IN先頭B				B番号で指定
;	P1	=	OUT先頭B			B番号で指定
;	P2	=	IN先頭W				DM番号で指定					
;	P3	=	OUT先頭W			DM番号で指定	
;	P4	=	受信先頭@DM			文字列
;	P5	=	Result code			結果ｺｰﾄﾞ		#20 :正常終了							
;												#21 :異常終了				
;	P6	=	I/F Bit				#0	:Prog->Macro	:QRID読取開始
;								#1	:Macro->Prog	:QRID読取完了
;								#2	:Macro->Prog	:QRID読取中
;								#3	:Macro->Prog	:
;								#4	:Prog->Macro	:
;								#5	:Prog->Macro	:
;								#6	:Prog->Macro	:
;								#7	:Prog->Macro	:ﾏｸﾛ強制終了
;MAIN
LD @CR2008
SET @MR000
STG @MR000
AND P6:#0                ; I/F Bit
SET P6:#2                ; I/F Bit
CON
RES P6:#0                ; I/F Bit
CON
JMP @MR001
;ﾒﾓﾘﾘｾｯﾄ
STG @MR001
JMP @MR002
FMOV #0 P2:#17 #65       ; IN先頭W
FMOV #0 P4:#0 #65        ; 受信先頭@DM
;受信
STG @MR002
ANB @R009                ; SR_ SeriesTRG BUSY
SET @R408                ; SR_ Series読取要求
CON
JMP @MR003
STG @MR003
AND @R009                ; SR_ SeriesTRG BUSY
JMP @MR004
STG @MR004
ANB @R009                ; SR_ SeriesTRG BUSY
RES @R408                ; SR_ Series読取要求
CON
JMP @MR005
STG @MR005
AND @R100                ; SR_ Series読取完
MPS
AND= P2:#4 #0            ; IN先頭W
SMOV P2:#18 P4:#0        ; IN先頭W  受信先頭@DM
MOV P2:#0 P4:#70         ; IN先頭W  受信先頭@DM
MOV P2:#1 P4:#71         ; IN先頭W  受信先頭@DM
MOV P2:#2 P4:#72         ; IN先頭W  受信先頭@DM
SET @R500                ; SR_ Series読取完ｸﾘｱ
CON
JMP @MR006
MPP
AND<> P2:#4 #0           ; IN先頭W
SET @R500                ; SR_ Series読取完ｸﾘｱ
CON
JMP @MR010
STG @MR006
MPS
AND<> P2:#18 #0          ; IN先頭W
JMP @MR007
MPP
AND= P2:#18 #0           ; IN先頭W
JMP @MR010
STG @MR007
ANB @R100                ; SR_ Series読取完
RES @R500                ; SR_ Series読取完ｸﾘｱ
CON
DW #20 @DM0
CON
JMP @MR015
STG @MR010
ANB @R100                ; SR_ Series読取完
RES @R500                ; SR_ Series読取完ｸﾘｱ
CON
DW #21 @DM0
CON
JMP @MR015
;Input
LD P0:#0                 ; IN先頭B
OUT @R000                ; SR_ Seriesｴﾗｰ
LD P0:#1                 ; IN先頭B
OUT @R001                ; SR_ Seriesﾃﾞｰﾀ更新可能
LD P0:#2                 ; IN先頭B
OUT @R002                ; SR_ Seriesﾃﾞｰﾀ更新完了
LD P0:#6                 ; IN先頭B
OUT @R006                ; SR_ Seriesﾊﾞｯﾌｧｵｰﾊﾞｴﾗ-
LD P0:#7                 ; IN先頭B
OUT @R007                ; SR_ Series一般ｴﾗｰ
LD P0:#8                 ; IN先頭B
OUT @R008                ; SR_ SeriesBUSY
LD P0:#9                 ; IN先頭B
OUT @R009                ; SR_ SeriesTRG BUSY
LD P0:#10                ; IN先頭B
OUT @R010                ; SR_ SeriesLOCK BUSY
LD P0:#11                ; IN先頭B
OUT @R011                ; SR_ SeriesMODE BUSY
LD P0:#12                ; IN先頭B
OUT @R012                ; SR_ SeriesERR BUSY
LD P0:#16                ; IN先頭B
OUT @R100                ; SR_ Series読取完
LD P0:#17                ; IN先頭B
OUT @R101                ; SR_ Seriesﾌﾟﾘｾｯﾄ完
LD P0:#18                ; IN先頭B
OUT @R102                ; SR_ Seriesﾌﾟﾘ登録完
LD P0:#19                ; IN先頭B
OUT @R103                ; SR_ Seriesﾁｭｰﾆﾝｸﾞ完
LD P0:#23                ; IN先頭B
OUT @R107                ; SR_ SeriesEXT指示完
LD P0:#24                ; IN先頭B
OUT @R108                ; SR_ Series読取失敗
LD P0:#25                ; IN先頭B
OUT @R109                ; SR_ Seriesﾌﾟﾘｾｯﾄ失敗
LD P0:#26                ; IN先頭B
OUT @R110                ; SR_ Seriesﾌﾟﾘ登録失敗
LD P0:#27                ; IN先頭B
OUT @R111                ; SR_ Seriesﾁｭｰﾆﾝｸﾞ失敗
LD P0:#31                ; IN先頭B
OUT @R115                ; SR_ SeriesEXT指示失敗
LD P0:#32                ; IN先頭B
OUT @R200                ; SR_ Series入力1状態
LD P0:#33                ; IN先頭B
OUT @R201                ; SR_ Series入力2状態
LD P0:#36                ; IN先頭B
OUT @R204                ; SR_ Series出力1状態
LD P0:#37                ; IN先頭B
OUT @R205                ; SR_ Series出力2状態
LD P0:#38                ; IN先頭B
OUT @R206                ; SR_ Series出力3状態
LD P0:#40                ; IN先頭B
OUT @R208                ; SR_ Series不安定
LD P0:#41                ; IN先頭B
OUT @R209                ; SR_ Seriesﾏｯﾁﾝｸﾞ不安定
LD P0:#42                ; IN先頭B
OUT @R210                ; SR_ SeriesISOIEC不安定
LD P0:#43                ; IN先頭B
OUT @R211                ; SR_ SeriesAIMDPM不安定
LD P0:#44                ; IN先頭B
OUT @R212                ; SR_ SeriesAS9132不安定
;OUT
LD @R401                 ; SR_ Seriesﾃﾞｰﾀ更新許可
OUT P1:#1                ; OUT先頭B
LD @R407                 ; SR_ Seriesｴﾗｰｸﾘｱ
OUT P1:#7                ; OUT先頭B
LD @R408                 ; SR_ Series読取要求
OUT P1:#8                ; OUT先頭B
LD @R409                 ; SR_ Seriesﾌﾟﾘｾｯﾄ要求
OUT P1:#9                ; OUT先頭B
LD @R410                 ; SR_ Seriesﾌﾟﾘ登録要求
OUT P1:#10               ; OUT先頭B
LD @R411                 ; SR_ Seriesﾁｭｰﾆﾝｸﾞ要求
OUT P1:#11               ; OUT先頭B
LD @R500                 ; SR_ Series読取完ｸﾘｱ
OUT P1:#16               ; OUT先頭B
LD @R501                 ; SR_ Seriesﾌﾟﾘｾｯﾄ完ｸﾘｱ
OUT P1:#17               ; OUT先頭B
LD @R502                 ; SR_ Seriesﾌﾟﾘ登完ｸﾘｱ
OUT P1:#18               ; OUT先頭B
LD @R503                 ; SR_ Seriesﾁｭｰﾆﾝｸﾞ完ｸﾘｱ
OUT P1:#19               ; OUT先頭B
LD @R507                 ; SR_ SeriesEXT指示完ｸﾘｱ
OUT P1:#23               ; OUT先頭B
;END
STG @MR015
LDA @DM0
CON
STA P5                   ; Result_code
CON
RES P6:#2                ; I/F Bit
CON
SET P6:#1                ; I/F Bit
CON
JMP @MR000
LDB CR2002               ; 常時ON
DW #0 P3:#0              ; OUT先頭W
LD P6:#7                 ; I/F Bit
MEND
END
ENDH
