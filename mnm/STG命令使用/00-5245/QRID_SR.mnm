DEVICE:53
;MODULE:QRID_SR
;MODULE_TYPE:0
;<共用ﾗｲﾌﾞﾗﾘｰ>
;QRID読込照合 SR-750,1000 EtherNetI/P 
;
;<説明>
;  ①マクロ宣言にてマクロ引数を設定してください
;  ②SERIAL_COM設定に値を入れてください。
;  ③
;  ④
;  ⑤
;マクロ宣言
; IN先頭B:		EthernetI/Pに割り当てた入力ﾃﾞﾊﾞｲｽB先頭番地(64bit)
; OUT先頭B:		EthernetI/Pに割り当てた出力ﾃﾞﾊﾞｲｽB先頭番地(64bit)
; IN先頭W:		EthernetI/Pに割り当てた入力ﾃﾞﾊﾞｲｽW先頭番地(82word)
; OUT先頭W:		EthernetI/Pに割り当てた出力ﾃﾞﾊﾞｲｽW先頭番地(36word)
; 受信先頭@DM: 	ｺﾏﾝﾄﾞ、ﾃﾞｰﾀの受信内容を格納
; Result_Code:	マクロ起動結果内容を格納
; I/F Bit:		#0	:Prog->Macro	:QRID読取開始
;				#1	:Macro->Prog	:QRID読取完了
;				#2	:Macro->Prog	:QRID読取中
;				#3	:Macro->Prog	:
;				#4	:Prog->Macro	:
;				#5	:Prog->Macro	:
;				#6	:Prog->Macro	:
;				#7	:Prog->Macro	:ﾏｸﾛ強制終了
LD CR2002                ; 常時ON
ANB @MR007               ; ﾏｸﾛ強制終了
MSTRT QRID_SR_COM B1000 B1040 W2030 W2082 @DM100 @DM10 @MR000;SR-1000 Series[2]ｴﾗｰ  SR-1000 Series[2]ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ  SR-1000 Series[2]ﾊﾞﾝｸ番号  SR Seriesﾃﾞｰﾀ(0000)  Result_Code  QRID読取開始
;<h1/>QRID読取ﾒｲﾝｲﾝﾀｰﾌｪｲｽ
;[bit]
;MR20200:SR_1SL読取開始
;MR20201:SR_1SL読取完了
;MR20202:SR_1SL読取中
;MR20215:SR_1SL読取通信異常
;[word]
;DM20000～DM20109:Tｺｰﾄﾞ  (20ﾜｰﾄﾞ)
;DM20020:ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ  (1ﾜｰﾄﾞ)
;DM20021:ISOIECｸﾞﾚｰﾄﾞ  (1ﾜｰﾄﾞ)
;DM20022:AIMDPMｸﾞﾚｰﾄﾞ  (1ﾜｰﾄﾞ)
;MAIN
STG MR20200              ; SR_読取開始
ANB @MR002               ; QRID読取中
SET MR20202              ; SR_読取中
CON
JMP @MR100
;Memory clear
STG @MR100
RES MR20215              ; SR_1SL読取通信異常
CON
RES MR20201              ; SR_読取完了
CON
ZRES DM20000 DM20049     ; SR_Tｺｰﾄﾞﾃﾞｰﾀ  SR_予約
CON
ZRES @DM10 @DM19         ; Result_Code
CON
ZRES @DM100 @DM199       ; SR Seriesﾃﾞｰﾀ(0000)
CON
JMP @MR101
;<h1/>汎用通信
STG @MR101
DW #0 @DM10              ; Result_Code
CON
SET @MR000               ; QRID読取開始
CON
JMP @MR102
STG @MR102
AND @MR001               ; QRID読取完了
RES @MR001               ; QRID読取完了
CON
JMP @MR103
STG @MR103
MPS
AND= @DM10 #20           ; Result_Code
JMP @MR104
MPP
LD<> @DM10 #20           ; Result_Code
AND<> @DM10 #0           ; Result_Code
ANL
SET MR20215              ; SR_1SL読取通信異常
CON
JMP @MR104
LD CR2002                ; 常時ON
BMOV @DM100 DM20000 #20  ; SR Seriesﾃﾞｰﾀ(0000)  SR_Tｺｰﾄﾞﾃﾞｰﾀ
MOV @DM170 DM20020       ; SR_ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ
MOV @DM171 DM20021       ; SR_ISOIECｸﾞﾚｰﾄﾞ 
MOV @DM172 DM20022       ; SR_AIMDPMｸﾞﾚｰﾄﾞ
STG @MR104
RES MR20202              ; SR_読取中
CON
SET MR20201              ; SR_読取完了
CON
ENDS
END
ENDH
