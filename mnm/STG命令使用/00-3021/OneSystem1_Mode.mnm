DEVICE:53
;MODULE:OneSystem1_Mode
;MODULE_TYPE:0
;OneSystem Master-Module
;
;-----------------------------------------
;ModuleName	:	OneSystem1_Mode
;ModuleType	:	Master Module
;Function	:	Mode Control
;-----------------------------------------
;
;Copylight(C) 2011 SEIKO EPSON Corp. All rights reserved.
LD CR2008                ; 運転開始時1ｽｷｬﾝON
SET R46114               ; _装置原点復帰待ち
CON
SET R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
LDF R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
AND R46114               ; _装置原点復帰待ち
RES R46114               ; _装置原点復帰待ち
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ZRES @R000 @R215         ; ﾓｰﾄﾞIN処理
;<h1/>Mode Start/運転ﾓｰﾄﾞ開始
;●HOME、AUTOﾓｰﾄﾞ開始処理
;・定停止中にHOMEもしくはAUTO動作指定によりSTARTｽｲｯﾁ押下待ち
;・Data_Distribut起動後、BringDown_Standby起動、各ﾓｰﾄﾞﾌﾗｸﾞSET、ﾒｲﾝﾓｼﾞｭｰﾙ起動
LD R46103                ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
AND R40002               ; _ｼｽﾃﾑ正常状態
LD MainTP_StartOK        ; MainTP　ｽﾀｰﾄOK
OR CR2002                ; 常時ON
ANL
LD R46111                ; _AUTOﾓｰﾄﾞ選択中
OR R46112                ; _HOMEﾓｰﾄﾞ選択中
ANL
ANP R44400               ; *Group1　ｽﾀｰﾄSW
AND R44304               ; *Group1　ｴﾘｱｾﾝｻ入力
ANB R9115                ; ﾒﾝﾃﾅﾝｽ要求ﾌﾞｻﾞｰON
SET R50900               ; _Group1 ｴﾘｱｾﾝｻ無効宣言
CON
SET R40404               ; _ﾊﾟﾗﾒｰﾀ変更後ﾕｰｻﾞｰSTG
CON
SET @R000                ; ﾓｰﾄﾞIN処理
STG @R000                ; ﾓｰﾄﾞIN処理
ANB R44400               ; *Group1　ｽﾀｰﾄSW
ANB R40404               ; _ﾊﾟﾗﾒｰﾀ変更後ﾕｰｻﾞｰSTG
RES MR9001               ; Task1 HOME完了
CON
RES MR9002               ; Task1 AUTO完了
CON
MDSTRT BringDown_Standby
JMP @R001                ; ﾓｰﾄﾞﾌﾗｸﾞ処理
STG @R001                ; ﾓｰﾄﾞﾌﾗｸﾞ処理
AND _BringDown_Standby
MPS
AND R46111               ; _AUTOﾓｰﾄﾞ選択中
RES R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
SET R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
SET R40401               ; _AUTOﾓｰﾄﾞ移行ﾕｰｻﾞｰSTG
CON
JMP @R002                ; 登録ﾀｽｸ起動
MPP
AND R46112               ; _HOMEﾓｰﾄﾞ選択中
RES R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
SET R46101               ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
JMP @R002                ; 登録ﾀｽｸ起動
STG @R002                ; 登録ﾀｽｸ起動
MPS
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
AND R40402               ; _AUTOﾓｰﾄﾞ移行OK
OR R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
ANL
MPS
AND>= DM9200 #1          ; _Group1ﾀｽｸ登録数
SET R47300               ; _Group1　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
AND>= DM9200:#1 #1       ; _Group2ﾀｽｸ登録数
SET R47300:#1            ; _Group2　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
AND>= DM9200:#2 #1       ; _Group3ﾀｽｸ登録数
SET R47300:#2            ; _Group3　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
AND>= DM9200:#3 #1       ; _Group4ﾀｽｸ登録数
SET R47300:#3            ; _Group4　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
AND>= DM9200:#4 #1       ; _Group5ﾀｽｸ登録数
SET R47300:#4            ; _Group5　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
AND>= DM9200:#5 #1       ; _Group6ﾀｽｸ登録数
SET R47300:#5            ; _Group6　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
AND>= DM9200:#6 #1       ; _Group7ﾀｽｸ登録数
SET R47300:#6            ; _Group7　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
AND>= DM9200:#7 #1       ; _Group8ﾀｽｸ登録数
SET R47300:#7            ; _Group8　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MPP
JMP @R003                ; 登録ﾀｽｸ起動待ち
MPP
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
AND R40403               ; _AUTOﾓｰﾄﾞ移行NG
ANL
JMP @R014                ; ModeOutHandle終了待ち
STG @R003                ; 登録ﾀｽｸ起動待ち
AND R40003               ; _全ﾀｽｸ起動完了
RES R40402               ; _AUTOﾓｰﾄﾞ移行OK
CON
JMP @R008                ; 原点自動終了待ち
;●MAINTEﾓｰﾄﾞ開始処理
;・MAINTEﾓｰﾄﾞ選択中に各GroupのSTARTｽｲｯﾁ押下待ち
LD R46103                ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46102                ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND R44304               ; *Group1　ｴﾘｱｾﾝｻ入力
ANB R9115                ; ﾒﾝﾃﾅﾝｽ要求ﾌﾞｻﾞｰON
MPS
LDB R46700               ; _安全ｶﾊﾞｰ1開処理中
ANB R50700               ; _Group1 ｴｱｰ元圧状態
AND>= DM9200 #1          ; _Group1ﾀｽｸ登録数
LD MainTP_StartOK        ; MainTP　ｽﾀｰﾄOK
OR CR2002                ; 常時ON
ANL
ANB R47500               ; _Group1　ﾒﾝﾃ動作中
ANP R44400               ; *Group1　ｽﾀｰﾄSW
ANL
SET R47500               ; _Group1　ﾒﾝﾃ動作中
MRD
LDB R46701               ; _安全ｶﾊﾞｰ2開処理中
ANB R50701               ; _Group2 ｴｱｰ元圧状態
AND>= DM9200:#1 #1       ; _Group2ﾀｽｸ登録数
AND SubTP1_StartOK       ; SubTP1　ｽﾀｰﾄOK
ANB R47501               ; _Group2　ﾒﾝﾃ動作中
ANP R44600               ; *Group2　ｽﾀｰﾄSW
ANL
SET R47501               ; _Group2　ﾒﾝﾃ動作中
MRD
LDB R46702               ; _安全ｶﾊﾞｰ3開処理中
ANB R50702               ; _Group3 ｴｱｰ元圧状態
AND>= DM9200:#2 #1       ; _Group3ﾀｽｸ登録数
AND SubTP2_StartOK       ; SubTP2　ｽﾀｰﾄOK
ANB R47502               ; _Group3　ﾒﾝﾃ動作中
ANP R44800               ; *Group3　ｽﾀｰﾄSW
ANL
SET R47502               ; _Group3　ﾒﾝﾃ動作中
MRD
LDB R46703               ; _安全ｶﾊﾞｰ4開処理中
ANB R50703               ; _Group4 ｴｱｰ元圧状態
AND>= DM9200:#3 #1       ; _Group4ﾀｽｸ登録数
AND SubTP3_StartOK       ; SubTP3　ｽﾀｰﾄOK
ANB R47503               ; _Group4　ﾒﾝﾃ動作中
ANP R45000               ; *Group4　ｽﾀｰﾄSW
ANL
SET R47503               ; _Group4　ﾒﾝﾃ動作中
MRD
LDB R46704               ; _安全ｶﾊﾞｰ5開処理中
ANB R50704               ; _Group5 ｴｱｰ元圧状態
AND>= DM9200:#4 #1       ; _Group5ﾀｽｸ登録数
AND SubTP4_StartOK       ; SubTP4　ｽﾀｰﾄOK
ANB R47504               ; _Group5　ﾒﾝﾃ動作中
ANP R45200               ; *Group5　ｽﾀｰﾄSW
ANL
SET R47504               ; _Group5　ﾒﾝﾃ動作中
MRD
LDB R46705               ; _安全ｶﾊﾞｰ6開処理中
ANB R50705               ; _Group6 ｴｱｰ元圧状態
AND>= DM9200:#5 #1       ; _Group6ﾀｽｸ登録数
AND SubTP5_StartOK       ; SubTP5　ｽﾀｰﾄOK
ANB R47505               ; _Group6　ﾒﾝﾃ動作中
ANP R45400               ; *Group6　ｽﾀｰﾄSW
ANL
SET R47505               ; _Group6　ﾒﾝﾃ動作中
MRD
LDB R46706               ; _安全ｶﾊﾞｰ7開処理中
ANB R50706               ; _Group7 ｴｱｰ元圧状態
AND>= DM9200:#6 #1       ; _Group7ﾀｽｸ登録数
AND SubTP6_StartOK       ; SubTP6　ｽﾀｰﾄOK
ANB R47506               ; _Group7　ﾒﾝﾃ動作中
ANP R45600               ; *Group7　ｽﾀｰﾄSW
ANL
SET R47506               ; _Group7　ﾒﾝﾃ動作中
MPP
LDB R46707               ; _安全ｶﾊﾞｰ8開処理中
ANB R50707               ; _Group8 ｴｱｰ元圧状態
AND>= DM9200:#7 #1       ; _Group8ﾀｽｸ登録数
AND SubTP7_StartOK       ; SubTP7　ｽﾀｰﾄOK
ANB R47507               ; _Group8　ﾒﾝﾃ動作中
ANP R45800               ; *Group8　ｽﾀｰﾄSW
ANL
SET R47507               ; _Group8　ﾒﾝﾃ動作中
;【MAINTEDO未起動状態の場合】
;・Data_Distribut起動後、BringDown_Standby起動、各GroupﾒﾝﾃﾓｰﾄﾞﾌﾗｸﾞSET、ﾒｲﾝﾓｼﾞｭｰﾙ起動
LD R46103                ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
ANB R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
LDA R47500               ; _Group1　ﾒﾝﾃ動作中
CON
ANDA $00FF
CON
CMP #0
CON
AND CR2011               ; 演算結果が正
MPS
RES R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
SET R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
MPP
SET R40404               ; _ﾊﾟﾗﾒｰﾀ変更後ﾕｰｻﾞｰSTG
CON
SET @R005                ; ﾒﾝﾃﾓｰﾄﾞIN処理
STG @R005                ; ﾒﾝﾃﾓｰﾄﾞIN処理
MDSTRT BringDown_Standby
JMP @R006                ; ﾒﾝﾃﾓｰﾄﾞBringDown起動待ち
STG @R006                ; ﾒﾝﾃﾓｰﾄﾞBringDown起動待ち
AND _BringDown_Standby
ENDS
;【MAINTEDO起動済みの場合】
;・別のGroupでﾒﾝﾃﾓｰﾄﾞIN済みなので、IN処理はｷｬﾝｾﾙしてﾒｲﾝﾓｼﾞｭｰﾙ起動へ
;SubTPを使用しない場合
;・SubTPを使用しない場合はMainTPの開始でGroup2〜8のﾒｲﾝﾓｼﾞｭｰﾙを起動
;・SubTP使用未使用に関わらずGroup1は起動
LD R46113                ; _MAINTEﾓｰﾄﾞ選択中
AND R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
MPS
ANP R47500               ; _Group1　ﾒﾝﾃ動作中
MPS
SET R47300               ; _Group1　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R100                ; Group1起動記憶
MRD
LD>= DM9200:#1 #1        ; _Group2ﾀｽｸ登録数
ANB R59500:#0            ; _ｻﾌﾞTP1使用有無
ANL
SET R47300:#1            ; _Group2　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
LD>= DM9200:#2 #1        ; _Group3ﾀｽｸ登録数
ANB R59500:#1            ; _ｻﾌﾞTP2使用有無
ANL
SET R47300:#2            ; _Group3　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
LD>= DM9200:#3 #1        ; _Group4ﾀｽｸ登録数
ANB R59500:#2            ; _ｻﾌﾞTP3使用有無
ANL
SET R47300:#3            ; _Group4　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
LD>= DM9200:#4 #1        ; _Group5ﾀｽｸ登録数
ANB R59500:#3            ; _ｻﾌﾞTP4使用有無
ANL
SET R47300:#4            ; _Group5　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
LD>= DM9200:#5 #1        ; _Group6ﾀｽｸ登録数
ANB R59500:#4            ; _ｻﾌﾞTP5使用有無
ANL
SET R47300:#5            ; _Group6　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
LD>= DM9200:#6 #1        ; _Group7ﾀｽｸ登録数
ANB R59500:#5            ; _ｻﾌﾞTP6使用有無
ANL
SET R47300:#6            ; _Group7　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MRD
LD>= DM9200:#7 #1        ; _Group8ﾀｽｸ登録数
ANB R59500:#6            ; _ｻﾌﾞTP7使用有無
ANL
SET R47300:#7            ; _Group8　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
MPP
MOV #1 DM2020            ; _Group1　ﾗﾝﾌﾟ状態
MRD
ANP R47501               ; _Group2　ﾒﾝﾃ動作中
MPS
SET R47300:#1            ; _Group2　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R101                ; Group2起動記憶
MPP
MOV #1 DM2021            ; _Group2　ﾗﾝﾌﾟ状態
MRD
ANP R47502               ; _Group3　ﾒﾝﾃ動作中
MPS
SET R47300:#2            ; _Group3　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R102                ; Group3起動記憶
MPP
MOV #1 DM2022            ; _Group3　ﾗﾝﾌﾟ状態
MRD
ANP R47503               ; _Group4　ﾒﾝﾃ動作中
MPS
SET R47300:#3            ; _Group4　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R103                ; Group4起動記憶
MPP
MOV #1 DM2023            ; _Group4　ﾗﾝﾌﾟ状態
MRD
ANP R47504               ; _Group5　ﾒﾝﾃ動作中
MPS
SET R47300:#4            ; _Group5　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R104                ; Group5起動記憶
MPP
MOV #1 DM2024            ; _Group5　ﾗﾝﾌﾟ状態
MRD
ANP R47505               ; _Group6　ﾒﾝﾃ動作中
MPS
SET R47300:#5            ; _Group6　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R105                ; Group6起動記憶
MPP
MOV #1 DM2025            ; _Group6　ﾗﾝﾌﾟ状態
MRD
ANP R47506               ; _Group7　ﾒﾝﾃ動作中
MPS
SET R47300:#6            ; _Group7　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R106                ; Group7起動記憶
MPP
MOV #1 DM2026            ; _Group7　ﾗﾝﾌﾟ状態
MPP
ANP R47507               ; _Group8　ﾒﾝﾃ動作中
MPS
SET R47300:#7            ; _Group8　ﾒｲﾝﾓｼﾞｭｰﾙ起動要求
CON
SET @R107                ; Group8起動記憶
MPP
MOV #1 DM2027            ; _Group8　ﾗﾝﾌﾟ状態
;<h1/>Hold Request/定停止要求処理
;ﾕｰｻﾞｰﾀｽｸからの定停止要求により定停止移行中へ
;【HOME、AUTO】
;全ｸﾞﾙｰﾌﾟ共通の定停止要求待ち→定停止移行へ
;HOLDRQ：定停止要求
;HOLD：定停止移行中
LDP R46101               ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
LD R46107                ; _定停止要求
ORP R44401               ; *Group1　ｽﾄｯﾌﾟSW
ORP R44601               ; *Group2　ｽﾄｯﾌﾟSW
ORP R44801               ; *Group3　ｽﾄｯﾌﾟSW
ORP R45001               ; *Group4　ｽﾄｯﾌﾟSW
ORP R45201               ; *Group5　ｽﾄｯﾌﾟSW
ORP R45401               ; *Group6　ｽﾄｯﾌﾟSW
ORP R45601               ; *Group7　ｽﾄｯﾌﾟSW
ORP R45801               ; *Group8　ｽﾄｯﾌﾟSW
ANL
ORL
RES R46107               ; _定停止要求
CON
SET R46106               ; _定停止   移行中
;【MAINTE】
;個別ｸﾞﾙｰﾌﾟの定停止要求待ち→定停止移行で任意ﾀｲﾐﾝｸﾞのﾓｰﾄﾞIN、ﾓｰﾄﾞOUTを可能とする
;HOLDRQm*：定停止要求
;HOLDm*：定停止移行中
LD R46102                ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
MPS
LD R47500                ; _Group1　ﾒﾝﾃ動作中
LD R47900                ; _Group1　ﾒﾝﾃ動作定停止要求
ORP R44401               ; *Group1　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47900               ; _Group1　ﾒﾝﾃ動作定停止要求
CON
SET R47800               ; _Group1　ﾒﾝﾃ動作定停止移行中
MRD
LD R47501                ; _Group2　ﾒﾝﾃ動作中
LD R47901                ; _Group2　ﾒﾝﾃ動作定停止要求
ORP R44601               ; *Group2　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47901               ; _Group2　ﾒﾝﾃ動作定停止要求
CON
SET R47801               ; _Group2　ﾒﾝﾃ動作定停止移行中
MRD
LD R47502                ; _Group3　ﾒﾝﾃ動作中
LD R47902                ; _Group3　ﾒﾝﾃ動作定停止要求
ORP R44801               ; *Group3　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47902               ; _Group3　ﾒﾝﾃ動作定停止要求
CON
SET R47802               ; _Group3　ﾒﾝﾃ動作定停止移行中
MRD
LD R47503                ; _Group4　ﾒﾝﾃ動作中
LD R47903                ; _Group4　ﾒﾝﾃ動作定停止要求
ORP R45001               ; *Group4　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47903               ; _Group4　ﾒﾝﾃ動作定停止要求
CON
SET R47803               ; _Group4　ﾒﾝﾃ動作定停止移行中
MRD
LD R47504                ; _Group5　ﾒﾝﾃ動作中
LD R47904                ; _Group5　ﾒﾝﾃ動作定停止要求
ORP R45201               ; *Group5　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47904               ; _Group5　ﾒﾝﾃ動作定停止要求
CON
SET R47804               ; _Group5　ﾒﾝﾃ動作定停止移行中
MRD
LD R47505                ; _Group6　ﾒﾝﾃ動作中
LD R47905                ; _Group6　ﾒﾝﾃ動作定停止要求
ORP R45401               ; *Group6　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47905               ; _Group6　ﾒﾝﾃ動作定停止要求
CON
SET R47805               ; _Group6　ﾒﾝﾃ動作定停止移行中
MRD
LD R47506                ; _Group7　ﾒﾝﾃ動作中
LD R47906                ; _Group7　ﾒﾝﾃ動作定停止要求
ORP R45601               ; *Group7　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47906               ; _Group7　ﾒﾝﾃ動作定停止要求
CON
SET R47806               ; _Group7　ﾒﾝﾃ動作定停止移行中
MPP
LD R47507                ; _Group8　ﾒﾝﾃ動作中
LD R47907                ; _Group8　ﾒﾝﾃ動作定停止要求
ORP R45801               ; *Group8　ｽﾄｯﾌﾟSW
ANL
ANL
RES R47907               ; _Group8　ﾒﾝﾃ動作定停止要求
CON
SET R47807               ; _Group8　ﾒﾝﾃ動作定停止移行中
;<h1/>Mode Finish/運転ﾓｰﾄﾞ終了
;HOME、AUTO終了処理
;・TASKDO*:#?の全OFF待ち→GROUP*DOの全OFF待ち(ﾒｲﾝﾓｼﾞｭｰﾙが全て停止)
STG @R008                ; 原点自動終了待ち
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
AND R46106               ; _定停止   移行中
OR R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
ANL
LDA R40100               ; _Group1起動中ﾌﾗｸﾞ
CON
ANDA $00FF
CON
CMP #0
CON
AND CR2010               ; 演算結果がｾﾞﾛ
JMP @R013                ; ﾓｰﾄﾞOUT処理
;ﾒﾝﾃﾅﾝｽﾓｰﾄﾞ終了処理
;・ﾒﾝﾃﾓｰﾄﾞはいずれかのｸﾞﾙｰﾌﾟﾓｰﾄﾞINしたら、別ｸﾞﾙｰﾌﾟは任意ﾀｲﾐﾝｸﾞでﾓｰﾄﾞIN、ﾓｰﾄﾞOUTが可能
;・全ｸﾞﾙｰﾌﾟがﾒﾝﾃﾓｰﾄﾞから抜けたら定停止とする
;・ﾒﾝﾃﾓｰﾄﾞ時はModeOut_Handle実行しない
;・いずれかのｸﾞﾙｰﾌﾟ起動待ち
LD R46102                ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
LDA R40100               ; _Group1起動中ﾌﾗｸﾞ
CON
ANDA $00FF
CON
CMP #0
CON
AND CR2011               ; 演算結果が正
SET @R009                ; 全Grp終了監視
;・全ｸﾞﾙｰﾌﾟの終了待ち
STG @R009                ; 全Grp終了監視
LDA R40100               ; _Group1起動中ﾌﾗｸﾞ
CON
ANDA $00FF
CON
CMP #0
CON
AND CR2010               ; 演算結果がｾﾞﾛ
JMP @R014                ; ModeOutHandle終了待ち
;・全ｸﾞﾙｰﾌﾟが終了するまで各ｸﾞﾙｰﾌﾟのﾓｰﾄﾞIN監視
LD @R009                 ; 全Grp終了監視
MPS
LD @R100                 ; Group1起動記憶
AND R40100               ; _Group1起動中ﾌﾗｸﾞ
ANL
SET @R200                ; Group1終了待ち
MRD
LD @R101                 ; Group2起動記憶
AND R40101               ; _Group2起動中ﾌﾗｸﾞ
ANL
SET @R201                ; Group2終了待ち
MRD
LD @R102                 ; Group3起動記憶
AND R40102               ; _Group3起動中ﾌﾗｸﾞ
ANL
SET @R202                ; Group3終了待ち
MRD
LD @R103                 ; Group4起動記憶
AND R40103               ; _Group4起動中ﾌﾗｸﾞ
ANL
SET @R203                ; Group4終了待ち
MRD
LD @R104                 ; Group5起動記憶
AND R40104               ; _Group5起動中ﾌﾗｸﾞ
ANL
SET @R204                ; Group5終了待ち
MRD
LD @R105                 ; Group6起動記憶
AND R40105               ; _Group6起動中ﾌﾗｸﾞ
ANL
SET @R205                ; Group6終了待ち
MRD
LD @R106                 ; Group7起動記憶
AND R40106               ; _Group7起動中ﾌﾗｸﾞ
ANL
SET @R206                ; Group7終了待ち
MPP
LD @R107                 ; Group8起動記憶
AND R40107               ; _Group8起動中ﾌﾗｸﾞ
ANL
SET @R207                ; Group8終了待ち
;・全ｸﾞﾙｰﾌﾟが終了するまで各ｸﾞﾙｰﾌﾟのﾓｰﾄﾞOUT監視
STG @R200                ; Group1終了待ち
AND R47800               ; _Group1　ﾒﾝﾃ動作定停止移行中
ANB R40100               ; _Group1起動中ﾌﾗｸﾞ
RES @R100                ; Group1起動記憶
CON
RES R47800               ; _Group1　ﾒﾝﾃ動作定停止移行中
CON
RES R47500               ; _Group1　ﾒﾝﾃ動作中
CON
RES R47508               ; _Group1　ﾒﾝﾃ開始禁止宣言
CON
ENDS
STG @R201                ; Group2終了待ち
AND R47801               ; _Group2　ﾒﾝﾃ動作定停止移行中
ANB R40101               ; _Group2起動中ﾌﾗｸﾞ
RES @R101                ; Group2起動記憶
CON
RES R47801               ; _Group2　ﾒﾝﾃ動作定停止移行中
CON
RES R47501               ; _Group2　ﾒﾝﾃ動作中
CON
RES R47509               ; _Group2　ﾒﾝﾃ開始禁止宣言
CON
ENDS
STG @R202                ; Group3終了待ち
AND R47802               ; _Group3　ﾒﾝﾃ動作定停止移行中
ANB R40102               ; _Group3起動中ﾌﾗｸﾞ
RES @R102                ; Group3起動記憶
CON
RES R47802               ; _Group3　ﾒﾝﾃ動作定停止移行中
CON
RES R47502               ; _Group3　ﾒﾝﾃ動作中
CON
RES R47510               ; _Group3　ﾒﾝﾃ開始禁止宣言
CON
ENDS
STG @R203                ; Group4終了待ち
AND R47803               ; _Group4　ﾒﾝﾃ動作定停止移行中
ANB R40103               ; _Group4起動中ﾌﾗｸﾞ
RES @R103                ; Group4起動記憶
CON
RES R47803               ; _Group4　ﾒﾝﾃ動作定停止移行中
CON
RES R47503               ; _Group4　ﾒﾝﾃ動作中
CON
RES R47511               ; _Group4　ﾒﾝﾃ開始禁止宣言
CON
ENDS
STG @R204                ; Group5終了待ち
AND R47804               ; _Group5　ﾒﾝﾃ動作定停止移行中
ANB R40104               ; _Group5起動中ﾌﾗｸﾞ
RES @R104                ; Group5起動記憶
CON
RES R47804               ; _Group5　ﾒﾝﾃ動作定停止移行中
CON
RES R47504               ; _Group5　ﾒﾝﾃ動作中
CON
RES R47512               ; _Group5　ﾒﾝﾃ開始禁止宣言
CON
ENDS
STG @R205                ; Group6終了待ち
AND R47805               ; _Group6　ﾒﾝﾃ動作定停止移行中
ANB R40105               ; _Group6起動中ﾌﾗｸﾞ
RES @R105                ; Group6起動記憶
CON
RES R47805               ; _Group6　ﾒﾝﾃ動作定停止移行中
CON
RES R47505               ; _Group6　ﾒﾝﾃ動作中
CON
RES R47513               ; _Group6　ﾒﾝﾃ開始禁止宣言
CON
ENDS
STG @R206                ; Group7終了待ち
AND R47806               ; _Group7　ﾒﾝﾃ動作定停止移行中
ANB R40106               ; _Group7起動中ﾌﾗｸﾞ
RES @R106                ; Group7起動記憶
CON
RES R47806               ; _Group7　ﾒﾝﾃ動作定停止移行中
CON
RES R47506               ; _Group7　ﾒﾝﾃ動作中
CON
RES R47514               ; _Group7　ﾒﾝﾃ開始禁止宣言
CON
ENDS
STG @R207                ; Group8終了待ち
AND R47807               ; _Group8　ﾒﾝﾃ動作定停止移行中
ANB R40107               ; _Group8起動中ﾌﾗｸﾞ
RES @R107                ; Group8起動記憶
CON
RES R47807               ; _Group8　ﾒﾝﾃ動作定停止移行中
CON
RES R47507               ; _Group8　ﾒﾝﾃ動作中
CON
RES R47515               ; _Group8　ﾒﾝﾃ開始禁止宣言
CON
ENDS
;ModeOut_Handle実行要求
;・HOME、AUTO時のﾓｰﾄﾞOUT時のみ
STG @R013                ; ﾓｰﾄﾞOUT処理
SET R40407               ; _ﾓｰﾄﾞOUTﾕｰｻﾞｰSTG
CON
JMP @R014                ; ModeOutHandle終了待ち
;全運転ﾓｰﾄﾞ共通最終処理
;・全ﾓｼﾞｭｰﾙが停止したら定停止へ
STG @R014                ; ModeOutHandle終了待ち
ANB R40407               ; _ﾓｰﾄﾞOUTﾕｰｻﾞｰSTG
MDSTOP BringDown_Standby
@INC DM11480
CON
JMP @R015                ; ﾓｰﾄﾞOUT完了待ち
STG @R015                ; ﾓｰﾄﾞOUT完了待ち
ANB _BringDown_Standby
MPS
RES R46107               ; _定停止要求
CON
RES R46106               ; _定停止   移行中
CON
RES R46101               ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
RES R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
RES R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
ZRES R47800 R47807       ; _Group1　ﾒﾝﾃ動作定停止移行中  _Group8　ﾒﾝﾃ動作定停止移行中
MPP
ZRES LR400 LR9915        ; _Grp1_Task0_Start.STG  _Grp8_Task31_MAINTE.STG
CON
RES R40402               ; _AUTOﾓｰﾄﾞ移行OK
CON
RES R40403               ; _AUTOﾓｰﾄﾞ移行NG
CON
RES R46115               ; _装置ｻｲｸﾙﾀｲﾑ計測中
CON
SET R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
CON
ENDS
;<h1/>Start OK Condition Making/ｽﾀｰﾄOK条件作成
;操作BOX STARTｽｲｯﾁ押下OK条件
;【共通】
;・STOPｽｲｯﾁ
;・ｶﾊﾞｰ開要求ｽｲｯﾁ
;・ﾊﾟﾗﾒｰﾀ編集中
;・ﾊﾟﾗﾒｰﾀ変更後処理
;・ﾒﾝﾃ動作開始禁止
;【MainTP】
;・現在画面番号がHOME,AUTOの場合はﾒｲﾝ画面のみ、MAINTEは動作選択画面
;【SubTP】
;・ｻﾌﾞTP使用設定になっていてMAINTE動作選択画面
LDB R40404               ; _ﾊﾟﾗﾒｰﾀ変更後ﾕｰｻﾞｰSTG
ANB R46105               ; _ﾊﾟﾗﾒｰﾀ編集中　ﾓｰﾄﾞﾌﾗｸﾞ
MPS
LDB R44401               ; *Group1　ｽﾄｯﾌﾟSW
ANB R44402               ; *Group1　ｶﾊﾞｰ開要求SW
ANB R44406               ; *Group1　ｶﾊﾞｰ継続実行SW
ANB R47508               ; _Group1　ﾒﾝﾃ開始禁止宣言
LD R46112                ; _HOMEﾓｰﾄﾞ選択中
AND= DM3008 #10          ; _MainTP　切替ﾍﾟｰｼﾞNo
LD R46111                ; _AUTOﾓｰﾄﾞ選択中
AND= DM3008 #10          ; _MainTP　切替ﾍﾟｰｼﾞNo
AND> DM5010 #0           ; _AUTO動作番号
ORL
LD R46113                ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3008 #211         ; _MainTP　切替ﾍﾟｰｼﾞNo
AND> DM4110 #0           ; _Group1　ﾒﾝﾃ動作番号
ORL
ANL
ANL
OUT MainTP_StartOK       ; MainTP　ｽﾀｰﾄOK
MRD
LDB R44601               ; *Group2　ｽﾄｯﾌﾟSW
ANB R44602               ; *Group2　ｶﾊﾞｰ開要求SW
ANB R44609               ; *Group2　ｶﾊﾞｰ継続実行SW
ANB R47509               ; _Group2　ﾒﾝﾃ開始禁止宣言
AND R59500               ; _ｻﾌﾞTP1使用有無
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3028 #210         ; _SubTP1_1　切替ﾍﾟｰｼﾞNo
AND> DM4111 #0           ; _Group2　ﾒﾝﾃ動作番号
ANL
OUT SubTP1_StartOK       ; SubTP1　ｽﾀｰﾄOK
MRD
LDB R44801               ; *Group3　ｽﾄｯﾌﾟSW
ANB R44802               ; *Group3　ｶﾊﾞｰ開要求SW
ANB R44809               ; *Group3　ｶﾊﾞｰ継続実行SW
ANB R47510               ; _Group3　ﾒﾝﾃ開始禁止宣言
AND R59500:#1            ; _ｻﾌﾞTP2使用有無
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3048 #210         ; _SubTP1_2　切替ﾍﾟｰｼﾞNo
AND> DM4112 #0           ; _Group3　ﾒﾝﾃ動作番号
ANL
OUT SubTP2_StartOK       ; SubTP2　ｽﾀｰﾄOK
MRD
LDB R45001               ; *Group4　ｽﾄｯﾌﾟSW
ANB R45002               ; *Group4　ｶﾊﾞｰ開要求SW
ANB R45009               ; *Group4　ｶﾊﾞｰ継続実行SW
ANB R47511               ; _Group4　ﾒﾝﾃ開始禁止宣言
AND R59500:#2            ; _ｻﾌﾞTP3使用有無
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3068 #210         ; _SubTP1_3　切替ﾍﾟｰｼﾞNo
AND> DM4113 #0           ; _Group4　ﾒﾝﾃ動作番号
ANL
OUT SubTP3_StartOK       ; SubTP3　ｽﾀｰﾄOK
MRD
LDB R45201               ; *Group5　ｽﾄｯﾌﾟSW
ANB R45202               ; *Group5　ｶﾊﾞｰ開要求SW
ANB R45209               ; *Group5　ｶﾊﾞｰ継続実行SW
ANB R47512               ; _Group5　ﾒﾝﾃ開始禁止宣言
AND R59500:#3            ; _ｻﾌﾞTP4使用有無
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3088 #210         ; _SubTP1_4　切替ﾍﾟｰｼﾞNo
AND> DM4114 #0           ; _Group5　ﾒﾝﾃ動作番号
ANL
OUT SubTP4_StartOK       ; SubTP4　ｽﾀｰﾄOK
MRD
LDB R45401               ; *Group6　ｽﾄｯﾌﾟSW
ANB R45402               ; *Group6　ｶﾊﾞｰ開要求SW
ANB R45409               ; *Group6　ｶﾊﾞｰ継続実行SW
ANB R47513               ; _Group6　ﾒﾝﾃ開始禁止宣言
AND R59500:#4            ; _ｻﾌﾞTP5使用有無
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3108 #210         ; _SubTP1_5　切替ﾍﾟｰｼﾞNo
AND> DM4115 #0           ; _Group6　ﾒﾝﾃ動作番号
ANL
OUT SubTP5_StartOK       ; SubTP5　ｽﾀｰﾄOK
MRD
LDB R45601               ; *Group7　ｽﾄｯﾌﾟSW
ANB R45602               ; *Group7　ｶﾊﾞｰ開要求SW
ANB R45609               ; *Group7　ｶﾊﾞｰ継続実行SW
ANB R47514               ; _Group7　ﾒﾝﾃ開始禁止宣言
AND R59500:#5            ; _ｻﾌﾞTP6使用有無
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3128 #210         ; _SubTP1_6　切替ﾍﾟｰｼﾞNo
AND> DM4116 #0           ; _Group7　ﾒﾝﾃ動作番号
ANL
OUT SubTP6_StartOK       ; SubTP6　ｽﾀｰﾄOK
MPP
LDB R45801               ; *Group8　ｽﾄｯﾌﾟSW
ANB R45802               ; *Group8　ｶﾊﾞｰ開要求SW
ANB R45809               ; *Group8　ｶﾊﾞｰ継続実行SW
ANB R47515               ; _Group8　ﾒﾝﾃ開始禁止宣言
AND R59500:#6            ; _ｻﾌﾞTP7使用有無
AND R46113               ; _MAINTEﾓｰﾄﾞ選択中
AND= DM3148 #210         ; _SubTP1_7　切替ﾍﾟｰｼﾞNo
AND> DM4117 #0           ; _Group8　ﾒﾝﾃ動作番号
ANL
OUT SubTP7_StartOK       ; SubTP7　ｽﾀｰﾄOK
;<h1/>System All Green/ｼｽﾃﾑ正常状態
;・非常停止、ｴﾗｰ、ﾎﾟｰｽﾞ、ｸｲｯｸﾎﾟｰｽﾞ未発生状態
LDB R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB R46208               ; _Group1　ｴﾗｰ発生中
ANB R46209               ; _Group2　ｴﾗｰ発生中
ANB R46210               ; _Group3　ｴﾗｰ発生中
ANB R46211               ; _Group4　ｴﾗｰ発生中
ANB R46212               ; _Group5　ｴﾗｰ発生中
ANB R46213               ; _Group6　ｴﾗｰ発生中
ANB R46214               ; _Group7　ｴﾗｰ発生中
ANB R46215               ; _Group8　ｴﾗｰ発生中
ANB R44200               ; _Grp1     ﾎﾟｰｽﾞ要求
ANB R44201               ; _Grp2 ﾎﾟｰｽﾞ要求
ANB R44202               ; _Grp3 ﾎﾟｰｽﾞ要求
ANB R44203               ; _Grp4 ﾎﾟｰｽﾞ要求
ANB R44204               ; _Grp5 ﾎﾟｰｽﾞ要求
ANB R44205               ; _Grp6 ﾎﾟｰｽﾞ要求
ANB R44206               ; _Grp7 ﾎﾟｰｽﾞ要求
ANB R44207               ; _Grp8 ﾎﾟｰｽﾞ要求
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
ANB R46301               ; _Group2　ｴﾘｱｾﾝｻ遮断中
ANB R46302               ; _Group3　ｴﾘｱｾﾝｻ遮断中
ANB R46303               ; _Group4　ｴﾘｱｾﾝｻ遮断中
ANB R46304               ; _Group5　ｴﾘｱｾﾝｻ遮断中
ANB R46305               ; _Group6　ｴﾘｱｾﾝｻ遮断中
ANB R46306               ; _Group7　ｴﾘｱｾﾝｻ遮断中
ANB R46307               ; _Group8　ｴﾘｱｾﾝｻ遮断中
ANB R46700               ; _安全ｶﾊﾞｰ1開処理中
ANB R46701               ; _安全ｶﾊﾞｰ2開処理中
ANB R46702               ; _安全ｶﾊﾞｰ3開処理中
ANB R46703               ; _安全ｶﾊﾞｰ4開処理中
ANB R46704               ; _安全ｶﾊﾞｰ5開処理中
ANB R46705               ; _安全ｶﾊﾞｰ6開処理中
ANB R46706               ; _安全ｶﾊﾞｰ7開処理中
ANB R46707               ; _安全ｶﾊﾞｰ8開処理中
ANB R50700               ; _Group1 ｴｱｰ元圧状態
ANB R50701               ; _Group2 ｴｱｰ元圧状態
ANB R50702               ; _Group3 ｴｱｰ元圧状態
ANB R50703               ; _Group4 ｴｱｰ元圧状態
ANB R50704               ; _Group5 ｴｱｰ元圧状態
ANB R50705               ; _Group6 ｴｱｰ元圧状態
ANB R50706               ; _Group7 ｴｱｰ元圧状態
ANB R50707               ; _Group8 ｴｱｰ元圧状態
OUT R40002               ; _ｼｽﾃﾑ正常状態
;<h1/>AlwaysON and OFF/常時信号ON|OFF
;・ﾀｲﾑｱｯﾌﾟｴﾗｰﾏｸﾛ引数用(CRは引数として渡せない為)
LD CR2002                ; 常時ON
OUT R40000               ; _ﾕｰｻﾞｰ常時ON
LD CR2003                ; 常時OFF
OUT R40001               ; _ﾕｰｻﾞｰ常時OFF
END
ENDH
