DEVICE:53
;MODULE:AlwaysSignal
;MODULE_TYPE:0
;OneSystem Sub-Module
;
;---------------------------------------
;ModuleName	:	Always_Signal
;ModuleType	:	Sub Module
;Function	:	条件生成
;---------------------------------------
;<使用方法>
;ﾌﾟﾛｼﾞｪｸﾄ全体に関わる条件ｼｸﾞﾅﾙ生成は本ﾓｼﾞｭｰﾙに記述して下さい
;・ﾓｰｼｮﾝｺﾝﾄﾛｰﾙ動作許可
;・ｺﾐｭﾆｹｰｼｮﾝﾕﾆｯﾄ通信許可
;・ﾋｰﾀｰ電源ON
;など
;ｴﾘｱｾﾝｻｰ監視
LD CR2008                ; 運転開始時1ｽｷｬﾝON
SET @MR001               ; ﾃﾞﾊﾞｲｽﾈｯﾄ立ち上がり時DLY
LD @MR001                ; ﾃﾞﾊﾞｲｽﾈｯﾄ立ち上がり時DLY
TMR @3 #20               ; ﾃﾞﾊﾞｲｽﾈｯﾄ立ち上がり時DLYﾀｲﾏ
CON
AND @T3                  ; ﾃﾞﾊﾞｲｽﾈｯﾄ立ち上がり時DLYﾀｲﾏ
RES @MR001               ; ﾃﾞﾊﾞｲｽﾈｯﾄ立ち上がり時DLY
;ｸﾘｰﾝﾕﾆｯﾄｱﾗｰﾑ
LDB R5300                ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ1
ANB R39004               ; ｴﾗｰ処理中
AND R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB @MR002
ANB @T1                  ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ1ﾀｲﾏ
TMR @1 #300              ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ1ﾀｲﾏ
CON
AND @T1                  ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ1ﾀｲﾏ
@SET R39004              ; ｴﾗｰ処理中
CON
DW #2 @DM1               ; ErrorNo /ERROR_DISP
CON
DW #1000 @DM9            ; ReturnSW /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
@SET @MR100              ; Always ERROR
CON
@SET @R001               ; Always ERROR処理
LDB R5301                ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ2
ANB R39004               ; ｴﾗｰ処理中
AND R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB @MR002
ANB @T2                  ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ2ﾀｲﾏ
TMR @2 #300              ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ2ﾀｲﾏ
CON
AND @T2                  ; ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ2ﾀｲﾏ
@SET R39004              ; ｴﾗｰ処理中
CON
DW #3 @DM1               ; ErrorNo /ERROR_DISP
CON
DW #1000 @DM9            ; ReturnSW /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
@SET @MR100              ; Always ERROR
CON
@SET @R001               ; Always ERROR処理
;巻き取りモータアラーム
LDB R5302                ; 巻取りﾓｰﾀｱﾗｰﾑ
ANB R39004               ; ｴﾗｰ処理中
ANB @MR002
@SET R39004              ; ｴﾗｰ処理中
CON
DW #48 @DM1              ; ErrorNo /ERROR_DISP
CON
DW #1000 @DM9            ; ReturnSW /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
@SET @MR100              ; Always ERROR
CON
@SET @R001               ; Always ERROR処理
;巻き取りモータ温度異常
LDB R008                 ; ﾓｰﾀ温度正常
ANB R39004               ; ｴﾗｰ処理中
ANB @MR002
@SET R39004              ; ｴﾗｰ処理中
CON
DW #51 @DM1              ; ErrorNo /ERROR_DISP
CON
DW #1000 @DM9            ; ReturnSW /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
@SET @MR100              ; Always ERROR
CON
@SET @R001               ; Always ERROR処理
;ｴﾗｰSTG
STG @R001                ; Always ERROR処理
JMP @MR002
STG @MR002
AND @MR101               ; Always ERROR完了
RES @MR101               ; Always ERROR完了
CON
RES R39004               ; ｴﾗｰ処理中
CON
ENDS
;ｴﾘｱｾﾝｻｰ異常
LD R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OR MR10011               ; ﾒﾝﾃﾌﾗｸﾞ
BOR DM10507 #2           ; RB1 状態信号
BOR DM10515 #2           ; RB2 状態信号
ANB R7615                ; ｴﾘｱｾﾝｻｰ出力
ANB R44200               ; _Grp1 ﾎﾟｰｽﾞ要求
ANB @MR001               ; ﾃﾞﾊﾞｲｽﾈｯﾄ立ち上がり時DLY
ANB MR10100              ; ﾜｰｸ投入中
ANB MR11000              ; ﾜｰｸ除去要求
ANB MR11010              ; 別機種ﾜｰｸ除去要求
SET MR10101              ; ｴﾘｱｾﾝｻ遮光検知
LD MR10101               ; ｴﾘｱｾﾝｻ遮光検知
ANB R39004               ; ｴﾗｰ処理中
@SET @MR003
STG @MR003
@SET @MR1900             ; Main1 HALT許可
CON
ANB R39004               ; ｴﾗｰ処理中
SET R39004               ; ｴﾗｰ処理中
CON
DW #1000 @DM9            ; ReturnSW /ERROR_DISP
CON
DW #4 @DM1               ; ErrorNo /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
SET @MR100               ; Always ERROR
CON
JMP @MR004
STG @MR004
AND @MR101               ; Always ERROR完了
RES @MR101               ; Always ERROR完了
CON
RES @MR1900              ; Main1 HALT許可
CON
RES R39004               ; ｴﾗｰ処理中
CON
JMP @MR005
STG @MR005
AND @MR105               ; SW1
RES MR10101              ; ｴﾘｱｾﾝｻ遮光検知
CON
ENDS
;<h1/>MyTask Error Process Substance/エラー処理実体
STG @MR100               ; Always ERROR
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @MR105 @MR108       ; SW1
CON
LDA @DM9                 ; ReturnSW /ERROR_DISP
CON
TBCD
CON
STA @DM10
CON
DISN @DM10 @DM3 #4
MRD
DW #0 @DM0
CON
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @MR102
CON
JMP @MR103
STG @MR103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP  ErrorNo /ERROR_DISP
MPS
AND= DM60007 @DM6        ; ReturnSW /ERROR_DISP
SET @MR105               ; SW1
CON
JMP @MR104
MRD
AND= DM60007 @DM5        ; ReturnSW /ERROR_DISP
SET @MR106
CON
JMP @MR104
MRD
AND= DM60007 @DM4        ; ReturnSW /ERROR_DISP
SET @MR107
CON
JMP @MR104
MPP
AND= DM60007 @DM3        ; ReturnSW /ERROR_DISP
SET @MR108
CON
JMP @MR104
STG @MR104
ANB R39002               ; ERROR_DISP Busy
RES @MR102
CON
SET @MR101               ; Always ERROR完了
CON
ENDS
;TPｶﾚﾝﾀﾞﾀｲﾏ自動同期
LD= CM703 #8             ; ｶﾚﾝﾀﾞﾀｲﾏ(時)
AND= CM704 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ(分)
AND= CM705 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ(秒)
SET @R010
STG @R010
MPS
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ(年)
CON
ADD #32768
CON
TBCD
CON
STA DM3010               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ(設定値)
MRD
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ(月)
CON
TBCD
CON
STA DM3011               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ(設定値)
MRD
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ(日)
CON
TBCD
CON
STA DM3012               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ(設定値)
MRD
LDA CM703                ; ｶﾚﾝﾀﾞﾀｲﾏ(時)
CON
TBCD
CON
STA @DM21
MRD
LDA CM704                ; ｶﾚﾝﾀﾞﾀｲﾏ(分)
CON
TBCD
CON
STA @DM20
MRD
UNIB @DM20 DM3013 #2     ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ(設定値)
MPP
JMP @R011
STG @R011
TMH @5 #5
CON
AND @T5
BRES DM3010 #15          ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ(設定値)
CON
ENDS
END
ENDH
