DEVICE:51
;MODULE:Master
;MODULE_TYPE:0
LDB R50914               ; HOMEsw ON
ANB MR207                ; In instantly stops error
INV
LD MR4212                ; Waste fluid tank surface detecti
AND R50001               ; In Auto
ORL
ZRES @MR000 @MR1915      ; Start ON PLS
;CPU起動時ﾓｼﾞｭｰﾙ起動 / Module  starts at the time of CPU starting.
LD CR2007
TMR #200 #10
TMR #0 #100
MDSTRT MAIN_ST
@RES LR200               ; Auto mode selected
CON
@RES LR201               ; Manual mode selected
;ｽﾀｰﾄｽｲｯﾁ管理 / Start SW management
LDP R4000                ; START SW
AND _MAIN_ST
DIFU @MR000              ; Start ON PLS
OUT R51000               ; Start SW ON Pulse
LD @MR000                ; Start ON PLS
OR @MR001                ; Start SW ON
ANB @MR002               ; Start SW OFF
OUT @MR001               ; Start SW ON
OUT R51001               ; Start SW ON
LD @MR001                ; Start SW ON
ANB R4000                ; START SW
OUT @MR002               ; Start SW OFF
;ﾓｰﾄﾞ選択 / Select Mode
;<h1/>原点復帰 / HOME
LDP R49908               ; HOME start sw (TP)
ANB R50306               ; PAUSE
ANB MR207                ; In instantly stops error
MPS
RES LR200                ; Auto mode selected
CON
RES LR201                ; Manual mode selected
CON
RES R51100               ; Origin Return Finished
MPP
DIFU R50914              ; HOMEsw ON
LDF R49908               ; HOME start sw (TP)
ANB R50306               ; PAUSE
ANB R50108               ; In Error
DIFU @MR208              ; HOME Start PLS
;原点復帰開始 / HOME START
LDB R51100               ; Origin Return Finished
ANB R50001               ; In Auto
ANB R50002               ; In Manual
AND T0
OUT @MR100               ; Home start condition
LD @MR208                ; HOME Start PLS
AND @MR100               ; Home start condition
ANB R50108               ; In Error
OR R50003                ; In Origin
AND T200
ANB R51100               ; Origin Return Finished
OUT R50003               ; In Origin
LD R50003                ; In Origin
OR @MR103                ; Home in motion
ANB @MR105               ; Home end confirmation
OUT @MR103               ; Home in motion
;HOME終了操作 / HOME End process
LD @MR103                ; Home in motion
OR @MR104                ; Home end
AND R51100               ; Origin Return Finished
ANB @MR105               ; Home end confirmation
OUT @MR104               ; Home end
LD @MR104                ; Home end
OUT @MR105               ; Home end confirmation
;ﾓｰﾄﾞ選択 / Mode selection
LDP R50101               ; Auto Mode
AND R50005               ; In Stop
ANB LR200                ; Auto mode selected
ORP @MR105               ; Home end confirmation
DIFU @MR200              ; Auto mode SW ON
LDP R50101               ; Auto Mode
AND R50005               ; In Stop
AND LR200                ; Auto mode selected
DIFU @MR201              ; Manual mode SW ON
LD @MR200                ; Auto mode SW ON
SET LR200                ; Auto mode selected
CON
RES LR201                ; Manual mode selected
LD @MR201                ; Manual mode SW ON
SET LR201                ; Manual mode selected
CON
RES LR200                ; Auto mode selected
;<h1/>自動 / AUTO
;ﾌﾗｸﾞ制御 / FLG Control
LD CR2002
LDA DM3000
CON
CMP #102
CON
AND CR2010
OUT R49201               ; MAIN screen displaying
;AUTO処理開始 / AUTO START
LD R49201                ; MAIN screen displaying
AND LR200                ; Auto mode selected
ANP R51000               ; Start SW ON Pulse
ANB R50001               ; In Auto
ANB R50108               ; In Error
ANB R50306               ; PAUSE
ANB MR4212               ; Waste fluid tank surface detecti
ANB LR4006               ; Zero-point saerch confirmation
DIFU @MR301              ; Auto start SW ON
;起動条件OKならSTART / START when States OK
LD @MR301                ; Auto start SW ON
AND LR200                ; Auto mode selected
OR R50001                ; In Auto
AND R51100               ; Origin Return Finished
ANB @MR305               ; Auto end
OUT R50001               ; In Auto
LDP R50001               ; In Auto
SET MR7304               ; Desiccator atmosphere release
CON
SET MR7004               ; Wft atmosphere release swith
CON
SET MR7005               ; Wft compressed air/vacuum swith
CON
SET MR500                ; Vacuum pump ON
;AUTO 停止監視 開始 / AUTO STOP process Start
LD R50001                ; In Auto
DIFU @MR302              ; Auto start PLS
LD @MR302                ; Auto start PLS
OR @MR303                ; Auto start confirmation
AND R50001               ; In Auto
ANB @MR304               ; Task in motion
OUT @MR303               ; Auto start confirmation
;停止信号入力待ち / STOP signal wait
LD @MR303                ; Auto start confirmation
AND R50500               ; AUTO motion end
OR @MR304                ; Task in motion
AND R50001               ; In Auto
ANB @MR305               ; Auto end
OUT @MR304               ; Task in motion
;各ﾓｼﾞｭｰﾙ停止待ち / Each modul STOP wait
LD @MR304                ; Task in motion
RES R50500               ; AUTO motion end
CON
OUT @MR305               ; Auto end
;AUTO 終了処理 / AUTO END process
LDF R50001               ; In Auto
RES R50500               ; AUTO motion end
CON
RES MR500                ; Vacuum pump ON
CON
RES MR7004               ; Wft atmosphere release swith
;<h1/>手動 / Manual
LD R49201                ; MAIN screen displaying
AND R51000               ; Start SW ON Pulse
AND LR201                ; Manual mode selected
ANB R50002               ; In Manual
LD LR000                 ; Waste fluid discharge mode
OR LR001                 ; Flowmeter zero-poit search mode
ANL
ANB R50108               ; In Error
ANB R50306               ; PAUSE
ANB MR207                ; In instantly stops error
DIFU @MR401              ; Manual start SW ON
LD @MR401                ; Manual start SW ON
OR R50002                ; In Manual
AND R51100               ; Origin Return Finished
ANB @MR405               ; Manual end
OUT R50002               ; In Manual
LD R50002                ; In Manual
DIFU @MR402              ; Manual start PLS
LD @MR402                ; Manual start PLS
OR @MR403                ; Manual start confirmation
AND R50002               ; In Manual
ANB @MR404               ; Task in motion
OUT @MR403               ; Manual start confirmation
LDB R50500               ; AUTO motion end
ANB R50700               ; Waste fluid discharge Activate
ANB R50701               ; Flowmeter zeropoint search Activ
OUB @MR406               ; Manual activate
LD @MR403                ; Manual start confirmation
AND @MR406               ; Manual activate
OR @MR404                ; Task in motion
AND R50002               ; In Manual
ANB @MR405               ; Manual end
OUT @MR404               ; Task in motion
LD @MR404                ; Task in motion
ANB @MR406               ; Manual activate
OUT @MR405               ; Manual end
;動作中 / During operation
LD R50001                ; In Auto
OR R50002                ; In Manual
OR R50003                ; In Origin
OUT R50004               ; In Motion
;ｻｲｸﾙﾀｲﾑ計算 / Cycle Time Measeremet 
LD R50001                ; In Auto
AND R50009               ; In auto 1Cycle motion
AND CR2005
@INC.D DM464             ; Cycle time mesurement
LDF R50009               ; In auto 1Cycle motion
MOV.D DM464 DM462        ; Cycle time mesurement  Cycle time
DW.D #0 DM464            ; Cycle time mesurement
END
ENDH
