DEVICE:53
;MODULE:MC_Cont
;MODULE_TYPE:0
;SCRIPT_TYPE:
;<h1/>MC20 動作許可
;[内容]
;・非常停止、優先ｴﾗｰ発生時に初期化したいﾃﾞﾊﾞｲｽを指定して下さい
;※本Taskで使用するﾛｰｶﾙﾃﾞﾊﾞｲｽなど
;※STG〜JMPにて使用しているﾃﾞﾊﾞｲｽは必須
LD CR2002                ; 常時ON
FLIK #30 #30 @MR000
LD R46104                ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
RES MR20503              ; 軸1 原点復帰完了記憶
CON
RES MR1105               ; ｻｰﾎﾞｱﾝﾌﾟ動力電源ON
CON
RES MR1106               ; ｻｰﾎﾞﾌﾞﾚｰｷ解除
CON
ZRES @MR100 @MR115
LD CR2002                ; 常時ON
ANB R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
MPS
TMR @0 #50
CON
AND @T0
OUT @MR514               ; MC立上りｳｪｲﾄﾀｲﾏ
MPP
@SET MR1105              ; ｻｰﾎﾞｱﾝﾌﾟ動力電源ON
;MC 立上げ時ﾁｪｯｸ
LDB R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
OUT R21600               ; 動作許可
LD R22800                ; 動作可能
OUT MR20400              ; MC20 動作可能
LD R22801                ; 動作許可ｴﾗｰ
OUT MR20401              ; MC20 動作不可_ｴﾗｰ発生
LD R20802                ; 軸1 位置決め完了
OUT MR20511              ; MC 軸1位置決め完了
LD R24705                ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR R24400                ; 軸1 軸ｴﾗｰ中
ANB @MR008               ; MCｱﾗｰﾑ発生
OUT MR20515              ; MC 軸1ｴﾗｰ検出
LD @MR514                ; MC立上りｳｪｲﾄﾀｲﾏ
ANB @MR008               ; MCｱﾗｰﾑ発生
AND MR20401              ; MC20 動作不可_ｴﾗｰ発生
ANB R39004               ; ｴﾗｰ中
SET @MR008               ; MCｱﾗｰﾑ発生
CON
SET R39004               ; ｴﾗｰ中
CON
DW #3 @DM1
CON
DW #8000 @DM9
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2
CON
SET @R100                ; ｱﾗｰﾑ発生
CON
LDA DM11500              ; ﾕﾆｯﾄｴﾗｰｺｰﾄﾞ
CON
STA DM20030              ; TP/ｴﾗｰｺｰﾄﾞ表示
CON
SET MR20915              ; ﾀｯﾁﾊﾟﾈﾙ MCｴﾗｰｺｰﾄﾞ表示
CON
SET @R000
STG @R000
AND @R101
RES @R101
CON
DW #0 DM60009            ; Sensor ERROR No.
CON
AND @R105                ; SW1
DW #0 DM20030            ; TP/ｴﾗｰｺｰﾄﾞ表示
CON
RES MR20915              ; ﾀｯﾁﾊﾟﾈﾙ MCｴﾗｰｺｰﾄﾞ表示
CON
SET @R001
CON
ENDS
LD @R001
TMR #900 #5              ; ｳｪｲﾄﾀｲﾏ
CON
AND T900                 ; ｳｪｲﾄﾀｲﾏ
MSTRT F_ERROR_DISP #15
;
LD @MR514                ; MC立上りｳｪｲﾄﾀｲﾏ
ANP MR20515              ; MC 軸1ｴﾗｰ検出
ANB R39004               ; ｴﾗｰ中
SET @MR008               ; MCｱﾗｰﾑ発生
CON
SET R39004               ; ｴﾗｰ中
CON
DW #4 @DM1
CON
DW #8000 @DM9
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2
CON
SET @R100                ; ｱﾗｰﾑ発生
CON
LDA DM11500              ; ﾕﾆｯﾄｴﾗｰｺｰﾄﾞ
CON
STA DM20030              ; TP/ｴﾗｰｺｰﾄﾞ表示
CON
SET MR20915              ; ﾀｯﾁﾊﾟﾈﾙ MCｴﾗｰｺｰﾄﾞ表示
CON
SET @R003
STG @R003
AND @R101
RES @R101
CON
DW #0 DM60009            ; Sensor ERROR No.
CON
AND @R105                ; SW1
DW #0 DM20030            ; TP/ｴﾗｰｺｰﾄﾞ表示
CON
RES MR20915              ; ﾀｯﾁﾊﾟﾈﾙ MCｴﾗｰｺｰﾄﾞ表示
CON
SET @R004
CON
ENDS
LD @R004
TMR #901 #5              ; ｳｪｲﾄﾀｲﾏ
CON
AND T901                 ; ｳｪｲﾄﾀｲﾏ
MSTRT F_ERROR_DISP #15
;<h1/>MC20 1軸目 ｴﾚﾍﾞｰﾀｻｰﾎﾞ設定
LD CR2008                ; 運転開始時1ｽｷｬﾝON
ORP MR20508              ; MC_軸1 ｱﾗｰﾑﾘｾｯﾄ SW
SET @MR500
LD @MR500
ANB R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
AND @MR514               ; MC立上りｳｪｲﾄﾀｲﾏ
ANB @MR515
RES @MR500
CON
SET @MR501
STG @MR501
SET MR1105               ; ｻｰﾎﾞｱﾝﾌﾟ動力電源ON
CON
TMR @1 #15
CON
AND @T1
SET R24305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR502
STG @MR502
ANB R24705               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R24305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
CON
SET R24000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR503
STG @MR503
ANB R24400               ; 軸1 軸ｴﾗｰ中
RES R24000               ; 軸1 軸ｴﾗｰｸﾘｱ
CON
JMP @MR504
STG @MR504
TMR @2 #30
CON
AND @T2
SET R24113               ; 軸1 ｻｰﾎﾞON
CON
JMP @MR505
STG @MR505
AND R24513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
SET @MR515
CON
ENDS
LDF R24513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
RES @MR515
LDP MR20500              ; MC_軸1 ｻｰﾎﾞON SW
ANB MR20510              ; MC 軸1BUSY
ALT R24113               ; 軸1 ｻｰﾎﾞON
LD R24113                ; 軸1 ｻｰﾎﾞON
MPS
OUT MR20501              ; MC_軸1 ｻｰﾎﾞON SW LP
MPP
AND R1006                ; ｻｰﾎﾞﾌﾞﾚｰｷｲﾝﾀｰﾛｯｸ
OUT MR1106               ; ｻｰﾎﾞﾌﾞﾚｰｷ解除
;<h1/>MC20 1軸目 ｴﾚﾍﾞｰﾀｻｰﾎﾞ Busy
LDB MR20511              ; MC 軸1位置決め完了
OUT MR20510              ; MC 軸1BUSY
;<h1/>MC20 1軸目 現在値読み出し
LD CR2002                ; 常時ON
U_RDFPOS.L #3 #1 EM2600  ; MC 軸1 現在位置
;'現在値  ﾀｯﾁﾊﾟﾈﾙ表示用
;
;EM30000.L = EM2600.L / 10
;DM21100.L = EM31000.L - 5000
;DM21110.L = DM4226.L * 10
;DM21102.L = EM31000.L - DM21110.L - 5000
;
LD CR2002                ; 常時ON
NCJ #1000
;'現在値  ﾀｯﾁﾊﾟﾈﾙ表示用
;
;EM30000.L = EM2600.L / 10
;
LD CR2002                ; 常時ON
LDA.L EM2600             ; MC 軸1 現在位置
CON
EXT.L
CON
DIV.L +10
CON
STA.L EM30000
;DM21100.L = EM31000.L - 5000
;
LD CR2002                ; 常時ON
LDA.L EM31000            ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
CON
SUB.L +5000
CON
STA.L DM21100
;DM21110.L = DM4226.L * 10
;
LD CR2002                ; 常時ON
LDA.L DM4226             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
MUL.L +10
CON
STA.L DM21110
;DM21102.L = EM31000.L - DM21110.L - 5000
;
LD CR2002                ; 常時ON
LDA.L EM31000            ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
CON
SUB.L DM21110
CON
SUB.L +5000
CON
STA.L DM21102
LABEL #1000
;
;<h1/>MC20 1軸目 原点復帰
LDB MR24011              ; 扉開
ANB R46700               ; _安全ｶﾊﾞｰ1開処理中
OUT MR19907              ; ｻｰﾎﾞ動作ｲﾝﾀｰﾛｯｸ
LD LR10003               ; ULD ﾄﾚﾁｪﾝ小 選択
LD R5104                 ; 下段移載 ﾄﾚｲ搬送扉側限
ANB R5103                ; 下段移載 ﾄﾚｲ搬送ｴﾚﾍﾞｰﾀ側限
LD R5103                 ; 下段移載 ﾄﾚｲ搬送ｴﾚﾍﾞｰﾀ側限
ANB R5104                ; 下段移載 ﾄﾚｲ搬送扉側限
ANB R5200                ; 下段移載 ｴﾚﾍﾞｰﾀ側ﾄﾚｲ有無
ORL
ANL
ANB R24404               ; 軸1 軸制御中
ANB MR20502              ; 軸1 原点復帰動作中
AND MR19907              ; ｻｰﾎﾞ動作ｲﾝﾀｰﾛｯｸ
ANP MR20505              ; MC_軸1 原点復帰SW
RES MR20503              ; 軸1 原点復帰完了記憶
CON
SET MR20502              ; 軸1 原点復帰動作中
CON
SET MR20506              ; MC_軸1 原点復帰SW LP
CON
SET @MR700
LD LR10002               ; ULD ﾄﾚﾁｪﾝ大 選択
LD R4104                 ; 下段移載 ﾄﾚｲ搬送扉側限
ANB R4103                ; 下段移載 ﾄﾚｲ搬送ｴﾚﾍﾞｰﾀ側限
LD R4103                 ; 下段移載 ﾄﾚｲ搬送ｴﾚﾍﾞｰﾀ側限
ANB R4104                ; 下段移載 ﾄﾚｲ搬送扉側限
ANB R4102                ; 下段移載 ｴﾚﾍﾞｰﾀ側ﾄﾚｲ有無
ORL
ANL
ANB R24404               ; 軸1 軸制御中
ANB MR20502              ; 軸1 原点復帰動作中
ANP MR20505              ; MC_軸1 原点復帰SW
RES MR20503              ; 軸1 原点復帰完了記憶
CON
SET MR20502              ; 軸1 原点復帰動作中
CON
SET MR20506              ; MC_軸1 原点復帰SW LP
CON
SET @MR700
STG @MR700
SET R24012               ; 軸1 原点復帰要求
CON
ANB R24404               ; 軸1 軸制御中
JMP @MR701
STG @MR701
AND R24404               ; 軸1 軸制御中
RES R24012               ; 軸1 原点復帰要求
CON
RES MR20506              ; MC_軸1 原点復帰SW LP
CON
RES MR20502              ; 軸1 原点復帰動作中
CON
SET MR20503              ; 軸1 原点復帰完了記憶
CON
ENDS
;<h1/>MC20 1軸目 動作
LD CR2002                ; 常時ON
AND MR20503              ; 軸1 原点復帰完了記憶
AND R22800               ; 動作可能
AND R24513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
OUT @MR1000              ; 軸１動作有効
LDB R24100               ; 軸1 JOG正方向
ANB R24101               ; 軸1 JOG負方向
ANB MR20610              ; MC 軸1ﾎﾟｲﾝﾄ移動中
INV
OUT MR20110              ; MC1 BUSY　ｲﾝﾀﾛｯｸ用
LD @MR1000               ; 軸１動作有効
MPS
LD MR20601               ; MC_軸1 JOG+ SW
ANB MR20603              ; MC_軸1 JOG- SW
ANL
OUT MR20602              ; MC_軸1 JOG+ SW LP
CON
OUT R24100               ; 軸1 JOG正方向
MPP
LD MR20603               ; MC_軸1 JOG- SW
ANB MR20601              ; MC_軸1 JOG+ SW
ANL
OUT MR20604              ; MC_軸1 JOG- SW LP
CON
OUT R24101               ; 軸1 JOG負方向
;取得ﾃﾞｰﾀ
;'ﾄﾚｲ無し時のﾄﾚｲ載台停止位置座標取得
;EM31000.L = DM11790.L
;'表示用は、/100にする
;DM21002.L = EM31000.L / 10
LDP MR9201               ; 取込みSW-2
NCJ #1001
;'ﾄﾚｲ無し時のﾄﾚｲ載台停止位置座標取得
;
;EM31000.L = DM11790.L
;
LD CR2002                ; 常時ON
MOV.L DM11790 EM31000    ; 軸1 現在座標  ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
;'表示用は、/100にする
;
;DM21002.L = EM31000.L / 10
LD CR2002                ; 常時ON
LDA.L EM31000            ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
CON
EXT.L
CON
DIV.L +10
CON
STA.L DM21002            ; ﾄﾚｲ無し ﾃｰﾌﾞﾙ停止位ﾃﾞｰﾀ（取込）
LABEL #1001
;
;'切出し位置座標取得
;EM31100.L = DM11790.L
;'表示用は、/100にする
;DM21000.L = EM31100.L / 10
LDP MR9200               ; 取込みSW-1
NCJ #1002
;'切出し位置座標取得
;
;EM31100.L = DM11790.L
;
LD CR2002                ; 常時ON
MOV.L DM11790 EM31100    ; 軸1 現在座標
;'表示用は、/100にする
;
;DM21000.L = EM31100.L / 10
LD CR2002                ; 常時ON
LDA.L EM31100
CON
EXT.L
CON
DIV.L +10
CON
STA.L DM21000            ; 切出し位置ﾃﾞｰﾀ（取込）
LABEL #1002
;
;取得ﾃﾞｰﾀ　CF書込み
;'切出し位置への移動量算出
;EM31200.L = EM31100.L - EM31000.L
;'表示用は、/100にする
;DM21004.L = EM31200.L / 10
;dm4200.L = DM21004.L
;dm4208.L = DM21004.L * -1
;set(@R10)
LDP MR9202               ; 取込みSW-3
MPS
AND @R010
OUT R55301               ; Data Setting End
MPP
NCJ #1003
;'切出し位置への移動量算出
;
;EM31200.L = EM31100.L - EM31000.L
;
LD CR2002                ; 常時ON
LDA.L EM31100
CON
SUB.L EM31000            ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
CON
STA.L EM31200
;'表示用は、/100にする
;
;DM21004.L = EM31200.L / 10
;
LD CR2002                ; 常時ON
LDA.L EM31200
CON
EXT.L
CON
DIV.L +10
CON
STA.L DM21004            ; 切出し移動量（算出）
;dm4200.L = DM21004.L
;
LD CR2002                ; 常時ON
MOV.L DM21004 DM4200     ; 切出し移動量（算出）  _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
;dm4208.L = DM21004.L * -1
;
LD CR2002                ; 常時ON
LDA.L DM21004            ; 切出し移動量（算出）
CON
MUL.L -1
CON
STA.L DM4208             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
;set(@R10)
LD CR2002                ; 常時ON
SET @R010
LABEL #1003
;
;MyTask Error Process Substance/エラー処理実体
STG @R100                ; ｱﾗｰﾑ発生
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @R105 @R108         ; SW1
CON
LDA @DM9
CON
TBCD
CON
STA @DM10
CON
DISN @DM10 @DM3 #4
MRD
DW #5 @DM0
CON
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @R102
CON
JMP @R103
STG @R103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP
AND= DM60007 @DM6        ; ReturnSW /ERROR_DISP
SET @R105                ; SW1
CON
JMP @R104
STG @R104
ANB R39002               ; ERROR_DISP Busy
RES @R102
CON
SET @R101
CON
ENDS
END
ENDH
