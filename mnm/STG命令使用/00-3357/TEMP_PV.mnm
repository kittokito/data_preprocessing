DEVICE:53
;MODULE:TEMP_PV
;MODULE_TYPE:1
;温調器通信ﾓｼﾞｭｰﾙ
;
;RS-485通信を利用して現在温度を読み取る
;
;通信機器
;通信ﾓｰﾄﾞ	無手順
;
LD R46104                ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
MEND
LD CR2008                ; 運転開始時1ｽｷｬﾝON
DW #0 @DM0               ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
CON
SET @MR000
;通信設定
;Port2
;ﾃﾞｰﾀ格納単位	ﾊﾞｲﾄ単位
;ﾓｰﾄﾞ			
;ﾀｲﾑｱｳﾄ			
;送信ﾍｯﾀﾞ		指定なし（直接指定）
;送信ﾃﾞﾘﾐﾀ		指定なし（直接指定）
;受信ﾍｯﾀﾞ		STX
;受信ﾃﾞﾘﾐﾀ		ETX
;受信ﾃﾞｰﾀ長		
LD CR2002                ; 常時ON
MOV $0000 P1:#515        ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MOV $0001 P1:#516        ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MOV #10 P1:#517          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MOV $0000 P1:#518        ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MOV $0000 P1:#519        ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MOV $0200 P1:#520        ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MOV $0300 P1:#521        ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MOV $0000 P1:#522        ; 先頭ﾃﾞｰﾀﾒﾓﾘ
STG @MR000
SET @MR002
CON
ZRES @EM0 @EM14
CON
ZRES P1:#1 P1:#257       ; 先頭ﾃﾞｰﾀﾒﾓﾘ  先頭ﾃﾞｰﾀﾒﾓﾘ
CON
JMP @MR004
STG @MR004
SET P0:#32               ; 先頭ﾘﾚｰ
CON
JMP @MR005
;対象ﾉｰﾄﾞ用にﾃﾞｰﾀを指定
;	送信ﾃﾞｰﾀ2の上位ﾊﾞｲﾄ = ﾉｰﾄﾞ番号(1〜4 = 31〜34)
;	送信ﾃﾞｰﾀ12の下位ﾊﾞｲﾄ = BCC値
STG @MR005
AND P0:#16               ; 先頭ﾘﾚｰ
MPS
AND= @DM0 #0             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
DW $3130 P1:#3           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $0340 P1:#13          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
JMP @MR006
MRD
AND= @DM0 #1             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
DW $3230 P1:#3           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $0343 P1:#13          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
JMP @MR006
MRD
AND= @DM0 #2             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
DW $3330 P1:#3           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $0342 P1:#13          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
JMP @MR006
MPP
AND= @DM0 #3             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
DW $3430 P1:#3           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $0345 P1:#13          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
JMP @MR006
STG @MR006
DW #24 P1:#1             ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $0230 P1:#2           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3030 P1:#4           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3031 P1:#5           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3031 P1:#6           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $4330 P1:#7           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3030 P1:#8           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3030 P1:#9           ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3030 P1:#10          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3030 P1:#11          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
DW $3031 P1:#12          ; 先頭ﾃﾞｰﾀﾒﾓﾘ
CON
SET P0:#33               ; 先頭ﾘﾚｰ
CON
JMP @MR007
STG @MR007
AND P0:#18               ; 先頭ﾘﾚｰ
RES P0:#33               ; 先頭ﾘﾚｰ
CON
JMP @MR008
STG @MR008
ANB P0:#18               ; 先頭ﾘﾚｰ
BMOV P1:#268 @EM0 #2     ; 先頭ﾃﾞｰﾀﾒﾓﾘ
MPS
AND= @DM0 #0             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
RHASC @EM0 P2:#0         ; PV保存先
MRD
AND= @DM0 #1             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
RHASC @EM0 P2:#1         ; PV保存先
MRD
AND= @DM0 #2             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
RHASC @EM0 P2:#2         ; PV保存先
MRD
AND= @DM0 #3             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
RHASC @EM0 P2:#3         ; PV保存先
MPP
TMS @0 #2
CON
AND @T0
JMP @MR009
STG @MR009
@INC @DM0                ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
CON
JMP @MR010
STG @MR010
MPS
AND< @DM0 V0             ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ  読取UT数
JMP @MR000
MPP
AND>= @DM0 V0            ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ  読取UT数
JMP @MR011
STG @MR011
DW #0 @DM0               ; 通信ﾉｰﾄﾞｱﾄﾞﾚｽ
CON
JMP @MR000
END
ENDH
