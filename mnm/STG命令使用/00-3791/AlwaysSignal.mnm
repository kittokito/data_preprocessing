DEVICE:53
;MODULE:AlwaysSignal
;MODULE_TYPE:0
;OneSystem Sub-Module
;
;---------------------------------------
;ModuleName	:	Always_Signal
;ModuleType	:	Sub Module
;Function	:	条件生成
;---------------------------------------
;<使用方法>
;ﾌﾟﾛｼﾞｪｸﾄ全体に関わる条件ｼｸﾞﾅﾙ生成は本ﾓｼﾞｭｰﾙに記述して下さい
;・ﾓｰｼｮﾝｺﾝﾄﾛｰﾙ動作許可
;・ｺﾐｭﾆｹｰｼｮﾝﾕﾆｯﾄ通信許可
;・ﾋｰﾀｰ電源ON
;など
LD MR14402               ; T2_受取PP_Z軸_Pos#11
OR MR14404               ; T2_受取PP_Z軸_Pos#13
OR MR14405               ; T2_受取PP_Z軸_Pos#14
ANB MR14301              ; T2_受取PP_X軸_Pos#2
ANB MR14302              ; T2_受取PP_X軸_Pos#3
BLD DM10515 #2           ; RB1 状態信号
BOR DM10531 #2           ; RB3 状態信号
ANL
RES R507                 ; C RB非常停止
CON
MSTRT F_ERROR_DISP #1
LD CR2003                ; 常時OFF
MSTRT MSG_DEL #1 #1
LD CR2002                ; 常時ON
MPS
AND MR12104              ; COM_MC_TYPE_ﾍｯﾄﾞｻﾌﾞ
LDA.D DM5046             ; _処理計測時間3
CON
DIV.D #40
CON
STA.D DM20012
MRD
AND MR12102              ; COM_MC_TYPE_ﾎﾙﾀﾞ上
LDA.D DM5046             ; _処理計測時間3
CON
DIV.D #30
CON
STA.D DM20012
MRD
AND MR12103              ; COM_MC_TYPE_基板
LDA.D DM5046             ; _処理計測時間3
CON
DIV.D #36
CON
STA.D DM20012
MPP
LD MR12101               ; COM_MC_TYPE_ﾎﾙﾀﾞﾍｯﾄﾞ
OR MR12105               ; COM_MC_TYPE_窓ﾓｰﾙﾄﾞ
ANL
LDA.D DM5046             ; _処理計測時間3
CON
DIV.D #25
CON
STA.D DM20012
LDB R4010                ; BC ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ1
AND MR12000              ; COM_機種_大ﾄﾚｲ(1.3.5)_Flg
LDB R5010                ; SC ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ1
AND MR12001              ; COM_機種_小ﾄﾚｲ(2.4)_Flg
ORL
TMR @1 #300
CON
AND @T1
BANB DM2000 #0           ; _動作ﾊﾟﾗﾒｰﾀ
ANB R39004               ; ｴﾗｰ処理中
SET R39004               ; ｴﾗｰ処理中
CON
DW #2 @DM1               ; ErrorNo /ERROR_DISP
CON
DW #1000 @DM9            ; ReturnSW /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
@SET @MR100              ; Always ERROR
CON
@SET @R001               ; Always ERROR処理
LDB R4011                ; BC ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ2
AND MR12000              ; COM_機種_大ﾄﾚｲ(1.3.5)_Flg
LDB R5011                ; SC ｴｱｸﾘｰﾝﾕﾆｯﾄ ｱﾗｰﾑ2
AND MR12001              ; COM_機種_小ﾄﾚｲ(2.4)_Flg
ORL
TMR @2 #300
CON
AND @T2
BANB DM2000 #0           ; _動作ﾊﾟﾗﾒｰﾀ
ANB R39004               ; ｴﾗｰ処理中
SET R39004               ; ｴﾗｰ処理中
CON
DW #3 @DM1               ; ErrorNo /ERROR_DISP
CON
DW #1000 @DM9            ; ReturnSW /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
@SET @MR100              ; Always ERROR
CON
@SET @R001               ; Always ERROR処理
STG @R001                ; Always ERROR処理
AND @MR101               ; Always ERROR完了
RES @R001                ; Always ERROR処理
CON
RES R39004               ; ｴﾗｰ処理中
CON
ENDS
;<h1/>MyTask Error Process Substance/エラー処理実体
STG @MR100               ; Always ERROR
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @MR105 @MR108
CON
LDA @DM9                 ; ReturnSW /ERROR_DISP
CON
TBCD
CON
STA @DM10
CON
DISN @DM10 @DM3 #4
MRD
DW #0 @DM0
CON
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @MR102
CON
JMP @MR103
STG @MR103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP  ErrorNo /ERROR_DISP
MPS
AND= DM60007 @DM6        ; ReturnSW /ERROR_DISP
SET @MR105
CON
JMP @MR104
MRD
AND= DM60007 @DM5        ; ReturnSW /ERROR_DISP
SET @MR106
CON
JMP @MR104
MRD
AND= DM60007 @DM4        ; ReturnSW /ERROR_DISP
SET @MR107
CON
JMP @MR104
MPP
AND= DM60007 @DM3        ; ReturnSW /ERROR_DISP
SET @MR108
CON
JMP @MR104
STG @MR104
ANB R39002               ; ERROR_DISP Busy
RES @MR102
CON
SET @MR101               ; Always ERROR完了
CON
ENDS
;TPｶﾚﾝﾀﾞﾀｲﾏ自動同期
LD= CM703 #8             ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
AND= CM704 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
AND= CM705 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（秒）
SET @R010
STG @R010
MPS
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
CON
ADD #32768
CON
TBCD
CON
STA DM3010               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
CON
TBCD
CON
STA DM3011               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
CON
TBCD
CON
STA DM3012               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM703                ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
CON
TBCD
CON
STA @DM21
MRD
LDA CM704                ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
CON
TBCD
CON
STA @DM20
MRD
UNIB @DM20 DM3013 #2     ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MPP
JMP @R011
STG @R011
TMH @3 #5
CON
AND @T3
BRES DM3010 #15          ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
CON
ENDS
;<h1/>機種切替
;1-1ｾﾙからの切替信号により機種No.をDM8640に代入し機種変更ﾌﾗｸﾞを立てる。
;No.1　=　BIJ-2
;No.3　=　DEPP
LD= W1000 #0             ; 親ｾﾙより機種切替要求
DW #0 W101C              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
LD= W1000 #1             ; 親ｾﾙより機種切替要求
AND= DM3008 #10          ; _MainTP　切替ﾍﾟｰｼﾞNo
AND R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB R52210               ; 機種切替中
AND= W101C #0            ; 親ｾﾙへ切替完了ｺｰﾄﾞ
DW #1 W101C              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
SET MR1000
STG MR1000
MPS
AND= DM5260 W1001        ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
JMP MR1001
MPP
AND<> DM5260 W1001       ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
MPS
AND= W1001 #1            ; 親ｾﾙより要求機種No
DW #0 DM9033             ; _機種変更種類
CON
DW #1 DM8641             ; _TP機種切替実行分類番号
CON
DW #1 DM8640             ; _TP選択中機種ｺｰﾄﾞ
CON
SET R54807               ; _機種切替要求(From TP)
CON
SET R52210               ; 機種切替中
CON
JMP MR1001
MPP
AND= W1001 #3            ; 親ｾﾙより要求機種No
DW #0 DM9033             ; _機種変更種類
CON
DW #1 DM8641             ; _TP機種切替実行分類番号
CON
DW #3 DM8640             ; _TP選択中機種ｺｰﾄﾞ
CON
SET R54807               ; _機種切替要求(From TP)
CON
SET R52210               ; 機種切替中
CON
JMP MR1001
STG MR1001
ANB R52210               ; 機種切替中
TMR #20 #10
CON
AND T20
MPS
AND= DM5260 W1001        ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
DW #2 W101C              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
ENDS
MPP
AND<> DM5260 W1001       ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
DW #3 W101C              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
ENDS
LD CR2002                ; 常時ON
MOV DM5260 W101D         ; 選択中ｺｰﾄﾞ  親ｾﾙへ完了機種No.
END
ENDH
