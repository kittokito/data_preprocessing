DEVICE:53
;MODULE:MC_Offset
;MODULE_TYPE:0
;SCRIPT_TYPE:
;※MCﾘｰｸ方法変更
;→待機ﾓｼﾞｭｰﾙ「MC_Leak_NEW」にて算出した補正値より
;自動時のﾘｰｸ補正値を自動計算して書込み
;
;詳細
;①上流-下流を1対1で接続した冶具(A)にて1回路ずつﾘｰｸ検査
;各回路の結果として記録
;②上流を封止した冶具(B)にて1回路ずつﾘｰｸ検査
;各回路の結果として記録
;
;①②を複合して補正値として利用する
;
;例
;上流1,下流2,3を使用するﾘｰｸ検査時
;→上流1,下流2,3の装置ﾘｰｸ補正を加算した値を検査補正値として利用
;* MC leak method change
;→ From the correction value calculated by standby module "MC_Leak_NEW"
;Automatically calculate and correct the leak correction value during automatic operation
;
;Details
;① Leak inspection for one circuit at a jig (A) connected upstream - downstream one - to - one
;Record as a result of each circuit
;② Leak inspection by one circuit at jig (B) sealed upstream
;Record as a result of each circuit
;
;Combine ① and use it as a correction value
;
;An example
;At the time of leak check using upstream 1, downstream 2, 3
;→ Use the value obtained by adding the equipment leak correction of upstream 1 and downstream 2 and 3 as inspection correction value
LDP MR30500              ; (TP)検査強制終了
ORP MR900                ; 重度異常：電源再投入必要
MDSTOP MC_Offset
;<h1/>初期化/Initialize
LD @CR2008
SET @MR400
;※特定の回数で止めて確認するため、ﾙｰﾌﾟをFOR文ではなくLD表記
;* To stop and check at a specific number of times, loop the LD notation instead of the FOR statement
STG @MR400
DW #1 @DM0               ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
CON
JMP @MR401
;現在選択している部品のﾘｰｸ検査1～6の使用流路を参照
;上下流補正用ﾌﾗｸﾞを初期化
;Refer to the use flow path of leak check 1 to 6 of the currently selected part
;Initialize upstream / downstream correction flag
STG @MR401
FMOV #0 @DM1 #20         ; 上流1ｴｱｵﾍﾟ使用(=1)
FMOV #0 @DM21 #20        ; 下流1ｴｱｵﾍﾟ使用(=1)
DW.S +0 @DM44            ; 補正値合算
CON
JMP @MR402
LD CR2002                ; 常時ON
LDA @DM0                 ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
CON
SUB #1
CON
MUL #5
CON
STA Z1
LD= DM790:Z1 #0          ; 現設定_ﾘｰｸ検査1 設定番号1
AND= DM791:Z1 #0         ; 現設定_ﾘｰｸ検査1 設定番号2
AND= DM792:Z1 #0         ; 現設定_ﾘｰｸ検査1 設定番号3
AND= DM793:Z1 #0         ; 現設定_ﾘｰｸ検査1 設定番号4
AND= DM794:Z1 #0         ; 現設定_ﾘｰｸ検査1 設定番号5
OUT @MR000               ; ﾘｰｸ検査X回目有効回路無し
STG @MR402
MPS
AND @MR000               ; ﾘｰｸ検査X回目有効回路無し
JMP @MR700
MPP
ANB @MR000               ; ﾘｰｸ検査X回目有効回路無し
JMP @MR500
;使用流路参照ｶｳﾝﾀ初期化/Used flow reference counter initialization
STG @MR500
DW #1 @DM41              ; 使用流路参照ｶｳﾝﾀ(1～5)
CON
JMP @MR501
;
; '流路番号/Flow channel number
; @DM42 = DM790:(((@DM0-1)*5)+(@DM41-1))
LD @MR501
NCJ #1002
; '流路番号/Flow channel number
;
; @DM42 = DM790:(((@DM0-1)*5)+(@DM41-1))
LD CR2002                ; 常時ON
LDA @DM41                ; 使用流路参照ｶｳﾝﾀ(1～5)
CON
EXT
CON
SUB.L +1
CON
STA.L @VM0
CON
LDA @DM0                 ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
CON
EXT
CON
SUB.L +1
CON
MUL.L +5
CON
ADD.L @VM0
CON
STA.L Z12
CON
MOV DM790:Z12 @DM42      ; 現設定_ﾘｰｸ検査1 設定番号1  流路番号
LABEL #1002
;
; '参照した流路番号：入口が0でない
; 'Flow path number referenced: If the entrance is not 0
; @DM45=DM650:(@DM42 - 1)
; IF @DM45<>0 THEN 
;    @DM1:(@DM45-1) = 1
; END IF
; 
; '参照した流路番号：出口1が0でない
; 'Referenced flow path number: exit 1 is not 0
; @DM46=DM670:((@DM42 - 1)*5)
; IF @DM46<>0 THEN 
;  @DM21:(@DM46-1) = 1
; END IF
; 
; '参照した流路番号：出口2が0でない
; 'Referenced flow path number: exit 2 is not 0
; @DM47=DM671:((@DM42 - 1)*5)
; IF @DM47<>0 THEN 
;    @DM21:(@DM47-1) = 1
; END IF
; 
; '参照した流路番号：出口3が0でない
; 'Referenced flow path number: exit 3 is not 0
; @DM48=DM672:((@DM42 - 1)*5)
; IF @DM48<>0 THEN 
;    @DM21:(@DM48-1) = 1
; END IF
; 
; '参照した流路番号：出口4が0でない
; 'Referenced flow path number: exit 4 is not 0
; @DM49=DM673:((@DM42 - 1)*5)
; IF @DM49<>0 THEN 
;    @DM21:(@DM49-1) = 1
; END IF
; 
; '参照した流路番号：出口5が0でない
; 'Referenced flow path number: exit 5 is not 0
; @DM50=DM674:((@DM42 - 1)*5)
; IF @DM50<>0 THEN 
;    @DM21:(@DM50-1) = 1
; END IF
LD @MR501
AND<> @DM42 #0           ; 流路番号
NCJ #1000
; '参照した流路番号：入口が0でない
;
; 'Flow path number referenced: If the entrance is not 0
;
; @DM45=DM650:(@DM42 - 1)
;
LD CR2002                ; 常時ON
LDA @DM42                ; 流路番号
CON
EXT
CON
SUB.L +1
CON
STA.L Z12
CON
MOV DM650:Z12 @DM45      ; 現設定_入口側 接続設定1  IN1
; IF @DM45<>0 THEN 
;
LD<> @DM45 #0            ; IN1
NCJ #2000
;    @DM1:(@DM45-1) = 1
;
LD CR2002                ; 常時ON
LDA @DM45                ; IN1
CON
EXT
CON
SUB.L +1
CON
STA.L Z11
CON
MOV #1 @DM1:Z11          ; 上流1ｴｱｵﾍﾟ使用(=1)
; END IF
;
LABEL #2000
; '参照した流路番号：出口1が0でない
;
; 'Referenced flow path number: exit 1 is not 0
;
; @DM46=DM670:((@DM42 - 1)*5)
;
LD CR2002                ; 常時ON
LDA @DM42                ; 流路番号
CON
EXT
CON
SUB.L +1
CON
MUL.L +5
CON
STA.L Z12
CON
MOV DM670:Z12 @DM46      ; 現設定_出口側 接続設定1-1  OUT1
; IF @DM46<>0 THEN 
;
LD<> @DM46 #0            ; OUT1
NCJ #2001
;  @DM21:(@DM46-1) = 1
;
LD CR2002                ; 常時ON
LDA @DM46                ; OUT1
CON
EXT
CON
SUB.L +1
CON
STA.L Z11
CON
MOV #1 @DM21:Z11         ; 下流1ｴｱｵﾍﾟ使用(=1)
; END IF
;
LABEL #2001
; '参照した流路番号：出口2が0でない
;
; 'Referenced flow path number: exit 2 is not 0
;
; @DM47=DM671:((@DM42 - 1)*5)
;
LD CR2002                ; 常時ON
LDA @DM42                ; 流路番号
CON
EXT
CON
SUB.L +1
CON
MUL.L +5
CON
STA.L Z12
CON
MOV DM671:Z12 @DM47      ; 現設定_出口側 接続設定1-2  OUT2
; IF @DM47<>0 THEN 
;
LD<> @DM47 #0            ; OUT2
NCJ #2002
;    @DM21:(@DM47-1) = 1
;
LD CR2002                ; 常時ON
LDA @DM47                ; OUT2
CON
EXT
CON
SUB.L +1
CON
STA.L Z11
CON
MOV #1 @DM21:Z11         ; 下流1ｴｱｵﾍﾟ使用(=1)
; END IF
;
LABEL #2002
; '参照した流路番号：出口3が0でない
;
; 'Referenced flow path number: exit 3 is not 0
;
; @DM48=DM672:((@DM42 - 1)*5)
;
LD CR2002                ; 常時ON
LDA @DM42                ; 流路番号
CON
EXT
CON
SUB.L +1
CON
MUL.L +5
CON
STA.L Z12
CON
MOV DM672:Z12 @DM48      ; 現設定_出口側 接続設定1-3  OUT3
; IF @DM48<>0 THEN 
;
LD<> @DM48 #0            ; OUT3
NCJ #2003
;    @DM21:(@DM48-1) = 1
;
LD CR2002                ; 常時ON
LDA @DM48                ; OUT3
CON
EXT
CON
SUB.L +1
CON
STA.L Z11
CON
MOV #1 @DM21:Z11         ; 下流1ｴｱｵﾍﾟ使用(=1)
; END IF
;
LABEL #2003
; '参照した流路番号：出口4が0でない
;
; 'Referenced flow path number: exit 4 is not 0
;
; @DM49=DM673:((@DM42 - 1)*5)
;
LD CR2002                ; 常時ON
LDA @DM42                ; 流路番号
CON
EXT
CON
SUB.L +1
CON
MUL.L +5
CON
STA.L Z12
CON
MOV DM673:Z12 @DM49      ; 現設定_出口側 接続設定1-4  OUT4
; IF @DM49<>0 THEN 
;
LD<> @DM49 #0            ; OUT4
NCJ #2004
;    @DM21:(@DM49-1) = 1
;
LD CR2002                ; 常時ON
LDA @DM49                ; OUT4
CON
EXT
CON
SUB.L +1
CON
STA.L Z11
CON
MOV #1 @DM21:Z11         ; 下流1ｴｱｵﾍﾟ使用(=1)
; END IF
;
LABEL #2004
; '参照した流路番号：出口5が0でない
;
; 'Referenced flow path number: exit 5 is not 0
;
; @DM50=DM674:((@DM42 - 1)*5)
;
LD CR2002                ; 常時ON
LDA @DM42                ; 流路番号
CON
EXT
CON
SUB.L +1
CON
MUL.L +5
CON
STA.L Z12
CON
MOV DM674:Z12 @DM50      ; 現設定_出口側 接続設定1-5  OUT5
; IF @DM50<>0 THEN 
;
LD<> @DM50 #0            ; OUT5
NCJ #2005
;    @DM21:(@DM50-1) = 1
;
LD CR2002                ; 常時ON
LDA @DM50                ; OUT5
CON
EXT
CON
SUB.L +1
CON
STA.L Z11
CON
MOV #1 @DM21:Z11         ; 下流1ｴｱｵﾍﾟ使用(=1)
; END IF
LABEL #2005
LABEL #1000
;
STG @MR501
JMP @MR502
;使用流路5まで計算済？/Calculated up to use channel 5?
;※計算ﾁｪｯｸ用/入力ﾄﾘｶﾞｰ
STG @MR502
LD CR2003                ; 常時OFF
ANP MR2000               ; ｽﾀｰﾄSW
OR CR2002                ; 常時ON
ANL
MPS
AND>= @DM41 #5           ; 使用流路参照ｶｳﾝﾀ(1～5)
JMP @MR600
MPP
AND< @DM41 #5            ; 使用流路参照ｶｳﾝﾀ(1～5)
JMP @MR503
STG @MR503
INC @DM41                ; 使用流路参照ｶｳﾝﾀ(1～5)
CON
JMP @MR501
;ﾌﾗｸﾞを参照して補正値を算出
STG @MR600
DW #0 @DM43              ; ｶｳﾝﾀ0～19
CON
JMP @MR601
;
;'上流Xｴｱぺ使用の場合
;'When using upstream X air
;IF @DM1:@DM43 =1 THEN
; @DM44.S = @DM44.S + EM1070.S:@DM43
;END IF
;
;
;'下流Xｴｱぺ使用の場合
;'When using downstream X air gap
;IF @DM21:@DM43 =1 THEN
; @DM44.S = @DM44.S + EM1130.S:@DM43
;END IF
LD @MR601
ANB LR1909               ; MCﾘｰｸ共通経路測定有効
NCJ #1001
;'上流Xｴｱぺ使用の場合
;
;'When using upstream X air
;
;IF @DM1:@DM43 =1 THEN
;
LD CR2002                ; 常時ON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
LD= @DM1:Z12 #1          ; 上流1ｴｱｵﾍﾟ使用(=1)
NCJ #2006
; @DM44.S = @DM44.S + EM1070.S:@DM43
;
LD CR2002                ; 常時ON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
CON
LDA.S EM1070:Z12         ; MCﾘｰｸ結果(回路1上流封止) ﾘｰｸ量
CON
EXT.S
CON
STA.L @VM2
CON
LDA.S @DM44              ; 補正値合算
CON
EXT.S
CON
ADD.L @VM2
CON
STA.S @DM44              ; 補正値合算
;END IF
;
LABEL #2006
;'下流Xｴｱぺ使用の場合
;
;'When using downstream X air gap
;
;IF @DM21:@DM43 =1 THEN
;
LD CR2002                ; 常時ON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
LD= @DM21:Z12 #1         ; 下流1ｴｱｵﾍﾟ使用(=1)
NCJ #2007
; @DM44.S = @DM44.S + EM1130.S:@DM43
;
LD CR2002                ; 常時ON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
CON
LDA.S EM1130:Z12         ; MCﾘｰｸ結果(回路1下流算出) ﾘｰｸ量
CON
EXT.S
CON
STA.L @VM4
CON
LDA.S @DM44              ; 補正値合算
CON
EXT.S
CON
ADD.L @VM4
CON
STA.S @DM44              ; 補正値合算
;END IF
LABEL #2007
LABEL #1001
;
;'追加：共通回路の重複分を修正
;'Add: Correct overlapping of common circuits
;
;'上流Xｴｱぺ使用の場合
;'When using upstream X air
;IF @DM1:@DM43 =1 THEN
; @DM44.S = @DM44.S + (EM1070.S:@DM43 - EM1170.S)
;END IF
;
;
;'下流Xｴｱぺ使用の場合
;'When using downstream X air gap
;IF @DM21:@DM43 =1 THEN
; @DM44.S = @DM44.S + EM1130.S:@DM43
;END IF
LD @MR601
AND LR1909               ; MCﾘｰｸ共通経路測定有効
NCJ #1003
;'追加：共通回路の重複分を修正
;
;'Add: Correct overlapping of common circuits
;
;'上流Xｴｱぺ使用の場合
;
;'When using upstream X air
;
;IF @DM1:@DM43 =1 THEN
;
LD CR2002                ; 常時ON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
LD= @DM1:Z12 #1          ; 上流1ｴｱｵﾍﾟ使用(=1)
NCJ #2008
; @DM44.S = @DM44.S + (EM1070.S:@DM43 - EM1170.S)
;
LD CR2002                ; 常時ON
LDA.S EM1170             ; MCﾘｰｸ結果(共通回路) ﾘｰｸ量
CON
EXT.S
CON
STA.L @VM6
CON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
CON
LDA.S EM1070:Z12         ; MCﾘｰｸ結果(回路1上流封止) ﾘｰｸ量
CON
EXT.S
CON
SUB.L @VM6
CON
STA.L @VM8
CON
LDA.S @DM44              ; 補正値合算
CON
EXT.S
CON
ADD.L @VM8
CON
STA.S @DM44              ; 補正値合算
;END IF
;
LABEL #2008
;'下流Xｴｱぺ使用の場合
;
;'When using downstream X air gap
;
;IF @DM21:@DM43 =1 THEN
;
LD CR2002                ; 常時ON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
LD= @DM21:Z12 #1         ; 下流1ｴｱｵﾍﾟ使用(=1)
NCJ #2009
; @DM44.S = @DM44.S + EM1130.S:@DM43
;
LD CR2002                ; 常時ON
LDA @DM43                ; ｶｳﾝﾀ0～19
CON
EXT
CON
STA.L Z12
CON
LDA.S EM1130:Z12         ; MCﾘｰｸ結果(回路1下流算出) ﾘｰｸ量
CON
EXT.S
CON
STA.L @VM10
CON
LDA.S @DM44              ; 補正値合算
CON
EXT.S
CON
ADD.L @VM10
CON
STA.S @DM44              ; 補正値合算
;END IF
LABEL #2009
LABEL #1003
;
STG @MR601
JMP @MR602
;上下流20までﾁｪｯｸ?/Check up to 20 upstream / downstream?
STG @MR602
MPS
AND>= @DM43 #19          ; ｶｳﾝﾀ0～19
JMP @MR700
MPP
AND< @DM43 #19           ; ｶｳﾝﾀ0～19
JMP @MR603
STG @MR603
INC @DM43                ; ｶｳﾝﾀ0～19
CON
JMP @MR601
;算出した補正値をﾘｰｸ検査X回目の補正値に書き込み
;Write the calculated correction value to the correction value of the Xth leak check
;※追加：共通回路の重複分を修正→最後に加算
;※Add: Correct overlapping of common circuits→ Add last
STG @MR700
MPS
LDA EM30012              ; (TP)部品選択
CON
SUB #1
CON
MUL #350
CON
STA Z1
MPP
LDA.S @DM44              ; 補正値合算
CON
MPS
AND LR1909               ; MCﾘｰｸ共通経路測定有効
ADD.S EM1170             ; MCﾘｰｸ結果(共通回路) ﾘｰｸ量
MRD
AND= @DM0 #1             ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
STA DM1218:Z1            ; 部品1_ﾘｰｸ検査1補正量
MRD
AND= @DM0 #2             ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
STA DM1219:Z1            ; 部品1_ﾘｰｸ検査2補正量
MRD
AND= @DM0 #3             ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
STA DM1220:Z1            ; 部品1_ﾘｰｸ検査3補正量
MRD
AND= @DM0 #4             ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
STA DM1221:Z1            ; 部品1_ﾘｰｸ検査4補正量
MRD
AND= @DM0 #5             ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
STA DM1222:Z1            ; 部品1_ﾘｰｸ検査5補正量
MRD
AND= @DM0 #6             ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
STA DM1223:Z1            ; 部品1_ﾘｰｸ検査6補正量
MPP
JMP @MR3200
;ﾘｰｸ検査6まで計算済？/Calculated to leak check 6?
STG @MR3200
MPS
AND>= @DM0 #6            ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
JMP @MR3215
MPP
AND< @DM0 #6             ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
JMP @MR3201
STG @MR3201
INC @DM0                 ; ﾘｰｸ検査番号参照ｶｳﾝﾀ(1～6)
CON
JMP @MR401
;終了/end
STG @MR3215
MDSTOP MC_Offset
ENDS
;<h1/>■ｻﾌﾞﾙｰﾁﾝ/Subroutine
END
ENDH
