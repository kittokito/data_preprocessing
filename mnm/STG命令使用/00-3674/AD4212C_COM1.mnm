DEVICE:53
;MODULE:AD4212C_COM1
;MODULE_TYPE:0
;SCRIPT_TYPE:
;PCとの通信
LDP R46104               ; _ESTOP_MODE
ZRES @R100 @R315
;<h1/>Communication MAIN
;Command Number Description (EM1920) 
;# Continuous output request 0 'SIR' weight value 
;# Stop continuous output of 1 'C' weight value 
;# Weight value data request 2 'S' after stabilization 
;
;
;# Stop continuous output of 11 'C' weight value 
;# 12 'R' Tare (RE-ZERO) 
;
;# Continuous reception of 20 measured values ??(no transmission)
;
;
;
;ｺﾏﾝﾄﾞ番号説明　(EM1920)
;#0	'SIR'	計量値の連続出力要求
;#1	'C'		計量値の連続出力の停止
;#2	'S'		安定後計量値ﾃﾞｰﾀ要求
;
;
;#11	'C'		計量値の連続出力の停止
;#12	'R'		風袋引き(RE-ZERO)
;
;#20	　　　　計量値の連続受信(送信無）
LD CR2005                ; 100msｸﾛｯｸﾊﾟﾙｽ
ANB R37002               ; AD4212C-1通信中
AND= EM1920 #20          ; 天秤1 処理ｺﾏﾝﾄﾞNO
AND= DM3000 #506         ; 表示中 画面No.
AND R37007               ; 天秤1 連続計量 FLG
@SET R37000              ; AD4212C-1通信開始
STG R37000               ; AD4212C-1通信開始
RES R37001               ; AD4212C-1通信完了
CON
ZRES DM25259 DM25514     ; Port1 受信ﾃﾞｰﾀ1  Port1 受信ﾃﾞｰﾀ256
CON
RES @R301
CON
SET R37002               ; AD4212C-1通信中
CON
ZRES @DM0 @DM12
CON
ZRES @DM16 @DM999
CON
JMP @R100
STG @R100
LDA EM1920               ; 天秤1 処理ｺﾏﾝﾄﾞNO
CON
STA @DM7
CON
LDA EM1920               ; 天秤1 処理ｺﾏﾝﾄﾞNO
CON
STA @DM50
CON
JMP @R101
;<<送受信ｺﾏﾝﾄﾞ>>
STG @R101
MPS
AND= #0 @DM50
SMOV "SIR" @DM100
JMP @R200
MRD
AND= #1 @DM50
SMOV "C" @DM100
JMP @R200
MRD
AND= #2 @DM50
SMOV "S" @DM100
JMP @R200
MRD
AND= #11 @DM50
SMOV "C" @DM100
JMP @R200
MRD
AND= #12 @DM50
SMOV "R" @DM100
JMP @R200
MPP
AND= #20 @DM50
JMP @R200
;<<受信用>>
STG @R102
JMP @R200
;<h1/>General-purpose cominucation 
STG @R200
ANB @R302
SET @R300
CON
JMP @R201
STG @R201
AND @R301
MPS
ANB @R303
RES @R301
CON
JMP @R205
MPP
AND @R303
RES @R301
CON
JMP @R202
STG @R202
SET R37003               ; 送受信異常1
CON
RES @R303
CON
JMP @R205
STG @R205
SET R37001               ; AD4212C-1通信完了
CON
RES R37002               ; AD4212C-1通信中
CON
ENDS
;<h1/>SERIAL cominucation START
;'SERIAL_COM ﾏｸﾛ使用する為に以下の設定を行う
;@DM0 = $0000	'ﾃﾞｰﾀ格納単位設定
;@DM1 = $0000	'ﾓｰﾄﾞ設定
;@DM2 = #0000	'ﾀｲﾑｱｳﾄﾁｪｯｸ時間設定
;@DM3 = $0000	'送信用ﾍｯﾀﾞ設定
;@DM4 = $0D0A	'送信用ﾃﾞﾘﾐﾀ設定
;@DM5 = $0000	'受信用ﾍｯﾀﾞ設定
;@DM6 = $0D0A	'受信用ﾃﾞﾘﾐﾀ設定
LD CR2002                ; 常時ON
NCJ #1000
;'SERIAL_COM ﾏｸﾛ使用する為に以下の設定を行う
;
;@DM0 = $0000	'ﾃﾞｰﾀ格納単位設定
;
LD CR2002                ; 常時ON
MOV $0000 @DM0
;@DM1 = $0000	'ﾓｰﾄﾞ設定
;
LD CR2002                ; 常時ON
MOV $0000 @DM1
;@DM2 = #0000	'ﾀｲﾑｱｳﾄﾁｪｯｸ時間設定
;
LD CR2002                ; 常時ON
MOV #0 @DM2
;@DM3 = $0000	'送信用ﾍｯﾀﾞ設定
;
LD CR2002                ; 常時ON
MOV $0000 @DM3
;@DM4 = $0D0A	'送信用ﾃﾞﾘﾐﾀ設定
;
LD CR2002                ; 常時ON
MOV $0D0A @DM4
;@DM5 = $0000	'受信用ﾍｯﾀﾞ設定
;
LD CR2002                ; 常時ON
MOV $0000 @DM5
;@DM6 = $0D0A	'受信用ﾃﾞﾘﾐﾀ設定
LD CR2002                ; 常時ON
MOV $0D0A @DM6
LABEL #1000
;
STG @R300
SET @R302
CON
DW #0 @DM10
CON
JMP @R304
LDP @R304
MSTRT SERIAL_COM1 R25000 DM25000 @DM0 @DM100 @DM500 @DM10;Port1 通信可能  ﾕﾆｯﾄｴﾗｰ番号
STG @R304
MPS
AND= @DM10 #20
JMP @R305
MPP
LD<> @DM10 #20
AND<> @DM10 #0
ANL
SET @R303
CON
JMP @R315
;測定ﾃﾞｰﾀ保管処理分岐
STG @R305
MPS
LD= EM1920 #1            ; 天秤1 処理ｺﾏﾝﾄﾞNO
OR= EM1920 #11           ; 天秤1 処理ｺﾏﾝﾄﾞNO
ANL
JMP @R315
MPP
LD= EM1920 #0            ; 天秤1 処理ｺﾏﾝﾄﾞNO
OR= EM1920 #2            ; 天秤1 処理ｺﾏﾝﾄﾞNO
OR= EM1920 #12           ; 天秤1 処理ｺﾏﾝﾄﾞNO
OR= EM1920 #20           ; 天秤1 処理ｺﾏﾝﾄﾞNO
ANL
@FMOV #0 EM30000 #10     ; ST(① weight ASC Byte)
@BMOV DM25259 EM30000 #10; Port1 受信ﾃﾞｰﾀ1  ST(① weight ASC Byte)
@BMOV EM30003 EM30010 #3 ; 01(① weight ASC Byte)  01(① weight ASC Byte)
@DISS EM30010 EM30020    ; 01(① weight ASC Byte)  00(① weight ASC Byte)
@SMOV "･0" EM30026       ; 00(① weight ASC Byte)
@UNIS EM30021 EM30030 #6 ; 01(① weight ASC Byte)  12(① weight ASC Byte)
@BMOV EM30030 EM30050 #3 ; 12(① weight ASC Byte)  12(① weight ASC Byte)
@RFASC EM30050 EM30080   ; 12(① weight ASC Byte)  12.34(① weight FLOTE)
MPS
LDA.F EM30080            ; 12.34(① weight FLOTE)
CON
MUL.F +100
CON
STA.F EM30090            ; 1234(① weight FLOTE)
MRD
LDA.L EM30090            ; 1234(① weight FLOTE)
CON
INTG.L
CON
STA.L EM30100            ; 1234(① weight ±10進32bit)
MPP
JMP @R315
STG @R315
TMS @0 #10
CON
AND @T0
SET @R301
CON
RES @R302
CON
ENDS
END
ENDH
