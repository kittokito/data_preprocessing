DEVICE:53
;MODULE:Camera
;MODULE_TYPE:0
;SCRIPT_TYPE:
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ORP MR3608               ; 画像処理ｷｬﾝｾﾙ
ZRES MR4600 MR4615       ; １回目画像処理_ﾒｯｾｰｼﾞ通信開始
CON
ZRES @R100 @R1915
CON
RES MR3608               ; 画像処理ｷｬﾝｾﾙ
;ﾒｯｾｰｼﾞ通信設定
;' X軸
;DM20000.L = DM420.L * 10000
;DM20004.L = DM422.L * 10000
;' Y軸
;DM20010.L = DM424.L * 10000
;DM20014.L = DM426.L * 10000
;' θ軸
;DM20020.L = DM428.L * 10
;DM20024.L = DM430.L * 10
;
;
LD CR2002                ; 常時ON
NCJ #1001
;' X軸
;
;DM20000.L = DM420.L * 10000
;
LD CR2002                ; 常時ON
LDA.L DM420              ; 受渡し移動 X軸移動量
CON
MUL.L +10000
CON
STA.L DM20000
;DM20004.L = DM422.L * 10000
;
LD CR2002                ; 常時ON
LDA.L DM422              ; 受渡し移動 X軸速度
CON
MUL.L +10000
CON
STA.L DM20004
;' Y軸
;
;DM20010.L = DM424.L * 10000
;
LD CR2002                ; 常時ON
LDA.L DM424
CON
MUL.L +10000
CON
STA.L DM20010
;DM20014.L = DM426.L * 10000
;
LD CR2002                ; 常時ON
LDA.L DM426              ; 受渡し移動 X軸ｵﾌｾｯﾄ
CON
MUL.L +10000
CON
STA.L DM20014
;' θ軸
;
;DM20020.L = DM428.L * 10
;
LD CR2002                ; 常時ON
LDA.L DM428              ; 受渡し移動 Y軸ｵﾌｾｯﾄ
CON
MUL.L +10
CON
STA.L DM20020
;DM20024.L = DM430.L * 10
;
LD CR2002                ; 常時ON
LDA.L DM430              ; 受渡し移動 X軸移動量（実）
CON
MUL.L +10
CON
STA.L DM20024
LABEL #1001
;
;SceneGroup
STG MR4600               ; １回目画像処理_ﾒｯｾｰｼﾞ通信開始
SET MR4602               ; 画像検査1回目撮像中
CON
JMP @R1000
STG MR4608               ; 二回目画像処理_ﾒｯｾｰｼﾞ通信開始
SET MR4610               ; 画像検査2回目撮像中
CON
JMP @R1015
;'FZ-350とのEthernetI/P通信 ﾒｯｾｰｼﾞ送信 手順
;'①
;@DM0=192   'IP Address 設定192.168.0.122
;@DM1=168   
;@DM2=0     
;@DM3=122   
;'②
;@DM4=$32 'サービス
;@DM5=$64 'クラス
;@DM6=$01 'インスタンス
;@DM7=$01 'アトリビュート
;
LD MR4602                ; 画像検査1回目撮像中
OR MR4610                ; 画像検査2回目撮像中
NCJ #1000
;'FZ-350とのEthernetI/P通信 ﾒｯｾｰｼﾞ送信 手順
;
;'①
;
;@DM0=192   'IP Address 設定192.168.0.122
;
LD CR2002                ; 常時ON
MOV #192 @DM0            ; IP
;@DM1=168   
;
LD CR2002                ; 常時ON
MOV #168 @DM1            ; IP
;@DM2=0     
;
LD CR2002                ; 常時ON
MOV #0 @DM2              ; IP
;@DM3=122   
;
LD CR2002                ; 常時ON
MOV #122 @DM3            ; IP
;'②
;
;@DM4=$32 'サービス
;
LD CR2002                ; 常時ON
MOV $0032 @DM4           ; Service
;@DM5=$64 'クラス
;
LD CR2002                ; 常時ON
MOV $0064 @DM5           ; CLASS
;@DM6=$01 'インスタンス
;
LD CR2002                ; 常時ON
MOV $0001 @DM6           ; instance
;@DM7=$01 'アトリビュート
;
LD CR2002                ; 常時ON
MOV $0001 @DM7           ; attribute
LABEL #1000
;
STG @R1000
AND @R1001
JMP @R1002
;SELECT CASE DM434
;CASE 0
;	@DM20.T = "SG 00"+CHR($00) 'Scene group  00
;CASE 1
;	@DM20.T = "SG 01"+CHR($00) 'Scene group  01
;CASE 2
;	@DM20.T = "SG 02"+CHR($00) 'Scene group  02
;CASE 3
;	@DM20.T = "SG 03"+CHR($00) 'Scene group  03	
;CASE ELSE
;	@DM20.T = "SG 00"+CHR($00) 'Scene group  00
;END SELECT
;
;@D40=RCPSASC(@D20.T,@D10)
;
;SET(@R1001)
LD @R1000
ANB @R1001
NCJ #1002
;SELECT CASE DM434
;
LD CR2002                ; 常時ON
MOV DM434 @VM0           ; _機種分類1　機種別ﾃﾞｰﾀ18
;CASE 0
;
LD= @VM0 #0
NCJ #2000
;	@DM20.T = "SG 00"+CHR($00) 'Scene group  00
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM2
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM1
CON
SMOV @VM1 *@VM2
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM4
SMOV "SG 00" *@VM4
LD CR2002                ; 常時ON
SADD *@VM4 *@VM2 *@VM4
SMOV *@VM4 @DM20
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;CASE 1
;
LD= @VM0 #1
NCJ #2002
;	@DM20.T = "SG 01"+CHR($00) 'Scene group  01
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM7
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM6
CON
SMOV @VM6 *@VM7
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM9
SMOV "SG 01" *@VM9
LD CR2002                ; 常時ON
SADD *@VM9 *@VM7 *@VM9
SMOV *@VM9 @DM20
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;CASE 2
;
LD= @VM0 #2
NCJ #2004
;	@DM20.T = "SG 02"+CHR($00) 'Scene group  02
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM12
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM11
CON
SMOV @VM11 *@VM12
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM14
SMOV "SG 02" *@VM14
LD CR2002                ; 常時ON
SADD *@VM14 *@VM12 *@VM14
SMOV *@VM14 @DM20
LD CR2002                ; 常時ON
CJ #2005
LABEL #2004
;CASE 3
;
LD= @VM0 #3
NCJ #2006
;	@DM20.T = "SG 03"+CHR($00) 'Scene group  03	
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM17
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM16
CON
SMOV @VM16 *@VM17
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM19
SMOV "SG 03" *@VM19
LD CR2002                ; 常時ON
SADD *@VM19 *@VM17 *@VM19
SMOV *@VM19 @DM20
LD CR2002                ; 常時ON
CJ #2007
LABEL #2006
;CASE ELSE
;
;	@DM20.T = "SG 00"+CHR($00) 'Scene group  00
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM22
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM21
CON
SMOV @VM21 *@VM22
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM24
SMOV "SG 00" *@VM24
LD CR2002                ; 常時ON
SADD *@VM24 *@VM22 *@VM24
SMOV *@VM24 @DM20
;END SELECT
;
LABEL #2007
LABEL #2005
LABEL #2003
LABEL #2001
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM26
RCPSASC @DM20 @DM10 @VM26; QTY
LD CR2002                ; 常時ON
MOV @VM26 @DM40
;SET(@R1001)
LD CR2002                ; 常時ON
SET @R1001
LABEL #1002
;
STG @R1002
RES @R1001
CON
SET @R1500               ; 送信
CON
JMP @R1003
STG @R1003
AND @R1501               ; 送信完了
RES @R1501               ; 送信完了
CON
JMP @R1004
STG @R1004
MPS
ANB @R1503               ; NG
JMP @R1005
MPP
AND @R1503               ; NG
JMP @R1114
;Scene
STG @R1005
AND @R1006
JMP @R1007
;@DM20.T = "S 0"+CHR($00) 'S 00
;@D40=RCPSASC(@D20.T,@D10)
;
;SET(@R1006)
LD @R1005
ANB @R1006
NCJ #1003
;@DM20.T = "S 0"+CHR($00) 'S 00
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM28
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM27
CON
SMOV @VM27 *@VM28
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM30
SMOV "S 0" *@VM30
LD CR2002                ; 常時ON
SADD *@VM30 *@VM28 *@VM30
SMOV *@VM30 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM32
RCPSASC @DM20 @DM10 @VM32; QTY
LD CR2002                ; 常時ON
MOV @VM32 @DM40
;SET(@R1006)
LD CR2002                ; 常時ON
SET @R1006
LABEL #1003
;
STG @R1007
RES @R1006
CON
SET @R1500               ; 送信
CON
JMP @R1008
STG @R1008
AND @R1501               ; 送信完了
RES @R1501               ; 送信完了
CON
JMP @R1009
STG @R1009
MPS
ANB @R1503               ; NG
JMP @R1010
MPP
AND @R1503               ; NG
JMP @R1114
;Directory 作成
STG @R1010
AND @R1011
JMP @R1012
;'@D40.T=EM32122.T  'ロット番号
;@D50.T =CHR($22) & EM32122.T  & CHR($22)'フォルダー名の前後に””を入れる
;@D60.T="UD 1 direct LOTNO$(0)=" & CHR($22)& "\" & EM32122.T & CHR($22)&CHR(00)
;@D40=RCPSASC(@D60.T,@D10)
;SET(@R1011)
LD @R1010
ANB @R1011
NCJ #1004
;'@D40.T=EM32122.T  'ロット番号
;
;@D50.T =CHR($22) & EM32122.T  & CHR($22)'フォルダー名の前後に””を入れる
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM34
LD CR2002                ; 常時ON
LDA $0022
CON
SLA #8
CON
STA @VM33
CON
SMOV @VM33 *@VM34
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM37
LD CR2002                ; 常時ON
LDA $0022
CON
SLA #8
CON
STA @VM36
CON
SMOV @VM36 *@VM37
LD CR2002                ; 常時ON
SADD *@VM37 EM32122 *@VM37;LOT識別用No
SADD *@VM37 *@VM34 *@VM37
SMOV *@VM37 @DM50
;@D60.T="UD 1 direct LOTNO$(0)=" & CHR($22)& "\" & EM32122.T & CHR($22)&CHR(00)
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM40
LD CR2002                ; 常時ON
LDA #0
CON
SLA #8
CON
STA @VM39
CON
SMOV @VM39 *@VM40
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM43
LD CR2002                ; 常時ON
LDA $0022
CON
SLA #8
CON
STA @VM42
CON
SMOV @VM42 *@VM43
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM46
LD CR2002                ; 常時ON
LDA $0022
CON
SLA #8
CON
STA @VM45
CON
SMOV @VM45 *@VM46
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM48
SMOV "UD 1 direct LOTNO$(0)=" *@VM48
LD CR2002                ; 常時ON
SADD *@VM48 *@VM46 *@VM48
SADD *@VM48 "\" *@VM48
SADD *@VM48 EM32122 *@VM48;LOT識別用No
SADD *@VM48 *@VM43 *@VM48
SADD *@VM48 *@VM40 *@VM48
SMOV *@VM48 @DM60
;@D40=RCPSASC(@D60.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM50
RCPSASC @DM60 @DM10 @VM50; QTY
LD CR2002                ; 常時ON
MOV @VM50 @DM40
;SET(@R1011)
LD CR2002                ; 常時ON
SET @R1011
LABEL #1004
;
STG @R1012
RES @R1011
CON
SET @R1500               ; 送信
CON
JMP @R1013
STG @R1013
AND @R1501               ; 送信完了
RES @R1501               ; 送信完了
CON
JMP @R1014
STG @R1014
MPS
ANB @R1503               ; NG
JMP @R1015
MPP
AND @R1503               ; NG
JMP @R1114
;<h1/>内部ﾃﾞｰﾀClear
STG @R1015
AND @R1100
JMP @R1101
;@D20.T= "CLRMEAS"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1100)
LD @R1015
ANB @R1100
NCJ #1005
;@D20.T= "CLRMEAS"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM52
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM51
CON
SMOV @VM51 *@VM52
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM54
SMOV "CLRMEAS" *@VM54
LD CR2002                ; 常時ON
SADD *@VM54 *@VM52 *@VM54
SMOV *@VM54 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM56
RCPSASC @DM20 @DM10 @VM56; QTY
LD CR2002                ; 常時ON
MOV @VM56 @DM40
;SET(@R1100)
LD CR2002                ; 常時ON
SET @R1100
LABEL #1005
;
STG @R1101
RES @R1100
CON
SET @R1500               ; 送信
CON
JMP @R1102
STG @R1102
AND @R1501               ; 送信完了
RES @R1501               ; 送信完了
CON
JMP @R1103
STG @R1103
MPS
ANB @R1503               ; NG
JMP @R1104
MPP
AND @R1503               ; NG
JMP @R1114
;撮像
STG @R1104
AND @R1105
JMP @R1106
;@D20.T= "M"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1105)
LD @R1104
ANB @R1105
NCJ #1006
;@D20.T= "M"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM58
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM57
CON
SMOV @VM57 *@VM58
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM60
SMOV "M" *@VM60
LD CR2002                ; 常時ON
SADD *@VM60 *@VM58 *@VM60
SMOV *@VM60 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM62
RCPSASC @DM20 @DM10 @VM62; QTY
LD CR2002                ; 常時ON
MOV @VM62 @DM40
;SET(@R1105)
LD CR2002                ; 常時ON
SET @R1105
LABEL #1006
;
STG @R1106
RES @R1105
CON
SET @R1500               ; 送信
CON
JMP @R1107
STG @R1107
AND @R1501               ; 送信完了
RES @R1501               ; 送信完了
CON
JMP @R1108
STG @R1108
MPS
ANB @R1503               ; NG
MPS
AND MR4602               ; 画像検査1回目撮像中
JMP @R1109
MPP
AND MR4610               ; 画像検査2回目撮像中
JMP @R1200
MPP
AND @R1503               ; NG
JMP @R1114
;θ値読み込み
STG @R1109
AND @R1110
JMP @R1111
;@D20.T= "UD 2 7"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1110)
LDB LR10001
AND @R1109
ANB @R1110
NCJ #1016
;@D20.T= "UD 2 7"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM64
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM63
CON
SMOV @VM63 *@VM64
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM66
SMOV "UD 2 7" *@VM66
LD CR2002                ; 常時ON
SADD *@VM66 *@VM64 *@VM66
SMOV *@VM66 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM68
RCPSASC @DM20 @DM10 @VM68; QTY
LD CR2002                ; 常時ON
MOV @VM68 @DM40
;SET(@R1110)
LD CR2002                ; 常時ON
SET @R1110
LABEL #1016
;
;@D20.T= "UD 17 7"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1110)
LD LR10001
AND @R1109
ANB @R1110
NCJ #1018
;@D20.T= "UD 17 7"+CHR($00)'内部ﾃﾞｰﾀｸﾘｱ
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM70
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM69
CON
SMOV @VM69 *@VM70
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM72
SMOV "UD 17 7" *@VM72
LD CR2002                ; 常時ON
SADD *@VM72 *@VM70 *@VM72
SMOV *@VM72 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM74
RCPSASC @DM20 @DM10 @VM74; QTY
LD CR2002                ; 常時ON
MOV @VM74 @DM40
;SET(@R1110)
LD CR2002                ; 常時ON
SET @R1110
LABEL #1018
;
STG @R1111
RES @R1110
CON
SET @R1600               ; 読込Command送信
CON
JMP @R1112
STG @R1112
AND @R1601               ; 読込完了
RES @R1601               ; 読込完了
CON
JMP @R1113
STG @R1113
MPS
ANB @R1603               ; NG
JMP @R1115
MPP
AND @R1603               ; NG
JMP @R1114
;Error
STG @R1114
SET MR4604               ; 画像ｴﾗｰ
CON
JMP @R1115
STG @R1115
RES @R1503               ; NG
CON
RES @R1603               ; NG
CON
RES @R1803               ; NG
CON
SET MR4601               ; 一回目画像処理完了
CON
RES MR4602               ; 画像検査1回目撮像中
CON
ENDS
;XY読込
STG @R1200
AND @R1201               ; X軸読込
JMP @R1202
;@D20.T= "UD 2 5"+CHR($00)'X軸読込
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1201)
LDB LR10001
AND @R1200
ANB @R1201               ; X軸読込
NCJ #1014
;@D20.T= "UD 2 5"+CHR($00)'X軸読込
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM76
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM75
CON
SMOV @VM75 *@VM76
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM78
SMOV "UD 2 5" *@VM78
LD CR2002                ; 常時ON
SADD *@VM78 *@VM76 *@VM78
SMOV *@VM78 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM80
RCPSASC @DM20 @DM10 @VM80; QTY
LD CR2002                ; 常時ON
MOV @VM80 @DM40
;SET(@R1201)
LD CR2002                ; 常時ON
SET @R1201               ; X軸読込
LABEL #1014
;
;@D20.T= "UD 17 5"+CHR($00)'X軸読込
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1201)
LD LR10001
AND @R1200
ANB @R1201               ; X軸読込
NCJ #1020
;@D20.T= "UD 17 5"+CHR($00)'X軸読込
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM82
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM81
CON
SMOV @VM81 *@VM82
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM84
SMOV "UD 17 5" *@VM84
LD CR2002                ; 常時ON
SADD *@VM84 *@VM82 *@VM84
SMOV *@VM84 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM86
RCPSASC @DM20 @DM10 @VM86; QTY
LD CR2002                ; 常時ON
MOV @VM86 @DM40
;SET(@R1201)
LD CR2002                ; 常時ON
SET @R1201               ; X軸読込
LABEL #1020
;
STG @R1202
SET @R1800               ; XY読込
CON
JMP @R1203
STG @R1203
AND @R1801               ; XY読込完了
RES @R1801               ; XY読込完了
CON
RES @R1201               ; X軸読込
CON
JMP @R1204
STG @R1204
MPS
ANB @R1803               ; NG
JMP @R1205
MPP
AND @R1803               ; NG
JMP @R1211
STG @R1205
AND @R1206               ; Y軸読込
JMP @R1207
;@D20.T= "UD 2 6"+CHR($00)'Y軸読込
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1206)
LDB LR10001
AND @R1205
ANB @R1206               ; Y軸読込
NCJ #1015
;@D20.T= "UD 2 6"+CHR($00)'Y軸読込
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM88
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM87
CON
SMOV @VM87 *@VM88
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM90
SMOV "UD 2 6" *@VM90
LD CR2002                ; 常時ON
SADD *@VM90 *@VM88 *@VM90
SMOV *@VM90 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM92
RCPSASC @DM20 @DM10 @VM92; QTY
LD CR2002                ; 常時ON
MOV @VM92 @DM40
;SET(@R1206)
LD CR2002                ; 常時ON
SET @R1206               ; Y軸読込
LABEL #1015
;
;@D20.T= "UD 17 6"+CHR($00)'Y軸読込
;@D40=RCPSASC(@D20.T,@D10)
;SET(@R1206)
LD LR10001
AND @R1205
ANB @R1206               ; Y軸読込
NCJ #1022
;@D20.T= "UD 17 6"+CHR($00)'Y軸読込
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM94
LD CR2002                ; 常時ON
LDA $0000
CON
SLA #8
CON
STA @VM93
CON
SMOV @VM93 *@VM94
LD CR2002                ; 常時ON
ADRADD.S +1 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM96
SMOV "UD 17 6" *@VM96
LD CR2002                ; 常時ON
SADD *@VM96 *@VM94 *@VM96
SMOV *@VM96 @DM20
;@D40=RCPSASC(@D20.T,@D10)
;
LD CR2002                ; 常時ON
MOV #0 @VM98
RCPSASC @DM20 @DM10 @VM98; QTY
LD CR2002                ; 常時ON
MOV @VM98 @DM40
;SET(@R1206)
LD CR2002                ; 常時ON
SET @R1206               ; Y軸読込
LABEL #1022
;
STG @R1207
SET @R1800               ; XY読込
CON
JMP @R1208
STG @R1208
AND @R1801               ; XY読込完了
RES @R1801               ; XY読込完了
CON
RES @R1206               ; Y軸読込
CON
JMP @R1209
STG @R1209
MPS
ANB @R1803               ; NG
JMP @R1211
MPP
AND @R1803               ; NG
JMP @R1210
;Error
STG @R1210
SET MR4604               ; 画像ｴﾗｰ
CON
JMP @R1211
STG @R1211
RES @R1603               ; NG
CON
RES @R1803               ; NG
CON
SET MR4609               ; 二回目画像処理完了
CON
RES MR4610               ; 画像検査2回目撮像中
CON
ENDS
;<h1/>---COMMAND メッセージの送信---
STG @R1500               ; 送信
ZRES @DM100 @DM199
CON
SET @R1502               ; 送信中
CON
JMP @R1504
STG @R1504
ANB R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1506
STG @R1506
U_MSGTO #0 @DM0          ; IP
U_MSGSND #0 @DM10        ; QTY
SET R30700               ; ﾒｯｾｰｼﾞ通信実行要求
CON
AND R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1507
STG @R1507
MPS
ANB R31701               ; ﾒｯｾｰｼﾞ通信失敗
U_MSGRCV #0 @DM100
@CPSASC @DM100 @DM120    ; 読込ﾃﾞｰﾀ
JMP @R1508
MPP
AND R31701               ; ﾒｯｾｰｼﾞ通信失敗
SET @R1503               ; NG
CON
JMP @R1508
STG @R1508
RES R30700               ; ﾒｯｾｰｼﾞ通信実行要求
CON
ANB R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1509
;ER=#17746
STG @R1509
MPS
AND<> @DM120 #17746      ; 読込ﾃﾞｰﾀ
JMP @R1510
MPP
AND= @DM120 #17746       ; 読込ﾃﾞｰﾀ
SET @R1503               ; NG
CON
JMP @R1510
STG @R1510
RES @R1502               ; 送信中
CON
SET @R1501               ; 送信完了
CON
ENDS
;<h1/>Data読込:θ
STG @R1600               ; 読込Command送信
ZRES @DM100 @DM199
CON
SET @R1602               ; 送信中
CON
JMP @R1604               ; 未読込
STG @R1604               ; 未読込
JMP @R1605
STG @R1605
RES @R1606
CON
MPS
U_MSGSND #0 @DM10        ; QTY
MPP
ANB R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1607
STG @R1607
SET R30700               ; ﾒｯｾｰｼﾞ通信実行要求
CON
AND R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1608
STG @R1608
MPS
ANB R31701               ; ﾒｯｾｰｼﾞ通信失敗
U_MSGRCV #0 @DM100
@CPSASC @DM100 @DM120    ; 読込ﾃﾞｰﾀ
JMP @R1609
MPP
AND R31701               ; ﾒｯｾｰｼﾞ通信失敗
SET @R1603               ; NG
CON
JMP @R1704
STG @R1609
RES R30700               ; ﾒｯｾｰｼﾞ通信実行要求
CON
ANB R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1610
;読み込み開始
STG @R1610
JMP @R1611
DW #20 @DM140            ; Parameter1
CON
DW #0 @DM141             ; Parameter2
CON
SFINDN @DM120 "OK" @DM140 @DM144;読込ﾃﾞｰﾀ  Parameter1  検索数格納
;$FFFF=未読
STG @R1611
MPS
AND= @DM144 $FFFF        ; 検索数格納
JMP @R1604               ; 未読込
MPP
AND<> @DM144 $FFFF       ; 検索数格納
JMP @R1612               ; 読込完了
STG @R1612               ; 読込完了
AND @R1613
JMP @R1615
;@D146=SFIND(@D120.T,".",0)
;@D150.T=SLEFT(@D120.T,@D146)'小数点以下削除
;SET(@R1613)
LD @R1612                ; 読込完了
ANB @R1613
NCJ #1012
;@D146=SFIND(@D120.T,".",0)
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM99
SMOV "." *@VM99
LD CR2002                ; 常時ON
MOV #0 @VM101
SFIND @DM120 *@VM99 @VM101 #0;読込ﾃﾞｰﾀ
LD CR2002                ; 常時ON
MOV @VM101 @DM146
;@D150.T=SLEFT(@D120.T,@D146)'小数点以下削除
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM102
LD CR2002                ; 常時ON
SLEFT @DM120 *@VM102 @DM146;読込ﾃﾞｰﾀ
LD CR2002                ; 常時ON
SMOV *@VM102 @DM150
;SET(@R1613)
LD CR2002                ; 常時ON
SET @R1613
LABEL #1012
;
STG @R1615
RES @R1613
CON
JMP @R1701
STG @R1701
TMR #1342 #0
CON
AND T1342
AND @R1702
JMP @R1703
;@D160.L=(RDASC(@D150.T)/1)'BIN変換
;SET(@R1702)
LD @R1701
ANB @R1702
NCJ #1013
;@D160.L=(RDASC(@D150.T)/1)'BIN変換
;
LD CR2002                ; 常時ON
MOV.L +0 @VM104
RDASC.L @DM150 @VM104
LD CR2002                ; 常時ON
LDA.L @VM104
CON
EXT.L
CON
DIV.L +1
CON
STA.L @DM160             ; 取込み移動量
;SET(@R1702)
LD CR2002                ; 常時ON
SET @R1702
LABEL #1013
;
STG @R1703
TMR #1340 #0
CON
AND T1340
RES @R1702
CON
MPS
AND<>.L @DM160 -9999000  ; 取込み移動量
JMP @R1704
MPP
AND=.L @DM160 -9999000   ; 取込み移動量
SET @R1603               ; NG
CON
JMP @R1705
STG @R1704
MPS
LD<=.L DM20024 @DM160    ; 取込み移動量
AND<=.L @DM160 DM20020   ; 取込み移動量
ANL
LDA.L @DM160             ; 取込み移動量
CON
EXT.L
CON
DIV.L +10
CON
STA.L EM2284             ; ｱﾗｲﾒﾝﾄ θ軸移動量
CON
STA.L EM38302
CON
JMP @R1705
MPP
LD>.L DM20024 @DM160     ; 取込み移動量
OR>.L @DM160 DM20020     ; 取込み移動量
ANL
SET MR4507               ; 1回目画像ﾃﾞｰﾀ ｱﾗｲﾒﾝﾄ範囲外
CON
SET @R1603               ; NG
CON
JMP @R1705
STG @R1705
RES @R1602               ; 送信中
CON
SET @R1601               ; 読込完了
CON
ENDS
;<h1/>Data読込:XY
STG @R1800               ; XY読込
ZRES @DM100 @DM199
CON
SET @R1802               ; XY読込中
CON
JMP @R1804
STG @R1804
JMP @R1805
STG @R1805
MPS
U_MSGSND #0 @DM10        ; QTY
MPP
ANB R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1807
STG @R1807
SET R30700               ; ﾒｯｾｰｼﾞ通信実行要求
CON
AND R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1808
STG @R1808
MPS
ANB R31701               ; ﾒｯｾｰｼﾞ通信失敗
U_MSGRCV #0 @DM100
@CPSASC @DM100 @DM120    ; 読込ﾃﾞｰﾀ
JMP @R1809
MPP
AND R31701               ; ﾒｯｾｰｼﾞ通信失敗
SET @R1803               ; NG
CON
JMP @R1904
STG @R1809
RES R30700               ; ﾒｯｾｰｼﾞ通信実行要求
CON
ANB R31700               ; ﾒｯｾｰｼﾞ通信完了
JMP @R1810
;読み込み開始
STG @R1810
JMP @R1811
DW #20 @DM140            ; Parameter1
CON
DW #0 @DM141             ; Parameter2
CON
SFINDN @DM120 "OK" @DM140 @DM144;読込ﾃﾞｰﾀ  Parameter1  検索数格納
;$FFFF=未読
STG @R1811
MPS
AND= @DM144 $FFFF        ; 検索数格納
JMP @R1804
MPP
AND<> @DM144 $FFFF       ; 検索数格納
JMP @R1812
STG @R1812
AND @R1813
JMP @R1815
;@D146=SFIND(@D120.T,".",0)
;@D150.T=SLEFT(@D120.T,@D146)'小数点以下削除
;SET(@R1813)
LD @R1812
ANB @R1813
NCJ #1010
;@D146=SFIND(@D120.T,".",0)
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM106
SMOV "." *@VM106
LD CR2002                ; 常時ON
MOV #0 @VM108
SFIND @DM120 *@VM106 @VM108 #0;読込ﾃﾞｰﾀ
LD CR2002                ; 常時ON
MOV @VM108 @DM146
;@D150.T=SLEFT(@D120.T,@D146)'小数点以下削除
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM109
LD CR2002                ; 常時ON
SLEFT @DM120 *@VM109 @DM146;読込ﾃﾞｰﾀ
LD CR2002                ; 常時ON
SMOV *@VM109 @DM150
;SET(@R1813)
LD CR2002                ; 常時ON
SET @R1813
LABEL #1010
;
STG @R1815
RES @R1813
CON
JMP @R1901
STG @R1901
TMR #1343 #0
CON
AND T1343
AND @R1902
JMP @R1903
;@D160.L=(RDASC(@D150.T)/1)'BIN変換
;SET(@R1902)
LD @R1901
ANB @R1902
NCJ #1011
;@D160.L=(RDASC(@D150.T)/1)'BIN変換
;
LD CR2002                ; 常時ON
MOV.L +0 @VM111
RDASC.L @DM150 @VM111
LD CR2002                ; 常時ON
LDA.L @VM111
CON
EXT.L
CON
DIV.L +1
CON
STA.L @DM160             ; 取込み移動量
;SET(@R1902)
LD CR2002                ; 常時ON
SET @R1902
LABEL #1011
;
STG @R1903
TMR #1341 #0
CON
AND T1341
RES @R1902
CON
MPS
LD<>.L @DM160 -9999000   ; 取込み移動量
AND<>.L @DM160 +0        ; 取込み移動量
ANL
JMP @R1904
MPP
LD=.L @DM160 -9999000    ; 取込み移動量
OR=.L @DM160 +0          ; 取込み移動量
ANL
SET MR4604               ; 画像ｴﾗｰ
CON
SET @R1803               ; NG
CON
JMP @R1905
STG @R1904
MPS
AND @R1201               ; X軸読込
MPS
LD<=.L DM20004 @DM160    ; 取込み移動量
AND<=.L @DM160 DM20000   ; 取込み移動量
ANL
LDA.L @DM160             ; 取込み移動量
CON
EXT.L
CON
DIV.L +10000
CON
STA.L EM2280             ; ｱﾗｲﾒﾝﾄ X軸移動量
CON
STA.L EM38002
CON
JMP @R1905
MPP
LD>.L DM20004 @DM160     ; 取込み移動量
OR>.L @DM160 DM20000     ; 取込み移動量
ANL
SET MR4507               ; 1回目画像ﾃﾞｰﾀ ｱﾗｲﾒﾝﾄ範囲外
CON
SET @R1803               ; NG
CON
JMP @R1905
MPP
AND @R1206               ; Y軸読込
MPS
LD<=.L DM20014 @DM160    ; 取込み移動量
AND<=.L @DM160 DM20010   ; 取込み移動量
ANL
LDA.L @DM160             ; 取込み移動量
CON
EXT.L
CON
DIV.L +10000
CON
STA.L EM2282             ; ｱﾗｲﾒﾝﾄ Y軸移動量
CON
STA.L EM38102
CON
JMP @R1905
MPP
LD>.L DM20014 @DM160     ; 取込み移動量
OR>.L @DM160 DM20010     ; 取込み移動量
ANL
SET MR4507               ; 1回目画像ﾃﾞｰﾀ ｱﾗｲﾒﾝﾄ範囲外
CON
SET @R1803               ; NG
CON
JMP @R1905
STG @R1905
RES @R1802               ; XY読込中
CON
SET @R1801               ; XY読込完了
CON
ENDS
;
END
ENDH
