DEVICE:53
;MODULE:RB_Control
;MODULE_TYPE:0
;SCRIPT_TYPE:
;<h1/>Device_Init/ﾃﾞﾊﾞｲｽ初期化
;<h1/>RB_interlock
LD R013                  ; 安全扉状態(ON=OK)
AND R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
OUT MR600                ; RB1_HOME_interlock_OK
OUT MR601                ; RB1_P1_interlock_OK
OUT MR602                ; RB1_P2_interlock_OK
OUT MR603                ; RB1_P3_interlock_OK
OUT MR604                ; RB1_P4_interlock_OK
OUT MR605                ; RB1_P5_interlock_OK
LD R013                  ; 安全扉状態(ON=OK)
AND R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
ANB R54002               ; During RB1 MOVE 
ANB R54010               ; During RB1 HOME
AND DM10607.4
LD= DM2020 #1            ; RBT RB Position No
AND MR600                ; RB1_HOME_interlock_OK
LD= DM2020 #2            ; RBT RB Position No
AND MR602                ; RB1_P2_interlock_OK
ORL
LD= DM2020 #3            ; RBT RB Position No
AND MR603                ; RB1_P3_interlock_OK
ORL
LD= DM2020 #4            ; RBT RB Position No
AND MR604                ; RB1_P4_interlock_OK
ORL
LD= DM2020 #5            ; RBT RB Position No
AND MR605                ; RB1_P5_interlock_OK
ORL
LD= DM2020 #0            ; RBT RB Position No
AND MR605                ; RB1_P5_interlock_OK
ORL
ANL
OUT MR30809              ; RB1_move OK
;<h1/>TP_RB_Teach
LD= EM30000 #550         ; (TP)現在表示中画面No.
RES MR305                ; 原点復帰完了
CON
MPS
AND MR30200              ; TP:ｻｰﾎﾞONsw
ALT DM10807.4            ; RB1ｻｰﾎﾞon
MPP
AND DM10607.4
OUT MR30400              ; TPRB1ｻｰﾎﾞｵﾝLamp
LD CR2002                ; 常時ON
LDA DM10606              ; RB1ｱﾗｰﾑｺｰﾄﾞ
CON
STA DM22004              ; TP_RB_ALM_CODE
LD DM10607.3
OUT MR30401              ; TP_RB1_ALM_Lamp
LDP MR30201              ; TP_RB1_ALM_SW
SET DM10807.3            ; RB1_ALM_res
LDF MR30201              ; TP_RB1_ALM_SW
RES DM10807.3            ; RB1_ALM_res
LD CR2002                ; 常時ON
LDA.L DM10600            ; RB1現在値L
CON
STA.L DM22000            ; TP_RB_NOW_Pos
LD MR30214               ; TP_RB_+SW
ANB MR30215              ; TP_RB_-SW
SET DM10807.8            ; RB1_jog+
LDF MR30214              ; TP_RB_+SW
RES DM10807.8            ; RB1_jog+
LD MR30215               ; TP_RB_-SW
ANB MR30214              ; TP_RB_+SW
SET DM10807.7            ; RB1_jog-
LDF MR30215              ; TP_RB_-SW
RES DM10807.7            ; RB1_jog-
LDP MR30212              ; TP inc/jog sw
ALT DM10807.5            ; RB1_inc
LD DM10807.5             ; RB1_inc
OUT MR30412              ; inc_lamp
LDP MR30213              ; TP_RB_HIGH/LOW_sw
ALT DM10807.6            ; RB1_high
LD DM10807.6             ; RB1_high
OUT MR30413              ; High_lamp
LD DM10607.1
LD R54010                ; During RB1 HOME
AND MR005                ; ﾗﾝﾌﾟ点滅用(0.5S)
ORL
OUT MR30808              ; RB1_HOME_Lamp
CON
OUT MR30500              ; TP_RB1_home_lamp
LD= DM20202 #1           ; RB1現在位置No
LD= DM2020 #1            ; RBT RB Position No
AND DM10607.2
OR MR30600               ; TP_RB1_P1_move_sw
AND MR005                ; ﾗﾝﾌﾟ点滅用(0.5S)
ORL
OUT MR30800              ; RB1_P1_Lamp
LD= DM20202 #2           ; RB1現在位置No
LD= DM2020 #2            ; RBT RB Position No
AND DM10607.2
OR MR30601               ; TP_RB1_P2_move_sw
AND MR005                ; ﾗﾝﾌﾟ点滅用(0.5S)
ORL
OUT MR30801              ; RB1_P2_Lamp
LD= DM20202 #3           ; RB1現在位置No
LD= DM2020 #3            ; RBT RB Position No
AND DM10607.2
OR MR30602               ; TP_RB1_P3_move_sw
AND MR005                ; ﾗﾝﾌﾟ点滅用(0.5S)
ORL
OUT MR30802              ; RB1_P3_Lamp
LD= DM20202 #4           ; RB1現在位置No
LD= DM2020 #4            ; RBT RB Position No
AND DM10607.2
OR MR30603               ; TP_RB1_P4_move_sw
AND MR005                ; ﾗﾝﾌﾟ点滅用(0.5S)
ORL
OUT MR30803              ; RB1_P4_Lamp
LD= DM20202 #5           ; RB1現在位置No
LD= DM2020 #5            ; RBT RB Position No
AND DM10607.2
OR MR30604               ; TP_RB1_P5_move_sw
AND MR005                ; ﾗﾝﾌﾟ点滅用(0.5S)
ORL
OUT MR30804              ; RB1_P5_Lamp
;<h1/>RB1 HOME
LDP MR30300              ; TP_RB_HOME_sw
ORP MR30608              ; TP_RB_HOME_sw2
ANB R54010               ; During RB1 HOME
ANB R54002               ; During RB1 MOVE 
AND MR600                ; RB1_HOME_interlock_OK
SET @MR000
STG @MR000
SET MR403                ; ｴﾘｱｾﾝｻ監視中
CON
SET MR506                ; RB電源ON
CON
SET R54008               ; RB1 HOME
CON
JMP @MR001
STG @MR001
AND R54009               ; RB1 HOME END
RES MR403                ; ｴﾘｱｾﾝｻ監視中
CON
RES R54009               ; RB1 HOME END
CON
ENDS
;#20	=	正常終了
;#21	=	RB応答なし
;#22	=	ｽﾃｰﾀｽ異常
;#25	=	原点異常
;#26	=	原点ｾﾝｻｰ異常
STG R54008               ; RB1 HOME
DW #0 DM2020             ; RBT RB Position No
CON
DW #0 DM20202            ; RB1現在位置No
CON
DW #0 @DM50              ; Macro　Status　RB1HOME
CON
SET R54010               ; During RB1 HOME
CON
JMP @MR200               ; Task1 SELECT_ACT
STG @MR200               ; Task1 SELECT_ACT
MPS
LDB MR315                ; 扉開処理中
ANB MR415                ; ｴﾘｱｾﾝｻ監視中遮光記憶
ANL
MSTRT CON_HOME DM10600 DM10800 @DM50;RB1現在値L  RB1目標位置L  Macro　Status　RB1HOME
MPS
AND= @DM50 #20           ; Macro　Status　RB1HOME
DW #0 DM20202            ; RB1現在位置No
CON
JMP @MR201               ; Task1 SEL_ACT END
MPP
LD<> @DM50 #20           ; Macro　Status　RB1HOME
AND<> @DM50 #0           ; Macro　Status　RB1HOME
ANL
SET R54003               ; RB1 Alarm
CON
JMP @MR201               ; Task1 SEL_ACT END
MPP
LD MR415                 ; ｴﾘｱｾﾝｻ監視中遮光記憶
OR MR315                 ; 扉開処理中
ANL
ZRES MR30600 MR30605     ; TP_RB1_P1_move_sw
CON
RES R54009               ; RB1 HOME END
CON
RES R54010               ; During RB1 HOME
CON
ENDS
STG @MR201               ; Task1 SEL_ACT END
ZRES MR30600 MR30605     ; TP_RB1_P1_move_sw
CON
SET R54009               ; RB1 HOME END
CON
RES R54010               ; During RB1 HOME
CON
ENDS
;<h1/>RB1 MOVE
LD MR30600               ; TP_RB1_P1_move_sw
AND R4007                ; ﾊﾟｯｸ首溶着 開限
ANB R4006                ; ﾊﾟｯｸ首溶着 閉限
ANB R4014                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着閉限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
ANB R54010               ; During RB1 HOME
ANB R54002               ; During RB1 MOVE 
AND MR601                ; RB1_P1_interlock_OK
AND MR30808              ; RB1_HOME_Lamp
MPS
SET MR30510              ; TP_ｽﾀｰﾄSW　点滅
MPP
ANP MR21000              ; TP_自動ｽﾀｰﾄSW
DW #1 DM2020             ; RBT RB Position No
CON
RES MR30600              ; TP_RB1_P1_move_sw
CON
SET @MR103
LD MR30601               ; TP_RB1_P2_move_sw
AND R4007                ; ﾊﾟｯｸ首溶着 開限
ANB R4006                ; ﾊﾟｯｸ首溶着 閉限
ANB R4014                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着閉限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
ANB R54010               ; During RB1 HOME
ANB R54002               ; During RB1 MOVE 
AND MR602                ; RB1_P2_interlock_OK
AND MR30808              ; RB1_HOME_Lamp
MPS
SET MR30510              ; TP_ｽﾀｰﾄSW　点滅
MPP
ANP MR21000              ; TP_自動ｽﾀｰﾄSW
DW #2 DM2020             ; RBT RB Position No
CON
RES MR30601              ; TP_RB1_P2_move_sw
CON
SET @MR103
LD MR30602               ; TP_RB1_P3_move_sw
AND R4007                ; ﾊﾟｯｸ首溶着 開限
ANB R4006                ; ﾊﾟｯｸ首溶着 閉限
ANB R4014                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着閉限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
ANB R54010               ; During RB1 HOME
ANB R54002               ; During RB1 MOVE 
AND MR603                ; RB1_P3_interlock_OK
AND MR30808              ; RB1_HOME_Lamp
MPS
SET MR30510              ; TP_ｽﾀｰﾄSW　点滅
MPP
ANP MR21000              ; TP_自動ｽﾀｰﾄSW
DW #3 DM2020             ; RBT RB Position No
CON
RES MR30602              ; TP_RB1_P3_move_sw
CON
SET @MR103
LD MR30603               ; TP_RB1_P4_move_sw
AND R4007                ; ﾊﾟｯｸ首溶着 開限
ANB R4006                ; ﾊﾟｯｸ首溶着 閉限
ANB R4014                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着閉限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
ANB R54010               ; During RB1 HOME
ANB R54002               ; During RB1 MOVE 
AND MR604                ; RB1_P4_interlock_OK
AND MR30808              ; RB1_HOME_Lamp
MPS
SET MR30510              ; TP_ｽﾀｰﾄSW　点滅
MPP
ANP MR21000              ; TP_自動ｽﾀｰﾄSW
DW #4 DM2020             ; RBT RB Position No
CON
RES MR30603              ; TP_RB1_P4_move_sw
CON
SET @MR103
LD MR30604               ; TP_RB1_P5_move_sw
AND R4007                ; ﾊﾟｯｸ首溶着 開限
ANB R4006                ; ﾊﾟｯｸ首溶着 閉限
ANB R4014                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着閉限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
ANB R54010               ; During RB1 HOME
ANB R54002               ; During RB1 MOVE 
AND MR605                ; RB1_P5_interlock_OK
AND MR30808              ; RB1_HOME_Lamp
MPS
SET MR30510              ; TP_ｽﾀｰﾄSW　点滅
MPP
ANP MR21000              ; TP_自動ｽﾀｰﾄSW
DW #5 DM2020             ; RBT RB Position No
CON
RES MR30604              ; TP_RB1_P5_move_sw
CON
SET @MR103
STG @MR103
SET MR403                ; ｴﾘｱｾﾝｻ監視中
CON
SET R54000               ; RB1 MOVE
CON
RES MR30510              ; TP_ｽﾀｰﾄSW　点滅
CON
RES MR305                ; 原点復帰完了
CON
SET MR307                ; ﾒﾝﾃ動作中
CON
JMP @MR104
STG @MR104
AND R54001               ; RB1 MOVE END
RES MR403                ; ｴﾘｱｾﾝｻ監視中
CON
RES MR307                ; ﾒﾝﾃ動作中
CON
RES R54001               ; RB1 MOVE END
CON
ENDS
;#20	=	正常終了
;#21	=	RB応答なし
;#22	=	ｽﾃｰﾀｽ異常
;#25	=	原点異常
;#26	=	原点ｾﾝｻｰ異常
STG R54000               ; RB1 MOVE
DW #0 DM20202            ; RB1現在位置No
CON
DW #0 @DM51              ; Macro　Status　RB1MOVE
CON
SET R54002               ; During RB1 MOVE 
CON
JMP @MR202               ; Task1 SEL_ACT Busy
;'Target pos
;DM2100.L=DM22010.L:((DM2020-1)*2)
;'速度/Speed
;DM2104 = DM22030:((DM2020-1)*2)
;'加減速/Acceleration / deceleration
;DM2105 = DM22050:((DM2020-1)*2)
LD @MR202                ; Task1 SEL_ACT Busy
NCJ #1000
;'Target pos
;
;DM2100.L=DM22010.L:((DM2020-1)*2)
;
LD CR2002                ; 常時ON
LDA DM2020               ; RBT RB Position No
CON
EXT
CON
SUB.L +1
CON
MUL.L +2
CON
STA.L Z12
CON
MOV.L DM22010:Z12 DM2100 ; RB1 目標値下位
;'速度/Speed
;
;DM2104 = DM22030:((DM2020-1)*2)
;
LD CR2002                ; 常時ON
LDA DM2020               ; RBT RB Position No
CON
EXT
CON
SUB.L +1
CON
MUL.L +2
CON
STA.L Z12
CON
MOV DM22030:Z12 DM2104   ; RB1 速度
;'加減速/Acceleration / deceleration
;
;DM2105 = DM22050:((DM2020-1)*2)
LD CR2002                ; 常時ON
LDA DM2020               ; RBT RB Position No
CON
EXT
CON
SUB.L +1
CON
MUL.L +2
CON
STA.L Z12
CON
MOV DM22050:Z12 DM2105   ; RB1P1設定加減速ﾊﾞｯﾌｧ  RB1 G
LABEL #1000
;
STG @MR202               ; Task1 SEL_ACT Busy
MPS
ANB MR415                ; ｴﾘｱｾﾝｻ監視中遮光記憶
MSTRT CON_MOVE_1 DM2100 DM2104 DM2105 DM10600 DM10800 @DM51;RB1 目標値下位  RB1 速度  RB1 G  RB1現在値L  RB1目標位置L  Macro　Status　RB1MOVE
MPS
AND= @DM51 #20           ; Macro　Status　RB1MOVE
LDA DM2010               ; RB1 RB SELECT No (Main)
CON
STA DM20202              ; RB1現在位置No
CON
JMP @MR203
MPP
LD<> @DM51 #20           ; Macro　Status　RB1MOVE
AND<> @DM51 #0           ; Macro　Status　RB1MOVE
ANL
SET R54003               ; RB1 Alarm
CON
JMP @MR203
MPP
AND MR415                ; ｴﾘｱｾﾝｻ監視中遮光記憶
JMP @MR203
STG @MR203
ANB MR007                ; CON_MOVE_ON
RES R54002               ; During RB1 MOVE 
CON
SET R54001               ; RB1 MOVE END
CON
ENDS
LD= EM30000 #550         ; (TP)現在表示中画面No.
MPS
LD MR30202               ; TP_RB1_P1_sw
ANP MR30210
ANL
MOV.L DM22000 DM22010    ; TP_RB_NOW_Pos
MRD
LD MR30203               ; TP_RB1_P2_sw
ANP MR30210
ANL
MOV.L DM22000 DM22012    ; TP_RB_NOW_Pos
MRD
LD MR30204               ; TP_RB1_P3_sw
ANP MR30210
ANL
MOV.L DM22000 DM22014    ; TP_RB_NOW_Pos
MRD
LD MR30205               ; TP_RB1_P4_sw
ANP MR30210
ANL
MOV.L DM22000 DM22016    ; TP_RB_NOW_Pos
MPP
LD MR30206               ; TP_RB1_P5_sw
ANP MR30210
ANL
MOV.L DM22000 DM22018    ; TP_RB_NOW_Pos
;<h1/>▼_RB1 現在位置確認
;'RB位置決め範囲内確認
;E20060.L = K200			'位置決め幅0.3mm	
;E20000.L = D10600.L - E20060.L	'INPOS(-)
;E20002.L = D10600.L + E20060.L	'INPOS(+)
LD CR2002                ; 常時ON
NCJ #1001
;'RB位置決め範囲内確認
;
;E20060.L = K200			'位置決め幅0.3mm	
;
LD CR2002                ; 常時ON
MOV.L +200 EM20060
;E20000.L = D10600.L - E20060.L	'INPOS(-)
;
LD CR2002                ; 常時ON
LDA.L DM10600            ; RB1現在値L
CON
SUB.L EM20060
CON
STA.L EM20000            ; RB1_INPOS(-)L
;E20002.L = D10600.L + E20060.L	'INPOS(+)
LD CR2002                ; 常時ON
LDA.L DM10600            ; RB1現在値L
CON
ADD.L EM20060
CON
STA.L EM20002            ; RB1_INPOS(+)L
LABEL #1001
;
LD MR305                 ; 原点復帰完了
OR DM10607.1
MPS
LD<=.L EM20000 DM22010   ; RB1_INPOS(-)L
AND>=.L EM20002 DM20210  ; RB1_INPOS(+)L
ANL
OUT MR2101               ; RB1_P1(搬送)給除材位置
MRD
LD<=.L EM20000 DM22012   ; RB1_INPOS(-)L
AND>=.L EM20002 DM22012  ; RB1_INPOS(+)L
ANL
OUT MR2102               ; RB1_P2(搬送)QR読み込み位置
MRD
LD<=.L EM20000 DM22014   ; RB1_INPOS(-)L
AND>=.L EM20002 DM22014  ; RB1_INPOS(+)L
ANL
OUT MR2103               ; RB1_P3(搬送)首溶着位置
MRD
LD<=.L EM20000 DM22016   ; RB1_INPOS(-)L
AND>=.L EM20002 DM22016  ; RB1_INPOS(+)L
ANL
OUT MR2104               ; RB1_P4(搬送)肩溶着位置
MPP
LD<=.L EM20000 DM22018   ; RB1_INPOS(-)L
AND>=.L EM30002 DM22018
ANL
OUT MR2105               ; RB1_P5(搬送)
END
ENDH
