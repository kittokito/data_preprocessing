DEVICE:53
;MODULE:Main
;MODULE_TYPE:0
;SCRIPT_TYPE:
;ｲﾆｼｬﾗｲｽﾞ/Initialize
LD CR2008                ; 運転開始時1ｽｷｬﾝON
ORP MR900                ; 重度異常：電源再投入必要
RES DM10807.2            ; 一時停止
CON
RES MR20011              ; ﾜｰｸ除材要求
CON
ZRES @MR000 @MR5015
LD @MR2003               ; 首溶着動作中
OR @MR2203               ; 肩溶着動作中
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
RES MR7014               ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 溶着
CON
RES MR7012               ; ﾊﾟｯｸ首溶着　下降
CON
RES MR504                ; 非常停止
CON
RES MR305                ; 原点復帰完了
CON
RES MR30007              ; ｻｲｸﾙ動作中
CON
RES MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
DW #0 DM2020             ; RBT RB Position No
CON
RES DM10807.2            ; 一時停止
CON
RES MR20011              ; ﾜｰｸ除材要求
CON
ZRES @MR000 @MR5015
;<<装置起動日確認>>
;<<Confirmation on device start day>>
;※電源投入日と最終電源投入日が違う時は、ワークNo.を0リセットする。
;※When the power supply turning on day and the final power supply turning on
;  day are different, 0 resets of work No..
LD CR2008                ; 運転開始時1ｽｷｬﾝON
BMOV CM700 DM0 #3        ; ｶﾚﾝﾀﾞﾀｲﾏ（年）  電源投入日ﾃﾞｰﾀ(年)
SET @MR200
STG @MR200
BCMP DM0 DM10 TM0 #3     ; 電源投入日ﾃﾞｰﾀ(年)  最終電源投入日ﾃﾞｰﾀ(年)
JMP @MR201
STG @MR201
BMOV DM0 DM10 #3         ; 電源投入日ﾃﾞｰﾀ(年)  最終電源投入日ﾃﾞｰﾀ(年)
MPS
AND CR2010               ; 演算結果がｾﾞﾛ
ENDS
MPP
ANB CR2010               ; 演算結果がｾﾞﾛ
FMOV #0 DM200 #250       ; 機種1部品1ﾜｰｸNo
ENDS
;<h1/>※ﾃﾞﾊﾞｲｽﾈｯﾄ 参加状態 登録ﾉｰﾄﾞ比較
LD= DM10110 DM10114      ; 登録ﾉｰﾄﾞ一覧(0-15)  正常通信ﾉｰﾄﾞ一覧(0-15)
AND= DM10111 DM10115     ; 登録ﾉｰﾄﾞ一覧(16-31)  正常通信ﾉｰﾄﾞ一覧(16-31)
AND= DM10112 DM10116     ; 登録ﾉｰﾄﾞ一覧(32-47)  正常通信ﾉｰﾄﾞ一覧(32-47)
AND= DM10113 DM10117     ; 登録ﾉｰﾄﾞ一覧(48-63)  正常通信ﾉｰﾄﾞ一覧(48-63)
OUT R58500               ; DEVICEﾈｯﾄ登録ﾉｰﾄﾞ一致
;電源ON wait/Power ON wait
LD CR2002                ; 常時ON
TMR @30 #10              ; 電源ON wait
TMR @31 #50              ; 電源ON wait2
;電源投入時の初期画面表示/Initial screen display at power on
;EM30025=1:原点復帰要求/Home position return request
LD @T30                  ; 電源ON wait
@DW #0 EM30001           ; (TP)ﾍﾟｰｼﾞ画面切替用No.
CON
@SET MR506               ; RB電源ON
CON
@SET MR504               ; 非常停止
LD @T31                  ; 電源ON wait2
AND R58500               ; DEVICEﾈｯﾄ登録ﾉｰﾄﾞ一致
@RES MR305               ; 原点復帰完了
CON
@DW #500 EM30001         ; (TP)ﾍﾟｰｼﾞ画面切替用No.
;<h1/>※ｴﾘｱｾﾝｻｰ遮光記憶処理
LD MR403                 ; ｴﾘｱｾﾝｻ監視中
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
ANB MR415                ; ｴﾘｱｾﾝｻ監視中遮光記憶
@RES MR504               ; 非常停止
CON
@SET MR415               ; ｴﾘｱｾﾝｻ監視中遮光記憶
LD MR415                 ; ｴﾘｱｾﾝｻ監視中遮光記憶
AND R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
ANB MR902                ; ｴﾗｰ
@SET MR504               ; 非常停止
CON
@RES MR415               ; ｴﾘｱｾﾝｻ監視中遮光記憶
;<h1/>■原点復帰動作/Starting return home position
;@MR100〜315
;TP画面0：初期画面/TP screen 0: initial screen
;EM30025=2:原点復帰中/Returning to home position
LD= EM30000 #500         ; (TP)現在表示中画面No.
ANB MR306                ; 自動運転中
ANB MR307                ; ﾒﾝﾃ動作中
ANB MR902                ; ｴﾗｰ
ANB MR315                ; 扉開処理中
ANB MR30003              ; 原点復帰中
AND MR20102              ; HOME  Select
MPS
OUT @MR410               ; 動作開始要求11
MPP
ANP MR21000              ; TP_自動ｽﾀｰﾄSW
SET @MR101
;<h1/> 原点復帰ﾓｼﾞｭｰﾙ起動/Activation of home module
STG @MR101
MDSTRT Home
SET MR304                ; 原点復帰中
CON
SET MR30100              ; 原点復帰開始
CON
JMP @MR102
STG @MR102
ANF _Home
JMP @MR106
;終了/End
STG @MR106
RES MR20102              ; HOME  Select
CON
RES MR304                ; 原点復帰中
CON
SET MR305                ; 原点復帰完了
CON
ENDS
;<h1/>■自動動作/Automatic operation
;@MR500〜1915
LD R4002                 ; ﾊﾟｯｸ首溶着上放射温度計
AND R4003                ; ﾊﾟｯｸ首溶着下放射温度計
AND R4004                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 上 放射温度計
AND R4005                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 下 放射温度計
AND R001                 ; ﾋｰﾀｰ1 ALM2(Suitable temp)
AND R003                 ; ﾋｰﾀｰ2 ALM2(Suitable temp)
AND R005                 ; ﾋｰﾀｰ3 ALM2(Suitable temp)
AND R007                 ; ﾋｰﾀｰ4 ALM2(Suitable temp)
OUT MR21101              ; 自動_温度OK
LD R4011                 ; ﾜｰｸ有無 ﾊﾟｯｸ側
AND R4100                ; 舟型確認
AND R4101                ; ﾜｰｸ有無 舟形側
AND R4012                ; ﾄｸﾞﾙ手前　SET完了
AND R4013                ; ﾄｸﾞﾙ奥　SET完了
OUT MR21100              ; 自動_ﾜｰｸｾｯﾄOK
LD= EM30000 #500         ; (TP)現在表示中画面No.
AND MR20100              ; AUTO  Select
AND MR305                ; 原点復帰完了
ANB MR306                ; 自動運転中
ANB MR307                ; ﾒﾝﾃ動作中
ANB MR902                ; ｴﾗｰ
ANB MR315                ; 扉開処理中
MPS
OUT @MR409               ; 動作開始要求10
MPP
ANP MR21000              ; TP_自動ｽﾀｰﾄSW
SET MR306                ; 自動運転中
CON
SET MR30001              ; 自動運転中
CON
SET @MR600
LDP MR21001              ; STOP　SW
MPS
LD MR30007               ; ｻｲｸﾙ動作中
ORB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
OR MR21100               ; 自動_ﾜｰｸｾｯﾄOK
ANL
SET MR20005              ; 自動停止処理中
MPP
LD R1014                 ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
LDB MR21100              ; 自動_ﾜｰｸｾｯﾄOK
OR CR2002                ; 常時ON
ANL
ANB MR30007              ; ｻｲｸﾙ動作中
ANL
RES MR20005              ; 自動停止処理中
CON
RES @MR802
CON
RES MR004                ; ﾜｰｸ不良品
CON
RES MR306                ; 自動運転中
CON
RES MR20100              ; AUTO  Select
;状態LP初期化/State LP initialization
STG @MR600
SET MR507                ; 検査ﾌﾗｸﾞ初期化
CON
JMP @MR601
STG @MR601
ANB MR507                ; 検査ﾌﾗｸﾞ初期化
JMP @MR700
;<h1/> ﾒﾓﾘｰｶｰﾄﾞの空き容量確認/Free space confirmation of memory card
;DM410：ﾒﾓﾘｰｶｰﾄﾞ書き込み
;0bit目 結果書き込み無効
;1bit目 測定書き込み無効
;
;DM 410: Memory card write
;0 bit Result write invalid
;1st bit Measurement write invalid
STG @MR700
RES MR403                ; ｴﾘｱｾﾝｻ監視中
CON
MPS
AND= EM31016 #0          ; SDカード記録　0=あり
JMP @MR701
MPP
AND= EM31016 #1          ; SDカード記録　0=あり
JMP @MR800
;結果または測定ﾃﾞｰﾀ書き込み有りの場合、空き容量確認
;If there is a result or measured data written, check the free space
LDP @MR701
MSTRT MEM_FREE_3 DM500 DM502 @MR010 @DM10;ﾒﾓﾘｰｶｰﾄﾞ指定空き容量(下位)  ﾒﾓﾘｰｶｰﾄﾞ空き容量(下位)  ﾒﾓﾘｰｶｰﾄﾞ空き容量NG  ﾒﾓﾘｰｶｰﾄﾞNG情報
STG @MR701
ANF _MEM_FREE_3
MPS
ANB @MR010               ; ﾒﾓﾘｰｶｰﾄﾞ空き容量NG
JMP @MR800
MPP
AND @MR010               ; ﾒﾓﾘｰｶｰﾄﾞ空き容量NG
JMP @MR702
;ﾒﾓﾘｶｰﾄﾞｴﾗｰ/Memory card error
STG @MR702
ANB MR902                ; ｴﾗｰ
JMP @MR703
;
;select case @DM10
;case 1
;	set( MR32100.b )	'ｶｰﾄﾞ未挿入
;case 6
;	set( MR32101.b )	'ﾌｧｲﾙ書込みｴﾗｰ
;case 8
;	set( MR32102.b )	'容量不足
;case 10
;	set( MR32103.b )	'空き容量不足
;case else
;	set( MR32104.b )	'その他
;end select
;
LD @MR703
NCJ #1000
;select case @DM10
;
LD CR2002                ; 常時ON
MOV @DM10 @VM0           ; ﾒﾓﾘｰｶｰﾄﾞNG情報
;case 1
;
LD= @VM0 #1
NCJ #2000
;	set( MR32100.b )	'ｶｰﾄﾞ未挿入
;
LD CR2002                ; 常時ON
SET MR32100              ; ﾒﾓﾘｰｶｰﾄﾞ未挿入
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;case 6
;
LD= @VM0 #6
NCJ #2002
;	set( MR32101.b )	'ﾌｧｲﾙ書込みｴﾗｰ
;
LD CR2002                ; 常時ON
SET MR32101              ; ﾌｧｲﾙ書込みｴﾗｰ
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;case 8
;
LD= @VM0 #8
NCJ #2004
;	set( MR32102.b )	'容量不足
;
LD CR2002                ; 常時ON
SET MR32102              ; ﾒﾓﾘｰｶｰﾄﾞ容量不足
LD CR2002                ; 常時ON
CJ #2005
LABEL #2004
;case 10
;
LD= @VM0 #10
NCJ #2006
;	set( MR32103.b )	'空き容量不足
;
LD CR2002                ; 常時ON
SET MR32103              ; ﾒﾓﾘｰｶｰﾄﾞ空き容量不足
LD CR2002                ; 常時ON
CJ #2007
LABEL #2006
;case else
;
;	set( MR32104.b )	'その他
;
LD CR2002                ; 常時ON
SET MR32104
;end select
;
LABEL #2007
LABEL #2005
LABEL #2003
LABEL #2001
LABEL #1000
;
STG @MR703
MOV @DM10 DM148          ; ﾒﾓﾘｰｶｰﾄﾞNG情報  ｴﾗｰ詳細
SET MR112                ; ﾒﾓﾘｶｰﾄﾞｴﾗｰ
CON
JMP @MR704
STG @MR704
ANB MR112                ; ﾒﾓﾘｶｰﾄﾞｴﾗｰ
JMP @MR1908
;<h1/> ﾜｰｸｾｯﾄ準備/Work Setting
STG @MR800
JMP @MR802
STG @MR802
MPS
LDB MR21014              ; TP_STOP　SW　点滅
ANB MR30007              ; ｻｲｸﾙ動作中
AND MR21100              ; 自動_ﾜｰｸｾｯﾄOK
AND MR21101              ; 自動_温度OK
AND R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
ANL
MPS
OUT @MR401               ; 動作開始要求2
MPP
ANP R4008                ; START sw
SET MR30007              ; ｻｲｸﾙ動作中
CON
JMP @MR803
MPP
AND MR21014              ; TP_STOP　SW　点滅
RES MR30001              ; 自動運転中
CON
ENDS
STG @MR803
AND MR504                ; 非常停止
SET MR403                ; ｴﾘｱｾﾝｻ監視中
CON
RES @MR2002              ; 首溶着NG
CON
RES @MR2202              ; 肩溶着NG
CON
RES MR20000              ; 溶着動作OK
CON
RES MR20001              ; 溶着動作NG
CON
DW.L +0 DM20100          ; 首溶着　潰し量
CON
DW.L +0 DM20102          ; 肩溶着　潰し量
CON
SET MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
JMP @MR808
;<h1/> RB1移動_P2ﾊﾞｰｺｰﾄﾞ読み込み/RB1 Move P2 Bar Code Read
STG @MR808
ANB MR315                ; 扉開処理中
ANB MR902                ; ｴﾗｰ
SET MR510                ; ﾎﾟｰｽﾞ禁止
CON
AND R4007                ; ﾊﾟｯｸ首溶着 開限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
DW #2 DM2020             ; RBT RB Position No
CON
SET R54000               ; RB1 MOVE
CON
JMP @MR809
STG @MR809
MPS
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
JMP @MR1904              ; エリアセンサ遮光停止
MPP
LD R1014                 ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
AND R54001               ; RB1 MOVE END
ANL
RES R54001               ; RB1 MOVE END
CON
MPS
ANB R54003               ; RB1 Alarm
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
MPS
ANB EM31018              ; QRﾘｰﾀﾞｰ読み取り 無効=1
JMP @MR1500
MPP
AND EM31018              ; QRﾘｰﾀﾞｰ読み取り 無効=1
JMP @MR1600
MPP
AND R54003               ; RB1 Alarm
JMP @MR1905              ; 自動RBアラーム停止
;<h1/> 部品ﾊﾞｰｺｰﾄﾞ読み込み/Part bar code reading
STG @MR1500
ANB MR315                ; 扉開処理中
ANB MR902                ; ｴﾗｰ
SET MR20200              ; ﾜｰｸBCR_読取開始
CON
JMP @MR1501
STG @MR1501
AND MR20201              ; ﾜｰｸBCR_読取完了
RES MR20201              ; ﾜｰｸBCR_読取完了
CON
JMP @MR1502
STG @MR1502
MPS
ANB MR20214              ; ﾜｰｸBCR_読取ﾀｲﾑｱｳﾄ
MPS
ANB MR20215              ; ﾜｰｸBCR_読取通信異常
SET TM90.0               ; ｻｲｸﾙ測定_工程1
CON
JMP @MR1507
MPP
AND MR20215              ; ﾜｰｸBCR_読取通信異常
JMP @MR1505
MPP
AND MR20214              ; ﾜｰｸBCR_読取ﾀｲﾑｱｳﾄ
JMP @MR1503
;Err27 ﾜｰｸﾊﾞｰｺｰﾄﾞ読取ﾀｲﾑｱｳﾄ /Err27 product bar code reading timeout
STG @MR1503
RES MR20214              ; ﾜｰｸBCR_読取ﾀｲﾑｱｳﾄ
CON
ANB MR902                ; ｴﾗｰ
DW #27 DM150             ; ｴﾗｰ番号
CON
SET MR31110              ; Err27ﾜｰｸﾊﾞｰｺｰﾄﾞ異常
CON
SET MR902                ; ｴﾗｰ
CON
JMP @MR1504
STG @MR1504
ANB MR902                ; ｴﾗｰ
RES MR31110              ; Err27ﾜｰｸﾊﾞｰｺｰﾄﾞ異常
CON
JMP @MR1511
;Err28 ﾜｰｸﾊﾞｰｺｰﾄﾞ読取通信異常/Err28 product Bar code reading communication error
STG @MR1505
RES MR20215              ; ﾜｰｸBCR_読取通信異常
CON
ANB MR902                ; ｴﾗｰ
DW #28 DM150             ; ｴﾗｰ番号
CON
SET MR31111              ; Err28
CON
SET MR902                ; ｴﾗｰ
CON
JMP @MR1506
STG @MR1506
ANB MR902                ; ｴﾗｰ
RES MR31111              ; Err28
CON
JMP @MR1511
;ﾜｰｸﾊﾞｰｺｰﾄﾞ記録/Product bar code record
STG @MR1507
BMOV DM20036 EM1950 DM20035;N-L20[1]ﾃﾞｰﾀ(0000)  ﾜｰｸ名  N-L20[1]ﾃﾞｰﾀｻｲｽﾞ
JMP @MR1600
STG @MR1510
MPS
LD MR31110               ; Err27ﾜｰｸﾊﾞｰｺｰﾄﾞ異常
ANP MR30114              ; (TP)BzRstSw
ANL
DW #607 EM30001          ; (TP)ﾍﾟｰｼﾞ画面切替用No.
MPP
ANB MR902                ; ｴﾗｰ
RES MR31110              ; Err27ﾜｰｸﾊﾞｰｺｰﾄﾞ異常
CON
JMP @MR1511
;読み取り失敗→ｾｯﾄ位置に戻して終了
;Failed to read → Return to set position and finish
; RB1移動_P1ﾜｰｸｾｯﾄ位置/RB1 Move P1 set pos
STG @MR1511
SET MR510                ; ﾎﾟｰｽﾞ禁止
CON
AND R4007                ; ﾊﾟｯｸ首溶着 開限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
DW #1 DM2020             ; RBT RB Position No
CON
SET R54000               ; RB1 MOVE
CON
JMP @MR1512
STG @MR1512
MPS
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
JMP @MR1904              ; エリアセンサ遮光停止
MPP
LD R1014                 ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
AND R54001               ; RB1 MOVE END
ANL
RES R54001               ; RB1 MOVE END
CON
MPS
ANB R54003               ; RB1 Alarm
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
JMP @MR1908
MPP
AND R54003               ; RB1 Alarm
JMP @MR1905              ; 自動RBアラーム停止
;<h1/> 溶着前ﾁｪｯｸ/Before weld Check
STG @MR1600
ANB MR902                ; ｴﾗｰ
MPS
AND CR2003               ; 常時OFF
SET MR402                ; 状態監視中
MPP
JMP @MR1700              ; 溶着ﾓｼﾞｭｰﾙ起動
;<h1/> 溶着動作/Weld Operating
;溶着順序選択  
;    EM31000="0"  首溶着→肩溶着
;    EM31000="1"  肩溶着→首溶着
STG @MR1700              ; 溶着ﾓｼﾞｭｰﾙ起動
ANB MR315                ; 扉開処理中
ANB MR902                ; ｴﾗｰ
SET MR510                ; ﾎﾟｰｽﾞ禁止
CON
AND R4007                ; ﾊﾟｯｸ首溶着 開限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
MPS
AND= EM31000 #0
DW #3 DM2020             ; RBT RB Position No
CON
SET R54000               ; RB1 MOVE
CON
JMP @MR1701
MPP
AND= EM31000 #1
DW #4 DM2020             ; RBT RB Position No
CON
SET R54000               ; RB1 MOVE
CON
JMP @MR1701
STG @MR1701
MPS
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
JMP @MR1904              ; エリアセンサ遮光停止
MPP
LD R1014                 ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
AND R54001               ; RB1 MOVE END
ANL
RES R54001               ; RB1 MOVE END
CON
MPS
ANB R54003               ; RB1 Alarm
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
JMP @MR1704
MPP
AND R54003               ; RB1 Alarm
JMP @MR1905              ; 自動RBアラーム停止
STG @MR1704
ANB MR315                ; 扉開処理中
ANB MR902                ; ｴﾗｰ
MPS
AND= EM31000 #0
SET @MR2000              ; 首溶着動作
CON
JMP @MR1705
MPP
AND= EM31000 #1
SET @MR2200              ; 肩溶着動作
CON
JMP @MR1705
STG @MR1705
MPS
LD= EM31000 #0
AND @MR2001              ; 首溶着動作完了
ANL
RES @MR2001              ; 首溶着動作完了
CON
JMP @MR1706
MPP
LD= EM31000 #1
AND @MR2201              ; 肩溶着動作完了
ANL
RES @MR2201              ; 肩溶着動作完了
CON
JMP @MR1706
STG @MR1706
MPS
AND= EM31000 #0
MPS
ANB @MR2002              ; 首溶着NG
JMP @MR1707
MPP
AND @MR2002              ; 首溶着NG
SET MR20001              ; 溶着動作NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR1900              ; AUTO終了判定
MPP
AND= EM31000 #1
MPS
ANB @MR2202              ; 肩溶着NG
JMP @MR1707
MPP
AND @MR2202              ; 肩溶着NG
SET MR20001              ; 溶着動作NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR1900              ; AUTO終了判定
STG @MR1707
ANB MR315                ; 扉開処理中
ANB MR902                ; ｴﾗｰ
SET MR510                ; ﾎﾟｰｽﾞ禁止
CON
AND R4007                ; ﾊﾟｯｸ首溶着 開限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
MPS
AND= EM31000 #0
DW #4 DM2020             ; RBT RB Position No
CON
SET R54000               ; RB1 MOVE
CON
JMP @MR1708
MPP
AND= EM31000 #1
DW #3 DM2020             ; RBT RB Position No
CON
SET R54000               ; RB1 MOVE
CON
JMP @MR1708
STG @MR1708
MPS
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
JMP @MR1904              ; エリアセンサ遮光停止
MPP
LD R1014                 ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
AND R54001               ; RB1 MOVE END
ANL
RES R54001               ; RB1 MOVE END
CON
MPS
ANB R54003               ; RB1 Alarm
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
JMP @MR1710
MPP
AND R54003               ; RB1 Alarm
JMP @MR1905              ; 自動RBアラーム停止
STG @MR1710
ANB MR315                ; 扉開処理中
ANB MR902                ; ｴﾗｰ
MPS
AND= EM31000 #0
SET @MR2200              ; 肩溶着動作
CON
JMP @MR1711
MPP
AND= EM31000 #1
SET @MR2000              ; 首溶着動作
CON
JMP @MR1711
STG @MR1711
MPS
LD= EM31000 #0
AND @MR2201              ; 肩溶着動作完了
ANL
RES @MR2201              ; 肩溶着動作完了
CON
JMP @MR1712
MPP
LD= EM31000 #1
AND @MR2001              ; 首溶着動作完了
ANL
RES @MR2001              ; 首溶着動作完了
CON
JMP @MR1712
STG @MR1712
MPS
AND= EM31000 #0
MPS
ANB @MR2202              ; 肩溶着NG
JMP @MR1713
MPP
AND @MR2202              ; 肩溶着NG
SET MR20001              ; 溶着動作NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR1900              ; AUTO終了判定
MPP
AND= EM31000 #1
MPS
ANB @MR2002              ; 首溶着NG
JMP @MR1713
MPP
AND @MR2002              ; 首溶着NG
SET MR20001              ; 溶着動作NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR1900              ; AUTO終了判定
; RB1移動_P1ﾜｰｸｾｯﾄ位置/RB1 Move P1 set pos
STG @MR1713
ANB MR315                ; 扉開処理中
ANB MR902                ; ｴﾗｰ
SET MR510                ; ﾎﾟｰｽﾞ禁止
CON
AND R4007                ; ﾊﾟｯｸ首溶着 開限
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
DW #1 DM2020             ; RBT RB Position No
CON
SET R54000               ; RB1 MOVE
CON
JMP @MR1714
STG @MR1714
MPS
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
SET TM90.3               ; ｻｲｸﾙ測定_工程4
CON
JMP @MR1904              ; エリアセンサ遮光停止
MPP
LD R1014                 ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
AND R54001               ; RB1 MOVE END
ANL
RES R54001               ; RB1 MOVE END
CON
MPS
ANB R54003               ; RB1 Alarm
MPS
LDB @MR2002              ; 首溶着NG
ANB @MR2202              ; 肩溶着NG
ANL
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
MPS
AND= EM31016 #0          ; SDカード記録　0=あり
SET TM90.3               ; ｻｲｸﾙ測定_工程4
CON
RES MR403                ; ｴﾘｱｾﾝｻ監視中
CON
JMP @MR1800
MPP
AND= EM31016 #1          ; SDカード記録　0=あり
SET TM90.3               ; ｻｲｸﾙ測定_工程4
CON
RES MR403                ; ｴﾘｱｾﾝｻ監視中
CON
JMP @MR1900              ; AUTO終了判定
MPP
LD @MR2002               ; 首溶着NG
OR @MR2202               ; 肩溶着NG
ANL
SET TM90.3               ; ｻｲｸﾙ測定_工程4
CON
RES MR403                ; ｴﾘｱｾﾝｻ監視中
CON
JMP @MR1900              ; AUTO終了判定
MPP
AND R54003               ; RB1 Alarm
JMP @MR1905              ; 自動RBアラーム停止
;<h1/> ﾃﾞｰﾀ記録/Data recording
;DM410：ﾒﾓﾘｰｶｰﾄﾞ書き込み
;0bit目 結果書き込み無効
;1bit目 測定書き込み無効
;
;DM 410: Memory card write
;0 bit Result write invalid
;1st bit Measurement write invalid
STG @MR1800
MPS
LDB DM504.0              ; ﾒﾓﾘｰｶｰﾄﾞ書込_結果ﾃﾞｰﾀ無効(=ON
ORB DM504.1              ; ﾒﾓﾘｰｶｰﾄﾞ書込_測定ﾃﾞｰﾀ無効(=ON
ANB MR902                ; ｴﾗｰ
ANL
JMP @MR1801
MPP
LD DM504.0               ; ﾒﾓﾘｰｶｰﾄﾞ書込_結果ﾃﾞｰﾀ無効(=ON
AND DM504.1              ; ﾒﾓﾘｰｶｰﾄﾞ書込_測定ﾃﾞｰﾀ無効(=ON
ANL
JMP @MR1900              ; AUTO終了判定
;書込み準備/Preparation for writing
STG @MR1801
ANB MR109                ; ﾒﾓﾘｶｰﾄﾞ書込中(排他ﾌﾗｸﾞ）
SET MR109                ; ﾒﾓﾘｶｰﾄﾞ書込中(排他ﾌﾗｸﾞ）
CON
JMP @MR1802
LD @MR1802
FMOV #0 EM2000 #260      ; 結果書込:ﾜｰｸNo.
@INC DM200               ; 機種1部品1ﾜｰｸNo
BMOV DM200 EM2000 #1     ; 機種1部品1ﾜｰｸNo  結果書込:ﾜｰｸNo.
BMOV CM700 EM2002 #1     ; ｶﾚﾝﾀﾞﾀｲﾏ（年）  結果書込:年
BMOV CM701 EM2004 #1     ; ｶﾚﾝﾀﾞﾀｲﾏ（月）  結果書込:月
BMOV CM702 EM2006 #1     ; ｶﾚﾝﾀﾞﾀｲﾏ（日）  結果書込:日
BMOV CM703 EM2008 #1     ; ｶﾚﾝﾀﾞﾀｲﾏ（時）  結果書込:時
BMOV CM704 EM2010 #1     ; ｶﾚﾝﾀﾞﾀｲﾏ（分）  結果書込:分
BMOV CM705 EM2012 #1     ; ｶﾚﾝﾀﾞﾀｲﾏ（秒）  結果書込:秒
BMOV.D DM100 EM2014 #1   ; 首溶着　潰し量設定値  結果書込:首溶着潰し設定値
BMOV.D DM20100 EM2016 #1 ; 首溶着　潰し量  結果書込:首溶着潰し測定値
BMOV.D DM102 EM2018 #1   ; 肩溶着　潰し量設定値  結果書込:肩溶着潰し設定
BMOV.D DM20102 EM2020 #1 ; 肩溶着　潰し量  結果書込:肩溶着潰し測定値
;ﾃﾞｰﾀ移行STG/Data migration STG
STG @MR1802
JMP @MR1803
;"MemoryCard_Access"ﾓｼﾞｭｰﾙ実行/"MemoryCard_Access" module execution
STG @MR1803
MDSTRT MemoryCard_Access
JMP @MR1804
;<<書込ﾓｼﾞｭｰﾙ停止処理>>/<< Write module stop process >>
STG @MR1804
AND _MemoryCard_Access
ANF MR111                ; ﾒﾓﾘｶｰﾄﾞ書込中
MDSTOP MemoryCard_Access
RES MR109                ; ﾒﾓﾘｶｰﾄﾞ書込中(排他ﾌﾗｸﾞ）
CON
JMP @MR1900              ; AUTO終了判定
;<h1/> 自動運転終了/Automatic operation End
;<h1/> 自動運転終了判定表示  /Automatic operation End  
STG @MR1900              ; AUTO終了判定
MPS
LDB @MR2002              ; 首溶着NG
ANB @MR2202              ; 肩溶着NG
ANL
SET MR20000              ; 溶着動作OK
CON
SET MR20008              ; 溶着OKﾌﾞｻﾞｰ
CON
JMP @MR1908
MPP
LD @MR2002               ; 首溶着NG
OR @MR2202               ; 肩溶着NG
ANL
@INC.D DM21002           ; NG品ｶｳﾝﾀ
CON
SET MR20001              ; 溶着動作NG
CON
JMP @MR1901
;<h1/>Err17 ﾜｰｸNG /
STG @MR1901
ANB MR902                ; ｴﾗｰ
DW #17 DM150             ; ｴﾗｰ番号
CON
SET MR31100              ; Err17
CON
SET MR902                ; ｴﾗｰ
CON
JMP @MR1902
STG @MR1902
ANB MR902                ; ｴﾗｰ
RES MR31015              ; Err16
CON
JMP @MR1903
STG @MR1903
ANB MR902                ; ｴﾗｰ
ANB MR404                ; ｴﾘｱｾﾝｻ遮光
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
AND R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
RES MR504                ; 非常停止
CON
RES MR305                ; 原点復帰完了
CON
RES MR30007              ; ｻｲｸﾙ動作中
CON
RES MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
DW #0 DM2020             ; RBT RB Position No
CON
RES MR306                ; 自動運転中
CON
ENDS
;自動RBアラーム停止/エリアセンサ遮光停止
STG @MR1904              ; エリアセンサ遮光停止
ANB R54002               ; During RB1 MOVE 
AND R54001               ; RB1 MOVE END
RES R54001               ; RB1 MOVE END
CON
JMP @MR1905              ; 自動RBアラーム停止
STG @MR1905              ; 自動RBアラーム停止
ANB MR902                ; ｴﾗｰ
ANB MR404                ; ｴﾘｱｾﾝｻ遮光
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
AND R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
RES MR504                ; 非常停止
CON
RES MR305                ; 原点復帰完了
CON
RES MR30007              ; ｻｲｸﾙ動作中
CON
RES MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
DW #0 DM2020             ; RBT RB Position No
CON
RES MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
ENDS
;<h1/> 自動運転終了/Automatic operation End
STG @MR1908
RES MR403                ; ｴﾘｱｾﾝｻ監視中
CON
SET MR20011              ; ﾜｰｸ除材要求
CON
ANB R4011                ; ﾜｰｸ有無 ﾊﾟｯｸ側
ANB R4012                ; ﾄｸﾞﾙ手前　SET完了
ANB R4013                ; ﾄｸﾞﾙ奥　SET完了
ANB R4100                ; 舟型確認
ANB R4101                ; ﾜｰｸ有無 舟形側
AND R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
RES MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
@INC.D DM21000           ; OK品ｶｳﾝﾀ
CON
JMP @MR1913
STG @MR1913
MPS
ANB MR21014              ; TP_STOP　SW　点滅
JMP @MR1914
MPP
AND MR21014              ; TP_STOP　SW　点滅
JMP @MR1915
STG @MR1914
RES LR1010               ; 首溶着済み
CON
RES LR1011               ; 肩溶着済み
CON
RES MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
RES MR20011              ; ﾜｰｸ除材要求
CON
RES MR30007              ; ｻｲｸﾙ動作中
CON
JMP @MR800
STG @MR1915
RES LR1010               ; 首溶着済み
CON
RES LR1011               ; 肩溶着済み
CON
RES MR30001              ; 自動運転中
CON
RES MR21014              ; TP_STOP　SW　点滅
CON
RES MR306                ; 自動運転中
CON
ENDS
;<h1/>■動作開始要求中：ｽﾀｰﾄSW点滅/During operation start request: Start SW blink
LDB @MR400               ; 動作開始要求1
ANB @MR401               ; 動作開始要求2
ANB @MR402               ; 動作開始要求3
ANB @MR403               ; 動作開始要求4
ANB @MR404               ; 動作開始要求5
ANB @MR405               ; 動作開始要求6
ANB @MR406               ; 動作開始要求7
ANB @MR407               ; 動作開始要求8
INV
OUT MR002                ; ｽﾀｰﾄSW点滅要求
LDB @MR408               ; 動作開始要求9
ANB @MR409               ; 動作開始要求10
ANB @MR410               ; 動作開始要求11
ANB @MR411               ; 動作開始要求12
ANB @MR412               ; 動作開始要求13
ANB @MR413               ; 動作開始要求14
ANB @MR414               ; 動作開始要求15
ANB @MR415               ; 動作開始要求16
INV
OUT MR010                ; 自動ｽﾀｰﾄSW　点滅
;<h1/>■ｻﾌﾞﾙｰﾁﾝ/Subroutine
;首溶着ｻﾌﾞﾙｰﾁﾝ
STG @MR2000              ; 首溶着動作
SET @MR2003              ; 首溶着動作中
CON
JMP @MR2005
STG @MR2005
ANB MR902                ; ｴﾗｰ
ANB MR505                ; 安全扉開
SET MR510                ; ﾎﾟｰｽﾞ禁止
CON
JMP @MR2006
;'比較値(DM100)=設定値(EM31010)
;    DM100.L = EM31010.L
;'検査P.V.値（DM110)=表示P.V.値(W04C)
;    DM110.L = W04C.L
;
;
LD @MR2006
NCJ #1002
;'比較値(DM100)=設定値(EM31010)
;
;    DM100.L = EM31010.L
;
LD CR2002                ; 常時ON
MOV.L EM31010 DM100      ; 首溶着　潰し量設定値
;'検査P.V.値（DM110)=表示P.V.値(W04C)
;
;    DM110.L = W04C.L
;
LD CR2002                ; 常時ON
MOV.L W04C DM110         ; DL-EP1[2]判定値(P.V.値)[1]  首溶着　潰し測定値
LABEL #1002
;
STG @MR2006
SET MR7012               ; ﾊﾟｯｸ首溶着　下降
CON
SET LR1010               ; 首溶着済み
CON
MPS
AND= EM31002 #0
MPS
AND>=.L DM110 DM100      ; 首溶着　潰し測定値  首溶着　潰し量設定値
JMP @MR2007
MPP
AND<.L DM110 DM100       ; 首溶着　潰し測定値  首溶着　潰し量設定値
TMR @21 #50              ; 首溶着　潰し量到達ﾀｲﾑｵｰﾊﾞｰ
CON
AND @T21                 ; 首溶着　潰し量到達ﾀｲﾑｵｰﾊﾞｰ
SET @MR2002              ; 首溶着NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR2007
MPP
AND= EM31002 #1
MPS
AND R4006                ; ﾊﾟｯｸ首溶着 閉限
TMR @20 EM31006          ; 首溶着ﾀｲﾏ
CON
AND @T20                 ; 首溶着ﾀｲﾏ
JMP @MR2007
MPP
ANB R4006                ; ﾊﾟｯｸ首溶着 閉限
TMR @22 #50
CON
AND @T22
SET @MR2002              ; 首溶着NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR2007
LD @MR2007
AND= EM31002 #0
@MOV.L DM110 DM20100     ; 首溶着　潰し測定値  首溶着　潰し量
STG @MR2007
RES MR7012               ; ﾊﾟｯｸ首溶着　下降
CON
AND R4007                ; ﾊﾟｯｸ首溶着 開限
JMP @MR2010
STG @MR2010
ANB MR902                ; ｴﾗｰ
@INC.D DM21004           ; 首動作回数
CON
SET TM90.1               ; ｻｲｸﾙ測定_工程2
CON
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
RES @MR2003              ; 首溶着動作中
CON
SET @MR2001              ; 首溶着動作完了
CON
ENDS
;肩溶着ｻﾌﾞﾙｰﾁﾝ
STG @MR2200              ; 肩溶着動作
SET @MR2203              ; 肩溶着動作中
CON
JMP @MR2205
STG @MR2205
ANB MR902                ; ｴﾗｰ
ANB MR505                ; 安全扉開
SET MR510                ; ﾎﾟｰｽﾞ禁止
CON
JMP @MR2206
;'比較値(DM102)=設定値(EM31012)
;    DM102.L = EM31012.L
;'検査P.V.値（DM112)=表示P.V.値(W04E)
;    DM112.L = W04E.L
;
;
LD @MR2206
NCJ #1001
;'比較値(DM102)=設定値(EM31012)
;
;    DM102.L = EM31012.L
;
LD CR2002                ; 常時ON
MOV.L EM31012 DM102      ; 肩溶着　潰し量設定値
;'検査P.V.値（DM112)=表示P.V.値(W04E)
;
;    DM112.L = W04E.L
;
LD CR2002                ; 常時ON
MOV.L W04E DM112         ; DL-EP1[2]判定値(P.V.値)[2]  肩溶着　潰し測定値
LABEL #1001
;
STG @MR2206
SET MR7014               ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 溶着
CON
SET LR1011               ; 肩溶着済み
CON
MPS
AND= EM31004 #0
MPS
AND>=.L DM112 DM102      ; 肩溶着　潰し測定値  肩溶着　潰し量設定値
JMP @MR2207
MPP
AND<.L DM112 DM102       ; 肩溶着　潰し測定値  肩溶着　潰し量設定値
TMR @26 #50              ; 肩溶着　潰し量到達ﾀｲﾑｵｰﾊﾞｰ
CON
AND @T26                 ; 肩溶着　潰し量到達ﾀｲﾑｵｰﾊﾞｰ
SET @MR2202              ; 肩溶着NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR2207
MPP
AND= EM31004 #1
MPS
AND R4014                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着閉限
TMR @25 EM31006          ; 肩溶着ﾀｲﾏ
CON
AND @T25                 ; 肩溶着ﾀｲﾏ
JMP @MR2207
MPP
ANB R4014                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着閉限
TMR @27 #50
CON
AND @T27
SET @MR2202              ; 肩溶着NG
CON
SET LR1000               ; ﾜｰｸNG（ｷｰsw解除必要Err
CON
JMP @MR2207
LD @MR2207
AND= EM31004 #0
@MOV.L DM112 DM20102     ; 肩溶着　潰し測定値  肩溶着　潰し量
STG @MR2207
RES MR7014               ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 溶着
CON
AND R4015                ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 熱溶着開限
JMP @MR2210
STG @MR2210
ANB MR902                ; ｴﾗｰ
@INC.D DM21006           ; 肩動作回数
CON
SET TM90.2               ; ｻｲｸﾙ測定_工程3
CON
RES MR510                ; ﾎﾟｰｽﾞ禁止
CON
RES @MR2203              ; 肩溶着動作中
CON
SET @MR2201              ; 肩溶着動作完了
CON
ENDS
LD @MR2003               ; 首溶着動作中
OR @MR2203               ; 肩溶着動作中
ANB R1014                ; ｴﾘｱｾﾝｻ状態(OFF=遮光)
RES MR7014               ; ﾊﾟｯｸ肩/ﾌｨﾙﾑ 溶着
CON
RES MR7012               ; ﾊﾟｯｸ首溶着　下降
CON
RES MR504                ; 非常停止
CON
RES MR305                ; 原点復帰完了
CON
RES MR30007              ; ｻｲｸﾙ動作中
CON
RES MR200                ; ｻｲｸﾙﾀｲﾑ測定ﾌﾗｸﾞ
CON
DW #0 DM2020             ; RBT RB Position No
CON
RES DM10807.2            ; 一時停止
CON
RES MR20011              ; ﾜｰｸ除材要求
CON
ZRES @MR000 @MR5015
END
ENDH
