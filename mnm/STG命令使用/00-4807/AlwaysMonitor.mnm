DEVICE:53
;MODULE:AlwaysMonitor
;MODULE_TYPE:0
;SCRIPT_TYPE:
;OneSystem Sub-Module
;
;---------------------------------------
;ModuleName	:	AlwaysMonitor
;ModuleType	:	Sub Module
;Function	:	常時監視
;---------------------------------------
;<使用方法>
;常時監視が必要な物は本ﾓｼﾞｭｰﾙ内に記述して下さい
;・ﾋｰﾀｰ過昇温検知による非常停止
;・ﾁｬﾝﾊﾞｰ排気量低下によるｴﾗｰ出力
;など
;<h1/>Pause処理　
;TASK0　　　　　
LD R44200                ; _Grp1 ﾎﾟｰｽﾞ要求
LDB DM2000.10            ; ｱｸｼｮﾝﾊﾟﾗﾒｰﾀ-11
AND B2009                ; ﾒｲﾝよりPAUSE要求
ORL
OUT R41200               ; CELL間 TASK0 PAUSE要求
;TASK2
LD R44200                ; _Grp1 ﾎﾟｰｽﾞ要求
LDB DM2000.10            ; ｱｸｼｮﾝﾊﾟﾗﾒｰﾀ-11
AND B2009                ; ﾒｲﾝよりPAUSE要求
ORL
AND CR2003               ; 常時OFF
OUT R41202               ; CELL間 TASK2 PAUSE要求
;TASK3
LD R44200                ; _Grp1 ﾎﾟｰｽﾞ要求
LDB DM2000.10            ; ｱｸｼｮﾝﾊﾟﾗﾒｰﾀ-11
AND B2009                ; ﾒｲﾝよりPAUSE要求
ORL
OUT R41203               ; CELL間 TASK3 PAUSE要求
;TASK4
LD R44200                ; _Grp1 ﾎﾟｰｽﾞ要求
LDB DM2000.10            ; ｱｸｼｮﾝﾊﾟﾗﾒｰﾀ-11
AND B2009                ; ﾒｲﾝよりPAUSE要求
ORL
AND CR2003               ; 常時OFF
OUT R41204               ; CELL間 TASK4 PAUSE要求
;TASK5
;TASK4
LD R44200                ; _Grp1 ﾎﾟｰｽﾞ要求
LDB DM2000.10            ; ｱｸｼｮﾝﾊﾟﾗﾒｰﾀ-11
AND B2009                ; ﾒｲﾝよりPAUSE要求
ORL
OUT R41205               ; CELL間 TASK5 PAUSE要求
;<h1/>CELL間 PAUSE 許可　　
LD R42600                ; _Grp1_Task0_ﾎﾟｰｽﾞ許可
ORB R41000               ; _Grp1_Task0_起動中ﾌﾗｸﾞ
LD R42603                ; _Grp1_Task3_ﾎﾟｰｽﾞ許可
ORB R42603               ; _Grp1_Task3_ﾎﾟｰｽﾞ許可
ANL
LD R42605                ; _Grp1_Task5_ﾎﾟｰｽﾞ許可
ORB R42605               ; _Grp1_Task5_ﾎﾟｰｽﾞ許可
ANL
AND B2009                ; ﾒｲﾝよりPAUSE要求
ANB CR2002               ; 常時ON
OR=.D R42600 R41000      ; _Grp1_Task0_ﾎﾟｰｽﾞ許可  _Grp1_Task0_起動中ﾌﾗｸﾞ
OUT B201A                ; ﾒｲﾝへPAUSE許可
;上流/下流ｾﾙへの一時停止中 表示制御
;@EM10.T = "メインより ポーズ許可待ち"
LD CR2002                ; 常時ON
NCJ #1000
;@EM10.T = "メインより ポーズ許可待ち"
LD CR2002                ; 常時ON
SMOV "メインより ポーズ許可待ち" @EM10
LABEL #1000
;
LDB DM2000.15            ; 上流 ﾎﾟｰｽﾞ信号 有効/無効
MPS
LDB B2009                ; ﾒｲﾝよりPAUSE要求
AND B2019                ; ﾒｲﾝへPAUSE要求
ANB B200A                ; ﾒｲﾝよりPAUSE許可
ANL
MSTRT BBS_MSG_W #1 #1 @EM10
MPP
LDB B2009                ; ﾒｲﾝよりPAUSE要求
AND B2019                ; ﾒｲﾝへPAUSE要求
AND B200A                ; ﾒｲﾝよりPAUSE許可
ANL
MSTRT BBS_MSG_C #1 #1
;<h1/>BBSﾒｯｾｰｼﾞ表示　　
;@EM30.T = "定停止するか、空ﾄﾚｲの給材をして下さい。"
LD CR2002                ; 常時ON
NCJ #1001
;@EM30.T = "定停止するか、空ﾄﾚｲの給材をして下さい。"
LD CR2002                ; 常時ON
SMOV "定停止するか、空ﾄﾚｲの給材をして" @EM30
SADD @EM45 "下さい。" @EM45
LABEL #1001
;
LD MR20210               ; ﾄﾚｲ交換無し選択ﾌﾗｸﾞ
AND CR2003               ; 常時OFF
MSTRT BBS_MSG_W #1 #3 @EM30
LDF MR20210              ; ﾄﾚｲ交換無し選択ﾌﾗｸﾞ
AND CR2003               ; 常時OFF
MSTRT BBS_MSG_C #1 #3
;<h1/>非常停止処理
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
LD R46102                ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
AND CR2003               ; 常時OFF
ORL
ANB R006                 ; 元圧空検出
MSTRT F_ERROR_DISP #10
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46102                ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
AND>=.L DM10516 +40000   ; RB2(ｴﾚﾍﾞｰﾀ) 現在位置
AND MR18100              ; RB1 P1移動要求
AND MR18001              ; RB1(ﾄﾚｲ搬送) 移動中
AND CR2003               ; 常時OFF
MSTRT F_ERROR_DISP #20
;洗浄機漏液検知による　非常停止追加　2013.12.18　S.HIDO
;下記ｲﾝﾀｰﾌｪｰｽ信号追加
;MAIN側		B2001：LDへ非常停止
;LD側		B2001：ﾒｲﾝより非常停止
LD CR2007                ; 運転開始時1ｽｷｬﾝOFF
TMR @0 #80
LD @T0
ANB B2001                ; ﾒｲﾝより非常停止
ANB DM2000.14            ; 上流 ﾊﾝﾄﾞｼｪｲｸ 有効/無効
MSTRT F_ERROR_DISP #18
END
ENDH
