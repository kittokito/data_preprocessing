DEVICE:53
;MODULE:MSCON_Cont
;MODULE_TYPE:0
;SCRIPT_TYPE:
;<h1/>ﾌﾘｯｶ制御
LD CR2002                ; 常時ON
FLIK #30 #30 @MR000
;<h1/>非常停止処理
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ZRES @MR100 @MR115       ; MSCON ｱﾗｰﾑ発生中
;<h1/>ﾃﾞｰﾀｾｯﾄ
;'ｴﾚﾍﾞｰﾀ ﾄﾚｲ確認
;DM21100.L = EM31000.L - 200
;DM21102.L = EM31000.L - DM4266.L - 200
LD CR2002                ; 常時ON
NCJ #1004
;'ｴﾚﾍﾞｰﾀ ﾄﾚｲ確認
;
;DM21100.L = EM31000.L - 200
;
LD CR2002                ; 常時ON
LDA.L EM31000            ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
CON
SUB.L +200
CON
STA.L DM21100
;DM21102.L = EM31000.L - DM4266.L - 200
LD CR2002                ; 常時ON
LDA.L EM31000            ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
CON
SUB.L DM4266             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
SUB.L +200
CON
STA.L DM21102
LABEL #1004
;
;<h1/>MSCON制御
LD CR2008                ; 運転開始時1ｽｷｬﾝON
BSET DM10715 #4          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
BSET DM10723 #4          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
SET @MR002               ; 運転開始後ｳｪｲﾄ
LD @MR002                ; 運転開始後ｳｪｲﾄ
MPS
TMR @0 #20
CON
AND @T0
BSET DM10700 #15
CON
@SET @MR003              ; MSCON動作可
MPP
TMR #450 #50             ; 運転開始後ｳｪｲﾄ2
;位置決め幅設定（0.1mm　固定）
LD CR2002                ; 常時ON
DW.D #10 DM10710         ; RB1(ﾄﾚｲ搬送) 位置決め幅
CON
DW.D #10 DM10718         ; RB2(ｴﾚﾍﾞｰﾀ) 位置決め幅
;<h1/>RB1　上段ﾄﾚｲ搬送
;状態確認
BLD DM10515 #3           ; RB1(ﾄﾚｲ搬送) 状態信号
ANB MR19010              ; RB2(ｴﾚﾍﾞｰﾀ) ｱﾗｰﾑ発生中
AND CR2003               ; 常時OFF
OUT MR18010              ; RB1(ﾄﾚｲ搬送) ｱﾗｰﾑ発生中
CON
OUT @MR100               ; MSCON ｱﾗｰﾑ発生中
LDP MR18010              ; RB1(ﾄﾚｲ搬送) ｱﾗｰﾑ発生中
ANB R39004               ; ｴﾗｰ中
SET @MR005               ; RB1ｱﾗｰﾑON
CON
SET R39004               ; ｴﾗｰ中
CON
DW #4 @DM1
CON
DW #1000 @DM9
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2
CON
SET @R100                ; ｱﾗｰﾑ発生
CON
LDA DM10514              ; RB1(ﾄﾚｲ搬送) ｱﾗｰﾑｺｰﾄﾞ
CON
STA DM11782              ; ｱﾗｰﾑ画面　軸ｴﾗｰｺｰﾄﾞ
CON
SET @R000
STG @R000
AND @R101                ; ｱﾗｰﾑ解除
DW #0 DM60009            ; Sensor ERROR No.
CON
AND @R105                ; SW1
SET MR24300              ; RB1　ｱﾗｰﾑﾘｾｯﾄ要求
CON
JMP @R001
STG @R001
TMR #530 #5              ; ｳｪｲﾄﾀｲﾏ
CON
AND T530                 ; ｳｪｲﾄﾀｲﾏ
AND MR24303              ; ｴﾗｰﾘｾｯﾄ処理完了
RES @MR005               ; RB1ｱﾗｰﾑON
CON
RES R39004               ; ｴﾗｰ中
CON
RES MR24303              ; ｴﾗｰﾘｾｯﾄ処理完了
CON
ENDS
STG MR24300              ; RB1　ｱﾗｰﾑﾘｾｯﾄ要求
BSET DM10715 #3          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
MPS
BANB DM10515 #3          ; RB1(ﾄﾚｲ搬送) 状態信号
JMP MR24301
MPP
BAND DM10515 #3          ; RB1(ﾄﾚｲ搬送) 状態信号
TMR #532 #30
CON
AND T532
JMP MR24302
STG MR24301
BAND DM10515 #4          ; RB1(ﾄﾚｲ搬送) 状態信号
BAND DM10515 #14         ; RB1(ﾄﾚｲ搬送) 状態信号
JMP MR24302
STG MR24302
SET MR24303              ; ｴﾗｰﾘｾｯﾄ処理完了
CON
ENDS
BLD DM10515 #4           ; RB1(ﾄﾚｲ搬送) 状態信号
BAND DM10515 #14         ; RB1(ﾄﾚｲ搬送) 状態信号
BANB DM10515 #15         ; RB1(ﾄﾚｲ搬送) 状態信号
OUT @MR101               ; MSCON RB1 動作可
BLD DM10515 #8           ; RB1(ﾄﾚｲ搬送) 状態信号
OUT MR18015              ; RB1(ﾄﾚｲ搬送) 移動完了
LD MR18115               ; ﾄﾚｲ搬送前後 段積み側 移動可
OR MR18215               ; ﾄﾚｲ搬送前後 ｴﾚﾍﾞｰﾀ側 移動可
OUB MR18012              ; ｲﾝﾀｰﾛｯｸ
LD MR19115               ; RB2 P1移動可
OR MR19215               ; RB2 P2移動可
OR MR19515               ; RB2 P5移動可
OR MR19615               ; RB2 P6移動可
OUB MR19012              ; ｲﾝﾀｰﾛｯｸ
;原点復帰
LDP MR18004              ; RB1(ﾄﾚｲ搬送) 原点復帰要求
AND MR18115              ; ﾄﾚｲ搬送前後 段積み側 移動可
ANB @MR1001              ; RB1(ﾄﾚｲ搬送) 原点復帰中
AND @MR003               ; MSCON動作可
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
AND @MR101               ; MSCON RB1 動作可
RES MR18005              ; RB1(ﾄﾚｲ搬送) 原点復帰完了
CON
SET @MR1001              ; RB1(ﾄﾚｲ搬送) 原点復帰中
CON
SET @MR1000              ; RB1(ﾄﾚｲ搬送) 原点復帰開始
STG @MR1000              ; RB1(ﾄﾚｲ搬送) 原点復帰開始
RES MR18004              ; RB1(ﾄﾚｲ搬送) 原点復帰要求
CON
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BRES DM10715 #0          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
BRES DM10715 #2          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
BRES DM10715 #3          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
BSET DM10715 #4          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
JMP @MR1003
STG @MR1003
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BANB DM10515 #2          ; RB1(ﾄﾚｲ搬送) 状態信号
JMP @MR1004
STG @MR1004
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BSET DM10715 #1          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
JMP @MR1005
STG @MR1005
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BANB DM10515 #0          ; RB1(ﾄﾚｲ搬送) 状態信号
BRES DM10715 #1          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
JMP @MR1006
STG @MR1006
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BANB DM10515 #2          ; RB1(ﾄﾚｲ搬送) 状態信号
BAND DM10515 #0          ; RB1(ﾄﾚｲ搬送) 状態信号
JMP @MR1007
STG @MR1007
MPS
ANB MR21202              ; MAINTE動作中
RES @MR1001              ; RB1(ﾄﾚｲ搬送) 原点復帰中
CON
SET MR18005              ; RB1(ﾄﾚｲ搬送) 原点復帰完了
CON
ENDS
MPP
AND MR21202              ; MAINTE動作中
RES @MR1001              ; RB1(ﾄﾚｲ搬送) 原点復帰中
CON
ENDS
;ﾎﾟｲﾝﾄ移動
LD MR18100               ; RB1 P1移動要求
OR MR18200               ; RB1 P2(EV側）移動要求
ANB @MR1001              ; RB1(ﾄﾚｲ搬送) 原点復帰中
AND MR18000              ; RB1(ﾄﾚｲ搬送) 移動指令
ANB @MR2001              ; RB1(ﾄﾚｲ搬送) 動作中
AND @MR003               ; MSCON動作可
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
AND @MR101               ; MSCON RB1 動作可
RES MR18101              ; RB1 P1(ﾄﾋﾞﾗ側）位置有り(表示用)
CON
RES MR18201              ; RB1 P2(EV側）位置有り(表示用)
CON
SET @MR2001              ; RB1(ﾄﾚｲ搬送) 動作中
CON
SET @MR2000              ; RB1(ﾄﾚｲ搬送) 動作開始
STG @MR2000              ; RB1(ﾄﾚｲ搬送) 動作開始
RES MR18000              ; RB1(ﾄﾚｲ搬送) 移動指令
CON
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BANB DM10515 #2          ; RB1(ﾄﾚｲ搬送) 状態信号
BRES DM10715 #2          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
BRES DM10715 #3          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
JMP @MR2003
STG @MR2003
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
MPS
AND MR18100              ; RB1 P1移動要求
MOV.L DM4200 DM10708     ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB1(ﾄﾚｲ搬送) 目標位置
MOV DM4202 DM10712       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB1(ﾄﾚｲ搬送) 移動速度
MOV DM4204 DM10713       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB1(ﾄﾚｲ搬送) 加減速度
MRD
AND MR18200              ; RB1 P2(EV側）移動要求
MOV.L DM4208 DM10708     ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB1(ﾄﾚｲ搬送) 目標位置
MOV DM4210 DM10712       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB1(ﾄﾚｲ搬送) 移動速度
MOV DM4212 DM10713       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB1(ﾄﾚｲ搬送) 加減速度
MPP
TMR #884 #2              ; ｳｪｲﾄﾀｲﾏ
CON
AND T884                 ; ｳｪｲﾄﾀｲﾏ
JMP @MR2004
STG @MR2004
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
MPS
LD MR18100               ; RB1 P1移動要求
LD MR18115               ; ﾄﾚｲ搬送前後 段積み側 移動可
OR CR2002                ; 常時ON
ANL
ANL
MPS
ANB MR18101              ; RB1 P1(ﾄﾋﾞﾗ側）位置有り(表示用)
BSET DM10715 #0          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
JMP @MR2005
MPP
AND MR18101              ; RB1 P1(ﾄﾋﾞﾗ側）位置有り(表示用)
JMP @MR2007
MPP
LD MR18200               ; RB1 P2(EV側）移動要求
LD MR18215               ; ﾄﾚｲ搬送前後 ｴﾚﾍﾞｰﾀ側 移動可
OR CR2002                ; 常時ON
ANL
ANL
MPS
ANB MR18201              ; RB1 P2(EV側）位置有り(表示用)
BSET DM10715 #0          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
JMP @MR2005
MPP
AND MR18201              ; RB1 P2(EV側）位置有り(表示用)
JMP @MR2007
STG @MR2005
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BANB DM10515 #0          ; RB1(ﾄﾚｲ搬送) 状態信号
BRES DM10715 #0          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
JMP @MR2006
STG @MR2006
ANB @MR100               ; MSCON ｱﾗｰﾑ発生中
BANB DM10515 #2          ; RB1(ﾄﾚｲ搬送) 状態信号
BAND DM10515 #0          ; RB1(ﾄﾚｲ搬送) 状態信号
TMH #885 #10             ; ｳｪｲﾄﾀｲﾏ
CON
AND T885                 ; ｳｪｲﾄﾀｲﾏ
JMP @MR2007
STG @MR2007
MPS
AND MR18100              ; RB1 P1移動要求
RES MR18201              ; RB1 P2(EV側）位置有り(表示用)
CON
SET MR18101              ; RB1 P1(ﾄﾋﾞﾗ側）位置有り(表示用)
CON
JMP @MR2008
MPP
AND MR18200              ; RB1 P2(EV側）移動要求
RES MR18101              ; RB1 P1(ﾄﾋﾞﾗ側）位置有り(表示用)
CON
SET MR18201              ; RB1 P2(EV側）位置有り(表示用)
CON
JMP @MR2008
STG @MR2008
BRES DM10715 #2          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
BRES DM10715 #3          ; RB1(ﾄﾚｲ搬送) 制御信号
CON
RES MR18100              ; RB1 P1移動要求
CON
RES MR18200              ; RB1 P2(EV側）移動要求
CON
RES @MR2001              ; RB1(ﾄﾚｲ搬送) 動作中
CON
ENDS
;<h1/>RB2　ｴﾚﾍﾞｰﾀ
;状態確認
LD T450                  ; 運転開始後ｳｪｲﾄ2
BAND DM10523 #3          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
ANB MR18010              ; RB1(ﾄﾚｲ搬送) ｱﾗｰﾑ発生中
OUT MR19010              ; RB2(ｴﾚﾍﾞｰﾀ) ｱﾗｰﾑ発生中
CON
OUT @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
LDP MR19010              ; RB2(ｴﾚﾍﾞｰﾀ) ｱﾗｰﾑ発生中
ANB R39004               ; ｴﾗｰ中
SET @MR006               ; RB2ｱﾗｰﾑON
CON
SET R39004               ; ｴﾗｰ中
CON
DW #5 @DM1
CON
DW #1000 @DM9
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2
CON
SET @R100                ; ｱﾗｰﾑ発生
CON
LDA DM10522              ; RB2(ｴﾚﾍﾞｰﾀ) ｱﾗｰﾑｺｰﾄﾞ
CON
STA DM11782              ; ｱﾗｰﾑ画面　軸ｴﾗｰｺｰﾄﾞ
CON
SET @R008
STG @R008
AND @R101                ; ｱﾗｰﾑ解除
DW #0 DM60009            ; Sensor ERROR No.
CON
AND @R105                ; SW1
SET MR24308              ; RB2　ｱﾗｰﾑﾘｾｯﾄ要求
CON
JMP @R009
STG @R009
TMR #531 #5
CON
AND T531
AND MR24311              ; ｴﾗｰﾘｾｯﾄ処理完了
RES @MR006               ; RB2ｱﾗｰﾑON
CON
RES R39004               ; ｴﾗｰ中
CON
RES MR24311              ; ｴﾗｰﾘｾｯﾄ処理完了
CON
ENDS
STG MR24308              ; RB2　ｱﾗｰﾑﾘｾｯﾄ要求
BSET DM10723 #3          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
MPS
BANB DM10523 #3          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
JMP MR24309
MPP
BAND DM10523 #3          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
TMR #534 #30
CON
AND T534
JMP MR24310
STG MR24309
BAND DM10523 #4          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BAND DM10523 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
JMP MR24310
STG MR24310
SET MR24311              ; ｴﾗｰﾘｾｯﾄ処理完了
CON
ENDS
BLD DM10523 #4           ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BAND DM10523 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BANB DM10523 #15         ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
OUT @MR201               ; MSCON RB2 動作可
BLD DM10523 #8           ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
OUT MR19015              ; RB2(ｴﾚﾍﾞｰﾀ) 移動完了
LD CR2002                ; 常時ON
LD R5208                 ; 下段ﾄﾚｲ搬送 前進(ｴﾚﾍﾞｰﾀ側)限
ANB R5303                ; 下段ﾄﾚｲ搬送 奥側ﾄﾚｲ有無
OR R5209                 ; 下段ﾄﾚｲ搬送 後退(扉側)限
ANL
OUT MR19115              ; RB2 P1移動可
LD CR2002                ; 常時ON
OUT MR19215              ; RB2 P2移動可
LD CR2002                ; 常時ON
OUT MR19315              ; RB2 P3移動可
LD CR2002                ; 常時ON
OUT MR19415              ; RB2 P4移動可
LD CR2002                ; 常時ON
AND R5113                ; 上段ﾄﾚｲ搬送前後　段積み側限
OUT MR19515              ; RB2 P5移動可
LD CR2002                ; 常時ON
AND R5113                ; 上段ﾄﾚｲ搬送前後　段積み側限
OUT MR19615              ; RB2 P6移動可
;原点復帰
LDP MR19004              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰要求
AND MR19115              ; RB2 P1移動可
ANB @MR1501              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰中
AND @MR003               ; MSCON動作可
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
AND @MR201               ; MSCON RB2 動作可
RES MR19005              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰完了
CON
SET @MR1501              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰中
CON
SET @MR1500              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰開始
STG @MR1500              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰開始
RES MR19004              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰要求
CON
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BRES DM10723 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
BRES DM10723 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
BRES DM10723 #2          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
BRES DM10723 #3          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
BSET DM10723 #4          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR1503
STG @MR1503
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BANB DM10523 #2          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
JMP @MR1504
STG @MR1504
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BSET DM10723 #1          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR1505
STG @MR1505
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BANB DM10523 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BRES DM10723 #1          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR1506
STG @MR1506
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BANB DM10523 #2          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BAND DM10523 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
JMP @MR1507
STG @MR1507
MPS
ANB MR21202              ; MAINTE動作中
RES @MR1501              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰中
CON
SET MR19005              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰完了
CON
ENDS
MPP
AND MR21202              ; MAINTE動作中
RES @MR1501              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰中
CON
ENDS
;ﾎﾟｲﾝﾄ移動
;DM27000.L = DM21004.L + DM4260.L + DM4262.L
;DM27010.L = DM27000.L * (-1)
;
;
LD CR2002                ; 常時ON
NCJ #1000
;DM27000.L = DM21004.L + DM4260.L + DM4262.L
;
LD CR2002                ; 常時ON
LDA.L DM21004            ; 切出し移動量（算出）
CON
ADD.L DM4260             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
ADD.L DM4262             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
STA.L DM27000            ; RB2(ｴﾚﾍﾞｰﾀ) 切出し移動量
;DM27010.L = DM27000.L * (-1)
;
LD CR2002                ; 常時ON
LDA.L DM27000            ; RB2(ｴﾚﾍﾞｰﾀ) 切出し移動量
CON
MUL.L -1
CON
STA.L DM27010            ; RB2(ｴﾚﾍﾞｰﾀ) 搬送逃げ移動量
LABEL #1000
;
LD MR19100               ; RB2 P1移動要求
OR MR19200               ; RB2 P2移動要求
OR MR19500               ; RB2 P5移動要求
OR MR19600               ; RB2 P6移動要求
ANB @MR1501              ; RB2(ｴﾚﾍﾞｰﾀ) 原点復帰中
AND MR19000              ; RB2(ｴﾚﾍﾞｰﾀ) 移動指令
ANB @MR2501              ; RB2(ｴﾚﾍﾞｰﾀ) 動作中
AND @MR003               ; MSCON動作可
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
AND @MR201               ; MSCON RB2 動作可
RES MR19101              ; RB2 P1位置有り(表示用)
CON
RES MR19201              ; RB2 P2位置有り(表示用)
CON
RES MR19101              ; RB2 P1位置有り(表示用)
CON
RES MR19201              ; RB2 P2位置有り(表示用)
CON
RES MR19501              ; RB2 P5位置有り(表示用)
CON
RES MR19601              ; RB2 P6位置有り(表示用)
CON
SET @MR2501              ; RB2(ｴﾚﾍﾞｰﾀ) 動作中
CON
SET @MR2500              ; RB2(ｴﾚﾍﾞｰﾀ) 動作開始
STG @MR2500              ; RB2(ｴﾚﾍﾞｰﾀ) 動作開始
RES MR19000              ; RB2(ｴﾚﾍﾞｰﾀ) 移動指令
CON
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BANB DM10523 #2          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BRES DM10723 #2          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
BRES DM10723 #3          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR2503
STG @MR2503
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
MPS
AND MR19100              ; RB2 P1移動要求
BRES DM10723 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
MOV.L DM4220 DM10716     ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 目標位置
MOV DM4222 DM10720       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 移動速度
MOV DM4224 DM10721       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 加減速度
MRD
AND MR19200              ; RB2 P2移動要求
BRES DM10723 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
MOV.L DM4226 DM10716     ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 目標位置
MOV DM4228 DM10720       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 移動速度
MOV DM4230 DM10721       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 加減速度
MRD
AND MR19500              ; RB2 P5移動要求
BRES DM10723 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
MPS
LDA.L DM27000            ; RB2(ｴﾚﾍﾞｰﾀ) 切出し移動量
CON
ADD.L DM10516            ; RB2(ｴﾚﾍﾞｰﾀ) 現在位置
CON
STA.L DM27800
MRD
@MOV.L DM27800 DM10716   ; RB2(ｴﾚﾍﾞｰﾀ) 目標位置
MRD
MOV DM4234 DM10720       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 移動速度
MPP
MOV DM4236 DM10721       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 加減速度
MRD
AND MR19600              ; RB2 P6移動要求
BRES DM10723 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
MPS
LDA.L DM10516            ; RB2(ｴﾚﾍﾞｰﾀ) 現在位置
CON
SUB.L DM27000            ; RB2(ｴﾚﾍﾞｰﾀ) 切出し移動量
CON
STA.L DM27810
MRD
@MOV.L DM27810 DM10716   ; RB2(ｴﾚﾍﾞｰﾀ) 目標位置
MRD
MOV DM4242 DM10720       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 移動速度
MPP
MOV DM4244 DM10721       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ  RB2(ｴﾚﾍﾞｰﾀ) 加減速度
MPP
TMR #886 #2              ; ｳｪｲﾄﾀｲﾏ
CON
AND T886                 ; ｳｪｲﾄﾀｲﾏ
JMP @MR2504
STG @MR2504
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
MPS
LD MR19100               ; RB2 P1移動要求
LD MR19115               ; RB2 P1移動可
OR CR2002                ; 常時ON
ANL
ANL
MPS
ANB MR19101              ; RB2 P1位置有り(表示用)
BSET DM10723 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR2505
MPP
AND MR19101              ; RB2 P1位置有り(表示用)
JMP @MR2507
MRD
LD MR19200               ; RB2 P2移動要求
LD MR19215               ; RB2 P2移動可
OR CR2002                ; 常時ON
ANL
ANL
MPS
ANB MR19201              ; RB2 P2位置有り(表示用)
BSET DM10723 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR2505
MPP
AND MR19201              ; RB2 P2位置有り(表示用)
JMP @MR2507
MRD
LD MR19500               ; RB2 P5移動要求
LD MR19515               ; RB2 P5移動可
OR CR2002                ; 常時ON
ANL
ANL
MPS
ANB MR19501              ; RB2 P5位置有り(表示用)
BSET DM10723 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR2505
MPP
AND MR19501              ; RB2 P5位置有り(表示用)
JMP @MR2507
MPP
LD MR19600               ; RB2 P6移動要求
LD MR19615               ; RB2 P6移動可
OR CR2002                ; 常時ON
ANL
ANL
MPS
ANB MR19601              ; RB2 P6位置有り(表示用)
BSET DM10723 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR2505
MPP
AND MR19601              ; RB2 P6位置有り(表示用)
JMP @MR2507
STG @MR2505
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BANB DM10523 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BRES DM10723 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
JMP @MR2506
STG @MR2506
ANB @MR200               ; MSCON RB2 ｱﾗｰﾑ発生中
BANB DM10523 #2          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
BAND DM10523 #0          ; RB2(ｴﾚﾍﾞｰﾀ) 状態信号
TMH #887 #10             ; ｳｪｲﾄﾀｲﾏ
CON
AND T887                 ; ｳｪｲﾄﾀｲﾏ
JMP @MR2507
STG @MR2507
MPS
AND MR19100              ; RB2 P1移動要求
SET MR19101              ; RB2 P1位置有り(表示用)
CON
JMP @MR2508
MRD
AND MR19200              ; RB2 P2移動要求
SET MR19201              ; RB2 P2位置有り(表示用)
CON
JMP @MR2508
MRD
AND MR19500              ; RB2 P5移動要求
SET MR19501              ; RB2 P5位置有り(表示用)
CON
JMP @MR2508
MPP
AND MR19600              ; RB2 P6移動要求
SET MR19601              ; RB2 P6位置有り(表示用)
CON
JMP @MR2508
STG @MR2508
BRES DM10723 #14         ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
BRES DM10723 #2          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
BRES DM10723 #3          ; RB2(ｴﾚﾍﾞｰﾀ) 制御信号
CON
RES MR19100              ; RB2 P1移動要求
CON
RES MR19200              ; RB2 P2移動要求
CON
RES MR19500              ; RB2 P5移動要求
CON
RES MR19600              ; RB2 P6移動要求
CON
RES @MR2501              ; RB2(ｴﾚﾍﾞｰﾀ) 動作中
CON
ENDS
;取得ﾃﾞｰﾀ
;'ﾄﾚｲ無し時のﾄﾚｲ載台停止位置座標取得
;EM31000.L = DM10516.L
;DM21002.L = EM31000.L
LDP MR9201               ; 取込みSW-2
NCJ #1001
;'ﾄﾚｲ無し時のﾄﾚｲ載台停止位置座標取得
;
;EM31000.L = DM10516.L
;
LD CR2002                ; 常時ON
MOV.L DM10516 EM31000    ; RB2(ｴﾚﾍﾞｰﾀ) 現在位置  ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
;DM21002.L = EM31000.L
LD CR2002                ; 常時ON
MOV.L EM31000 DM21002    ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ  ﾄﾚｲ無し ﾃｰﾌﾞﾙ停止位ﾃﾞｰﾀ（取込）
LABEL #1001
;
;'ﾄﾚｲ切出し位置座標取得
;EM31100.L = DM10516.L
;DM21000.L = EM31100.L
LDP MR9200               ; 取込みSW-1
NCJ #1002
;'ﾄﾚｲ切出し位置座標取得
;
;EM31100.L = DM10516.L
;
LD CR2002                ; 常時ON
MOV.L DM10516 EM31100    ; RB2(ｴﾚﾍﾞｰﾀ) 現在位置
;DM21000.L = EM31100.L
LD CR2002                ; 常時ON
MOV.L EM31100 DM21000    ; 切出し位置ﾃﾞｰﾀ（取込）
LABEL #1002
;
;取得ﾃﾞｰﾀ　CF書込み
;'ﾄﾚｲ切出し位置への移動量算出
;EM31200.L = EM31100.L - EM31000.L
;DM21004.L = EM31200.L
;dm4232.L = DM21004.L
;dm4240.L = DM21004.L * -1
;SET(@R10)
LDP MR9202               ; 取込みSW-3
MPS
AND @R010                ; ﾃﾞｰﾀ算出完了
OUT R55301               ; Data Setting End
MPP
NCJ #1003
;'ﾄﾚｲ切出し位置への移動量算出
;
;EM31200.L = EM31100.L - EM31000.L
;
LD CR2002                ; 常時ON
LDA.L EM31100
CON
SUB.L EM31000            ; ﾄﾚｲ無し時載台停止位置座標ﾊﾞｯﾌｧ
CON
STA.L EM31200
;DM21004.L = EM31200.L
;
LD CR2002                ; 常時ON
MOV.L EM31200 DM21004    ; 切出し移動量（算出）
;dm4232.L = DM21004.L
;
LD CR2002                ; 常時ON
MOV.L DM21004 DM4232     ; 切出し移動量（算出）  _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
;dm4240.L = DM21004.L * -1
;
LD CR2002                ; 常時ON
LDA.L DM21004            ; 切出し移動量（算出）
CON
MUL.L -1
CON
STA.L DM4240             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
;SET(@R10)
LD CR2002                ; 常時ON
SET @R010                ; ﾃﾞｰﾀ算出完了
LABEL #1003
;
;MyTask Error Process Substance/エラー処理実体
STG @R100                ; ｱﾗｰﾑ発生
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @R105 @R108         ; SW1
CON
LDA @DM9
CON
TBCD
CON
STA @DM10
CON
DISN @DM10 @DM3 #4
MRD
DW #5 @DM0
CON
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @R102
CON
JMP @R103
STG @R103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP
AND= DM60007 @DM6        ; ReturnSW /ERROR_DISP
SET @R105                ; SW1
CON
JMP @R104
STG @R104
ANB R39002               ; ERROR_DISP Busy
RES @R102
CON
SET @R101                ; ｱﾗｰﾑ解除
CON
ENDS
END
ENDH
