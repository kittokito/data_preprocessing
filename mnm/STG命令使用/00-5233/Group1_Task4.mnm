DEVICE:53
;MODULE:Group1_Task4
;MODULE_TYPE:0
;SCRIPT_TYPE:
;OneSystem Main-Module
;
;-----------------------------------------
;ModuleName	:	Group1_Task4
;ModuleType	:	Main Module
;Line		:	E252V Filter assy
;Cell		: 	Filter cut & welding
;Function	:	溶着ﾕﾆｯﾄ
;-----------------------------------------
;<<Task LocalDevice>>
;/*項目			/*割付ｴﾘｱ				/*備考
;---------------------------------------------------------------------			
;Emergency		@MR000～@MR015			Emergency処理時RESET禁止ｴﾘｱ
;Free			@MR100～@MR915			ﾕｰｻﾞｰﾌﾘｰｴﾘｱ
;HOME			@MR1000～@MR1515		HOME動作時使用ｴﾘｱ
;MAINTENANCE		@MR2000～@MR2915		MAINTE動作時使用ｴﾘｱ
;AUTO(Main1)		@MR3000～@MR3915		AUTO(Main1)動作時使用ｴﾘｱ
;	(Main2)		@MR4000～@MR4415		AUTO(Main2)動作時使用ｴﾘｱ
;SubRoutine		@MR4500～@MR6415		ｻﾌﾞﾙｰﾁﾝ共通動作使用ｴﾘｱ　※状況により増設してください。
;----------------------------------------------------------------------
;<h1/>Device_Init/ﾃﾞﾊﾞｲｽ初期化
;[内容]
;・非常停止、優先ｴﾗｰ発生時に初期化したいﾃﾞﾊﾞｲｽを指定して下さい
;※本Taskで使用するﾛｰｶﾙﾃﾞﾊﾞｲｽなど
;※STG～JMPにて使用しているﾃﾞﾊﾞｲｽは必須
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ZRES @MR100 @MR6305      ; Task4 ERROR
LD= DM60000 MyTask       ; TaskNo /ERROR_DISP  自ﾀｽｸ番号
AND R46208               ; _Group1　ｴﾗｰ発生中
OUT @MR001               ; TASK4　ERROR
;<h1/>Task_Monitor/ﾀｽｸﾓﾆﾀｰ
LD CR2002                ; 常時ON
FLIK #50 #50 @MR000
;ON STG Main1
;TYPE EM632.U,EM633.U,@MR000.U,@MR3000.U
;
;FOR EM632 = EM632 TO 160 STEP 16
;	IF @MR3000:EM632 <> 0 THEN
;		BREAK
;	END IF	
;NEXT
;	
;IF EM632 < 160 THEN
;	EM633 = (EM632 / 16) * 100 + DMX(@MR3000:EM632) + #3000
;END IF		
;		
;EM632 = EM632 + 16		
;IF EM632 > 160 THEN		
;	EM632 = 0		
;END IF
LDP @MR000
NCJ #1000
;TYPE EM632.U,EM633.U,@MR000.U,@MR3000.U
;
;FOR EM632 = EM632 TO 160 STEP 16
;
LD CR2002                ; 常時ON
MOV EM632 EM632          ; Task4 Main1@MR  Task4 Main1@MR
LABEL #2000
LD> EM632 #160           ; Task4 Main1@MR
CJ #2001
;	IF @MR3000:EM632 <> 0 THEN
;
LD CR2002                ; 常時ON
LDA EM632                ; Task4 Main1@MR
CON
EXT
CON
STA.L Z12
LD<> @MR3000:Z12 #0      ; AUTO Main1
NCJ #2002
;		BREAK
;
LD CR2002                ; 常時ON
CJ #2003
;	END IF	
;
LABEL #2002
;NEXT
;
LD CR2002                ; 常時ON
LDA EM632                ; Task4 Main1@MR
CON
ADD #16
CON
STA EM632                ; Task4 Main1@MR
LDB CR2009               ; 演算結果が負
CJ #2000
LABEL #2003
LABEL #2001
;IF EM632 < 160 THEN
;
LD< EM632 #160           ; Task4 Main1@MR
NCJ #2004
;	EM633 = (EM632 / 16) * 100 + DMX(@MR3000:EM632) + #3000
;
LD CR2002                ; 常時ON
LDA EM632                ; Task4 Main1@MR
CON
EXT
CON
STA.L Z12
CON
LDA @MR3000:Z12          ; AUTO Main1
CON
DMX
CON
STA @VM0
CON
LDA EM632                ; Task4 Main1@MR
CON
EXT
CON
EXT.L
CON
DIV.L +16
CON
MUL.L +100
CON
STA.L @VM1
CON
LDA @VM0
CON
EXT
CON
ADD.L @VM1
CON
ADD.L +3000
CON
STA EM633                ; Task4 Main1@MR
;END IF		
;
LABEL #2004
;EM632 = EM632 + 16		
;
LD CR2002                ; 常時ON
LDA EM632                ; Task4 Main1@MR
CON
EXT
CON
ADD.L +16
CON
STA EM632                ; Task4 Main1@MR
;IF EM632 > 160 THEN		
;
LD> EM632 #160           ; Task4 Main1@MR
NCJ #2005
;	EM632 = 0		
;
LD CR2002                ; 常時ON
MOV #0 EM632             ; Task4 Main1@MR
;END IF
LABEL #2005
LABEL #1000
;
;ON STG Main2
;TYPE EM634.U,EM635.U,@MR4000.U
;
;FOR EM634 = EM634 TO 80 STEP 16
;	IF @MR4000:EM634 <> 0 THEN
;		BREAK
;	END IF	
;NEXT	
;
;IF EM634 < 80 THEN
;	EM635 = (EM634 / 16) * 100 + DMX(@MR4000:EM634) + #4000
;END IF
;
;EM634 = EM634 + 16		
;
;IF EM634 > 80 THEN
;	EM634 = 0	
;END IF
LDP @MR000
NCJ #1001
;TYPE EM634.U,EM635.U,@MR4000.U
;
;FOR EM634 = EM634 TO 80 STEP 16
;
LD CR2002                ; 常時ON
MOV EM634 EM634          ; Task4 Main2@MR  Task4 Main2@MR
LABEL #2006
LD> EM634 #80            ; Task4 Main2@MR
CJ #2007
;	IF @MR4000:EM634 <> 0 THEN
;
LD CR2002                ; 常時ON
LDA EM634                ; Task4 Main2@MR
CON
EXT
CON
STA.L Z12
LD<> @MR4000:Z12 #0      ; AUTO Main2
NCJ #2008
;		BREAK
;
LD CR2002                ; 常時ON
CJ #2009
;	END IF	
;
LABEL #2008
;NEXT	
;
LD CR2002                ; 常時ON
LDA EM634                ; Task4 Main2@MR
CON
ADD #16
CON
STA EM634                ; Task4 Main2@MR
LDB CR2009               ; 演算結果が負
CJ #2006
LABEL #2009
LABEL #2007
;IF EM634 < 80 THEN
;
LD< EM634 #80            ; Task4 Main2@MR
NCJ #2010
;	EM635 = (EM634 / 16) * 100 + DMX(@MR4000:EM634) + #4000
;
LD CR2002                ; 常時ON
LDA EM634                ; Task4 Main2@MR
CON
EXT
CON
STA.L Z12
CON
LDA @MR4000:Z12          ; AUTO Main2
CON
DMX
CON
STA @VM3
CON
LDA EM634                ; Task4 Main2@MR
CON
EXT
CON
EXT.L
CON
DIV.L +16
CON
MUL.L +100
CON
STA.L @VM4
CON
LDA @VM3
CON
EXT
CON
ADD.L @VM4
CON
ADD.L +4000
CON
STA EM635                ; Task4 Main2@MR
;END IF
;
LABEL #2010
;EM634 = EM634 + 16		
;
LD CR2002                ; 常時ON
LDA EM634                ; Task4 Main2@MR
CON
EXT
CON
ADD.L +16
CON
STA EM634                ; Task4 Main2@MR
;IF EM634 > 80 THEN
;
LD> EM634 #80            ; Task4 Main2@MR
NCJ #2011
;	EM634 = 0	
;
LD CR2002                ; 常時ON
MOV #0 EM634             ; Task4 Main2@MR
;END IF
LABEL #2011
LABEL #1001
;
;ON STG SubRoutine
;TYPE EM636.U,EM637.U,@MR4500.U
;	
;FOR EM636 = EM636 TO 320 STEP 16
;	IF @MR4500:EM636 <> 0 THEN
;		BREAK
;	END IF	
;NEXT
;		
;IF EM636 < 320 THEN
;	EM637 = (EM636 / 16) * 100 + DMX(@MR4500:EM636) + #4500
;END IF
;		
;EM636 = EM636 + 16	
;
;IF EM636 > 320 THEN
;   EM636 = 0	
;END IF
LDP @MR000
NCJ #1002
;TYPE EM636.U,EM637.U,@MR4500.U
;
;FOR EM636 = EM636 TO 320 STEP 16
;
LD CR2002                ; 常時ON
MOV EM636 EM636          ; Task4 Sub@MR  Task4 Sub@MR
LABEL #2012
LD> EM636 #320           ; Task4 Sub@MR
CJ #2013
;	IF @MR4500:EM636 <> 0 THEN
;
LD CR2002                ; 常時ON
LDA EM636                ; Task4 Sub@MR
CON
EXT
CON
STA.L Z12
LD<> @MR4500:Z12 #0      ; ﾃｰﾌﾟ送り動作
NCJ #2014
;		BREAK
;
LD CR2002                ; 常時ON
CJ #2015
;	END IF	
;
LABEL #2014
;NEXT
;
LD CR2002                ; 常時ON
LDA EM636                ; Task4 Sub@MR
CON
ADD #16
CON
STA EM636                ; Task4 Sub@MR
LDB CR2009               ; 演算結果が負
CJ #2012
LABEL #2015
LABEL #2013
;IF EM636 < 320 THEN
;
LD< EM636 #320           ; Task4 Sub@MR
NCJ #2016
;	EM637 = (EM636 / 16) * 100 + DMX(@MR4500:EM636) + #4500
;
LD CR2002                ; 常時ON
LDA EM636                ; Task4 Sub@MR
CON
EXT
CON
STA.L Z12
CON
LDA @MR4500:Z12          ; ﾃｰﾌﾟ送り動作
CON
DMX
CON
STA @VM6
CON
LDA EM636                ; Task4 Sub@MR
CON
EXT
CON
EXT.L
CON
DIV.L +16
CON
MUL.L +100
CON
STA.L @VM7
CON
LDA @VM6
CON
EXT
CON
ADD.L @VM7
CON
ADD.L +4500
CON
STA EM637                ; Task4 Sub@MR
;END IF
;
LABEL #2016
;EM636 = EM636 + 16	
;
LD CR2002                ; 常時ON
LDA EM636                ; Task4 Sub@MR
CON
EXT
CON
ADD.L +16
CON
STA EM636                ; Task4 Sub@MR
;IF EM636 > 320 THEN
;
LD> EM636 #320           ; Task4 Sub@MR
NCJ #2017
;   EM636 = 0	
;
LD CR2002                ; 常時ON
MOV #0 EM636             ; Task4 Sub@MR
;END IF
LABEL #2017
LABEL #1002
;
;<h1/>Task_Init/ﾀｽｸ初期化
;[本STG内容]
;・本Task起動時に必要な初期化処理を記述して下さい
;・起動Taskの全Init処理終了後、Task_StartのSTGが起動します
STG LR804                ; _Grp1_Task4_Init.STG
ENDS
MOV #1 @DM17             ; 送り回数設定
MPS
ANB CR2002               ; 常時ON
MOV.L -700 @DM48         ; 溶着高さ誤差修正値
MPP
MOV.D #200 @DM46         ; 最短許容溶着時間(0.01s)
;<h1/>Task_Start/ﾀｽｸ開始
;[本STG内容]
;・Task起動後、以下運転ﾓｰﾄﾞに従い、各STGにJMPします
;【HOME】	→	LR5200
;【AUTO】	→	LR5400
;【MAINTE】	→	LR5600
;・本STGは追記、修正不要です
STG LR404                ; _Grp1_Task4_Start.STG
MPS
AND R46101               ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
JMP LR5204               ; _Grp1_Task4_HOME.STG
MRD
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
JMP LR5404               ; _Grp1_Task4_AUTO.STG
MPP
AND R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
JMP LR5604               ; _Grp1_Task4_MAINTE.STG
;<h1/>Task_Finish/ﾀｽｸ終了
;[本STG内容]
;・各Taskの終了STGになります
;・運転ﾓｰﾄﾞに係わらず終了時は本STGを経由して終了して下さい
;・本STGは追記、修正不要です
STG LR604                ; _Grp1_Task4_Fin.STG
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB @MR001               ; TASK4　ERROR
ANL
RES R42604               ; Grp1_Task4_ﾎﾟｰｽﾞ許可
CON
RES R41004               ; _Grp1_Task4_起動中ﾌﾗｸﾞ
CON
ENDS
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/>HOME/原点復帰
;[本STG内容]
;・STG @MR1000の続きから各Taskの原点復帰動作を記述する
;・動作終了時は@MR1515にJMPする事
STG LR5204               ; _Grp1_Task4_HOME.STG
JMP @MR1000              ; HOME
STG @MR1000              ; HOME
SET @MR1002              ; HOME中
CON
JMP @MR1005
;ｲｵﾅｲｻﾞ1 ON
STG @MR1005
SET MR7504               ; 溶着1 空冷ON
CON
SET MR7505               ; 溶着2 空冷ON
CON
SET MR7507               ; ｲｵﾅｲｻﾞ2 ｴｱﾌﾞﾛｰ (ﾃｰﾌﾟ)ﾕﾆｯﾄ)
CON
RES MR2110               ; ｲｵﾅｲｻﾞ2 放電停止
CON
RES MR2111               ; ｲｵﾅｲｻﾞ2 ﾘｾｯﾄ
CON
JMP @MR1006
;溶着ﾍｯﾄﾞ 上昇
STG @MR1006
RES MR7100               ; 溶着1 下降
CON
RES MR7102               ; 溶着2 下降
CON
MPS
LDB MR4101               ; 溶着1 上昇端異常
ANB MR4103               ; 溶着2 上昇端異常
ANB R4100                ; 溶着1 下降端
AND R4101                ; 溶着1 上昇端
ANB R4102                ; 溶着2 下降端
AND R4103                ; 溶着2 上昇端
ANL
JMP @MR1007
MPP
LD MR4101                ; 溶着1 上昇端異常
OR MR4103                ; 溶着2 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾀﾞﾝｻﾛｰﾗ上昇
STG @MR1007
RES MR7304               ; 段差ﾛｰﾗ 下降
CON
SET MR7305               ; 段差ﾛｰﾗ 上昇
CON
MPS
LDB MR4109               ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端異常
ANB R4108                ; ﾀﾞﾝｻｰﾛｰﾗ 下降端
AND R4109                ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端
ANL
JMP @MR1008
MPP
LD MR4109                ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ締め
STG @MR1008
RES MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
SET MR7309               ; ﾃｰﾌﾟ 締め
CON
MPS
ANB MR4113               ; ﾃｰﾌﾟ 締め側端異常
JMP @MR1009
MPP
LD MR4113                ; ﾃｰﾌﾟ 締め側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ下降
STG @MR1009
RES MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
SET MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
MPS
LDB MR4110               ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
ANB R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
AND R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
ANL
JMP @MR1100
MPP
LD MR4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ巻取り
STG @MR1100
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR4500              ; ﾃｰﾌﾟ送り動作
CON
JMP @MR1101
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR1101
AND @MR4501              ; ﾃｰﾌﾟ送り完了
RES @MR4501              ; ﾃｰﾌﾟ送り完了
CON
JMP @MR1514
;HEATER ON
STG @MR1514
MPS
JMP @MR1515              ; HOME END
MPP
ANB DM2000.13            ; ﾋｰﾀ無効
SET MR2000               ; ﾋｰﾀ1 ON
CON
SET MR2001               ; ﾋｰﾀ2 ON
;HOME完了
STG @MR1515              ; HOME END
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB @MR001               ; TASK4　ERROR
ANL
RES @MR1002              ; HOME中
CON
JMP LR604                ; _Grp1_Task4_Fin.STG
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/>AUTO/自動動作
STG LR5404               ; _Grp1_Task4_AUTO.STG
JMP @MR3000              ; AUTO Main1
;<h1/>Auto-Main1/Autoﾒｲﾝﾙｰﾁﾝ1
;[本STG内容]
;・各TaskのAUTO動作を記述して下さい
;・動作ﾓｰﾄﾞは「AUTOAC」に格納されています(1～32)
;・@MR3000:AUTO_Main1開始、@MR3001:AUTO_Main1完了、@MR3002:AUTO_Main1動作中
STG @MR3000              ; AUTO Main1
MPS
ANB R47800               ; _Group1　ﾒﾝﾃ動作定停止移行中
MPS
ANB R57304               ; Task4 停止要求
SET @MR3002              ; AUTO Main1 Busy
CON
JMP @MR3003
MPP
AND R57304               ; Task4 停止要求
JMP @MR3915              ; AUTO END
MPP
AND R47800               ; _Group1　ﾒﾝﾃ動作定停止移行中
JMP @MR3915              ; AUTO END
STG @MR3003
MPS
LD @MR801                ; ﾍｯﾄﾞ1溶着済記憶
AND @MR802               ; ﾍｯﾄﾞ2溶着済記憶
ANL
JMP @MR3801
MPP
LDB @MR801               ; ﾍｯﾄﾞ1溶着済記憶
ORB @MR802               ; ﾍｯﾄﾞ2溶着済記憶
ANL
JMP @MR3004
;<h1/> 溶着要求待ち
STG @MR3004
MPS
AND<> DM5010 #2          ; _AUTO動作番号
JMP @MR3005
MPP
AND= DM5010 #2           ; _AUTO動作番号
JMP @MR3006
;通常時
STG @MR3005
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
ANB R57304               ; Task4 停止要求
MPS
LD MR20400               ; Task3→4 ①溶着要求
OR MR20408               ; Task3→4 ③溶着要求
ANL
JMP @MR3009
MPP
LDB MR20400              ; Task3→4 ①溶着要求
ANB MR20408              ; Task3→4 ③溶着要求
LD MR20404               ; Task3→4 ②溶着要求
OR MR20412               ; Task3→4 ④溶着要求
ANL
ANL
JMP @MR3010
MPP
AND R57304               ; Task4 停止要求
JMP @MR3915              ; AUTO END
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;日常点検時
STG @MR3006
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
ANB R57304               ; Task4 停止要求
MPS
LDB @MR801               ; ﾍｯﾄﾞ1溶着済記憶
ANB @MR802               ; ﾍｯﾄﾞ2溶着済記憶
AND MR20504              ; Task3→4 0ﾘｾｯﾄ要求
ANL
JMP @MR3700
MPP
LD @MR801                ; ﾍｯﾄﾞ1溶着済記憶
OR @MR802                ; ﾍｯﾄﾞ2溶着済記憶
ANL
JMP @MR3801
MPP
AND R57304               ; Task4 停止要求
JMP @MR3915              ; AUTO END
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> 溶着前ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟ使用済みﾁｪｯｸ
;溶着ﾍｯﾄﾞ1
STG @MR3009
MPS
ANB @MR801               ; ﾍｯﾄﾞ1溶着済記憶
MPS
AND MR20400              ; Task3→4 ①溶着要求
JMP @MR3100              ; Main
MPP
ANB MR20400              ; Task3→4 ①溶着要求
MPS
AND MR20408              ; Task3→4 ③溶着要求
JMP @MR3300
MPP
ANB MR20408              ; Task3→4 ③溶着要求
JMP @MR3003
MPP
AND @MR801               ; ﾍｯﾄﾞ1溶着済記憶
JMP @MR3801
;溶着ﾍｯﾄﾞ2
STG @MR3010
MPS
ANB @MR802               ; ﾍｯﾄﾞ2溶着済記憶
MPS
AND MR20404              ; Task3→4 ②溶着要求
JMP @MR3200
MPP
ANB MR20404              ; Task3→4 ②溶着要求
MPS
AND MR20412              ; Task3→4 ④溶着要求
JMP @MR3400
MPP
ANB MR20412              ; Task3→4 ④溶着要求
JMP @MR3003
MPP
AND @MR802               ; ﾍｯﾄﾞ2溶着済記憶
JMP @MR3801
;<h1/> 溶着①
;to Task3 H/S start
STG @MR3100              ; Main
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20400              ; Task3→4 ①溶着要求
SET MR20402              ; Task4→3 ①溶着中
CON
JMP @MR3101
MPP
ANB MR20400              ; Task3→4 ①溶着要求
JMP @MR3004
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR3101
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR4800              ; 溶着①動作
CON
JMP @MR3102
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3102
AND @MR4801              ; 溶着①完了
MPS
RES @MR4801              ; 溶着①完了
CON
JMP @MR3103
MPP
AND @MR4803              ; 溶着①NG
SET MR20403              ; Task4→3 ①溶着NG
CON
RES @MR4803              ; 溶着①NG
;to Task0 H/S end
STG @MR3103
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20400              ; Task3→4 ①溶着要求
ANL
RES MR20402              ; Task4→3 ①溶着中
CON
JMP @MR3104
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3104
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
ANB MR20403              ; Task4→3 ①溶着NG
JMP @MR3800
MPP
AND MR20401              ; Task3→4 ①NG受信
RES MR20403              ; Task4→3 ①溶着NG
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> 溶着②
;to Task3 H/S start
STG @MR3200
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20404              ; Task3→4 ②溶着要求
SET MR20406              ; Task4→3 ②溶着中
CON
JMP @MR3201
MPP
ANB MR20404              ; Task3→4 ②溶着要求
JMP @MR3004
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR3201
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR5100              ; 溶着②動作
CON
JMP @MR3202
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3202
AND @MR5101              ; 溶着②完了
MPS
RES @MR5101              ; 溶着②完了
CON
JMP @MR3203
MPP
AND @MR5103              ; 溶着②NG
SET MR20407              ; Task4→3 ②溶着NG
CON
RES @MR5103              ; 溶着②NG
;to Task0 H/S end
STG @MR3203
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20404              ; Task3→4 ②溶着要求
ANL
RES MR20406              ; Task4→3 ②溶着中
CON
JMP @MR3204
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3204
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
ANB MR20407              ; Task4→3 ②溶着NG
JMP @MR3800
MPP
AND MR20405              ; Task3→4 ②NG受信
RES MR20407              ; Task4→3 ②溶着NG
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> 溶着③
;to Task3 H/S start
STG @MR3300
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20408              ; Task3→4 ③溶着要求
SET MR20410              ; Task4→3 ③溶着中
CON
JMP @MR3301
MPP
ANB MR20408              ; Task3→4 ③溶着要求
JMP @MR3004
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR3301
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR5400              ; 溶着③動作
CON
JMP @MR3302
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3302
AND @MR5401              ; 溶着③完了
MPS
RES @MR5401              ; 溶着③完了
CON
JMP @MR3303
MPP
AND @MR5403              ; 溶着③NG
SET MR20411              ; Task4→3 ③溶着NG
CON
RES @MR5403              ; 溶着③NG
;to Task0 H/S end
STG @MR3303
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20408              ; Task3→4 ③溶着要求
ANL
RES MR20410              ; Task4→3 ③溶着中
CON
JMP @MR3304
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3304
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
ANB MR20411              ; Task4→3 ③溶着NG
JMP @MR3800
MPP
AND MR20409              ; Task3→4 ③NG受信
RES MR20411              ; Task4→3 ③溶着NG
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> 溶着④
;to Task3 H/S start
STG @MR3400
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20412              ; Task3→4 ④溶着要求
SET MR20414              ; Task4→3 ④溶着中
CON
JMP @MR3401
MPP
ANB MR20412              ; Task3→4 ④溶着要求
JMP @MR3004
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR3401
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR5700              ; 溶着④動作
CON
JMP @MR3402
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3402
AND @MR5701              ; 溶着④完了
MPS
RES @MR5701              ; 溶着④完了
CON
JMP @MR3403
MPP
AND @MR5701              ; 溶着④完了
SET MR20415              ; Task4→3 ④溶着NG
CON
RES @MR5703              ; 溶着④NG
;to Task0 H/S end
STG @MR3403
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20412              ; Task3→4 ④溶着要求
ANL
RES MR20414              ; Task4→3 ④溶着中
CON
JMP @MR3404
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3404
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
ANB MR20415              ; Task4→3 ④溶着NG
JMP @MR3800
MPP
AND MR20413              ; Task3→4 ④NG受信
RES MR20415              ; Task4→3 ④溶着NG
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> 溶着高さﾘｾｯﾄ
;to Task3 H/S start
STG @MR3700
MPS
LDB R41204               ; TASK4 PAUSE 要求
AND MR20504              ; Task3→4 0ﾘｾｯﾄ要求
ANL
SET MR20506              ; Task4→3 0ﾘｾｯﾄ中
CON
JMP @MR3701
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ﾍｯﾄﾞ1
STG @MR3701
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR6000              ; ﾍｯﾄﾞ1 0ﾘｾｯﾄ動作
CON
JMP @MR3702
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3702
AND @MR6001              ; ﾍｯﾄﾞ1 0ﾘｾｯﾄ完了
RES @MR6001              ; ﾍｯﾄﾞ1 0ﾘｾｯﾄ完了
CON
JMP @MR3703
;to Task3 H/S (RB move)
STG @MR3703
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET MR20507              ; Task4→3 0 RB移動要求
CON
JMP @MR3704
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3704
AND MR20505              ; Task3→4 RB移動中
RES MR20507              ; Task4→3 0 RB移動要求
CON
JMP @MR3705
STG @MR3705
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20505              ; Task3→4 RB移動中
ANL
JMP @MR3706
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ﾍｯﾄﾞ2
STG @MR3706
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR6200              ; ﾍｯﾄﾞ2 0ﾘｾｯﾄ動作
CON
JMP @MR3707
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3707
AND @MR6201              ; ﾍｯﾄﾞ2 0ﾘｾｯﾄ完了
RES @MR6201              ; ﾍｯﾄﾞ2 0ﾘｾｯﾄ完了
CON
JMP @MR3708
;to Task0 H/S end
STG @MR3708
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20504              ; Task3→4 0ﾘｾｯﾄ要求
ANL
RES MR20506              ; Task4→3 0ﾘｾｯﾄ中
CON
JMP @MR3800
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> 溶着後ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟ使用済みﾁｪｯｸ
STG @MR3800
MPS
LDB @MR801               ; ﾍｯﾄﾞ1溶着済記憶
ORB @MR802               ; ﾍｯﾄﾞ2溶着済記憶
ANL
JMP @MR3004
MPP
LD @MR801                ; ﾍｯﾄﾞ1溶着済記憶
AND @MR802               ; ﾍｯﾄﾞ2溶着済記憶
ANL
JMP @MR3801
STG @MR3801
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR4500              ; ﾃｰﾌﾟ送り動作
CON
JMP @MR3802
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR3802
AND @MR4501              ; ﾃｰﾌﾟ送り完了
RES @MR4501              ; ﾃｰﾌﾟ送り完了
CON
JMP @MR3004
;<h1/>Auto終了処理
STG @MR3915              ; AUTO END
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB @MR001               ; TASK4　ERROR
ANB @MR4002              ; Main2 Busy
ANL
RES @MR3002              ; AUTO Main1 Busy
CON
JMP LR604                ; _Grp1_Task4_Fin.STG
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/>Auto-Main2/Autoﾒｲﾝﾙｰﾁﾝ2
;[本STG内容]
;・@MR4000の起動はMain1にて行う事
;・@MR4000:AUTO_Main2開始、@MR4001:AUTO_Main2完了、@MR4002:AUTO_Main2動作中
STG @MR4000              ; AUTO Main2
SET @MR4002              ; Main2 Busy
CON
JMP @MR4003
STG @MR4003
JMP @MR4415              ; Main2 END
STG @MR4415              ; Main2 END
SET @MR4001              ; Main2 END
CON
RES @MR4002              ; Main2 Busy
CON
ENDS
;<h1/>MAINTE/ﾒﾝﾃﾅﾝｽ動作
;[本STG内容]
;・各TaskのMAINTE動作を記述して下さい
;・動作ﾓｰﾄﾞは「MAINTEAC*」に格納されています(1～32)
;・動作終了時は@MR2915にJMPして下さい
STG LR5604               ; _Grp1_Task4_MAINTE.STG
JMP @MR2000              ; Mainte
STG @MR2000              ; Mainte
SET @MR2002              ; ﾒﾝﾃ中
CON
JMP @MR2003
STG @MR2003
MPS
LD= DM4110 #15           ; _Group1　ﾒﾝﾃ動作番号
OR= DM4110 #19           ; _Group1　ﾒﾝﾃ動作番号
OR= DM4110 #20           ; _Group1　ﾒﾝﾃ動作番号
OR= DM4110 #23           ; _Group1　ﾒﾝﾃ動作番号
OR= DM4110 #24           ; _Group1　ﾒﾝﾃ動作番号
ANL
JMP @MR2004
MPP
LD<> DM4110 #15          ; _Group1　ﾒﾝﾃ動作番号
AND<> DM4110 #19         ; _Group1　ﾒﾝﾃ動作番号
AND<> DM4110 #20         ; _Group1　ﾒﾝﾃ動作番号
AND<> DM4110 #23         ; _Group1　ﾒﾝﾃ動作番号
AND<> DM4110 #24         ; _Group1　ﾒﾝﾃ動作番号
ANL
JMP @MR2915              ; Mainte END
;ｽﾃｯﾌﾟor通常　か選択
STG @MR2004
MPS
MSTRT SELECT_POST #1 MyTask #0 @MR2005;自ﾀｽｸ番号
MPP
AND @MR2005
RES @MR2005
CON
MPS
AND= DM4110 #15          ; _Group1　ﾒﾝﾃ動作番号
JMP @MR2100
MRD
AND= DM4110 #19          ; _Group1　ﾒﾝﾃ動作番号
JMP @MR2200
MRD
AND= DM4110 #20          ; _Group1　ﾒﾝﾃ動作番号
JMP @MR2300
MRD
AND= DM4110 #23          ; _Group1　ﾒﾝﾃ動作番号
JMP @MR2400
MPP
AND= DM4110 #24          ; _Group1　ﾒﾝﾃ動作番号
JMP @MR2500
;<h1/> MT15：ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟ送り
STG @MR2100
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR4500              ; ﾃｰﾌﾟ送り動作
CON
JMP @MR2101
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR2101
AND @MR4501              ; ﾃｰﾌﾟ送り完了
RES @MR4501              ; ﾃｰﾌﾟ送り完了
CON
JMP @MR2914              ; Mainte Fin.
;<h1/> MT19：ﾌﾚｰﾑ①溶着
;to Task3 H/S start
STG @MR2200
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20400              ; Task3→4 ①溶着要求
SET MR20402              ; Task4→3 ①溶着中
CON
JMP @MR2201
MPP
LDB MR20400              ; Task3→4 ①溶着要求
ANB R41003               ; _Grp1_Task3_起動中ﾌﾗｸﾞ
ANL
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR2201
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR4800              ; 溶着①動作
CON
JMP @MR2202
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR2202
AND @MR4801              ; 溶着①完了
RES @MR4803              ; 溶着①NG
CON
RES @MR4801              ; 溶着①完了
CON
JMP @MR2203
;to Task0 H/S end
STG @MR2203
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20400              ; Task3→4 ①溶着要求
ANL
RES MR20402              ; Task4→3 ①溶着中
CON
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> MT20：ﾌﾚｰﾑ②溶着
;to Task3 H/S start
STG @MR2300
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20404              ; Task3→4 ②溶着要求
SET MR20406              ; Task4→3 ②溶着中
CON
JMP @MR2301
MPP
LDB MR20404              ; Task3→4 ②溶着要求
ANB R41003               ; _Grp1_Task3_起動中ﾌﾗｸﾞ
ANL
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR2301
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR5100              ; 溶着②動作
CON
JMP @MR2302
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR2302
AND @MR5101              ; 溶着②完了
RES @MR5103              ; 溶着②NG
CON
RES @MR5101              ; 溶着②完了
CON
JMP @MR2303
;to Task0 H/S end
STG @MR2303
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20404              ; Task3→4 ②溶着要求
ANL
RES MR20406              ; Task4→3 ②溶着中
CON
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> MT23：ﾌﾚｰﾑ③溶着
;to Task3 H/S start
STG @MR2400
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20408              ; Task3→4 ③溶着要求
SET MR20410              ; Task4→3 ③溶着中
CON
JMP @MR2401
MPP
LDB MR20408              ; Task3→4 ③溶着要求
ANB R41003               ; _Grp1_Task3_起動中ﾌﾗｸﾞ
ANL
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR2401
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR5400              ; 溶着③動作
CON
JMP @MR2402
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR2402
AND @MR5401              ; 溶着③完了
RES @MR5403              ; 溶着③NG
CON
RES @MR5401              ; 溶着③完了
CON
JMP @MR2403
;to Task0 H/S end
STG @MR2403
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20408              ; Task3→4 ③溶着要求
ANL
RES MR20410              ; Task4→3 ③溶着中
CON
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/> MT24：ﾌﾚｰﾑ④溶着
;to Task3 H/S start
STG @MR2500
MPS
ANB R41204               ; TASK4 PAUSE 要求
MPS
AND MR20412              ; Task3→4 ④溶着要求
SET MR20414              ; Task4→3 ④溶着中
CON
JMP @MR2501
MPP
LDB MR20412              ; Task3→4 ④溶着要求
ANB R41003               ; _Grp1_Task3_起動中ﾌﾗｸﾞ
ANL
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着
STG @MR2501
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET @MR5700              ; 溶着④動作
CON
JMP @MR2502
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR2502
AND @MR5701              ; 溶着④完了
RES @MR5703              ; 溶着④NG
CON
RES @MR5701              ; 溶着④完了
CON
JMP @MR2503
;to Task0 H/S end
STG @MR2503
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB MR20412              ; Task3→4 ④溶着要求
ANL
RES MR20414              ; Task4→3 ④溶着中
CON
JMP @MR2914              ; Mainte Fin.
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR2006
JMP @MR2914              ; Mainte Fin.
;Maintenance 終了
STG @MR2914              ; Mainte Fin.
MCALL MODE_INDI #2
MCALL HOLD_REQUEST MyGroup;自ｸﾞﾙｰﾌﾟ番号
JMP @MR2915              ; Mainte END
STG @MR2915              ; Mainte END
MPS
LD R41204                ; TASK4 PAUSE 要求
ANB @MR001               ; TASK4　ERROR
ANL
SET @MR1900              ; Main1 HALT許可
MPP
ANB R41204               ; TASK4 PAUSE 要求
RES @MR2002              ; ﾒﾝﾃ中
CON
JMP LR604                ; _Grp1_Task4_Fin.STG
;<h1/>SubRoutines/ｻﾌﾞﾙｰﾁﾝ
;<h1/> ﾃｰﾌﾟ送り @MR4500
STG @MR4500              ; ﾃｰﾌﾟ送り動作
DW #0 @DM16              ; 送り実行回数
CON
SET @MR4502              ; ﾃｰﾌﾟ送り動作中
CON
JMP @MR4505
;ﾀﾞﾝｻﾛｰﾗ上昇
STG @MR4505
RES MR7304               ; 段差ﾛｰﾗ 下降
CON
SET MR7305               ; 段差ﾛｰﾗ 上昇
CON
MPS
LDB MR4109               ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端異常
ANB R4108                ; ﾀﾞﾝｻｰﾛｰﾗ 下降端
AND R4109                ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端
ANL
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR4506
MPP
LD MR4109                ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR4506
MPS
AND R4105                ; ﾀﾞﾝｻｰﾛｰﾗ 上端検出
JMP @MR4600
MPP
ANB R4105                ; ﾀﾞﾝｻｰﾛｰﾗ 上端検出
JMP @MR4507
;巻取りﾓｰﾀ(M-4)駆動
STG @MR4507
RES MR2114               ; M-04 制動解除/ｱﾗｰﾑﾘｾｯﾄ
CON
SET MR2115               ; M-04 CW
CON
JMP @MR4508
STG @MR4508
MPS
LD R4105                 ; ﾀﾞﾝｻｰﾛｰﾗ 上端検出
ANB R4106                ; ﾀﾞﾝｻｰﾛｰﾗ 下端検出
AND R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
ANL
RES MR2115               ; M-04 CW
CON
JMP @MR4515
MRD
ANB R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
TMR @10 #30
CON
AND @T10
RES MR2115               ; M-04 CW
CON
JMP @MR4509
MPP
TMR @11 #50
CON
AND @T11
RES MR2115               ; M-04 CW
CON
JMP @MR4511
;ERR149 ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟｴﾝﾄﾞ検出
STG @MR4509
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #149 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #4107 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR4510
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR4510
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR4506
;ERR150 ﾃｰﾌﾟ巻取りﾀｲﾑｵｰﾊﾞｰ
STG @MR4511
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #150 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #4105 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR4512
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR4512
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
SET MR2114               ; M-04 制動解除/ｱﾗｰﾑﾘｾｯﾄ
CON
JMP @MR4506
;///
STG @MR4515
TMR @21 #3
CON
AND @T21
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR4600
;ﾀﾞﾝｻﾛｰﾗ下降
STG @MR4600
RES MR7305               ; 段差ﾛｰﾗ 上昇
CON
SET MR7304               ; 段差ﾛｰﾗ 下降
CON
MPS
LDB MR4108               ; ﾀﾞﾝｻｰﾛｰﾗ 下降端異常
ANB R4109                ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端
AND R4108                ; ﾀﾞﾝｻｰﾛｰﾗ 下降端
ANL
JMP @MR4601
MPP
LD MR4108                ; ﾀﾞﾝｻｰﾛｰﾗ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR4601
TMR @12 #2
CON
AND @T12
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR4602
;ﾀﾞﾝｻﾛｰﾗ上昇
STG @MR4602
RES MR7304               ; 段差ﾛｰﾗ 下降
CON
SET MR7305               ; 段差ﾛｰﾗ 上昇
CON
MPS
LDB MR4109               ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端異常
ANB R4108                ; ﾀﾞﾝｻｰﾛｰﾗ 下降端
AND R4109                ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端
ANL
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR4603
MPP
LD MR4109                ; ﾀﾞﾝｻｰﾛｰﾗ 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR4603
MPS
AND R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR4606
MPP
ANB R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
TMR @24 #30
CON
AND @T24
JMP @MR4604
;ERR149 ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟｴﾝﾄﾞ検出
STG @MR4604
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #149 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #4107 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR4605
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR4605
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR4506
;送り回数判断
STG @MR4606
INC @DM16                ; 送り実行回数
CON
JMP @MR4607
STG @MR4607
MPS
AND< @DM16 @DM17         ; 送り実行回数  送り回数設定
JMP @MR4505
MPP
AND>= @DM16 @DM17        ; 送り実行回数  送り回数設定
JMP @MR4608
;End
STG @MR4608
RES @MR801               ; ﾍｯﾄﾞ1溶着済記憶
CON
RES @MR802               ; ﾍｯﾄﾞ2溶着済記憶
CON
RES @MR4502              ; ﾃｰﾌﾟ送り動作中
CON
SET @MR4501              ; ﾃｰﾌﾟ送り完了
CON
ENDS
;<h1/> 溶着① @MR4800
STG @MR4800              ; 溶着①動作
SET @MR4802              ; 溶着①動作中
CON
JMP @MR4806
;ﾃｰﾌﾟｴﾝﾄﾞ確認
STG @MR4806
MPS
AND R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR4809
MPP
ANB R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR4807
;ERR152 ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟ異常
STG @MR4807
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #152 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #4107 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1004 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR4808
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR4808
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
SET MR2114               ; M-04 制動解除/ｱﾗｰﾑﾘｾｯﾄ
CON
MPS
AND @MR105               ; SW1
JMP @MR4806
MPP
AND @MR108               ; SW4
SET @MR4803              ; 溶着①NG
CON
JMP @MR4915
;溶着条件設定
;Z3 = ((DM12000 - 1) * 8) + 0	'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着①だから0
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  
;@DM50.L = DM7040.L:Z3 + DM7030.L:Z4
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値  
;'@DM50.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR4810)
LD @MR4809
NCJ #1003
;Z3 = ((DM12000 - 1) * 8) + 0	'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着①だから0
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +8
CON
ADD.L +0
CON
STA.L Z3
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +2
CON
STA.L Z4
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  
;
;@DM50.L = DM7040.L:Z3 + DM7030.L:Z4
;
LD CR2002                ; 常時ON
LDA.L DM7040:Z3          ; 基礎ﾃﾞｰﾀ21 CAV1溶着量①
CON
ADD.L DM7030:Z4          ; 基礎ﾃﾞｰﾀ16 CAV1ｵﾌｾｯﾄ
CON
STA.L @DM50              ; ①溶着量設定値
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値  
;
;'@DM50.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR4810)
LD CR2002                ; 常時ON
SET @MR4810              ; 溶着条件設定完了
LABEL #1003
;
STG @MR4809
AND @MR4810              ; 溶着条件設定完了
RES @MR4810              ; 溶着条件設定完了
CON
JMP @MR4811
;ﾋｰﾀ1適温待ち
STG @MR4811
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
LD MR1901                ; ﾋｰﾀ1適温
OR @MR2002               ; ﾒﾝﾃ中
OR DM2000.12             ; ﾄﾞﾗｲ運転
OR DM2000.13             ; ﾋｰﾀ無効
ANL
ANL
JMP @MR4900
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ上昇/ﾃｰﾌﾟ緩め
STG @MR4900
RES MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
SET MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
RES MR7309               ; ﾃｰﾌﾟ 締め
CON
SET MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
MPS
LDB MR4111               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
ANB MR4112               ; ﾃｰﾌﾟ ゆるめ側端異常
ANB R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
AND R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
ANB R4113                ; ﾃｰﾌﾟ 締め側端
AND R4112                ; ﾃｰﾌﾟ ゆるめ側端
ANL
JMP @MR4901
MPP
LD MR4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
OR MR4112                ; ﾃｰﾌﾟ ゆるめ側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR4901
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
ANL
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
SET R47005               ; _処理時間6計測開始
CON
DW.L +0 @DM12            ; 溶着量記憶
CON
JMP @MR4902
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着ﾍｯﾄﾞ1 下降
STG @MR4902
SET MR7100               ; 溶着1 下降
CON
MPS
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
AND R4100                ; 溶着1 下降端
MPS
AND>=.L DM11126 @DM50    ; GT2 現在値  ①溶着量設定値
TMR @13 DM7022           ; 基礎ﾃﾞｰﾀ12 ①溶着後ｳｪｲﾄ(0.01s)
CON
AND @T13
INC.D DM9034             ; _消耗品1ｶｳﾝﾀ
CON
JMP @MR4905
MPP
SET @MR801               ; ﾍｯﾄﾞ1溶着済記憶
CON
SET R47009               ; _処理時間10計測開始
MPP
TMR @14 #100
CON
AND @T14
SET @MR4803              ; 溶着①NG
CON
JMP @MR4905
MPP
AND R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
ANB R4100                ; 溶着1 下降端
JMP @MR4903
MPP
AND R4100                ; 溶着1 下降端
SET @MR4803              ; 溶着①NG
CON
JMP @MR4905
;下降限前でｴﾘｱ遮光→上昇してﾘﾄﾗｲ
STG @MR4903
RES R47009               ; _処理時間10計測開始
CON
RES MR7100               ; 溶着1 下降
CON
MPS
LDB MR4101               ; 溶着1 上昇端異常
ANB R4100                ; 溶着1 下降端
AND R4101                ; 溶着1 上昇端
ANL
RES R47005               ; _処理時間6計測開始
CON
JMP @MR4904
MPP
LD MR4101                ; 溶着1 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR4904
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND MR1901               ; ﾋｰﾀ1適温
JMP @MR4901
;溶着ﾍｯﾄﾞ1 上昇
STG @MR4905
RES R47009               ; _処理時間10計測開始
CON
RES MR7100               ; 溶着1 下降
CON
MPS
LDB MR4101               ; 溶着1 上昇端異常
ANB R4100                ; 溶着1 下降端
AND R4101                ; 溶着1 上昇端
ANL
RES R47005               ; _処理時間6計測開始
CON
JMP @MR4906
MPP
LD MR4101                ; 溶着1 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;溶着量Log.
LD @MR4902
OR @MR4905
AND>=.L DM11126 @DM12    ; GT2 現在値  溶着量記憶
MOV.L DM11126 @DM12      ; GT2 現在値  溶着量記憶
STG @MR4906
BMOV DM5300 DM5302 #14   ; _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ1_1  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ1_2
MOV.L @DM12 DM5300       ; 溶着量記憶  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ1_1
MPS
DW.L +0 @DM12            ; 溶着量記憶
CON
JMP @MR4907
MPP
LD<.D DM5060 @DM46       ; _処理計測時間10  最短許容溶着時間(0.01s)
AND CR2003               ; 常時OFF
ANL
SET @MR4803              ; 溶着①NG
STG @MR4907
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR4908
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ締め
STG @MR4908
TMH @34 DM7034           ; 基礎ﾃﾞｰﾀ18 ﾍｯﾄﾞ1ゆるみ戻しｳｪｲﾄ
CON
AND @T34
RES MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
SET MR7309               ; ﾃｰﾌﾟ 締め
CON
MPS
ANB MR4113               ; ﾃｰﾌﾟ 締め側端異常
JMP @MR4909
MPP
LD MR4113                ; ﾃｰﾌﾟ 締め側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ下降
STG @MR4909
RES MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
SET MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
MPS
LDB MR4110               ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
ANB R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
AND R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
ANL
JMP @MR4910
MPP
LD MR4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾋｰﾀｰﾂｰﾙ清掃回数ﾁｪｯｸ
STG @MR4910
MPS
AND<> DM8750 #0          ; _消耗品1現在消費%
JMP @MR4915
MPP
AND= DM8750 #0           ; _消耗品1現在消費%
JMP @MR4911
;ERR151 溶着ﾍｯﾄﾞ清掃要求
STG @MR4911
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #151 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #7005 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR4912
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR4912
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR4915
;終了
STG @MR4915
RES @MR4802              ; 溶着①動作中
CON
SET @MR4801              ; 溶着①完了
CON
ENDS
;<h1/> 溶着② @MR5100
STG @MR5100              ; 溶着②動作
SET @MR5102              ; 溶着②動作中
CON
JMP @MR5106
STG @MR5106
MPS
AND R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR5109
MPP
ANB R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR5107
;ERR152 ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟ異常
STG @MR5107
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #152 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #4107 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1004 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR5108
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR5108
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
SET MR2114               ; M-04 制動解除/ｱﾗｰﾑﾘｾｯﾄ
CON
MPS
AND @MR105               ; SW1
JMP @MR5106
MPP
AND @MR108               ; SW4
SET @MR5103              ; 溶着②NG
CON
JMP @MR5215
;溶着条件設定
;Z3 = ((DM12000 - 1) * 8) + 2		'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着②だから2
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  
;@DM52.L = DM7040.L:Z3 + DM7030.L:Z4
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値  
;'@DM52.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR5110)
LD @MR5109
NCJ #1005
;Z3 = ((DM12000 - 1) * 8) + 2		'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着②だから2
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +8
CON
ADD.L +2
CON
STA.L Z3
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +2
CON
STA.L Z4
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  
;
;@DM52.L = DM7040.L:Z3 + DM7030.L:Z4
;
LD CR2002                ; 常時ON
LDA.L DM7040:Z3          ; 基礎ﾃﾞｰﾀ21 CAV1溶着量①
CON
ADD.L DM7030:Z4          ; 基礎ﾃﾞｰﾀ16 CAV1ｵﾌｾｯﾄ
CON
STA.L @DM52              ; ②溶着量設定値
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値  
;
;'@DM52.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR5110)
LD CR2002                ; 常時ON
SET @MR5110              ; 溶着条件設定完了
LABEL #1005
;
STG @MR5109
AND @MR5110              ; 溶着条件設定完了
RES @MR5110              ; 溶着条件設定完了
CON
JMP @MR5111
;ﾋｰﾀ1適温待ち
STG @MR5111
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
LD MR1904                ; ﾋｰﾀ2適温
OR @MR2002               ; ﾒﾝﾃ中
OR DM2000.12             ; ﾄﾞﾗｲ運転
OR DM2000.13             ; ﾋｰﾀ無効
ANL
ANL
JMP @MR5200
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ上昇/ﾃｰﾌﾟ緩め
STG @MR5200
RES MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
SET MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
RES MR7309               ; ﾃｰﾌﾟ 締め
CON
SET MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
MPS
LDB MR4111               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
ANB MR4112               ; ﾃｰﾌﾟ ゆるめ側端異常
ANB R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
AND R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
ANB R4113                ; ﾃｰﾌﾟ 締め側端
AND R4112                ; ﾃｰﾌﾟ ゆるめ側端
ANL
JMP @MR5201
MPP
LD MR4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
OR MR4112                ; ﾃｰﾌﾟ ゆるめ側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR5201
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
ANL
SET R47006               ; _処理時間7計測開始
CON
DW.L +0 @DM12            ; 溶着量記憶
CON
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR5202
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着ﾍｯﾄﾞ2 下降
STG @MR5202
SET MR7102               ; 溶着2 下降
CON
MPS
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
AND R4102                ; 溶着2 下降端
MPS
AND>=.L DM11128 @DM52    ; GT3 現在値  ②溶着量設定値
TMR @15 DM7024           ; 基礎ﾃﾞｰﾀ13 ②溶着後ｳｪｲﾄ(0.01s)
CON
AND @T15
INC.D DM9036             ; _消耗品2ｶｳﾝﾀ
CON
JMP @MR5205
MPP
SET @MR802               ; ﾍｯﾄﾞ2溶着済記憶
CON
SET R47010               ; _処理時間11計測開始
MPP
TMR @16 #100
CON
AND @T16
SET @MR5103              ; 溶着②NG
CON
JMP @MR5205
MPP
AND R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
ANB R4102                ; 溶着2 下降端
JMP @MR5203
MPP
AND R4102                ; 溶着2 下降端
SET @MR5103              ; 溶着②NG
CON
JMP @MR5205
;下降限前でｴﾘｱ遮光→上昇してﾘﾄﾗｲ
STG @MR5203
RES R47010               ; _処理時間11計測開始
CON
RES MR7102               ; 溶着2 下降
CON
MPS
LDB MR4103               ; 溶着2 上昇端異常
ANB R4102                ; 溶着2 下降端
AND R4103                ; 溶着2 上昇端
ANL
RES R47006               ; _処理時間7計測開始
CON
JMP @MR5204
MPP
LD MR4103                ; 溶着2 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR5204
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND MR1904               ; ﾋｰﾀ2適温
JMP @MR5201
;溶着ﾍｯﾄﾞ2 上昇
STG @MR5205
RES R47010               ; _処理時間11計測開始
CON
RES MR7102               ; 溶着2 下降
CON
MPS
LDB MR4103               ; 溶着2 上昇端異常
ANB R4102                ; 溶着2 下降端
AND R4103                ; 溶着2 上昇端
ANL
RES R47006               ; _処理時間7計測開始
CON
JMP @MR5206
MPP
LD MR4103                ; 溶着2 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;溶着量Log.
LD @MR5202
OR @MR5205
AND>=.L DM11128 @DM12    ; GT3 現在値  溶着量記憶
MOV.L DM11128 @DM12      ; GT3 現在値  溶着量記憶
STG @MR5206
BMOV DM5320 DM5322 #14   ; _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ2_1  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ2_2
MOV.L @DM12 DM5320       ; 溶着量記憶  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ2_1
MPS
DW.L +0 @DM12            ; 溶着量記憶
CON
JMP @MR5207
MPP
LD<.D DM5062 @DM46       ; _処理計測時間11  最短許容溶着時間(0.01s)
AND CR2003               ; 常時OFF
ANL
SET @MR5103              ; 溶着②NG
STG @MR5207
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR5208
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ締め
STG @MR5208
TMH @35 DM7036           ; 基礎ﾃﾞｰﾀ19 ﾍｯﾄﾞ2ゆるみ戻しｳｪｲﾄ
CON
AND @T35
RES MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
SET MR7309               ; ﾃｰﾌﾟ 締め
CON
MPS
ANB MR4113               ; ﾃｰﾌﾟ 締め側端異常
JMP @MR5209
MPP
LD MR4113                ; ﾃｰﾌﾟ 締め側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ下降
STG @MR5209
RES MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
SET MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
MPS
LDB MR4110               ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
ANB R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
AND R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
ANL
JMP @MR5210
MPP
LD MR4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾋｰﾀｰﾂｰﾙ清掃回数ﾁｪｯｸ
STG @MR5210
MPS
AND<> DM8751 #0          ; _消耗品2現在消費%
JMP @MR5215
MPP
AND= DM8751 #0           ; _消耗品2現在消費%
JMP @MR5211
;ERR151 溶着ﾍｯﾄﾞ清掃要求
STG @MR5211
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #151 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #7006 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR5212
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR5212
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR5215
;終了
STG @MR5215
RES @MR5102              ; 溶着②動作中
CON
SET @MR5101              ; 溶着②完了
CON
ENDS
;<h1/> 溶着③ @MR5400
STG @MR5400              ; 溶着③動作
SET @MR5402              ; 溶着③動作中
CON
JMP @MR5406
STG @MR5406
MPS
AND R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR5409
MPP
ANB R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR5407
;ERR152 ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟ異常
STG @MR5407
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #152 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #4107 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1004 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR5408
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR5408
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
SET MR2114               ; M-04 制動解除/ｱﾗｰﾑﾘｾｯﾄ
CON
MPS
AND @MR105               ; SW1
JMP @MR5406
MPP
AND @MR108               ; SW4
SET @MR5403              ; 溶着③NG
CON
JMP @MR5515
;溶着条件設定
;Z3 = ((DM12000 - 1) * 8) + 4	'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着③だから4
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量
;@DM54.L = DM7040.L:Z3 + DM7030.L:Z4
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値
;'@DM54.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR5410)
LD @MR5409
NCJ #1004
;Z3 = ((DM12000 - 1) * 8) + 4	'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着③だから4
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +8
CON
ADD.L +4
CON
STA.L Z3
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +2
CON
STA.L Z4
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量
;
;@DM54.L = DM7040.L:Z3 + DM7030.L:Z4
;
LD CR2002                ; 常時ON
LDA.L DM7040:Z3          ; 基礎ﾃﾞｰﾀ21 CAV1溶着量①
CON
ADD.L DM7030:Z4          ; 基礎ﾃﾞｰﾀ16 CAV1ｵﾌｾｯﾄ
CON
STA.L @DM54              ; ③溶着量設定値
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値
;
;'@DM54.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR5410)
LD CR2002                ; 常時ON
SET @MR5410              ; 溶着条件設定完了
LABEL #1004
;
STG @MR5409
AND @MR5410              ; 溶着条件設定完了
RES @MR5410              ; 溶着条件設定完了
CON
JMP @MR5411
;ﾋｰﾀ1適温待ち
STG @MR5411
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
LD MR1901                ; ﾋｰﾀ1適温
OR @MR2002               ; ﾒﾝﾃ中
OR DM2000.12             ; ﾄﾞﾗｲ運転
OR DM2000.13             ; ﾋｰﾀ無効
ANL
ANL
JMP @MR5500
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ上昇/ﾃｰﾌﾟ緩め
STG @MR5500
RES MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
SET MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
RES MR7309               ; ﾃｰﾌﾟ 締め
CON
SET MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
MPS
LDB MR4111               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
ANB MR4112               ; ﾃｰﾌﾟ ゆるめ側端異常
ANB R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
AND R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
ANB R4113                ; ﾃｰﾌﾟ 締め側端
AND R4112                ; ﾃｰﾌﾟ ゆるめ側端
ANL
JMP @MR5501
MPP
LD MR4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
OR MR4112                ; ﾃｰﾌﾟ ゆるめ側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR5501
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
ANL
SET R47007               ; _処理時間8計測開始
CON
DW.L +0 @DM12            ; 溶着量記憶
CON
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR5502
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着ﾍｯﾄﾞ1 下降
STG @MR5502
SET MR7100               ; 溶着1 下降
CON
MPS
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
AND R4100                ; 溶着1 下降端
MPS
AND>=.L DM11126 @DM54    ; GT2 現在値  ③溶着量設定値
TMR @17 DM7026           ; 基礎ﾃﾞｰﾀ14 ③溶着後ｳｪｲﾄ(0.01s)
CON
AND @T17
INC.D DM9034             ; _消耗品1ｶｳﾝﾀ
CON
JMP @MR5505
MPP
SET @MR801               ; ﾍｯﾄﾞ1溶着済記憶
CON
SET R47011               ; _処理時間12計測開始
MPP
TMR @18 #100
CON
AND @T18
SET @MR5403              ; 溶着③NG
CON
JMP @MR5505
MPP
AND R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
ANB R4100                ; 溶着1 下降端
JMP @MR5503
MPP
AND R4100                ; 溶着1 下降端
SET @MR5403              ; 溶着③NG
CON
JMP @MR5505
;下降限前でｴﾘｱ遮光→上昇してﾘﾄﾗｲ
STG @MR5503
RES R47011               ; _処理時間12計測開始
CON
RES MR7100               ; 溶着1 下降
CON
MPS
LDB MR4101               ; 溶着1 上昇端異常
ANB R4100                ; 溶着1 下降端
AND R4101                ; 溶着1 上昇端
ANL
RES R47007               ; _処理時間8計測開始
CON
JMP @MR5504
MPP
LD MR4101                ; 溶着1 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR5504
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND MR1901               ; ﾋｰﾀ1適温
JMP @MR5501
;溶着ﾍｯﾄﾞ1 上昇
STG @MR5505
RES R47011               ; _処理時間12計測開始
CON
RES MR7100               ; 溶着1 下降
CON
MPS
LDB MR4101               ; 溶着1 上昇端異常
ANB R4100                ; 溶着1 下降端
AND R4101                ; 溶着1 上昇端
ANL
RES R47007               ; _処理時間8計測開始
CON
JMP @MR5506
MPP
LD MR4101                ; 溶着1 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;溶着量Log.
LD @MR5502
OR @MR5505
AND>=.L DM11126 @DM12    ; GT2 現在値  溶着量記憶
MOV.L DM11126 @DM12      ; GT2 現在値  溶着量記憶
STG @MR5506
BMOV DM5340 DM5342 #14   ; _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ3_1  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ3_2
MOV.L @DM12 DM5340       ; 溶着量記憶  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ3_1
MPS
DW.L +0 @DM12            ; 溶着量記憶
CON
JMP @MR5507
MPP
LD<.D DM5064 @DM46       ; _処理計測時間12  最短許容溶着時間(0.01s)
AND CR2003               ; 常時OFF
ANL
SET @MR5403              ; 溶着③NG
STG @MR5507
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR5508
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ締め
STG @MR5508
TMH @36 DM7034           ; 基礎ﾃﾞｰﾀ18 ﾍｯﾄﾞ1ゆるみ戻しｳｪｲﾄ
CON
AND @T36
RES MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
SET MR7309               ; ﾃｰﾌﾟ 締め
CON
MPS
ANB MR4113               ; ﾃｰﾌﾟ 締め側端異常
JMP @MR5509
MPP
LD MR4113                ; ﾃｰﾌﾟ 締め側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ下降
STG @MR5509
RES MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
SET MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
MPS
LDB MR4110               ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
ANB R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
AND R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
ANL
JMP @MR5510
MPP
LD MR4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾋｰﾀｰﾂｰﾙ清掃回数ﾁｪｯｸ
STG @MR5510
MPS
AND<> DM8750 #0          ; _消耗品1現在消費%
JMP @MR5515
MPP
AND= DM8750 #0           ; _消耗品1現在消費%
JMP @MR5511
;ERR151 溶着ﾍｯﾄﾞ清掃要求
STG @MR5511
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #151 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #7005 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR5512
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR5512
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR5515
;終了
STG @MR5515
RES @MR5402              ; 溶着③動作中
CON
SET @MR5401              ; 溶着③完了
CON
ENDS
;<h1/> 溶着④ @MR5700
STG @MR5700              ; 溶着④動作
SET @MR5702              ; 溶着④動作中
CON
JMP @MR5706
STG @MR5706
MPS
AND R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR5709
MPP
ANB R4107                ; ﾃｰﾌﾟｴﾝﾄﾞ検出(ﾀﾞﾝｻﾛｰﾗ下死点(NC)
JMP @MR5707
;ERR152 ﾎﾟﾘｲﾐﾄﾞﾃｰﾌﾟ異常
STG @MR5707
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #152 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #4107 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1004 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR5708
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR5708
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
SET MR2114               ; M-04 制動解除/ｱﾗｰﾑﾘｾｯﾄ
CON
MPS
AND @MR105               ; SW1
JMP @MR5706
MPP
AND @MR108               ; SW4
SET @MR5703              ; 溶着④NG
CON
JMP @MR5815
;溶着条件設定
;Z3 = ((DM12000 - 1) * 8) + 6	'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着④だから6
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量
;@DM56.L = DM7040.L:Z3 + DM7030.L:Z4
;
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値
;'@DM56.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR5710)
LD @MR5709
NCJ #1006
;Z3 = ((DM12000 - 1) * 8) + 6	'CAV_No.毎に8つﾃﾞｰﾀｼﾌﾄ  +  溶着④だから6
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +8
CON
ADD.L +6
CON
STA.L Z3
;Z4 = ((DM12000 - 1) * 2)		'CANｵﾌｾｯﾄﾃﾞｰﾀｼﾌﾄ分
;
LD CR2002                ; 常時ON
LDA DM12000              ; CAV_No
CON
EXT
CON
SUB.L +1
CON
MUL.L +2
CON
STA.L Z4
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量
;
;@DM56.L = DM7040.L:Z3 + DM7030.L:Z4
;
LD CR2002                ; 常時ON
LDA.L DM7040:Z3          ; 基礎ﾃﾞｰﾀ21 CAV1溶着量①
CON
ADD.L DM7030:Z4          ; 基礎ﾃﾞｰﾀ16 CAV1ｵﾌｾｯﾄ
CON
STA.L @DM56              ; ④溶着量設定値
;'目標値 = 溶着量  +  CAVｵﾌｾｯﾄ量  +  誤差修正値
;
;'@DM56.L = DM7040.L:Z3 + DM7030.L:Z4 + @DM48.L
;
;SET(@MR5710)
LD CR2002                ; 常時ON
SET @MR5710              ; 溶着条件設定完了
LABEL #1006
;
STG @MR5709
AND @MR5710              ; 溶着条件設定完了
RES @MR5710              ; 溶着条件設定完了
CON
JMP @MR5711
;ﾋｰﾀ2適温待ち
STG @MR5711
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
LD MR1904                ; ﾋｰﾀ2適温
OR @MR2002               ; ﾒﾝﾃ中
OR DM2000.12             ; ﾄﾞﾗｲ運転
OR DM2000.13             ; ﾋｰﾀ無効
ANL
ANL
JMP @MR5800
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ上昇/ﾃｰﾌﾟ緩め
STG @MR5800
RES MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
SET MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
RES MR7309               ; ﾃｰﾌﾟ 締め
CON
SET MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
MPS
LDB MR4111               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
ANB MR4112               ; ﾃｰﾌﾟ ゆるめ側端異常
ANB R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
AND R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
ANB R4113                ; ﾃｰﾌﾟ 締め側端
AND R4112                ; ﾃｰﾌﾟ ゆるめ側端
ANL
JMP @MR5801
MPP
LD MR4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
OR MR4112                ; ﾃｰﾌﾟ ゆるめ側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR5801
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
ANL
SET R47008               ; _処理時間9計測開始
CON
DW.L +0 @DM12            ; 溶着量記憶
CON
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR5802
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;溶着ﾍｯﾄﾞ2 下降
STG @MR5802
SET MR7102               ; 溶着2 下降
CON
MPS
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
AND R4102                ; 溶着2 下降端
MPS
AND>=.L DM11128 @DM56    ; GT3 現在値  ④溶着量設定値
TMR @19 DM7028           ; 基礎ﾃﾞｰﾀ15 ④溶着後ｳｪｲﾄ(0.01s)
CON
AND @T19
INC.D DM9036             ; _消耗品2ｶｳﾝﾀ
CON
JMP @MR5805
MPP
SET @MR802               ; ﾍｯﾄﾞ2溶着済記憶
CON
SET R47012               ; _処理時間13計測開始
MPP
TMR @20 #100
CON
AND @T20
SET @MR5703              ; 溶着④NG
CON
JMP @MR5805
MPP
AND R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
MPS
ANB R4102                ; 溶着2 下降端
JMP @MR5803
MPP
AND R4102                ; 溶着2 下降端
SET @MR5703              ; 溶着④NG
CON
JMP @MR5805
;下降限前でｴﾘｱ遮光→上昇してﾘﾄﾗｲ
STG @MR5803
RES R47012               ; _処理時間13計測開始
CON
RES MR7102               ; 溶着2 下降
CON
MPS
LDB MR4103               ; 溶着2 上昇端異常
ANB R4102                ; 溶着2 下降端
AND R4103                ; 溶着2 上昇端
ANL
RES R47008               ; _処理時間9計測開始
CON
JMP @MR5804
MPP
LD MR4103                ; 溶着2 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR5804
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND MR1904               ; ﾋｰﾀ2適温
JMP @MR5801
;溶着ﾍｯﾄﾞ2 上昇
STG @MR5805
RES R47012               ; _処理時間13計測開始
CON
RES MR7102               ; 溶着2 下降
CON
MPS
LDB MR4103               ; 溶着2 上昇端異常
ANB R4102                ; 溶着2 下降端
AND R4103                ; 溶着2 上昇端
ANL
RES R47008               ; _処理時間9計測開始
CON
JMP @MR5806
MPP
LD MR4103                ; 溶着2 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;溶着量Log.
LD @MR5802
OR @MR5805
AND>=.L DM11128 @DM12    ; GT3 現在値  溶着量記憶
MOV.L DM11128 @DM12      ; GT3 現在値  溶着量記憶
STG @MR5806
BMOV DM5360 DM5362 #14   ; _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ4_1  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ4_2
MOV.L @DM12 DM5360       ; 溶着量記憶  _ﾃﾞｰﾀ収集　ﾕｰｻﾞｰﾃﾞｰﾀ4_1
MPS
DW.L +0 @DM12            ; 溶着量記憶
CON
JMP @MR5807
MPP
LD<.D DM5066 @DM46       ; _処理計測時間13  最短許容溶着時間(0.01s)
AND CR2003               ; 常時OFF
ANL
SET @MR5703              ; 溶着④NG
STG @MR5807
MPS
ANB R41204               ; TASK4 PAUSE 要求
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR5808
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ締め
STG @MR5808
TMH @37 DM7036           ; 基礎ﾃﾞｰﾀ19 ﾍｯﾄﾞ2ゆるみ戻しｳｪｲﾄ
CON
AND @T37
RES MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
SET MR7309               ; ﾃｰﾌﾟ 締め
CON
MPS
ANB MR4113               ; ﾃｰﾌﾟ 締め側端異常
JMP @MR5809
MPP
LD MR4113                ; ﾃｰﾌﾟ 締め側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ下降
STG @MR5809
RES MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
SET MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
MPS
LDB MR4110               ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
ANB R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
AND R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
ANL
JMP @MR5810
MPP
LD MR4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾋｰﾀｰﾂｰﾙ清掃回数ﾁｪｯｸ
STG @MR5810
MPS
AND<> DM8751 #0          ; _消耗品2現在消費%
JMP @MR5815
MPP
AND= DM8751 #0           ; _消耗品2現在消費%
JMP @MR5811
;ERR151 溶着ﾍｯﾄﾞ清掃要求
STG @MR5811
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
DW #151 @DM1             ; ErrorNo /ERROR_DISP
CON
DW #7006 @DM2            ; SensorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
SET @MR100               ; Task4 ERROR
CON
JMP @MR5812
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
STG @MR5812
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; Task4 ERROR_End
RES @MR101               ; Task4 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR5815
;終了
STG @MR5815
RES @MR5702              ; 溶着④動作中
CON
SET @MR5701              ; 溶着④完了
CON
ENDS
;<h1/> ﾍｯﾄﾞ1 0ﾘｾｯﾄ @MR6000
STG @MR6000              ; ﾍｯﾄﾞ1 0ﾘｾｯﾄ動作
MPS
SET @MR6002              ; ﾍｯﾄﾞ1 0ﾘｾｯﾄ動作中
CON
JMP @MR6004
MPP
MOV.D #0 DM11322         ; GT2/3 PRESET設定値
;GT3ﾌﾟﾘｾｯﾄ設定値変更
STG @MR6004
TMH @30 #20
CON
AND @T30
SET DM11321.0            ; GT2 PRESET設定値書換要求
CON
JMP @MR6005
STG @MR6005
AND DM11124.0            ; GT2PRESET設定値書換え完了
RES DM11321.0            ; GT2 PRESET設定値書換要求
CON
JMP @MR6006
STG @MR6006
ANB DM11124.0            ; GT2PRESET設定値書換え完了
TMH @31 #20
CON
AND @T31
JMP @MR6008
;ｾﾞﾛﾃﾝｼｮﾝ上昇/ﾃｰﾌﾟ緩め
STG @MR6008
RES MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
SET MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
RES MR7309               ; ﾃｰﾌﾟ 締め
CON
SET MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
MPS
LDB MR4111               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
ANB MR4112               ; ﾃｰﾌﾟ ゆるめ側端異常
ANB R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
AND R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
ANB R4113                ; ﾃｰﾌﾟ 締め側端
AND R4112                ; ﾃｰﾌﾟ ゆるめ側端
ANL
JMP @MR6009
MPP
LD MR4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
OR MR4112                ; ﾃｰﾌﾟ ゆるめ側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR6009
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
ANL
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR6010
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;//*Select_Y_N
STG @MR6010
ANB R39104               ; SELECT_Y_N Interlock
SET R39104               ; SELECT_Y_N Interlock
CON
DW #2 @DM21              ; ScreenNo /SELECT_Y_N
CON
DW #0 @DM22              ; Bz_Use /SELECT_Y_N
CON
SET @MR300               ; Task4 SELECT_Y_N
CON
JMP @MR6011
STG @MR6011
AND @MR301               ; Task4 Y/N END
RES @MR301               ; Task4 Y/N END
CON
RES R39104               ; SELECT_Y_N Interlock
CON
MPS
AND @MR306               ; Task4 Y/N
JMP @MR6100              ; RB2 動作
MPP
ANB @MR306               ; Task4 Y/N
JMP @MR6105
;溶着ﾍｯﾄﾞ1 下降
STG @MR6100              ; RB2 動作
SET MR7100               ; 溶着1 下降
CON
MPS
LDB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND R4100                ; 溶着1 下降端
ANL
SET @MR801               ; ﾍｯﾄﾞ1溶着済記憶
CON
SET @MR801               ; ﾍｯﾄﾞ1溶着済記憶
CON
JMP @MR6102
MPP
AND R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
JMP @MR6101              ; RB2 動作完了
STG @MR6101              ; RB2 動作完了
RES MR7100               ; 溶着1 下降
CON
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND R44304               ; *Group1　ｴﾘｱｾﾝｻ入力
JMP @MR6100              ; RB2 動作
;０リセット
STG @MR6102
TMH @22 #60
CON
AND @T22
DW.L +0 DM11322          ; GT2/3 PRESET設定値
CON
SET DM11312.0            ; GT2 PRESET要求
CON
JMP @MR6103
STG @MR6103
AND DM11118.0
RES DM11312.0            ; GT2 PRESET要求
CON
JMP @MR6104
STG @MR6104
ANB DM11118.0
TMH @23 #20
CON
AND @T23
JMP @MR6105
;溶着ﾍｯﾄﾞ1 上昇
STG @MR6105
RES MR7100               ; 溶着1 下降
CON
MPS
LDB MR4101               ; 溶着1 上昇端異常
ANB R4100                ; 溶着1 下降端
AND R4101                ; 溶着1 上昇端
ANL
JMP @MR6106
MPP
LD MR4101                ; 溶着1 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ締め
STG @MR6106
RES MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
SET MR7309               ; ﾃｰﾌﾟ 締め
CON
MPS
ANB MR4113               ; ﾃｰﾌﾟ 締め側端異常
JMP @MR6107
MPP
LD MR4113                ; ﾃｰﾌﾟ 締め側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ下降
STG @MR6107
RES MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
SET MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
MPS
LDB MR4110               ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
ANB R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
AND R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
ANL
JMP @MR6108
MPP
LD MR4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;終了
STG @MR6108
RES @MR6002              ; ﾍｯﾄﾞ1 0ﾘｾｯﾄ動作中
CON
SET @MR6001              ; ﾍｯﾄﾞ1 0ﾘｾｯﾄ完了
CON
ENDS
;<h1/> ﾍｯﾄﾞ2 0ﾘｾｯﾄ @MR6200
STG @MR6200              ; ﾍｯﾄﾞ2 0ﾘｾｯﾄ動作
MPS
SET @MR6202              ; ﾍｯﾄﾞ2 0ﾘｾｯﾄ動作中
CON
JMP @MR6204
MPP
MOV.D DM0 DM11322        ; GT2/3 PRESET設定値
;GT3ﾌﾟﾘｾｯﾄ設定値変更
STG @MR6204
TMH @32 #20
CON
AND @T32
SET DM11321.1            ; GT3 PRESET設定値書換要求
CON
JMP @MR6205
STG @MR6205
AND DM11124.1            ; GT3PRESET設定値書換え完了
RES DM11321.1            ; GT3 PRESET設定値書換要求
CON
JMP @MR6206
STG @MR6206
ANB DM11124.1            ; GT3PRESET設定値書換え完了
TMH @33 #20
CON
AND @T33
JMP @MR6208
;ｾﾞﾛﾃﾝｼｮﾝ上昇/ﾃｰﾌﾟ緩め
STG @MR6208
RES MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
SET MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
RES MR7309               ; ﾃｰﾌﾟ 締め
CON
SET MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
MPS
LDB MR4111               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
ANB MR4112               ; ﾃｰﾌﾟ ゆるめ側端異常
ANB R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
AND R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
ANB R4113                ; ﾃｰﾌﾟ 締め側端
AND R4112                ; ﾃｰﾌﾟ ゆるめ側端
ANL
JMP @MR6209
MPP
LD MR4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端異常
OR MR4112                ; ﾃｰﾌﾟ ゆるめ側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
STG @MR6209
MPS
LDB R41204               ; TASK4 PAUSE 要求
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
ANL
SET R47600               ; _Group1　動作区切り開始
CON
AND R47608               ; _Group1　動作区切り完了
JMP @MR6210
MPP
AND R41204               ; TASK4 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;//*Select_Y_N
STG @MR6210
ANB R39104               ; SELECT_Y_N Interlock
SET R39104               ; SELECT_Y_N Interlock
CON
DW #3 @DM21              ; ScreenNo /SELECT_Y_N
CON
DW #0 @DM22              ; Bz_Use /SELECT_Y_N
CON
SET @MR300               ; Task4 SELECT_Y_N
CON
JMP @MR6211
STG @MR6211
AND @MR301               ; Task4 Y/N END
RES @MR301               ; Task4 Y/N END
CON
RES R39104               ; SELECT_Y_N Interlock
CON
MPS
AND @MR306               ; Task4 Y/N
JMP @MR6300
MPP
ANB @MR306               ; Task4 Y/N
JMP @MR6305
;溶着ﾍｯﾄﾞ2 下降
STG @MR6300
SET MR7102               ; 溶着2 下降
CON
MPS
LDB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND R4102                ; 溶着2 下降端
ANL
SET @MR802               ; ﾍｯﾄﾞ2溶着済記憶
CON
SET @MR802               ; ﾍｯﾄﾞ2溶着済記憶
CON
JMP @MR6302
MPP
AND R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
JMP @MR6301
STG @MR6301
RES MR7102               ; 溶着2 下降
CON
ANB R46300               ; _Group1　ｴﾘｱｾﾝｻ遮断中
AND R44304               ; *Group1　ｴﾘｱｾﾝｻ入力
JMP @MR6300
;０リセット
STG @MR6302
TMH @25 #60
CON
AND @T25
DW.L +0 DM11322          ; GT2/3 PRESET設定値
CON
SET DM11312.1            ; GT3 PRESET要求
CON
JMP @MR6303
STG @MR6303
AND DM11118.1
RES DM11312.1            ; GT3 PRESET要求
CON
JMP @MR6304
STG @MR6304
ANB DM11118.1
TMH @26 #20
CON
AND @T26
JMP @MR6305
;溶着ﾍｯﾄﾞ2 上昇
STG @MR6305
RES MR7102               ; 溶着2 下降
CON
MPS
LDB MR4103               ; 溶着2 上昇端異常
ANB R4102                ; 溶着2 下降端
AND R4103                ; 溶着2 上昇端
ANL
JMP @MR6306
MPP
LD MR4103                ; 溶着2 上昇端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ﾃｰﾌﾟ締め
STG @MR6306
RES MR7308               ; ﾃｰﾌﾟ ゆるめ
CON
SET MR7309               ; ﾃｰﾌﾟ 締め
CON
MPS
ANB MR4113               ; ﾃｰﾌﾟ 締め側端異常
JMP @MR6307
MPP
LD MR4113                ; ﾃｰﾌﾟ 締め側端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;ｾﾞﾛﾃﾝｼｮﾝ下降
STG @MR6307
RES MR7307               ; ｾﾞﾛﾃﾝｼｮﾝ 上昇
CON
SET MR7306               ; ｾﾞﾛﾃﾝｼｮﾝ 下降
CON
MPS
LDB MR4110               ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
ANB R4111                ; ｾﾞﾛﾃﾝｼｮﾝ 上昇端
AND R4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端
ANL
JMP @MR6308
MPP
LD MR4110                ; ｾﾞﾛﾃﾝｼｮﾝ 下降端異常
AND R41204               ; TASK4 PAUSE 要求
ANL
SET @MR1900              ; Main1 HALT許可
;終了
STG @MR6308
RES @MR6202              ; ﾍｯﾄﾞ2 0ﾘｾｯﾄ動作中
CON
SET @MR6201              ; ﾍｯﾄﾞ2 0ﾘｾｯﾄ完了
CON
ENDS
;<h1/>-----------------------------------------------------------
;<h1/>*ERROR
;MyTask Error Process Substance/エラー処理実体
STG @MR100               ; Task4 ERROR
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @MR105 @MR108       ; SW1  SW4
CON
DISN @DM9 @DM3 #4        ; ReturnSW /ERROR_DISP
MRD
DW MyTask @DM0           ; 自ﾀｽｸ番号  TaskNo /ERROR_DISP
CON
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP  TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @MR102               ; Task4 ERROR Busy
CON
JMP @MR103
STG @MR103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP  ErrorNo /ERROR_DISP
MPS
AND= DM60007 @DM6        ; ReturnSW /ERROR_DISP
SET @MR105               ; SW1
CON
JMP @MR104
MRD
AND= DM60007 @DM5        ; ReturnSW /ERROR_DISP
SET @MR106               ; SW2
CON
JMP @MR104
MRD
AND= DM60007 @DM4        ; ReturnSW /ERROR_DISP
SET @MR107               ; SW3
CON
JMP @MR104
MPP
AND= DM60007 @DM3        ; ReturnSW /ERROR_DISP
SET @MR108               ; SW4
CON
JMP @MR104
STG @MR104
ANB R39002               ; ERROR_DISP Busy
RES @MR102               ; Task4 ERROR Busy
CON
SET @MR101               ; Task4 ERROR_End
CON
ENDS
;<h1/>*Select_Y_N 
;MyTask Select_Y_N Process Substance/SELECT_Y_N処理実体
STG @MR300               ; Task4 SELECT_Y_N
ANB R39102               ; SELECT_Y_N Busy
MPS
ZRES @MR306 @MR307       ; Task4 Y/N
CON
DW #0 @DM20              ; TaskNo /SELECT_Y_N
CON
BMOV @DM20 DM60020 #3    ; TaskNo /SELECT_Y_N  TaskNo /SELECT_Y_N
MPP
SET R39100               ; SELECT_Y_N Start
CON
SET @MR302               ; Task4 Y_N Busy
CON
JMP @MR303
STG @MR303
AND R39102               ; SELECT_Y_N Busy
MPS
AND= DM60023 #1          ; Y_N /SELECT_Y_N
SET @MR306               ; Task4 Y/N
CON
JMP @MR304
MPP
AND= DM60023 #2          ; Y_N /SELECT_Y_N
RES @MR306               ; Task4 Y/N
CON
JMP @MR304
STG @MR304
ANB R39102               ; SELECT_Y_N Busy
RES @MR302               ; Task4 Y_N Busy
CON
SET @MR301               ; Task4 Y/N END
CON
ENDS
;<h1/>*TIMEUP ERROR
;MyTask TIMEUP_ERROR Process Substance/TIMEUP_ERROR処理実体
STG @MR400               ; Task4 TIMEUP_ERR
ANB R39302               ; TIMEUP_ERR Busy
MPS
DW #0 @DM40
CON
BMOV @DM40 DM60040 #2    ; TaskNo /TIMEUP_ERR
MPP
SET R39300               ; TIMEUP_ERR Start
CON
SET @MR402               ; Task4 TIMEUP Busy
CON
JMP @MR403
STG @MR403
AND R39302               ; TIMEUP_ERR Busy
JMP @MR404
STG @MR404
ANB R39302               ; TIMEUP_ERR Busy
RES @MR402               ; Task4 TIMEUP Busy
CON
SET @MR401               ; Task4 TIMEUP_END
CON
ENDS
;<h1/>*Select_ACT 
;MyTask Select_ACT Process Substance/SELECT_ACT処理実体
STG @MR200               ; Task4 SELECT_ACT
ANB R39202               ; SELECT_ACT Busy
MPS
ZRES @MR205 @MR208       ; SW1  SW4
CON
DW #0 @DM30              ; TaskNo /SELECT_ACT
CON
BMOV @DM30 DM60030 #7    ; TaskNo /SELECT_ACT  TaskNo /SELECT_ACT
MPP
SET R39200               ; SELECT_ACT Start
CON
SET @MR202               ; Task4 SEL_ACT Busy
CON
JMP @MR203
STG @MR203
AND R39202               ; SELECT_ACT Busy
AND<> DM60037 #0         ; SelectSW /SELECT_ACT
MPS
AND= DM60037 #1          ; SelectSW /SELECT_ACT
SET @MR205               ; SW1
CON
JMP @MR204
MRD
AND= DM60037 #2          ; SelectSW /SELECT_ACT
SET @MR206               ; SW2
CON
JMP @MR204
MRD
AND= DM60037 #3          ; SelectSW /SELECT_ACT
SET @MR207               ; SW3
CON
JMP @MR204
MPP
AND= DM60037 #4          ; SelectSW /SELECT_ACT
SET @MR208               ; SW4
CON
JMP @MR204
STG @MR204
ANB R39202               ; SELECT_ACT Busy
RES @MR202               ; Task4 SEL_ACT Busy
CON
SET @MR201               ; Task4 SEL_ACT END
CON
ENDS
;<h1/>HALT
LD R41204                ; TASK4 PAUSE 要求
AND @MR1900              ; Main1 HALT許可
LD @MR1901               ; Main2 HALT許可
ORB @MR4002              ; Main2 Busy
ANL
TMR @40 #5
CON
AND @T40
SET R42604               ; Grp1_Task4_ﾎﾟｰｽﾞ許可
LD R42604                ; Grp1_Task4_ﾎﾟｰｽﾞ許可
ORB R41204               ; TASK4 PAUSE 要求
ANB @MR001               ; TASK4　ERROR
RES @MR1900              ; Main1 HALT許可
CON
RES @MR1901              ; Main2 HALT許可
END
ENDH
