DEVICE:53
;MODULE:AlwaysSignal
;MODULE_TYPE:0
;OneSystem Sub-Module
;
;---------------------------------------
;ModuleName	:	Always_Signal
;ModuleType	:	Sub Module
;Function	:	条件生成
;---------------------------------------
;<使用方法>
;ﾌﾟﾛｼﾞｪｸﾄ全体に関わる条件ｼｸﾞﾅﾙ生成は本ﾓｼﾞｭｰﾙに記述して下さい
;・ﾓｰｼｮﾝｺﾝﾄﾛｰﾙ動作許可
;・ｺﾐｭﾆｹｰｼｮﾝﾕﾆｯﾄ通信許可
;・ﾋｰﾀｰ電源ON
;など
LD CR2008                ; 運転開始時1ｽｷｬﾝON
OR MR10100               ; 運転開始時1ｽｷｬﾝON　保持
ANB R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OUT MR10100              ; 運転開始時1ｽｷｬﾝON　保持
LD CR2002                ; 常時ON
MOV.D DM4200 DM4502      ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ_1  離脱量(0.01mm)(U1)
;ﾍｯﾄﾞｻﾌﾞ→ﾎﾙﾀﾞｰｻﾌﾞの先入れ先だし回路
;<h1/>FIFOテーブル　読出し回路
LD MR401                 ; FIFO読出し　Trig
SET MR17200              ; 読出し開始
STG MR17200              ; 読出し開始
MPS
LDB CR2002               ; 常時ON
ANB MR17301              ; 書き込み実行中
ANL
SET MR17201              ; 読出し実行中
CON
JMP MR17202              ; START
MPP
AND CR2002               ; 常時ON
SET MR17201              ; 読出し実行中
CON
JMP MR17202              ; START
STG MR17202              ; START
MPS
AND<> DM50 #0            ; ﾎﾙﾀﾞｻﾌﾞ指定No.
MPS
AND= DM50 DM60           ; ﾎﾙﾀﾞｻﾌﾞ指定No.  ﾎﾙﾀﾞｻﾌﾞ指定No.
JMP MR17206              ; 取出しOK
MPP
MOV DM50 DM60            ; ﾎﾙﾀﾞｻﾌﾞ指定No.  ﾎﾙﾀﾞｻﾌﾞ指定No.
MPP
AND= DM50 #0             ; ﾎﾙﾀﾞｻﾌﾞ指定No.
JMP MR17203              ; ﾃﾞｰﾀシフト開始
STG MR17203              ; ﾃﾞｰﾀシフト開始
LDA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
STA DM50                 ; ﾎﾙﾀﾞｻﾌﾞ指定No.
CON
LDA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
STA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
LDA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
STA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
LDA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
STA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
LDA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
STA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
LDA DM56                 ; FIFOﾃｰﾌﾞﾙ 6個目
CON
STA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
LDA #0
CON
STA DM56                 ; FIFOﾃｰﾌﾞﾙ 6個目
CON
JMP MR17204
STG MR17204
MPS
LD= DM51 #0              ; FIFOﾃｰﾌﾞﾙ 1個目
AND= DM52 #0             ; FIFOﾃｰﾌﾞﾙ 2個目
AND= DM53 #0             ; FIFOﾃｰﾌﾞﾙ 3個目
AND= DM54 #0             ; FIFOﾃｰﾌﾞﾙ 4個目
AND= DM55 #0             ; FIFOﾃｰﾌﾞﾙ 5個目
AND= DM56 #0             ; FIFOﾃｰﾌﾞﾙ 6個目
ANL
OUT MR17210              ; 全てO
CON
SET MR403                ; FIFO読出し完了なし
CON
JMP MR17208
MPP
ANB MR17210              ; 全てO
JMP MR17202              ; START
;<<行コメント編集：Ctrl+Enter/Escで確定>>
STG MR17206              ; 取出しOK
LDA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
STA DM50                 ; ﾎﾙﾀﾞｻﾌﾞ指定No.
CON
LDA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
STA DM51                 ; FIFOﾃｰﾌﾞﾙ 1個目
CON
LDA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
STA DM52                 ; FIFOﾃｰﾌﾞﾙ 2個目
CON
LDA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
STA DM53                 ; FIFOﾃｰﾌﾞﾙ 3個目
CON
LDA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
STA DM54                 ; FIFOﾃｰﾌﾞﾙ 4個目
CON
LDA DM56                 ; FIFOﾃｰﾌﾞﾙ 6個目
CON
STA DM55                 ; FIFOﾃｰﾌﾞﾙ 5個目
CON
MPS
LD= DM60 #1              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11211.0            ; RB13 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11211.15           ; RB13 排出品 記憶FLG
LD= DM60 #2              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11212.0            ; RB14 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11212.15           ; RB14 不良品 記憶FLG
ORL
LD= DM60 #3              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11213.0            ; RB15 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11213.15           ; RB15 不良品 記憶FLG
ORL
LD= DM60 #4              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11214.0            ; RB16 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11214.15           ; RB16 不良品FLG
ORL
LD= DM60 #5              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11215.0            ; RB17 ﾍｯﾄﾞSub　受取完了　記憶
ANB DM11215.15           ; RB17 不良品 記憶FLG
ORL
LD= DM60 #6              ; ﾎﾙﾀﾞｻﾌﾞ指定No.
AND DM11216.0            ; RB18 ﾍｯﾄﾞSub　受取完了 記憶FLG
ANB DM11216.15           ; RB18 不良品 記憶FLG
ORL
ANL
SET MR402                ; FIFO読出し完了OK
CON
JMP MR17208
MPP
ANB MR402                ; FIFO読出し完了OK
JMP MR17208
STG MR17208
ANB MR402                ; FIFO読出し完了OK
ANB MR403                ; FIFO読出し完了なし
RES MR17201              ; 読出し実行中
CON
ENDS
;<h1/>FIFOテーブル　書き込み回路
LD MR405                 ; FIFO書き込みTrig
SET MR17300              ; 書き込み開始
STG MR17300              ; 書き込み開始
ANB MR17201              ; 読出し実行中
RES MR17310              ; 書き込みOK　DM50へ
CON
RES MR17311              ; 書き込みOK　DM51へ
CON
RES MR17312              ; 書き込みOK　DM52へ
CON
RES MR17313              ; 書き込みOK　DM53へ
CON
RES MR17314              ; 書き込みOK　DM54へ
CON
RES MR17315              ; 書き込みOK　DM55へ
CON
RES MR17400              ; 書き込みOK　DM56へ
CON
SET MR17301              ; 書き込み実行中
CON
JMP MR17302              ; START
STG MR17302              ; START
MPS
AND= DM50 #0             ; ﾎﾙﾀﾞｻﾌﾞ指定No.
SET MR17310              ; 書き込みOK　DM50へ
CON
JMP MR17303
MPP
AND<> DM50 #0            ; ﾎﾙﾀﾞｻﾌﾞ指定No.
MPS
AND= DM51 #0             ; FIFOﾃｰﾌﾞﾙ 1個目
SET MR17311              ; 書き込みOK　DM51へ
CON
JMP MR17303
MPP
AND<> DM51 #0            ; FIFOﾃｰﾌﾞﾙ 1個目
MPS
AND= DM52 #0             ; FIFOﾃｰﾌﾞﾙ 2個目
SET MR17312              ; 書き込みOK　DM52へ
CON
JMP MR17303
MPP
AND<> DM52 #0            ; FIFOﾃｰﾌﾞﾙ 2個目
MPS
AND= DM53 #0             ; FIFOﾃｰﾌﾞﾙ 3個目
SET MR17313              ; 書き込みOK　DM53へ
CON
JMP MR17303
MPP
AND<> DM53 #0            ; FIFOﾃｰﾌﾞﾙ 3個目
MPS
AND= DM54 #0             ; FIFOﾃｰﾌﾞﾙ 4個目
SET MR17314              ; 書き込みOK　DM54へ
CON
JMP MR17303
MPP
AND<> DM54 #0            ; FIFOﾃｰﾌﾞﾙ 4個目
MPS
AND= DM55 #0             ; FIFOﾃｰﾌﾞﾙ 5個目
SET MR17315              ; 書き込みOK　DM55へ
CON
JMP MR17303
MPP
LD<> DM55 #0             ; FIFOﾃｰﾌﾞﾙ 5個目
AND= DM56 #0             ; FIFOﾃｰﾌﾞﾙ 6個目
ANL
SET MR17400              ; 書き込みOK　DM56へ
CON
JMP MR17303
STG MR17303
ANB MR17310              ; 書き込みOK　DM50へ
ANB MR17311              ; 書き込みOK　DM51へ
ANB MR17312              ; 書き込みOK　DM52へ
ANB MR17313              ; 書き込みOK　DM53へ
ANB MR17314              ; 書き込みOK　DM54へ
ANB MR17315              ; 書き込みOK　DM55へ
ANB MR17400              ; 書き込みOK　DM56へ
RES MR17301              ; 書き込み実行中
CON
ENDS
;TPｶﾚﾝﾀﾞﾀｲﾏ自動同期
LD= CM703 #8             ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
AND= CM704 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
AND= CM705 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（秒）
SET @R010
STG @R010
MPS
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
CON
ADD #32768
CON
TBCD
CON
STA DM3010               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
CON
TBCD
CON
STA DM3011               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
CON
TBCD
CON
STA DM3012               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM703                ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
CON
TBCD
CON
STA @DM21
MRD
LDA CM704                ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
CON
TBCD
CON
STA @DM20
MRD
UNIB @DM20 DM3013 #2     ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MPP
JMP @R011
STG @R011
TMH @1 #5
CON
AND @T1
BRES DM3010 #15          ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
CON
ENDS
;<h1/>温調器通信
LD CR2008                ; 運転開始時1ｽｷｬﾝON
MSTRT TEMP_PV R18100 DM15000 EM2000 #4;ﾕﾆｯﾄｴﾗｰ番号  TEMP_PV_UT1_#1
LD CR2008                ; 運転開始時1ｽｷｬﾝON
MSTRT TEMP_PV R18400 DM15610 EM2004 #4;ﾕﾆｯﾄｴﾗｰ番号  TEMP_PV_UT2_#1
LD CR2008                ; 運転開始時1ｽｷｬﾝON
MSTRT TEMP_PV R18700 DM16220 EM2008 #4;ﾕﾆｯﾄｴﾗｰ番号  TEMP_PV_UT3_#1
;<h1/>機種切替
;1-1ｾﾙからの切替信号により機種No.をDM8640に代入し機種変更ﾌﾗｸﾞを立てる。
;No.1　=　BIJ-2
;No.3　=　DEPP
LD= W1000 #0             ; 親ｾﾙより機種切替要求
DW #0 W101E              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
LD= W1000 #1             ; 親ｾﾙより機種切替要求
AND= DM3008 #10          ; _MainTP　切替ﾍﾟｰｼﾞNo
AND R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB R52210               ; 機種切替中
AND= W101E #0            ; 親ｾﾙへ切替完了ｺｰﾄﾞ
DW #1 W101E              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
SET MR200
STG MR200
MPS
AND= DM5260 W1001        ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
JMP MR201
MPP
AND<> DM5260 W1001       ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
MPS
AND= W1001 #1            ; 親ｾﾙより要求機種No
DW #0 DM9033             ; _機種変更種類
CON
DW #1 DM8641             ; _TP機種切替実行分類番号
CON
DW #1 DM8640             ; _TP選択中機種ｺｰﾄﾞ
CON
SET R54807               ; _機種切替要求(From TP)
CON
SET R52210               ; 機種切替中
CON
JMP MR201
MPP
AND= W1001 #3            ; 親ｾﾙより要求機種No
DW #0 DM9033             ; _機種変更種類
CON
DW #1 DM8641             ; _TP機種切替実行分類番号
CON
DW #3 DM8640             ; _TP選択中機種ｺｰﾄﾞ
CON
SET R54807               ; _機種切替要求(From TP)
CON
SET R52210               ; 機種切替中
CON
JMP MR201
STG MR201
ANB R52210               ; 機種切替中
TMR #20 #10
CON
AND T20
MPS
AND= DM5260 W1001        ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
DW #2 W101E              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
ENDS
MPP
AND<> DM5260 W1001       ; 選択中ｺｰﾄﾞ  親ｾﾙより要求機種No
DW #3 W101E              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
ENDS
LD CR2002                ; 常時ON
MOV DM5260 W101F         ; 選択中ｺｰﾄﾞ  親ｾﾙへ完了機種No.
;<h1/>カシメ動作DEPP対応
LD CR2002                ; 常時ON
MPS
AND<> #3 DM5260          ; 選択中ｺｰﾄﾞ
RES MR1303               ;  ｶｼﾒ U1(I/W)_2点溶着切替入力
MPP
AND= #3 DM5260           ; 選択中ｺｰﾄﾞ
SET MR1303               ;  ｶｼﾒ U1(I/W)_2点溶着切替入力
LD CR2002                ; 常時ON
MPS
AND<> #3 DM5260          ; 選択中ｺｰﾄﾞ
RES MR1311               ;  ｶｼﾒ U2(I/W)_2点溶着切替入力
MPP
AND= #3 DM5260           ; 選択中ｺｰﾄﾞ
SET MR1311               ;  ｶｼﾒ U2(I/W)_2点溶着切替入力
LD CR2002                ; 常時ON
MPS
AND<> #3 DM5260          ; 選択中ｺｰﾄﾞ
RES MR1503               ;  ｶｼﾒ U3(I/W)_2点溶着切替入力
MPP
AND= #3 DM5260           ; 選択中ｺｰﾄﾞ
SET MR1503               ;  ｶｼﾒ U3(I/W)_2点溶着切替入力
;<h1/>基準ヘッド日常点検
;4cellへフラグON
LD= DM5010 #2            ; _AUTO動作番号
SET B0100                ; 基準ﾍｯﾄﾞ日点ﾌﾗｸﾞ
LD<> DM5010 #2           ; _AUTO動作番号
RES B0100                ; 基準ﾍｯﾄﾞ日点ﾌﾗｸﾞ
END
ENDH
