DEVICE:52
;MODULE:PADJ-H40S
;MODULE_TYPE:1
;★★★PADJ-H40S  KV-H40S 現在座標書き込みシステムマクロ★★★ Ver2.00
;引数説明
;第１引数　ユニット番号選択　＃１〜＃４８　デバイス指定不可
;第２引数　軸選択　　　　　　＃０〜＃３　　　又は　デバイス指定可（＃０＝Ｘ１軸、＃１＝Ｙ１軸、＃２＝Ｘ２軸、＃３＝Ｙ２軸）
;第３引数　現在座標　　　　　＃−９９９９９９９９〜＃９９９９９９９９　又は　デバイス指定可
;引数エラーチェック
LD> V0 #3                ; 軸選択
CJ #0
;軸選択 (R)
LD @CR2008
ADRSET UR0 @EM0          ; ﾕﾆｯﾄ番号  軸先頭ﾘﾚｰ
LDA V0                   ; 軸選択
CON
MUL #48
CON
STA @EM4                 ; 軸選択ｵﾌｾｯﾄ
CON
ADRADD.S @EM4 @EM0       ; 軸選択ｵﾌｾｯﾄ  軸先頭ﾘﾚｰ
;軸選択（DM)
LD @CR2008
ADRSET UM0 @EM2          ; ﾕﾆｯﾄ番号  軸先頭DM
LDA V0                   ; 軸選択
CON
MUL #8
CON
STA @EM5                 ; 軸選択ｵﾌｾｯﾄ
CON
ADRADD.S @EM5 @EM2       ; 軸選択ｵﾌｾｯﾄ  軸先頭DM
;現在座標書き込み開始（開始条件が成立していない場合はマクロ終了）
LD @CR2008
MPS
LD *@EM0                 ; 軸先頭ﾘﾚｰ
ANB *@EM0:#22            ; 軸先頭ﾘﾚｰ
ANB *@EM0:#1             ; 軸先頭ﾘﾚｰ
ANB *@EM0:#3             ; 軸先頭ﾘﾚｰ
ANB *@EM0:#33            ; 軸先頭ﾘﾚｰ
ANL
MPS
LDA.L V1                 ; 現在座標
CON
STA.L *@EM2:#52          ; 軸先頭DM
MPP
SET *@EM0:#214           ; 軸先頭ﾘﾚｰ
MPP
LDB *@EM0                ; 軸先頭ﾘﾚｰ
OR *@EM0:#22             ; 軸先頭ﾘﾚｰ
OR *@EM0:#1              ; 軸先頭ﾘﾚｰ
OR *@EM0:#3              ; 軸先頭ﾘﾚｰ
OR *@EM0:#33             ; 軸先頭ﾘﾚｰ
ANL
MEND
;要求リレーのクリア(正常系)
LDB @CR2008
AND *@EM0:#214           ; 軸先頭ﾘﾚｰ
AND *@EM0:#22            ; 軸先頭ﾘﾚｰ
RES *@EM0:#214           ; 軸先頭ﾘﾚｰ
;ユニットエラー中リレーチェック：マクロ実行中にユニット側でエラーを検出した場合は、マクロ処理を中断
;現在座標書き込み完了リレーとのハンドシェイク完了でマクロ終了
LD *@EM0:#6              ; 軸先頭ﾘﾚｰ
LDB *@EM0:#214           ; 軸先頭ﾘﾚｰ
ANB *@EM0:#22            ; 軸先頭ﾘﾚｰ
ORL
RES *@EM0:#214           ; 軸先頭ﾘﾚｰ
CON
MEND
LABEL #0
LD> V0 #3                ; 軸選択
MEND
END
ENDH
