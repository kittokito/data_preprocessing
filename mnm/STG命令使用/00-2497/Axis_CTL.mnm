DEVICE:52
;MODULE:Axis_CTL
;MODULE_TYPE:0
;***** Axis_CTL *****
;
;※ 注意1:軸を動かせる範囲は、
;   ﾕﾆｯﾄ01(KV-MC40V:4軸)
;   4軸 15ﾎﾟｲﾝﾄ。
;
;※ 注意2:ﾌﾗｯｼｭROM書込みは、軸を動作させたﾎﾟｲﾝﾄのみ書込む。
;
;///// 位置決めﾕﾆｯﾄ ﾕﾆｯﾄ01動作許可 /////
LD MR53000               ; ﾕﾆｯﾄ01 動作許可
OUT R11600               ; 動作許可
LD R12800                ; 動作可能
OUT MR53500              ; ﾕﾆｯﾄ01 動作可能
LD R12801                ; 動作許可ｴﾗｰ
OUT MR53501              ; ﾕﾆｯﾄ01 動作許可ｴﾗｰ
;///// 位置決めﾕﾆｯﾄ ﾕﾆｯﾄ01ﾌﾗｯｼｭROM書込み /////
LDP MR53002              ; ﾕﾆｯﾄ01 ROM書込指示
ANB MR51110              ; 軸1BUSY
ANB MR51310              ; 軸2BUSY
ANB MR51510              ; 軸3BUSY
ANB MR51710              ; 軸4BUSY
OR MR53502               ; ﾕﾆｯﾄ01 ROM書込中
ANB MR53503              ; ﾕﾆｯﾄ01 ROM書込完了
AND MR53500              ; ﾕﾆｯﾄ01 動作可能
OUT MR53502              ; ﾕﾆｯﾄ01 ROM書込中
;----- ﾕﾆｯﾄ01 1軸目ﾃﾞｰﾀ設定 -----
LD MR53008               ; ﾕﾆｯﾄ01 軸1 有り
AND MR53502              ; ﾕﾆｯﾄ01 ROM書込中
@UWRIT.D #2 #14162 EM32406 #1;軸1JOG加減速度
@UWRIT.D #2 #14164 EM32406 #1;軸1JOG加減速度
@UWRIT.D #2 #14166 EM32402 #1;軸1JOG速度Lo(起動速度)
@UWRIT.D #2 #14168 EM32404 #1;軸1JOG速度Hi
@UWRIT.D #2 #14180 EM32400 #1;軸1原点復帰速度
;----- ﾕﾆｯﾄ01 2軸目ﾃﾞｰﾀ設定 -----
LD MR53009               ; ﾕﾆｯﾄ01 軸2 有り
AND MR53502              ; ﾕﾆｯﾄ01 ROM書込中
@UWRIT.D #2 #14212 EM32416 #1;軸2JOG加減速度
@UWRIT.D #2 #14214 EM32416 #1;軸2JOG加減速度
@UWRIT.D #2 #14216 EM32412 #1;軸2JOG速度Lo(起動速度)
@UWRIT.D #2 #14218 EM32414 #1;軸2JOG速度Hi
@UWRIT.D #2 #14230 EM32410 #1;軸2原点復帰速度
;----- ﾕﾆｯﾄ01 3軸目ﾃﾞｰﾀ設定 -----
LD MR53010               ; ﾕﾆｯﾄ01 軸3 有り
AND MR53502              ; ﾕﾆｯﾄ01 ROM書込中
@UWRIT.D #2 #14262 EM32426 #1;軸3JOG加減速度
@UWRIT.D #2 #14264 EM32426 #1;軸3JOG加減速度
@UWRIT.D #2 #14266 EM32422 #1;軸3JOG速度Lo(起動速度)
@UWRIT.D #2 #14268 EM32424 #1;軸3JOG速度Hi
@UWRIT.D #2 #14280 EM32420 #1;軸3原点復帰速度
;----- ﾕﾆｯﾄ01 4軸目ﾃﾞｰﾀ設定 -----
LD MR53011               ; ﾕﾆｯﾄ01 軸4 有り
AND MR53502              ; ﾕﾆｯﾄ01 ROM書込中
@UWRIT.D #2 #14312 EM32436 #1;軸4JOG加減速度
@UWRIT.D #2 #14314 EM32436 #1;軸4JOG加減速度
@UWRIT.D #2 #14316 EM32432 #1;軸4JOG速度Lo(起動速度)
@UWRIT.D #2 #14318 EM32434 #1;軸4JOG速度Hi
@UWRIT.D #2 #14330 EM32430 #1;軸4原点復帰速度
;----- ﾕﾆｯﾄ01 ﾌﾗｯｼｭROM書込み実行 -----
LD MR53502               ; ﾕﾆｯﾄ01 ROM書込中
MPS
OUT R11612               ; ﾌﾗｯｼｭROM書込要求
MPP
AND R12812               ; ﾌﾗｯｼｭROM書込完了
UREAD #2 #105 EM32721 #1 ; ﾕﾆｯﾄ01 ROM書込完了ｺｰﾄﾞ
MPS
OUT MR53503              ; ﾕﾆｯﾄ01 ROM書込完了
MPP
AND<> EM32721 #0         ; ﾕﾆｯﾄ01 ROM書込完了ｺｰﾄﾞ
OUT MR53504              ; ﾕﾆｯﾄ01 ROM書込ｴﾗｰ
;===== 軸1:動作制御 =====
;----- 軸1:起動Po.ｴﾝｺｰﾄﾞ -----
LD CR2002                ; 常時ON
LDA MR50000              ; 軸1ﾎﾟｲﾝﾄ移動指令
CON
BCNT
CON
STA EM32800              ; 軸1起動BITﾁｪｯｸ
LDB MR50114              ; 軸1減速停止
ANB MR51110              ; 軸1BUSY
ANB MR51113              ; 軸1ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51115              ; 軸1ｴﾗｰ検出
AND T2470                ; 軸1ｲﾝﾀｰﾊﾞﾙ
MPS
LD= EM32800 #1           ; 軸1起動BITﾁｪｯｸ
ANB MR50108              ; 軸1原点復帰指令
ANL
ENCO MR50000 #16         ; 軸1ﾎﾟｲﾝﾄ移動指令
CON
STA EM32803              ; 軸1起動Po.No
MPP
LD= EM32800 #0           ; 軸1起動BITﾁｪｯｸ
AND MR50108              ; 軸1原点復帰指令
ANL
MOV #99 EM32803          ; 軸1起動Po.No
LD= MR50000 #0           ; 軸1ﾎﾟｲﾝﾄ移動指令
AND= EM32800 #0          ; 軸1起動BITﾁｪｯｸ
ANB MR50108              ; 軸1原点復帰指令
ANB MR51110              ; 軸1BUSY
ORB R55000               ; 即停止/TRAP無
OR MR50114               ; 軸1減速停止
OR MR51113               ; 軸1ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR MR51115               ; 軸1ｴﾗｰ検出
OR CR2008                ; 運転開始時1ｽｷｬﾝON
MOV #0 EM32803           ; 軸1起動Po.No
;----- 軸1:起動ｲﾝﾀｰﾊﾞﾙ -----
LD R55000                ; 即停止/TRAP無
ANB MR51110              ; 軸1BUSY
AND= EM32800 #0          ; 軸1起動BITﾁｪｯｸ
ANB MR50108              ; 軸1原点復帰指令
TMH #2470 #5             ; 軸1ｲﾝﾀｰﾊﾞﾙ
;----- 軸1:ﾏｽﾀｰｺﾝﾄﾛｰﾙ -----
LD MR53500               ; ﾕﾆｯﾄ01 動作可能
AND R55000               ; 即停止/TRAP無
MC
;----- 軸1:JOG -----
LD MR53008               ; ﾕﾆｯﾄ01 軸1 有り
MPS
AND CR2003               ; 常時OFF
UWRIT.D #2 #14162 EM32406 #1;軸1JOG加減速度
UWRIT.D #2 #14164 EM32406 #1;軸1JOG加減速度
UWRIT.D #2 #14166 EM32402 #1;軸1JOG速度Lo(起動速度)
UWRIT.D #2 #14168 EM32404 #1;軸1JOG速度Hi
MRD
LD MR50112               ; 軸1+JOG
OR MR50113               ; 軸1-JOG
ANL
@U_WRPOR #2 #1 #100
MRD
AND MR50112              ; 軸1+JOG
OUT R14100               ; 軸1 JOG正方向
MRD
AND MR50113              ; 軸1-JOG
OUT R14101               ; 軸1 JOG負方向
MPP
AND MR50111              ; 軸1JOG速度切替 Hi
OUT R14102               ; 軸1 高速JOG
;----- 軸1:位置決め起動 -----
LD> EM32803 #0           ; 軸1起動Po.No
AND< EM32803 #16         ; 軸1起動Po.No
MEP
ANB R10000               ; 軸1 位置決め制御開始
OR R10000                ; 軸1 位置決め制御開始
ANB R10800               ; 軸1 位置決め制御開始完了
ANB MR50114              ; 軸1減速停止
ANB MR51113              ; 軸1ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51115              ; 軸1ｴﾗｰ検出
@U_WRPOR #2 #1 #100
MPS
@LDA EM32803             ; 軸1起動Po.No
CON
@SUB #1
CON
@MUL #512
CON
@ADD #18012
CON
@STA EM32806             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
MRD
@LDA EM32803             ; 軸1起動Po.No
CON
@SUB #1
CON
@MUL #10
CON
@STA Z8
MRD
@LDA EM32806             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #4
CON
@STA EM32807             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32807 EM30002:Z8 #1;軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸1 Po.1移動量
MRD
@LDA EM32806             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #16
CON
@STA EM32807             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32807 EM30000:Z8 #1;軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸1 Po.1速度
MRD
@LDA EM32806             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #18
CON
@STA EM32807             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32807 EM30004:Z8 #1;軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸1 Po.1加速度
MRD
@LDA EM32806             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #20
CON
@STA EM32807             ; 軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32807 EM30006:Z8 #1;軸1ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸1 Po.1減速度
MRD
@U_WRPPNT #2 #1 EM32803  ; 軸1起動Po.No
MRD
LD MR50009               ; 軸1ﾎﾟｲﾝﾄ09移動指令
OR MR50010               ; 軸1ﾎﾟｲﾝﾄ10移動指令
OR MR50011               ; 軸1ﾎﾟｲﾝﾄ11移動指令
OR MR50012               ; 軸1ﾎﾟｲﾝﾄ12移動指令
ANL
MPS
@LDA EM32803             ; 軸1起動Po.No
CON
@SUB #1
CON
@MUL #512
CON
@ADD #18076
CON
@STA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
MRD
@LDA EM32803             ; 軸1起動Po.No
CON
@SUB #1
CON
@MUL #10
CON
@STA Z8
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #4
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30402:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1移動量
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #16
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30400:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1速度
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #18
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30404:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1加速度
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #20
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MPP
@UWRIT.L #2 EM32827 EM30406:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1減速度
MPP
OUT R10000               ; 軸1 位置決め制御開始
;----- 軸1:原点復帰起動 -----
LD= EM32803 #99          ; 軸1起動Po.No
ANB R14012               ; 軸1 原点復帰要求
OR R14012                ; 軸1 原点復帰要求
ANB R14412               ; 軸1 原点復帰完了
ANB MR50114              ; 軸1減速停止
ANB MR51113              ; 軸1ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51115              ; 軸1ｴﾗｰ検出
@U_WRPOR #2 #1 #100
@UWRIT.D #2 #14180 EM32400 #1;軸1原点復帰速度
OUT R14012               ; 軸1 原点復帰要求
;----- 軸1:ｻｰﾎﾞ0N/ｻｰﾎﾞﾚﾃﾞｨｰ -----
LD MR50107               ; 軸1ｻｰﾎﾞON
OUT R14113               ; 軸1 ｻｰﾎﾞON
LD R14513                ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
OUT MR51107              ; 軸1ｻｰﾎﾞﾚﾃﾞｨｰ
;----- 軸1:ﾜｰﾆﾝｸﾞ/ｴﾗｰﾘｾｯﾄ -----
LD MR50115               ; 軸1ｴﾗｰﾘｾｯﾄ
MPS
LD MR51114               ; 軸1ﾜｰﾆﾝｸﾞ検出
OR MR51115               ; 軸1ｴﾗｰ検出
ANL
OUT R14000               ; 軸1 軸ｴﾗｰｸﾘｱ
MPP
AND MR51113              ; 軸1ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT R14305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
;----- 軸1:ﾜｰﾆﾝｸﾞ/ｴﾗｰ -----
LD R55000                ; 即停止/TRAP無
MPS
AND R14401               ; 軸1 軸ﾜｰﾆﾝｸﾞ中
OUT MR51114              ; 軸1ﾜｰﾆﾝｸﾞ検出
MRD
LD R14400                ; 軸1 軸ｴﾗｰ中
OR MR51102               ; 軸1運転開始異常完了
OR MR51104               ; 軸1原点復帰要求異常完了
ANL
OUT MR51115              ; 軸1ｴﾗｰ検出
MPP
AND R14705               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT MR51113              ; 軸1ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
;----- 軸1:減速停止 -----
LD MR50114               ; 軸1減速停止
OUT R14002               ; 軸1 減速停止
;----- 軸1:位置決め完了 -----
LD R10802                ; 軸1 位置決め完了
OUT MR51111              ; 軸1位置決め完了
;----- 軸1:原点復帰完了/記憶 -----
LD= EM32804 #99          ; 軸1起動Po.No退避
MPS
AND R14412               ; 軸1 原点復帰完了
OUT MR51108              ; 軸1原点復帰完了
MPP
ANP R14412               ; 軸1 原点復帰完了
SET MR51109              ; 軸1原点復帰完了記憶
LDP R51100               ; 原点復帰完了
OR MR12000               ; 転写ﾍｯﾄﾞ_原点復帰完了
SET MR51109              ; 軸1原点復帰完了記憶
;----- 軸1:BUSY -----
LD R10000                ; 軸1 位置決め制御開始
OR R14012                ; 軸1 原点復帰要求
OR R14404                ; 軸1 軸制御中
OUT MR51110              ; 軸1BUSY
;----- 軸1:起動Po.退避 -----
LD R14100                ; 軸1 JOG正方向
ANP R14404               ; 軸1 軸制御中
MOV #198 EM32804         ; 軸1起動Po.No退避
LD R14101                ; 軸1 JOG負方向
ANP R14404               ; 軸1 軸制御中
MOV #199 EM32804         ; 軸1起動Po.No退避
LDP R10000               ; 軸1 位置決め制御開始
LD CR2003                ; 常時OFF
ANP R14012               ; 軸1 原点復帰要求
ORL
MOV EM32803 EM32804      ; 軸1起動Po.No  軸1起動Po.No退避
MOV #0 EM32803           ; 軸1起動Po.No
;----- 軸1:Po.移動完了 -----
LDB MR51111              ; 軸1位置決め完了
MOV #0 MR51000           ; 軸1位置決め完了
LD> EM32804 #0           ; 軸1起動Po.No退避
AND< EM32804 #16         ; 軸1起動Po.No退避
ANP MR51111              ; 軸1位置決め完了
LDA EM32804              ; 軸1起動Po.No退避
CON
DECO MR51000 #4          ; 軸1位置決め完了
MCR
;----- 軸1:ﾌﾗｸﾞ/記憶ｸﾘｱ -----
LDB R55000               ; 即停止/TRAP無
ORF R51100               ; 原点復帰完了
LD CR2003                ; 常時OFF
LDP R14012               ; 軸1 原点復帰要求
OR MR51115               ; 軸1ｴﾗｰ検出
ANL
ORL
OR MR51113               ; 軸1ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR CR2008                ; 運転開始時1ｽｷｬﾝON
RES MR51109              ; 軸1原点復帰完了記憶
;----- 軸1:位置決め制御開始完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R10800               ; 軸1 位置決め制御開始完了
MPS
UREAD #2 #440 EM32607 #1 ; 軸1運転開始完了ｺｰﾄﾞ
MPP
ANB R51101               ; 原点復帰中
MPS
AND= EM32607 #0          ; 軸1運転開始完了ｺｰﾄﾞ
SET MR51101              ; 軸1運転開始正常完了
MPP
AND<> EM32607 #0         ; 軸1運転開始完了ｺｰﾄﾞ
SET MR51102              ; 軸1運転開始異常完了
LDP R10000               ; 軸1 位置決め制御開始
RES MR51101              ; 軸1運転開始正常完了
LD MR51102               ; 軸1運転開始異常完了
AND MR50115              ; 軸1ｴﾗｰﾘｾｯﾄ
RES MR51102              ; 軸1運転開始異常完了
;----- 軸1:原点復帰要求完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R14412               ; 軸1 原点復帰完了
UREAD #2 #452 EM32608 #1 ; 軸1原点復帰要求完了ｺｰﾄﾞ
MPS
AND= EM32608 #0          ; 軸1原点復帰要求完了ｺｰﾄﾞ
SET MR51103              ; 軸1原点復帰要求正常完了
MPP
AND<> EM32608 #0         ; 軸1原点復帰要求完了ｺｰﾄﾞ
SET MR51104              ; 軸1原点復帰要求異常完了
LDP R14012               ; 軸1 原点復帰要求
RES MR51103              ; 軸1原点復帰要求正常完了
LD MR51104               ; 軸1原点復帰要求異常完了
AND MR50115              ; 軸1ｴﾗｰﾘｾｯﾄ
RES MR51104              ; 軸1原点復帰要求異常完了
;----- 軸1:ﾓﾆﾀ -----
BLD DM11288 #0           ; 軸1 入力状態1
OUT MR52000              ; 軸1CWﾘﾐｯﾄ信号
BLD DM11288 #1           ; 軸1 入力状態1
OUT MR52001              ; 軸1CCWﾘﾐｯﾄ信号
BLD DM11288 #7           ; 軸1 入力状態1
OUT MR52002              ; 軸1ｻｰﾎﾞﾚﾃﾞｨｰ
BLD DM11288 #6           ; 軸1 入力状態1
OUT MR52003              ; 軸1ｻｰﾎﾞｴﾝﾄﾞ
BLD DM11288 #3           ; 軸1 入力状態1
OUT MR52004              ; 軸1停止ｾﾝｻ信号
BLD DM11288 #5           ; 軸1 入力状態1
OUT MR52005              ; 軸1零点信号(Z相)
BLD DM11288 #2           ; 軸1 入力状態1
OUT MR52006              ; 軸1原点ｾﾝｻ信号
LD CR2002                ; 常時ON
MOV.L DM11290 EM32600    ; 軸1 現在座標  軸1現在位置
MOV.D DM11298 EM32602    ; 軸1 現在速度  軸1現在速度
MOV.D #0 EM32605         ; 軸1ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPS
AND MR51114              ; 軸1ﾜｰﾆﾝｸﾞ検出
MOV DM11283 EM32605      ; 軸1 軸ﾜｰﾆﾝｸﾞｺｰﾄﾞ  軸1ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPP
AND MR51115              ; 軸1ｴﾗｰ検出
MOV DM11282 EM32606      ; 軸1 軸ｴﾗｰｺｰﾄﾞ  軸1ｴﾗｰｺｰﾄﾞ
;===== 軸2:動作制御 =====
;----- 軸2:起動Po.ｴﾝｺｰﾄﾞ -----
LD CR2002                ; 常時ON
LDA MR50200              ; 軸2ﾎﾟｲﾝﾄ移動指令
CON
BCNT
CON
STA EM32810              ; 軸2起動BITﾁｪｯｸ
LDB MR50314              ; 軸2減速停止
ANB MR51310              ; 軸2BUSY
ANB MR51313              ; 軸2ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51315              ; 軸2ｴﾗｰ検出
AND T2471                ; 軸2ｲﾝﾀｰﾊﾞﾙ
MPS
LD= EM32810 #1           ; 軸2起動BITﾁｪｯｸ
ANB MR50308              ; 軸2原点復帰指令
ANL
ENCO MR50200 #16         ; 軸2ﾎﾟｲﾝﾄ移動指令
CON
STA EM32813              ; 軸2起動Po.No
MPP
LD= EM32810 #0           ; 軸2起動BITﾁｪｯｸ
AND MR50308              ; 軸2原点復帰指令
ANL
MOV #99 EM32813          ; 軸2起動Po.No
LD= MR50200 #0           ; 軸2ﾎﾟｲﾝﾄ移動指令
AND= EM32810 #0          ; 軸2起動BITﾁｪｯｸ
ANB MR50308              ; 軸2原点復帰指令
ANB MR51310              ; 軸2BUSY
ORB R55000               ; 即停止/TRAP無
OR MR50314               ; 軸2減速停止
OR MR51313               ; 軸2ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR MR51315               ; 軸2ｴﾗｰ検出
OR CR2008                ; 運転開始時1ｽｷｬﾝON
MOV #0 EM32813           ; 軸2起動Po.No
;----- 軸2:起動ｲﾝﾀｰﾊﾞﾙ -----
LD R55000                ; 即停止/TRAP無
ANB MR51310              ; 軸2BUSY
AND= EM32810 #0          ; 軸2起動BITﾁｪｯｸ
ANB MR50308              ; 軸2原点復帰指令
TMH #2471 #5             ; 軸2ｲﾝﾀｰﾊﾞﾙ
;----- 軸2:ﾏｽﾀｰｺﾝﾄﾛｰﾙ -----
LD MR53500               ; ﾕﾆｯﾄ01 動作可能
AND R55000               ; 即停止/TRAP無
MC
;----- 軸2:JOG -----
LD MR53009               ; ﾕﾆｯﾄ01 軸2 有り
MPS
AND CR2003               ; 常時OFF
UWRIT.D #2 #14212 EM32416 #1;軸2JOG加減速度
UWRIT.D #2 #14214 EM32416 #1;軸2JOG加減速度
UWRIT.D #2 #14216 EM32412 #1;軸2JOG速度Lo(起動速度)
UWRIT.D #2 #14218 EM32414 #1;軸2JOG速度Hi
MRD
AND MR50312              ; 軸2+JOG
OUT R14900               ; 軸2 JOG正方向
MRD
AND MR50313              ; 軸2-JOG
OUT R14901               ; 軸2 JOG負方向
MPP
AND MR50311              ; 軸2JOG速度切替 Hi
OUT R14902               ; 軸2 高速JOG
;----- 軸2:位置決め起動 -----
LD> EM32813 #0           ; 軸2起動Po.No
AND< EM32813 #16         ; 軸2起動Po.No
MEP
ANB R10008               ; 軸2 位置決め制御開始
OR R10008                ; 軸2 位置決め制御開始
ANB R10808               ; 軸2 位置決め制御開始完了
ANB MR50314              ; 軸2減速停止
ANB MR51313              ; 軸2ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51315              ; 軸2ｴﾗｰ検出
MPS
@LDA EM32813             ; 軸2起動Po.No
CON
@SUB #1
CON
@MUL #512
CON
@ADD #18044
CON
@STA EM32816             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
MRD
@LDA EM32813             ; 軸2起動Po.No
CON
@SUB #1
CON
@MUL #10
CON
@STA Z8
MRD
@LDA EM32816             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #4
CON
@STA EM32817             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32817 EM30202:Z8 #1;軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸2 Po.1移動量
MRD
@LDA EM32816             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #16
CON
@STA EM32817             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32817 EM30200:Z8 #1;軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸2 Po.1速度
MRD
@LDA EM32816             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #18
CON
@STA EM32817             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32817 EM30204:Z8 #1;軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸2 Po.1加速度
MRD
@LDA EM32816             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #20
CON
@STA EM32817             ; 軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32817 EM30206:Z8 #1;軸2ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸2 Po.1減速度
MRD
@U_WRPPNT #2 #2 EM32813  ; 軸2起動Po.No
MRD
AND MR50213              ; 軸2ﾎﾟｲﾝﾄ13移動指令
MPS
@LDA EM32813             ; 軸2起動Po.No
CON
@SUB #1
CON
@MUL #512
CON
@ADD #18076
CON
@STA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
MRD
@LDA EM32813             ; 軸2起動Po.No
CON
@SUB #1
CON
@MUL #10
CON
@STA Z8
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #4
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30402:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1移動量
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #16
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30400:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1速度
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #18
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30404:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1加速度
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #20
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MPP
@UWRIT.L #2 EM32827 EM30406:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1減速度
MPP
OUT R10008               ; 軸2 位置決め制御開始
;----- 軸2:原点復帰起動 -----
LD= EM32813 #99          ; 軸2起動Po.No
ANB R14812               ; 軸2 原点復帰要求
OR R14812                ; 軸2 原点復帰要求
ANB R15212               ; 軸2 原点復帰完了
ANB MR50314              ; 軸2減速停止
ANB MR51313              ; 軸2ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51315              ; 軸2ｴﾗｰ検出
@UWRIT.D #2 #14230 EM32410 #1;軸2原点復帰速度
OUT R14812               ; 軸2 原点復帰要求
;----- 軸2:ｻｰﾎﾞ0N/ｻｰﾎﾞﾚﾃﾞｨｰ -----
LD MR50307               ; 軸2ｻｰﾎﾞON
OUT R14913               ; 軸2 ｻｰﾎﾞON
LD R15313                ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
OUT MR51307              ; 軸2ｻｰﾎﾞﾚﾃﾞｨｰ
;----- 軸2:ﾜｰﾆﾝｸﾞ/ｴﾗｰﾘｾｯﾄ -----
LD MR50315               ; 軸2ｴﾗｰﾘｾｯﾄ
MPS
LD MR51314               ; 軸2ﾜｰﾆﾝｸﾞ検出
OR MR51315               ; 軸2ｴﾗｰ検出
ANL
OUT R14800               ; 軸2 軸ｴﾗｰｸﾘｱ
MPP
AND MR51313              ; 軸2ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT R15105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
;----- 軸2:ﾜｰﾆﾝｸﾞ/ｴﾗｰ -----
LD R55000                ; 即停止/TRAP無
MPS
AND R15201               ; 軸2 軸ﾜｰﾆﾝｸﾞ中
OUT MR51314              ; 軸2ﾜｰﾆﾝｸﾞ検出
MRD
LD R15200                ; 軸2 軸ｴﾗｰ中
OR MR51302               ; 軸2運転開始異常完了
OR MR51304               ; 軸2原点復帰要求異常完了
ANL
OUT MR51315              ; 軸2ｴﾗｰ検出
MPP
AND R15505               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT MR51313              ; 軸2ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
;----- 軸2:減速停止 -----
LD MR50314               ; 軸2減速停止
OUT R14802               ; 軸2 減速停止
;----- 軸2:位置決め完了 -----
LD R10810                ; 軸2 位置決め完了
OUT MR51311              ; 軸2位置決め完了
;----- 軸2:原点復帰完了/記憶 -----
LD= EM32814 #99          ; 軸2起動Po.No退避
MPS
AND R15212               ; 軸2 原点復帰完了
OUT MR51308              ; 軸2原点復帰完了
MPP
ANP R15212               ; 軸2 原点復帰完了
SET MR51309              ; 軸2原点復帰完了記憶
LDP R51100               ; 原点復帰完了
OR MR12100               ; ﾌｨﾙﾑ送り_原点復帰完了
SET MR51309              ; 軸2原点復帰完了記憶
;----- 軸2:BUSY -----
LD R10008                ; 軸2 位置決め制御開始
OR R14812                ; 軸2 原点復帰要求
OR R15204                ; 軸2 軸制御中
OUT MR51310              ; 軸2BUSY
;----- 軸2:起動Po.退避 -----
LD R14900                ; 軸2 JOG正方向
ANP R15204               ; 軸2 軸制御中
MOV #198 EM32814         ; 軸2起動Po.No退避
LD R14901                ; 軸2 JOG負方向
ANP R15204               ; 軸2 軸制御中
MOV #199 EM32814         ; 軸2起動Po.No退避
LDP R10008               ; 軸2 位置決め制御開始
LD CR2003                ; 常時OFF
ANP R14812               ; 軸2 原点復帰要求
ORL
MOV EM32813 EM32814      ; 軸2起動Po.No  軸2起動Po.No退避
MOV #0 EM32813           ; 軸2起動Po.No
;----- 軸2:Po.移動完了 -----
LDB MR51311              ; 軸2位置決め完了
MOV #0 MR51200           ; 軸2位置決め完了
LD> EM32814 #0           ; 軸2起動Po.No退避
AND< EM32814 #16         ; 軸2起動Po.No退避
ANP MR51311              ; 軸2位置決め完了
LDA EM32814              ; 軸2起動Po.No退避
CON
DECO MR51200 #4          ; 軸2位置決め完了
MCR
;----- 軸2:ﾌﾗｸﾞ/記憶ｸﾘｱ -----
LDB R55000               ; 即停止/TRAP無
ORF R51100               ; 原点復帰完了
LD CR2003                ; 常時OFF
LDP R14812               ; 軸2 原点復帰要求
OR MR51315               ; 軸2ｴﾗｰ検出
ANL
ORL
OR MR51313               ; 軸2ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR CR2008                ; 運転開始時1ｽｷｬﾝON
RES MR51309              ; 軸2原点復帰完了記憶
;----- 軸2:位置決め御開始完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R10808               ; 軸2 位置決め制御開始完了
MPS
UREAD #2 #480 EM32617 #1 ; 軸2運転開始完了ｺｰﾄﾞ
MPP
ANB R51101               ; 原点復帰中
MPS
AND= EM32617 #0          ; 軸2運転開始完了ｺｰﾄﾞ
SET MR51301              ; 軸2運転開始正常完了
MPP
AND<> EM32617 #0         ; 軸2運転開始完了ｺｰﾄﾞ
SET MR51302              ; 軸2運転開始異常完了
LDP R10008               ; 軸2 位置決め制御開始
RES MR51301              ; 軸2運転開始正常完了
LD MR51302               ; 軸2運転開始異常完了
AND MR50315              ; 軸2ｴﾗｰﾘｾｯﾄ
RES MR51302              ; 軸2運転開始異常完了
;----- 軸2:原点復帰要求完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R15212               ; 軸2 原点復帰完了
UREAD #2 #492 EM32618 #1 ; 軸2原点復帰要求完了ｺｰﾄﾞ
MPS
AND= EM32618 #0          ; 軸2原点復帰要求完了ｺｰﾄﾞ
SET MR51303              ; 軸2原点復帰要求正常完了
MPP
AND<> EM32618 #0         ; 軸2原点復帰要求完了ｺｰﾄﾞ
SET MR51304              ; 軸2原点復帰要求異常完了
LDP R14812               ; 軸2 原点復帰要求
RES MR51303              ; 軸2原点復帰要求正常完了
LD MR51304               ; 軸2原点復帰要求異常完了
AND MR50315              ; 軸2ｴﾗｰﾘｾｯﾄ
RES MR51304              ; 軸2原点復帰要求異常完了
;----- 軸2:ﾓﾆﾀ -----
BLD DM11348 #0           ; 軸2 入力状態1
OUT MR52100              ; 軸2CWﾘﾐｯﾄ信号
BLD DM11348 #1           ; 軸2 入力状態1
OUT MR52101              ; 軸2CCWﾘﾐｯﾄ信号
BLD DM11348 #7           ; 軸2 入力状態1
OUT MR52102              ; 軸2ｻｰﾎﾞﾚﾃﾞｨｰ
BLD DM11348 #6           ; 軸2 入力状態1
OUT MR52103              ; 軸2ｻｰﾎﾞｴﾝﾄﾞ
BLD DM11348 #3           ; 軸2 入力状態1
OUT MR52104              ; 軸2停止ｾﾝｻ信号
BLD DM11348 #5           ; 軸2 入力状態1
OUT MR52105              ; 軸2零点信号(Z相)
BLD DM11348 #2           ; 軸2 入力状態1
OUT MR52106              ; 軸2原点ｾﾝｻ信号
LD CR2002                ; 常時ON
MOV.L DM11350 EM32610    ; 軸2 現在座標  軸2現在位置
MOV.D DM11358 EM32612    ; 軸2 現在速度  軸2現在速度
MOV.D #0 EM32615         ; 軸2ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPS
AND MR51314              ; 軸2ﾜｰﾆﾝｸﾞ検出
MOV DM11343 EM32615      ; 軸2 軸ﾜｰﾆﾝｸﾞｺｰﾄﾞ  軸2ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPP
AND MR51315              ; 軸2ｴﾗｰ検出
MOV DM11342 EM32616      ; 軸2 軸ｴﾗｰｺｰﾄﾞ  軸2ｴﾗｰｺｰﾄﾞ
;===== 軸3:動作制御 =====
;----- 軸3:起動Po.ｴﾝｺｰﾄﾞ -----
LD CR2002                ; 常時ON
LDA MR50400              ; 軸3ﾎﾟｲﾝﾄ移動指令
CON
BCNT
CON
STA EM32820              ; 軸3起動BITﾁｪｯｸ
LDB MR50514              ; 軸3減速停止
ANB MR51510              ; 軸3BUSY
ANB MR51513              ; 軸3ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51515              ; 軸3ｴﾗｰ検出
AND T2472                ; 軸3ｲﾝﾀｰﾊﾞﾙ
MPS
LD= EM32820 #1           ; 軸3起動BITﾁｪｯｸ
ANB MR50508              ; 軸3原点復帰指令
ANL
ENCO MR50400 #16         ; 軸3ﾎﾟｲﾝﾄ移動指令
CON
STA EM32823              ; 軸3起動Po.No
MPP
LD= EM32820 #0           ; 軸3起動BITﾁｪｯｸ
AND MR50508              ; 軸3原点復帰指令
ANL
MOV #99 EM32823          ; 軸3起動Po.No
LD= MR50400 #0           ; 軸3ﾎﾟｲﾝﾄ移動指令
AND= EM32820 #0          ; 軸3起動BITﾁｪｯｸ
ANB MR50508              ; 軸3原点復帰指令
ANB MR51510              ; 軸3BUSY
ORB R55000               ; 即停止/TRAP無
OR MR50514               ; 軸3減速停止
OR MR51513               ; 軸3ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR MR51515               ; 軸3ｴﾗｰ検出
OR CR2008                ; 運転開始時1ｽｷｬﾝON
MOV #0 EM32823           ; 軸3起動Po.No
;----- 軸3:起動ｲﾝﾀｰﾊﾞﾙ -----
LD R55000                ; 即停止/TRAP無
ANB MR51510              ; 軸3BUSY
AND= EM32820 #0          ; 軸3起動BITﾁｪｯｸ
ANB MR50508              ; 軸3原点復帰指令
TMH #2472 #5             ; 軸3ｲﾝﾀｰﾊﾞﾙ
;----- 軸3:ﾏｽﾀｰｺﾝﾄﾛｰﾙ -----
LD MR53500               ; ﾕﾆｯﾄ01 動作可能
AND R55000               ; 即停止/TRAP無
MC
;----- 軸3:JOG -----
LD MR53010               ; ﾕﾆｯﾄ01 軸3 有り
MPS
AND CR2003               ; 常時OFF
UWRIT.D #2 #14262 EM32426 #1;軸3JOG加減速度
UWRIT.D #2 #14264 EM32426 #1;軸3JOG加減速度
UWRIT.D #2 #14266 EM32422 #1;軸3JOG速度Lo(起動速度)
UWRIT.D #2 #14268 EM32424 #1;軸3JOG速度Hi
MRD
AND MR50512              ; 軸3+JOG
OUT R15700               ; 軸3 JOG正方向
MRD
AND MR50513              ; 軸3-JOG
OUT R15701               ; 軸3 JOG負方向
MPP
AND MR50511              ; 軸3JOG速度切替 Hi
OUT R15702               ; 軸3 高速JOG
;----- 軸3:位置決め起動 -----
LD> EM32823 #0           ; 軸3起動Po.No
AND< EM32823 #16         ; 軸3起動Po.No
MEP
ANB R10100               ; 軸3 位置決め制御開始
OR R10100                ; 軸3 位置決め制御開始
ANB R10900               ; 軸3 位置決め制御開始完了
ANB MR50514              ; 軸3減速停止
ANB MR51513              ; 軸3ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51515              ; 軸3ｴﾗｰ検出
MPS
@LDA EM32823             ; 軸3起動Po.No
CON
@SUB #1
CON
@MUL #512
CON
@ADD #18076
CON
@STA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
MRD
@LDA EM32823             ; 軸3起動Po.No
CON
@SUB #1
CON
@MUL #10
CON
@STA Z8
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #4
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30402:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1移動量
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #16
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30400:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1速度
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #18
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30404:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1加速度
MRD
@LDA EM32826             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #20
CON
@STA EM32827             ; 軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32827 EM30406:Z8 #1;軸3ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸3 Po.1減速度
MRD
@U_WRPPNT #2 #3 EM32823  ; 軸3起動Po.No
MPP
OUT R10100               ; 軸3 位置決め制御開始
;----- 軸3:原点復帰起動 -----
LD= EM32823 #99          ; 軸3起動Po.No
ANB R15612               ; 軸3 原点復帰要求
OR R15612                ; 軸3 原点復帰要求
ANB R16012               ; 軸3 原点復帰完了
ANB MR50514              ; 軸3減速停止
ANB MR51513              ; 軸3ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51515              ; 軸3ｴﾗｰ検出
@UWRIT.D #2 #14280 EM32420 #1;軸3原点復帰速度
OUT R15612               ; 軸3 原点復帰要求
;----- 軸3:ｻｰﾎﾞ0N/ｻｰﾎﾞﾚﾃﾞｨｰ -----
LD MR50507               ; 軸3ｻｰﾎﾞON
OUT R15713               ; 軸3 ｻｰﾎﾞON
LD R16113                ; 軸3 ｻｰﾎﾞﾚﾃﾞｨ
OUT MR51507              ; 軸3ｻｰﾎﾞﾚﾃﾞｨｰ
;----- 軸3:ﾜｰﾆﾝｸﾞ/ｴﾗｰﾘｾｯﾄ -----
LD MR50515               ; 軸3ｴﾗｰﾘｾｯﾄ
MPS
LD MR51514               ; 軸3ﾜｰﾆﾝｸﾞ検出
OR MR51515               ; 軸3ｴﾗｰ検出
ANL
OUT R15600               ; 軸3 軸ｴﾗｰｸﾘｱ
MPP
AND MR51513              ; 軸3ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT R15905               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
;----- 軸3:ﾜｰﾆﾝｸﾞ/ｴﾗｰ -----
LD R55000                ; 即停止/TRAP無
MPS
AND R16001               ; 軸3 軸ﾜｰﾆﾝｸﾞ中
OUT MR51514              ; 軸3ﾜｰﾆﾝｸﾞ検出
MRD
LD R16000                ; 軸3 軸ｴﾗｰ中
OR MR51502               ; 軸3運転開始異常完了
OR MR51504               ; 軸3原点復帰要求異常完了
ANL
OUT MR51515              ; 軸3ｴﾗｰ検出
MPP
AND R16305               ; 軸3 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT MR51513              ; 軸3ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
;----- 軸3:減速停止 -----
LD MR50514               ; 軸3減速停止
OUT R15602               ; 軸3 減速停止
;----- 軸3:位置決め完了 -----
LD R10902                ; 軸3 位置決め完了
OUT MR51511              ; 軸3位置決め完了
;----- 軸3:原点復帰完了/記憶 -----
LD= EM32824 #99          ; 軸3起動Po.No退避
MPS
AND R16012               ; 軸3 原点復帰完了
OUT MR51508              ; 軸3原点復帰完了
MPP
ANP R16012               ; 軸3 原点復帰完了
SET MR51509              ; 軸3原点復帰完了記憶
LDP R51100               ; 原点復帰完了
OR MR12200               ; 主軸ﾛｰﾗ_原点復帰完了
SET MR51509              ; 軸3原点復帰完了記憶
;----- 軸3:BUSY -----
LD R10100                ; 軸3 位置決め制御開始
OR R15612                ; 軸3 原点復帰要求
OR R16004                ; 軸3 軸制御中
OUT MR51510              ; 軸3BUSY
;----- 軸3:起動Po.退避 -----
LD R15700                ; 軸3 JOG正方向
ANP R16004               ; 軸3 軸制御中
MOV #198 EM32824         ; 軸3起動Po.No退避
LD R15701                ; 軸3 JOG負方向
ANP R16004               ; 軸3 軸制御中
MOV #199 EM32824         ; 軸3起動Po.No退避
LDP R10100               ; 軸3 位置決め制御開始
LD CR2003                ; 常時OFF
ANP R15612               ; 軸3 原点復帰要求
ORL
MOV EM32823 EM32824      ; 軸3起動Po.No  軸3起動Po.No退避
MOV #0 EM32823           ; 軸3起動Po.No
;----- 軸3:Po.移動完了 -----
LDB MR51511              ; 軸3位置決め完了
MOV #0 MR51400           ; 軸3位置決め完了
LD> EM32824 #0           ; 軸3起動Po.No退避
AND< EM32824 #16         ; 軸3起動Po.No退避
ANP MR51511              ; 軸3位置決め完了
LDA EM32824              ; 軸3起動Po.No退避
CON
DECO MR51400 #4          ; 軸3位置決め完了
MCR
;----- 軸3:ﾌﾗｸﾞ/記憶ｸﾘｱ -----
LDB R55000               ; 即停止/TRAP無
ORF R51100               ; 原点復帰完了
LD CR2003                ; 常時OFF
LDP R15612               ; 軸3 原点復帰要求
OR MR51515               ; 軸3ｴﾗｰ検出
ANL
ORL
OR MR51513               ; 軸3ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR CR2008                ; 運転開始時1ｽｷｬﾝON
RES MR51509              ; 軸3原点復帰完了記憶
;----- 軸3:位置決め御開始完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R10900               ; 軸3 位置決め制御開始完了
MPS
UREAD #2 #520 EM32627 #1 ; 軸3運転開始完了ｺｰﾄﾞ
MPP
ANB R51101               ; 原点復帰中
MPS
AND= EM32627 #0          ; 軸3運転開始完了ｺｰﾄﾞ
SET MR51501              ; 軸3運転開始正常完了
MPP
AND<> EM32627 #0         ; 軸3運転開始完了ｺｰﾄﾞ
SET MR51502              ; 軸3運転開始異常完了
LDP R10100               ; 軸3 位置決め制御開始
RES MR51501              ; 軸3運転開始正常完了
LD MR51502               ; 軸3運転開始異常完了
AND MR50515              ; 軸3ｴﾗｰﾘｾｯﾄ
RES MR51502              ; 軸3運転開始異常完了
;----- 軸3:原点復帰要求完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R16012               ; 軸3 原点復帰完了
UREAD #2 #532 EM32628 #1 ; 軸3原点復帰要求完了ｺｰﾄﾞ
MPS
AND= EM32628 #0          ; 軸3原点復帰要求完了ｺｰﾄﾞ
SET MR51503              ; 軸3原点復帰要求正常完了
MPP
AND<> EM32628 #0         ; 軸3原点復帰要求完了ｺｰﾄﾞ
SET MR51504              ; 軸3原点復帰要求異常完了
LDP R15612               ; 軸3 原点復帰要求
RES MR51503              ; 軸3原点復帰要求正常完了
LD MR51504               ; 軸3原点復帰要求異常完了
AND MR50515              ; 軸3ｴﾗｰﾘｾｯﾄ
RES MR51504              ; 軸3原点復帰要求異常完了
;----- 軸3:ﾓﾆﾀ -----
BLD DM11408 #0           ; 軸3 入力状態1
OUT MR52200              ; 軸3CWﾘﾐｯﾄ信号
BLD DM11408 #1           ; 軸3 入力状態1
OUT MR52201              ; 軸3CCWﾘﾐｯﾄ信号
BLD DM11408 #7           ; 軸3 入力状態1
OUT MR52202              ; 軸3ｻｰﾎﾞﾚﾃﾞｨｰ
BLD DM11408 #6           ; 軸3 入力状態1
OUT MR52203              ; 軸3ｻｰﾎﾞｴﾝﾄﾞ
BLD DM11408 #3           ; 軸3 入力状態1
OUT MR52204              ; 軸3停止ｾﾝｻ信号
BLD DM11408 #5           ; 軸3 入力状態1
OUT MR52205              ; 軸3零点信号(Z相)
BLD DM11408 #2           ; 軸3 入力状態1
OUT MR52206              ; 軸3原点ｾﾝｻ信号
LD CR2002                ; 常時ON
MOV.L DM11410 EM32620    ; 軸3 現在座標  軸3現在位置
MOV.D DM11418 EM32622    ; 軸3 現在速度  軸3現在速度
MOV.D #0 EM32625         ; 軸3ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPS
AND MR51514              ; 軸3ﾜｰﾆﾝｸﾞ検出
MOV DM11403 EM32625      ; 軸3 軸ﾜｰﾆﾝｸﾞｺｰﾄﾞ  軸3ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPP
AND MR51515              ; 軸3ｴﾗｰ検出
MOV DM11402 EM32626      ; 軸3 軸ｴﾗｰｺｰﾄﾞ  軸3ｴﾗｰｺｰﾄﾞ
;===== 軸4:動作制御 =====
;----- 軸4:起動Po.ｴﾝｺｰﾄﾞ -----
LD CR2002                ; 常時ON
LDA MR50600              ; 軸4ﾎﾟｲﾝﾄ移動指令
CON
BCNT
CON
STA EM32830              ; 軸4起動BITﾁｪｯｸ
LDB MR50714              ; 軸4減速停止
ANB MR51710              ; 軸4BUSY
ANB MR51713              ; 軸4ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51715              ; 軸4ｴﾗｰ検出
AND T2473                ; 軸4ｲﾝﾀｰﾊﾞﾙ
MPS
LD= EM32830 #1           ; 軸4起動BITﾁｪｯｸ
ANB MR50708              ; 軸4原点復帰指令
ANL
ENCO MR50600 #16         ; 軸4ﾎﾟｲﾝﾄ移動指令
CON
STA EM32833              ; 軸4起動Po.No
MPP
LD= EM32830 #0           ; 軸4起動BITﾁｪｯｸ
AND MR50708              ; 軸4原点復帰指令
ANL
MOV #99 EM32833          ; 軸4起動Po.No
LD= MR50600 #0           ; 軸4ﾎﾟｲﾝﾄ移動指令
AND= EM32830 #0          ; 軸4起動BITﾁｪｯｸ
ANB MR50708              ; 軸4原点復帰指令
ANB MR51710              ; 軸4BUSY
ORB R55000               ; 即停止/TRAP無
OR MR50714               ; 軸4減速停止
OR MR51713               ; 軸4ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR MR51715               ; 軸4ｴﾗｰ検出
OR CR2008                ; 運転開始時1ｽｷｬﾝON
MOV #0 EM32833           ; 軸4起動Po.No
;----- 軸4:起動ｲﾝﾀｰﾊﾞﾙ -----
LD R55000                ; 即停止/TRAP無
ANB MR51710              ; 軸4BUSY
AND= EM32830 #0          ; 軸4起動BITﾁｪｯｸ
ANB MR50708              ; 軸4原点復帰指令
TMH #2473 #5             ; 軸4ｲﾝﾀｰﾊﾞﾙ
;----- 軸4:ﾏｽﾀｰｺﾝﾄﾛｰﾙ -----
LD MR53500               ; ﾕﾆｯﾄ01 動作可能
AND R55000               ; 即停止/TRAP無
MC
;----- 軸4:JOG -----
LD MR53011               ; ﾕﾆｯﾄ01 軸4 有り
MPS
AND CR2003               ; 常時OFF
UWRIT.D #2 #14312 EM32436 #1;軸4JOG加減速度
UWRIT.D #2 #14314 EM32436 #1;軸4JOG加減速度
UWRIT.D #2 #14316 EM32432 #1;軸4JOG速度Lo(起動速度)
UWRIT.D #2 #14318 EM32434 #1;軸4JOG速度Hi
MRD
AND MR50712              ; 軸4+JOG
OUT R16500               ; 軸4 JOG正方向
MRD
AND MR50713              ; 軸4-JOG
OUT R16501               ; 軸4 JOG負方向
MPP
AND MR50711              ; 軸4JOG速度切替 Hi
OUT R16502               ; 軸4 高速JOG
;----- 軸4:位置決め起動 -----
LD> EM32833 #0           ; 軸4起動Po.No
AND< EM32833 #16         ; 軸4起動Po.No
MEP
ANB R10108               ; 軸4 位置決め制御開始
OR R10108                ; 軸4 位置決め制御開始
ANB R10908               ; 軸4 位置決め制御開始完了
ANB MR50714              ; 軸4減速停止
ANB MR51713              ; 軸4ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51715              ; 軸4ｴﾗｰ検出
MPS
@LDA EM32833             ; 軸4起動Po.No
CON
@SUB #1
CON
@MUL #512
CON
@ADD #18108
CON
@STA EM32836             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
MRD
@LDA EM32833             ; 軸4起動Po.No
CON
@SUB #1
CON
@MUL #10
CON
@STA Z8
MRD
@LDA EM32836             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #4
CON
@STA EM32837             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32837 EM30602:Z8 #1;軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸4 Po.1移動量
MRD
@LDA EM32836             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #16
CON
@STA EM32837             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32837 EM30600:Z8 #1;軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸4 Po.1速度
MRD
@LDA EM32836             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #18
CON
@STA EM32837             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32837 EM30604:Z8 #1;軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸4 Po.1加速度
MRD
@LDA EM32836             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ
CON
@ADD #20
CON
@STA EM32837             ; 軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出
MRD
@UWRIT.L #2 EM32837 EM30606:Z8 #1;軸4ﾎﾟｲﾝﾄﾊﾟﾗﾒｰﾀｱﾄﾞﾚｽ算出  軸4 Po.1減速度
MRD
@U_WRPPNT #2 #4 EM32833  ; 軸4起動Po.No
MPP
OUT R10108               ; 軸4 位置決め制御開始
;----- 軸4:原点復帰起動 -----
LD= EM32833 #99          ; 軸4起動Po.No
ANB R16412               ; 軸4 原点復帰要求
OR R16412                ; 軸4 原点復帰要求
ANB R16812               ; 軸4 原点復帰完了
ANB MR50714              ; 軸4減速停止
ANB MR51713              ; 軸4ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
ANB MR51715              ; 軸4ｴﾗｰ検出
@UWRIT.D #2 #14330 EM32430 #1;軸4原点復帰速度
OUT R16412               ; 軸4 原点復帰要求
;----- 軸4:ｻｰﾎﾞ0N/ｻｰﾎﾞﾚﾃﾞｨｰ -----
LD MR50707               ; 軸4ｻｰﾎﾞON
OUT R16513               ; 軸4 ｻｰﾎﾞON
LD R16913                ; 軸4 ｻｰﾎﾞﾚﾃﾞｨ
OUT MR51707              ; 軸4ｻｰﾎﾞﾚﾃﾞｨｰ
;----- 軸4:ﾜｰﾆﾝｸﾞ/ｴﾗｰﾘｾｯﾄ -----
LD MR50715               ; 軸4ｴﾗｰﾘｾｯﾄ
MPS
LD MR51714               ; 軸4ﾜｰﾆﾝｸﾞ検出
OR MR51715               ; 軸4ｴﾗｰ検出
ANL
OUT R16400               ; 軸4 軸ｴﾗｰｸﾘｱ
MPP
AND MR51713              ; 軸4ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT R16705               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
;----- 軸4:ﾜｰﾆﾝｸﾞ/ｴﾗｰ -----
LD R55000                ; 即停止/TRAP無
MPS
AND R16801               ; 軸4 軸ﾜｰﾆﾝｸﾞ中
OUT MR51714              ; 軸4ﾜｰﾆﾝｸﾞ検出
MRD
LD R16800                ; 軸4 軸ｴﾗｰ中
OR MR51702               ; 軸4運転開始異常完了
OR MR51704               ; 軸4原点復帰要求異常完了
ANL
OUT MR51715              ; 軸4ｴﾗｰ検出
MPP
AND R17105               ; 軸4 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OUT MR51713              ; 軸4ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
;----- 軸4:減速停止 -----
LD MR50714               ; 軸4減速停止
OUT R16402               ; 軸4 減速停止
;----- 軸4:位置決め完了 -----
LD R10910                ; 軸4 位置決め完了
OUT MR51711              ; 軸4位置決め完了
;----- 軸4:原点復帰完了/記憶 -----
LD= EM32834 #99          ; 軸4起動Po.No退避
MPS
AND R16812               ; 軸4 原点復帰完了
OUT MR51708              ; 軸4原点復帰完了
MPP
ANP R16812               ; 軸4 原点復帰完了
SET MR51709              ; 軸4原点復帰完了記憶
LDP R51100               ; 原点復帰完了
OR MR12300               ; ｽｸﾚｰﾊﾟ_原点復帰完了
SET MR51709              ; 軸4原点復帰完了記憶
;----- 軸4:BUSY -----
LD R10108                ; 軸4 位置決め制御開始
OR R16412                ; 軸4 原点復帰要求
OR R16804                ; 軸4 軸制御中
OUT MR51710              ; 軸4BUSY
;----- 軸4:起動Po.退避 -----
LD R16500                ; 軸4 JOG正方向
ANP R16804               ; 軸4 軸制御中
MOV #198 EM32834         ; 軸4起動Po.No退避
LD R16501                ; 軸4 JOG負方向
ANP R16804               ; 軸4 軸制御中
MOV #199 EM32834         ; 軸4起動Po.No退避
LDP R10108               ; 軸4 位置決め制御開始
LD CR2003                ; 常時OFF
ANP R16412               ; 軸4 原点復帰要求
ORL
MOV EM32833 EM32834      ; 軸4起動Po.No  軸4起動Po.No退避
MOV #0 EM32833           ; 軸4起動Po.No
;----- 軸4:Po.移動完了 -----
LDB MR51711              ; 軸4位置決め完了
MOV #0 MR51600           ; 軸4位置決め完了
LD> EM32834 #0           ; 軸4起動Po.No退避
AND< EM32834 #16         ; 軸4起動Po.No退避
ANP MR51711              ; 軸4位置決め完了
LDA EM32834              ; 軸4起動Po.No退避
CON
DECO MR51600 #4          ; 軸4位置決め完了
MCR
;----- 軸4:ﾌﾗｸﾞ/記憶ｸﾘｱ -----
LDB R55000               ; 即停止/TRAP無
ORF R51100               ; 原点復帰完了
LD CR2003                ; 常時OFF
LDP R16412               ; 軸4 原点復帰要求
OR MR51715               ; 軸4ｴﾗｰ検出
ANL
ORL
OR MR51713               ; 軸4ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
OR CR2008                ; 運転開始時1ｽｷｬﾝON
RES MR51709              ; 軸4原点復帰完了記憶
;----- 軸4:位置決め御開始完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R10908               ; 軸4 位置決め制御開始完了
MPS
UREAD #2 #560 EM32637 #1 ; 軸4運転開始完了ｺｰﾄﾞ
MPP
ANB R51101               ; 原点復帰中
MPS
AND= EM32637 #0          ; 軸4運転開始完了ｺｰﾄﾞ
SET MR51701              ; 軸4運転開始正常完了
MPP
AND<> EM32637 #0         ; 軸4運転開始完了ｺｰﾄﾞ
SET MR51702              ; 軸4運転開始異常完了
LDP R10108               ; 軸4 位置決め制御開始
RES MR51701              ; 軸4運転開始正常完了
LD MR51702               ; 軸4運転開始異常完了
AND MR50715              ; 軸4ｴﾗｰﾘｾｯﾄ
RES MR51702              ; 軸4運転開始異常完了
;----- 軸4:原点復帰要求完了ｺｰﾄﾞﾁｪｯｸ -----
LDP R16812               ; 軸4 原点復帰完了
UREAD #2 #572 EM32638 #1 ; 軸4原点復帰要求完了ｺｰﾄﾞ
MPS
AND= EM32638 #0          ; 軸4原点復帰要求完了ｺｰﾄﾞ
SET MR51703              ; 軸4原点復帰要求正常完了
MPP
AND<> EM32638 #0         ; 軸4原点復帰要求完了ｺｰﾄﾞ
SET MR51704              ; 軸4原点復帰要求異常完了
LDP R16412               ; 軸4 原点復帰要求
RES MR51703              ; 軸4原点復帰要求正常完了
LD MR51704               ; 軸4原点復帰要求異常完了
AND MR50715              ; 軸4ｴﾗｰﾘｾｯﾄ
RES MR51704              ; 軸4原点復帰要求異常完了
;----- 軸4:ﾓﾆﾀ -----
BLD DM11468 #0           ; 軸4 入力状態1
OUT MR52300              ; 軸4CWﾘﾐｯﾄ信号
BLD DM11468 #1           ; 軸4 入力状態1
OUT MR52301              ; 軸4CCWﾘﾐｯﾄ信号
BLD DM11468 #7           ; 軸4 入力状態1
OUT MR52302              ; 軸4ｻｰﾎﾞﾚﾃﾞｨｰ
BLD DM11468 #6           ; 軸4 入力状態1
OUT MR52303              ; 軸4ｻｰﾎﾞｴﾝﾄﾞ
BLD DM11468 #3           ; 軸4 入力状態1
OUT MR52304              ; 軸4停止ｾﾝｻ信号
BLD DM11468 #5           ; 軸4 入力状態1
OUT MR52305              ; 軸4零点信号(Z相)
BLD DM11468 #2           ; 軸4 入力状態1
OUT MR52306              ; 軸4原点ｾﾝｻ信号
LD CR2002                ; 常時ON
MOV.L DM11470 EM32630    ; 軸4 現在座標  軸4現在位置
MOV.D DM11478 EM32632    ; 軸4 現在速度  軸4現在速度
MOV.D #0 EM32635         ; 軸4ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPS
AND MR51714              ; 軸4ﾜｰﾆﾝｸﾞ検出
MOV DM11463 EM32635      ; 軸4 軸ﾜｰﾆﾝｸﾞｺｰﾄﾞ  軸4ﾜｰﾆﾝｸﾞｺｰﾄﾞ
MPP
AND MR51715              ; 軸4ｴﾗｰ検出
MOV DM11462 EM32636      ; 軸4 軸ｴﾗｰｺｰﾄﾞ  軸4ｴﾗｰｺｰﾄﾞ
END
ENDH
