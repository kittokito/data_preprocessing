DEVICE:52
;MODULE:Master
;MODULE_TYPE:0
LD R50000                ; 即停止
OR R50900                ; TRAP
OR R50914                ; HOME_ON_PLS
ZRES @MR000 @MR1915      ; 起動START_SW_ON
;***** ﾌﾗｸﾞ管理 ******
LDB R50000               ; 即停止
ANB R50900               ; TRAP
OUT R55000               ; 即停止/TRAP無
;***** CPU起動時ﾓｼﾞｭｰﾙ起動 ******
LD CR2002                ; 常時ON
AND CR2007               ; 運転開始時1ｽｷｬﾝOFF
AND R55000               ; 即停止/TRAP無
ANB R49915               ; 表示用　　 TRAP
TMR #120 #10             ; 動作中遅延
MDSTRT WF_Trans
MPS
@RES LR200               ; 自動ﾓｰﾄﾞ選択
CON
@RES LR201               ; 手動ﾓｰﾄﾞ選択
CON
@SET @MR900              ; 運転開始時ﾓｰﾀｱﾗｰﾑｸﾘｱ
MRD
@SET MR2002              ; 安全ｶﾊﾞｰﾛｯｸ解除
CON
@SET MR2004              ; 強制安全ｶﾊﾞｰﾛｯｸ解除
MPP
@SET MR2003              ; ﾌｨﾙﾑ除電ｲｵﾅｲｻﾞ_RUN
STG @MR900               ; 運転開始時ﾓｰﾀｱﾗｰﾑｸﾘｱ
SET MR10001              ; 転写ﾍｯﾄﾞ_ｴﾗｰｸﾘｱ
CON
SET MR10201              ; ﾌｨﾙﾑ送り_ｴﾗｰｸﾘｱ
CON
SET MR10401              ; 主軸ﾛｰﾗ_ｴﾗｰｸﾘｱ
CON
SET MR10601              ; ｽｸﾚｰﾊﾟ_ｴﾗｰｸﾘｱ
CON
JMP @MR901               ; 901
STG @MR901               ; 901
TMR #121 #10             ; 運転開始時ﾓｰﾀｱﾗｰﾑｸﾘｱ時間
CON
AND T121                 ; 運転開始時ﾓｰﾀｱﾗｰﾑｸﾘｱ時間
JMP @MR902
STG @MR902
RES MR10001              ; 転写ﾍｯﾄﾞ_ｴﾗｰｸﾘｱ
CON
RES MR10201              ; ﾌｨﾙﾑ送り_ｴﾗｰｸﾘｱ
CON
RES MR10401              ; 主軸ﾛｰﾗ_ｴﾗｰｸﾘｱ
CON
RES MR10601              ; ｽｸﾚｰﾊﾟ_ｴﾗｰｸﾘｱ
CON
ENDS
LD CR2002                ; 常時ON
AND CR2007               ; 運転開始時1ｽｷｬﾝOFF
AND R55000               ; 即停止/TRAP無
ANB R50007               ; 手動制御中
MPS
ANB R14113               ; 軸1 ｻｰﾎﾞON
SET MR10000              ; 転写ﾍｯﾄﾞ_ｻｰﾎﾞON
MRD
ANB R14913               ; 軸2 ｻｰﾎﾞON
SET MR10200              ; ﾌｨﾙﾑ送り_ｻｰﾎﾞON
MRD
ANB R15713               ; 軸3 ｻｰﾎﾞON
SET MR10400              ; 主軸ﾛｰﾗ_ｻｰﾎﾞON
MRD
ANB R16513               ; 軸4 ｻｰﾎﾞON
SET MR10600              ; ｽｸﾚｰﾊﾟ_ｻｰﾎﾞON
MPP
ANB R2003                ; ﾌｨﾙﾑ除電ｲｵﾅｲｻﾞ_RUN
SET MR2003               ; ﾌｨﾙﾑ除電ｲｵﾅｲｻﾞ_RUN
;スタートスイッチ管理
;Ｓｔａｒｔ  ＳＷ   ｍａｎａｇｅｍｅｎｔ
;
;起動Start_SW
LD R4304                 ; 起動ｽｲｯﾁ
MPS
TMR @0 #30               ; 起動ｽｲｯﾁ_OFF
MPP
ANB @T0                  ; 起動ｽｲｯﾁ_OFF
OUT @MR000               ; 起動START_SW_ON
LD @MR000                ; 起動START_SW_ON
AND _WF_Trans
OUT @MR001               ; 起動START_SW_ON_Pls
LD @MR001                ; 起動START_SW_ON_Pls
OR @MR002                ; 起動START_SW_ON
ANB @MR003               ; 起動START_SW_OFF
OUT @MR002               ; 起動START_SW_ON
OUT R51000               ; 起動ｽﾀｰﾄ_SW_ON
LD @MR002                ; 起動START_SW_ON
ANB R4304                ; 起動ｽｲｯﾁ
OUT @MR003               ; 起動START_SW_OFF
LD @MR001                ; 起動START_SW_ON_Pls
DIFU R51001              ; 起動ｽﾀｰﾄ_SW_ON_Pls
;Start_SW
LD R4013                 ; ｽﾀｰﾄｽｲｯﾁ1
OR R4307                 ; ｽﾀｰﾄｽｲｯﾁ2
MPS
TMR @1 #30               ; ｽﾀｰﾄｽｲｯﾁ_OFF
MPP
ANB @T1                  ; ｽﾀｰﾄｽｲｯﾁ_OFF
OUT @MR005               ; START_SW_ON
LD @MR005                ; START_SW_ON
OR @MR006                ; START_SW_ON_Pls
ANB @MR007               ; START_SW_ON
OUT @MR006               ; START_SW_ON_Pls
OUT R51002               ; ｽﾀｰﾄ_SW_ON
LD @MR006                ; START_SW_ON_Pls
ANB R4013                ; ｽﾀｰﾄｽｲｯﾁ1
ANB R4307                ; ｽﾀｰﾄｽｲｯﾁ2
OUT @MR007               ; START_SW_ON
LD @MR005                ; START_SW_ON
DIFU R51003              ; ｽﾀｰﾄ_SW_ON_Pls
;＠モード選択/Select Mode
;***** 原点復帰 ******
LD R51101                ; 原点復帰中
OUT R50003               ; 原点復帰中
LD R49200                ; 原点復帰画面
ANB R51101               ; 原点復帰中
AND R51000               ; 起動ｽﾀｰﾄ_SW_ON
AND R005                 ; 安全ｶﾊﾞｰ入力
ANB R50300               ; Pause
MPS
RES LR200                ; 自動ﾓｰﾄﾞ選択
CON
RES LR201                ; 手動ﾓｰﾄﾞ選択
CON
RES R51100               ; 原点復帰完了
MPP
DIFU R50914              ; HOME_ON_PLS
LD R49200                ; 原点復帰画面
ANB R51101               ; 原点復帰中
ANF R51000               ; 起動ｽﾀｰﾄ_SW_ON
AND R005                 ; 安全ｶﾊﾞｰ入力
ANB R50300               ; Pause
OUT @MR108               ; HOME_Start_PLS
LD R49200                ; 原点復帰画面
ANB R51100               ; 原点復帰完了
ANB R50001               ; 自動中
ANB R50002               ; 手動中
OUT @MR100               ; HOME条件
LD @MR103                ; HOME_動作中
OR @MR104                ; HOME終了
AND R51100               ; 原点復帰完了
ANB @MR105               ; HOME_終了確認
OUT @MR104               ; HOME終了
LD @MR100                ; HOME条件
AND @MR108               ; HOME_Start_PLS
ANB R50006               ; 異常発生中
ANB R50109               ; Err_ｽｷｰｼﾞUT
ANB R50110               ; Err_転写UT
OR R51101                ; 原点復帰中
AND T120                 ; 動作中遅延
AND R55000               ; 即停止/TRAP無
ANB R51100               ; 原点復帰完了
OUT R51101               ; 原点復帰中
LD R51101                ; 原点復帰中
DIFU @MR101              ; HOME_Start_PLS
LD @MR101                ; HOME_Start_PLS
OR @MR102                ; HOME_Start_確認
AND R51101               ; 原点復帰中
ANB @MR103               ; HOME_動作中
OUT @MR102               ; HOME_Start_確認
MDSTRT Origin
LD @MR102                ; HOME_Start_確認
AND _Origin
OR @MR103                ; HOME_動作中
AND R51101               ; 原点復帰中
ANB @MR105               ; HOME_終了確認
OUT @MR103               ; HOME_動作中
;HOME終了操作  /  HOME End Process
LD @MR104                ; HOME終了
ANB _Origin
AND R51100               ; 原点復帰完了
RES R51200               ; ｴﾘｱｾﾝｻ有効Flg
CON
OUT @MR105               ; HOME_終了確認
LD @MR104                ; HOME終了
OR R50000                ; 即停止
OR R50900                ; TRAP
MDSTOP Origin
LDP @MR105               ; HOME_終了確認
OR R50915                ; 原点復帰終了ﾌﾞｻﾞｰON
ANB T103                 ; HOME終了ﾌﾞｻﾞｰON
OUT R50915               ; 原点復帰終了ﾌﾞｻﾞｰON
TMR #103 #6              ; HOME終了ﾌﾞｻﾞｰON
;モード選択
;Ｍｏｄｅ  Ｓｅｌｅｃｔｉｏｎ
LD R50101                ; 自動ﾓｰﾄﾞ_SW
AND R50005               ; 停止中
DIFU @MR200              ; 自動ﾓｰﾄﾞ   SW ON
LD @MR200                ; 自動ﾓｰﾄﾞ   SW ON
@SET R50212
CON
SET LR200                ; 自動ﾓｰﾄﾞ選択
CON
RES LR201                ; 手動ﾓｰﾄﾞ選択
LD R50102                ; 手動ﾓｰﾄﾞ_SW
AND R50005               ; 停止中
DIFU @MR201              ; 手動ﾓｰﾄﾞ   SW ON
LD @MR201                ; 手動ﾓｰﾄﾞ   SW ON
@RES R50212
CON
SET LR201                ; 手動ﾓｰﾄﾞ選択
CON
RES LR200                ; 自動ﾓｰﾄﾞ選択
;
;ＡＵＴＯ
;
;ﾌﾗｸﾞ制御
;FLG Control
LD CR2002                ; 常時ON
MPS
LDA DM3000               ; 現在表示中   画面
CON
CMP #100
CON
AND CR2010               ; 演算結果がｾﾞﾛ
OUT R49200               ; 原点復帰画面
MPP
LDA DM3000               ; 現在表示中   画面
CON
CMP #102
CON
AND CR2010               ; 演算結果がｾﾞﾛ
OUT R49201               ; MAIN_画面表示中
LD R50104                ; 自動ﾓｰﾄﾞ停止_SW
OR R50100                ; 自動ﾓｰﾄﾞ停止PLS
RES R50100               ; 自動ﾓｰﾄﾞ停止PLS
;AUTO処理開始
;AUTO START
LD R49201                ; MAIN_画面表示中
AND R005                 ; 安全ｶﾊﾞｰ入力
AND LR200                ; 自動ﾓｰﾄﾞ選択
ANB R50004               ; 動作中
@SET R51605              ; 自動運転可能ﾗﾝﾌﾟ点滅
LD R49201                ; MAIN_画面表示中
AND R51000               ; 起動ｽﾀｰﾄ_SW_ON
AND R005                 ; 安全ｶﾊﾞｰ入力
AND LR200                ; 自動ﾓｰﾄﾞ選択
ANB R50004               ; 動作中
DIFU @MR301              ; 自動ｽﾀｰﾄ　  SW ON
;起動条件OKならSTART
;START when States OK
LD @MR301                ; 自動ｽﾀｰﾄ　  SW ON
ZRES R51600 R51604       ; 転写処理動作完了  除材動作中
LD @MR301                ; 自動ｽﾀｰﾄ　  SW ON
AND LR200                ; 自動ﾓｰﾄﾞ選択
AND MR100                ; ST原点Flg
OR R50001                ; 自動中
AND R55000               ; 即停止/TRAP無
AND R51100               ; 原点復帰完了
ANB @MR305               ; 自動終了
OUT R50001               ; 自動中
;AUTO 停止監視　開始
;AUTO STOP process Start
LD R50001                ; 自動中
DIFU @MR302              ; 自動ｽﾀｰﾄPLS
LD @MR302                ; 自動ｽﾀｰﾄPLS
OR @MR303                ; 自動ｽﾀｰﾄ　   確認
AND R50001               ; 自動中
ANB @MR304               ; 各ﾀｽｸ動作中
OUT @MR303               ; 自動ｽﾀｰﾄ　   確認
;停止信号入力待ち
;STOP signal wait
LD @MR303                ; 自動ｽﾀｰﾄ　   確認
AND R50500               ; AUTO動作終了
OR @MR304                ; 各ﾀｽｸ動作中
AND R50001               ; 自動中
ANB @MR305               ; 自動終了
OUT @MR304               ; 各ﾀｽｸ動作中
;各ﾓｼﾞｭｰﾙ停止待ち
;Each modul STOP wait
LD @MR304                ; 各ﾀｽｸ動作中
RES R51200               ; ｴﾘｱｾﾝｻ有効Flg
CON
RES R51601               ; ｽｷｰｼﾞ動作完了
CON
RES R51615               ; 転写動作完了
CON
RES R50500               ; AUTO動作終了
CON
OUT @MR305               ; 自動終了
;AUTO 終了処理
;AUTO END process
LD @MR305                ; 自動終了
OR R51008                ; 自動終了ﾌﾞｻﾞｰON
ANB T100                 ; 自動終了   ﾌﾞｻﾞｰON
OUT R51008               ; 自動終了ﾌﾞｻﾞｰON
TMR #100 #6              ; 自動終了   ﾌﾞｻﾞｰON
LD T100                  ; 自動終了   ﾌﾞｻﾞｰON
RES R51200               ; ｴﾘｱｾﾝｻ有効Flg
CON
AND CR2003               ; 常時OFF
RES LR200                ; 自動ﾓｰﾄﾞ選択
LD R50001                ; 自動中
SET R51200               ; ｴﾘｱｾﾝｻ有効Flg
LD @MR301                ; 自動ｽﾀｰﾄ　  SW ON
AND R55000               ; 即停止/TRAP無
AND R51100               ; 原点復帰完了
ANB @MR305               ; 自動終了
ANB R50001               ; 自動中
ANB MR100                ; ST原点Flg
SET R50507               ; 自動原点無し起動ｴﾗｰ
LDP R50001               ; 自動中
INC DM471                ; 投入ｶｳﾝﾀ
LDP T100                 ; 自動終了   ﾌﾞｻﾞｰON
INC DM470                ; 生産ｶｳﾝﾀ
LDP R41000               ; 生産ｶｳｯﾀﾘｾｯﾄ
FMOV #0 DM470 #2         ; 生産ｶｳﾝﾀ
;ＳＴ 原点部
;
LD CR2002                ; 常時ON
OUT MR100                ; ST原点Flg
;ＭＡＮＵ
;
LD R49201                ; MAIN_画面表示中
LD R51001                ; 起動ｽﾀｰﾄ_SW_ON_Pls
OR R51003                ; ｽﾀｰﾄ_SW_ON_Pls
ANL
LD LR000                 ; ｽｷｰｼﾞｽﾃｯﾌﾟ選択
OR LR001                 ; ｳｪﾊｰｾｯﾄ
OR LR002                 ; ﾌｨﾙﾑ転写ｽﾃｯﾌﾟ選択
OR LR003                 ; ﾌｨﾙﾑ交換選択
OR LR004                 ; ﾌｨﾙﾑ巻取/巻送
OR LR005                 ; ｽｸﾚｰﾊﾟ交換選択
OR LR006                 ; ｽｷｰｼﾞ台交換選択
OR LR007                 ; ﾌｨﾙﾑ採取選択
OR LR008                 ; ﾌｨﾙﾑ送り_ｴｰｼﾞﾝｸﾞ選択
ANL
AND LR201                ; 手動ﾓｰﾄﾞ選択
AND R4303                ; ｴﾘｱｾﾝｻ
AND R005                 ; 安全ｶﾊﾞｰ入力
DIFU @MR401              ; 手動ｽﾀｰﾄ 　SW ON
LD @MR401                ; 手動ｽﾀｰﾄ 　SW ON
OR R50002                ; 手動中
AND R55000               ; 即停止/TRAP無
AND R51100               ; 原点復帰完了
ANB @MR405               ; 手動終了
OUT R50002               ; 手動中
LD R50002                ; 手動中
DIFU @MR402              ; 手動STEPｽﾀｰﾄPLS
LD @MR402                ; 手動STEPｽﾀｰﾄPLS
OR @MR403                ; 手動ｽﾀｰﾄ　 確認
AND R50002               ; 手動中
ANB @MR404               ; 各ﾀｽｸ動作中
OUT @MR403               ; 手動ｽﾀｰﾄ　 確認
LDB R50500               ; AUTO動作終了
ANB R50600               ; ﾌｨﾙﾑ巻取動作中
ANB R50700               ; ｽｷｰｼﾞｽﾃｯﾌﾟ実行中
ANB R50701               ; ﾌｨﾙﾑ転写ｽﾃｯﾌﾟ実行中
ANB R50703               ; ﾌｨﾙﾑ巻出交換中
ANB R50704               ; ﾌｨﾙﾑ巻取り送り実行中
ANB R50705               ; ｽｸﾚｰﾊﾟ交換実行中
ANB R50706               ; ｽｷｰｼﾞ台交換実行中
ANB R50707               ; ﾌｨﾙﾑ採取実行中
ANB R50708               ; ﾌｨﾙﾑ送り_ｴｰｼﾞﾝｸﾞ実行中
ANB R50803               ; ｳｪﾊｰｾｯﾄSTEP実行中
OUB @MR406               ; STEP実行中
LD @MR403                ; 手動ｽﾀｰﾄ　 確認
AND @MR406               ; STEP実行中
OR @MR404                ; 各ﾀｽｸ動作中
AND R50002               ; 手動中
ANB @MR405               ; 手動終了
OUT @MR404               ; 各ﾀｽｸ動作中
LD @MR404                ; 各ﾀｽｸ動作中
ANB @MR406               ; STEP実行中
RES R51200               ; ｴﾘｱｾﾝｻ有効Flg
CON
OUT @MR405               ; 手動終了
;*****　連続手動ﾓｰﾄﾞ許可  /  Mnual mode Demand　*****
LD R42500                ; 連続STEP許可2点押sw1
AND R42501               ; 連続STEP許可2点押sw1
TMR #122 #20             ; 連続手動ﾓｰﾄﾞ許可
LDP T122                 ; 連続手動ﾓｰﾄﾞ許可
ALT R42503               ; 連続STEP許可
;動作中
;Ｄｕｒｉｎｇ  Ｏｐｅｒａｔｉｏｎ
LD R50001                ; 自動中
OR R50002                ; 手動中
OR R51101                ; 原点復帰中
OR R42510                ; 全ｶﾊﾞｰ開中
OR R42511                ; 全ｶﾊﾞｰ閉中
OUT R50004               ; 動作中
;手動ﾓｰﾄﾞ監視
LDB LR000                ; ｽｷｰｼﾞｽﾃｯﾌﾟ選択
ANB LR005                ; ｽｸﾚｰﾊﾟ交換選択
ANB LR006                ; ｽｷｰｼﾞ台交換選択
ANB LR007                ; ﾌｨﾙﾑ採取選択
OUB @MR500               ; ｽｷｰｼﾞSTEPﾓｰﾄﾞ
LDB LR001                ; ｳｪﾊｰｾｯﾄ
ANB LR002                ; ﾌｨﾙﾑ転写ｽﾃｯﾌﾟ選択
ANB LR003                ; ﾌｨﾙﾑ交換選択
ANB LR004                ; ﾌｨﾙﾑ巻取/巻送
ANB LR008                ; ﾌｨﾙﾑ送り_ｴｰｼﾞﾝｸﾞ選択
OUB @MR501               ; 転写STEPﾓｰﾄﾞ
;Ｃａｌｌ　Ｐｏｓｔ
LDB R50002               ; 手動中
ZRES R50403 R50405       ; Call_post実行中  50405
STG R50400               ; Call_Post
ANB R50403               ; Call_post実行中
AND R50002               ; 手動中
LD LR505                 ; Call_Post_Pass選択
OR LR003                 ; ﾌｨﾙﾑ交換選択
ANL
SET R50403               ; Call_post実行中
CON
JMP R50404               ; 50404
STG R50404               ; 50404
LD @MR500                ; ｽｷｰｼﾞSTEPﾓｰﾄﾞ
OR @MR501                ; 転写STEPﾓｰﾄﾞ
ANL
AND R51001               ; 起動ｽﾀｰﾄ_SW_ON_Pls
ANB R50300               ; Pause
ANB R50006               ; 異常発生中
AND R55000               ; 即停止/TRAP無
AND R4300                ; 元圧ｾﾝｻ
AND R005                 ; 安全ｶﾊﾞｰ入力
JMP R50405               ; 50405
STG R50405               ; 50405
ANB R50400               ; Call_Post
RES R50403               ; Call_post実行中
CON
ENDS
LD R50400                ; Call_Post
AND R50404               ; 50404
OUT R50401               ; Post_Busy
LD R50002                ; 手動中
AND R50405               ; 50405
ORB R50002               ; 手動中
OR R50408                ; POST_PASS1
OR R50409                ; POST_PASS2
LDB LR505                ; Call_Post_Pass選択
ANB LR003                ; ﾌｨﾙﾑ交換選択
ORL
OUT R50402               ; Post_Ok
LD @MR500                ; ｽｷｰｼﾞSTEPﾓｰﾄﾞ
OR @MR501                ; 転写STEPﾓｰﾄﾞ
LD R51000                ; 起動ｽﾀｰﾄ_SW_ON
OR R51002                ; ｽﾀｰﾄ_SW_ON
ANL
ANB R50300               ; Pause
TMR @8 #30
CON
AND @T8
OUT R50409               ; POST_PASS2
END
ENDH
