DEVICE:53
;MODULE:LK-G_COM
;MODULE_TYPE:0
;SCRIPT_TYPE:
;LK-Gとの通信
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ZRES @R100 @R515         ; 通信終了処理
;<h1/>通信 MAIN
;ｺﾏﾝﾄﾞ番号説明
;#0		Prg_No.0 呼び出し
;#1		Prg_No.1 呼び出し
;#2		Prg_No.2 呼び出し
;#3		Prg_No.3 呼び出し
;#4		Prg_No.4 呼び出し
;#5		Prg_No.5 呼び出し
;#6		Prg_No.6 呼び出し
;#7		Prg_No.7 呼び出し
;#8		-
;#9		-
;#10		OUT1ﾀｲﾐﾝｸﾞON
;#11		OUT2ﾀｲﾐﾝｸﾞON
;#12		OUT1,2ﾀｲﾐﾝｸﾞON
;#13		OUT1ﾀｲﾐﾝｸﾞOFF
;#14		OUT2ﾀｲﾐﾝｸﾞOFF
;#15		OUT1,2ﾀｲﾐﾝｸﾞOFF
;#16		OUT1測定値出力
;#17		OUT2測定値出力
;#18		OUT1,2測定値出力
;#19		-
;#20		ｽﾄﾚｰｼﾞ開始
;#21		ｽﾄﾚｰｼﾞ停止
;#22		OUT1オートゼロOFF
;#23		OUT2オートゼロOFF
;#99		初期設定
STG R37000               ; LK-G通信START
RES @R501                ; COM_Finish
CON
SET R37002               ; LK-G通信中
CON
ZRES @DM0 @DM12          ; 格納単位  送信STEP
CON
ZRES @DM16 @DM199
CON
JMP @R100
STG @R100
LDA EM1920               ; LK-G通信ｺｰﾄﾞ番号
CON
STA @DM50                ; 通信ｺｰﾄﾞ
CON
JMP @R101
STG @R101
MPS
AND= #0 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,0" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #1 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,1" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #2 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,2" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #3 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,3" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #4 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,4" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #5 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,5" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #6 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,6" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #7 @DM50            ; 通信ｺｰﾄﾞ
SMOV "PW,7" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #8 @DM50            ; 通信ｺｰﾄﾞ
SMOV "" @DM100           ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #9 @DM50            ; 通信ｺｰﾄﾞ
SMOV "" @DM100           ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #10 @DM50           ; 通信ｺｰﾄﾞ
SMOV "T1,1" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #11 @DM50           ; 通信ｺｰﾄﾞ
SMOV "T1,2" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #12 @DM50           ; 通信ｺｰﾄﾞ
SMOV "T1,0" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #13 @DM50           ; 通信ｺｰﾄﾞ
SMOV "T0,1" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #14 @DM50           ; 通信ｺｰﾄﾞ
SMOV "T0,2" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #15 @DM50           ; 通信ｺｰﾄﾞ
SMOV "T0,0" @DM100       ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #16 @DM50           ; 通信ｺｰﾄﾞ
SMOV "M1" @DM100         ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #17 @DM50           ; 通信ｺｰﾄﾞ
SMOV "M2" @DM100         ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #18 @DM50           ; 通信ｺｰﾄﾞ
SMOV "M0" @DM100         ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #19 @DM50           ; 通信ｺｰﾄﾞ
SMOV "" @DM100           ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #20 @DM50           ; 通信ｺｰﾄﾞ
MPS
DW #0 @DM15              ; 結果格納数
CON
DW #0 @DM13              ; 測定数
CON
SMOV "AS" @DM100         ; 送信ﾃﾞｰﾀ先頭
MPP
JMP @R200                ; 汎用通信
MRD
AND= #21 @DM50           ; 通信ｺｰﾄﾞ
SMOV "AP" @DM100         ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #22 @DM50           ; 通信ｺｰﾄﾞ
SMOV "V1" @DM100         ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MRD
AND= #23 @DM50           ; 通信ｺｰﾄﾞ
SMOV "V2" @DM100         ; 送信ﾃﾞｰﾀ先頭
JMP @R200                ; 汎用通信
MPP
AND= #99 @DM50           ; 通信ｺｰﾄﾞ
JMP @R102                ; 初期設定
;<h1/>初期設定通信
;初期設定として、PrgNo.0〜2を設定する
;No.0	通常用
;	OUT1 = ﾍｯﾄﾞAのﾋﾟｰｸtoﾋﾟｰｸ値※
;	OUT2 = ﾍｯﾄﾞBのﾋﾟｰｸtoﾋﾟｰｸ値※
;No.1	ﾍｯﾄﾞ1調整用
;	OUT1 = ﾍｯﾄﾞAのﾋﾟｰｸtoﾋﾟｰｸ値※
;	OUT2 = ﾍｯﾄﾞAのﾉｰﾏﾙ値		
;No.2	ﾍｯﾄﾞ2調整用
;	OUT1 = ﾍｯﾄﾞBのﾋﾟｰｸtoﾋﾟｰｸ値※
;	OUT2 = ﾍｯﾄﾞBのﾉｰﾏﾙ値
;※測定方法ﾋﾟｰｸﾎｰﾙﾄﾞ（MAX値出力）に変更
;2013/05/27
STG @R102                ; 初期設定
DW #0 @DM11              ; PrgNo
CON
DW #0 @DM12              ; 送信STEP
CON
JMP @R105
STG @R105
RES @R103                ; ｺﾏﾝﾄﾞ確定
CON
RES @R104                ; ｺﾏﾝﾄﾞ列終了
CON
JMP @R106
;'Prg No.0 初期設定ｺﾏﾝﾄﾞを送信
;
;SELECT CASE @DM12
;	CASE 0
;'通常ﾓｰﾄﾞ移行
;		@DM100.T = "R0"
;	CASE 1
;'ﾌﾟﾛｸﾞﾗﾑ切替
;		@DM100.T = "PW,0"
;	CASE 2
;'通信ﾓｰﾄﾞ移行
;		@DM100.T = "Q0"	
;	CASE 3
;'ﾍｯﾄﾞA演算方法指定
;		@DM100.T = "SW,OA,1,0,0"		
;	CASE 4
;'ﾍｯﾄﾞB演算方法指定
;		@DM100.T = "SW,OA,2,1,0"	
;	CASE 5
;'ﾍｯﾄﾞAｱﾗｰﾑ処理999設定
;		@DM100.T = "SW,HC,N,1,999"
;	CASE 6
;'ﾍｯﾄﾞBｱﾗｰﾑ処理999設定
;		@DM100.T = "SW,HC,N,2,999"
;	CASE 7
;'OUT1 ﾄﾘｶﾞﾓｰﾄﾞ2
;		@DM100.T = "SW,OE,M,1,1"
;	CASE 8
;'OUT2 ﾄﾘｶﾞﾓｰﾄﾞ2
;		@DM100.T = "SW,OE,M,2,1"
;	CASE 9
;		'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;		'		@DM100.T = "SW,OD,1,3"
;'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;		@DM100.T = "SW,OD,1,1"
;	CASE 10
;		'OUT2 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;		'		@DM100.T = "SW,OD,2,3"
;'OUT2 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;		@DM100.T = "SW,OD,2,1"
;	CASE 11
;'OUT1 測定0.001mm設定
;		@DM100.T = "SW,OG,1,1"
;	CASE 12
;'OUT2 測定0.001mm設定
;		@DM100.T = "SW,OG,2,1"
;	CASE 13
;'ｻﾝﾌﾟﾘﾝｸﾞ周期100μs設定
;		@DM100.T = "SW,CA,2"
;	CASE 14
;'ﾃﾞｰﾀｽﾄﾚｰｼﾞ設定
;		@DM100.T = "SW,CI,3,65536,4"
;	CASE 15
;'通常ﾓｰﾄﾞ移行
;		@DM100.T = "R0"
;	CASE ELSE
;		'ｺﾏﾝﾄﾞ列終了SET
;		SET (@R104)
;END SELECT
;	'ｺﾏﾝﾄﾞ確定SET
;	SET (@R103)
;
LD @R106
AND= @DM11 #0            ; PrgNo
NCJ #1000
;'Prg No.0 初期設定ｺﾏﾝﾄﾞを送信
;
;SELECT CASE @DM12
;
LD CR2002                ; 常時ON
MOV @DM12 @VM0           ; 送信STEP
;	CASE 0
;
LD= @VM0 #0
NCJ #2000
;'通常ﾓｰﾄﾞ移行
;
;		@DM100.T = "R0"
;
LD CR2002                ; 常時ON
SMOV "R0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;	CASE 1
;
LD= @VM0 #1
NCJ #2002
;'ﾌﾟﾛｸﾞﾗﾑ切替
;
;		@DM100.T = "PW,0"
;
LD CR2002                ; 常時ON
SMOV "PW,0" @DM100       ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;	CASE 2
;
LD= @VM0 #2
NCJ #2004
;'通信ﾓｰﾄﾞ移行
;
;		@DM100.T = "Q0"	
;
LD CR2002                ; 常時ON
SMOV "Q0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2005
LABEL #2004
;	CASE 3
;
LD= @VM0 #3
NCJ #2006
;'ﾍｯﾄﾞA演算方法指定
;
;		@DM100.T = "SW,OA,1,0,0"		
;
LD CR2002                ; 常時ON
SMOV "SW,OA,1,0,0" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2007
LABEL #2006
;	CASE 4
;
LD= @VM0 #4
NCJ #2008
;'ﾍｯﾄﾞB演算方法指定
;
;		@DM100.T = "SW,OA,2,1,0"	
;
LD CR2002                ; 常時ON
SMOV "SW,OA,2,1,0" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2009
LABEL #2008
;	CASE 5
;
LD= @VM0 #5
NCJ #2010
;'ﾍｯﾄﾞAｱﾗｰﾑ処理999設定
;
;		@DM100.T = "SW,HC,N,1,999"
;
LD CR2002                ; 常時ON
SMOV "SW,HC,N,1,999" @DM100;送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2011
LABEL #2010
;	CASE 6
;
LD= @VM0 #6
NCJ #2012
;'ﾍｯﾄﾞBｱﾗｰﾑ処理999設定
;
;		@DM100.T = "SW,HC,N,2,999"
;
LD CR2002                ; 常時ON
SMOV "SW,HC,N,2,999" @DM100;送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2013
LABEL #2012
;	CASE 7
;
LD= @VM0 #7
NCJ #2014
;'OUT1 ﾄﾘｶﾞﾓｰﾄﾞ2
;
;		@DM100.T = "SW,OE,M,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OE,M,1,1" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2015
LABEL #2014
;	CASE 8
;
LD= @VM0 #8
NCJ #2016
;'OUT2 ﾄﾘｶﾞﾓｰﾄﾞ2
;
;		@DM100.T = "SW,OE,M,2,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OE,M,2,1" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2017
LABEL #2016
;	CASE 9
;
LD= @VM0 #9
NCJ #2018
;		'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;
;		'		@DM100.T = "SW,OD,1,3"
;
;'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;
;		@DM100.T = "SW,OD,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OD,1,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2019
LABEL #2018
;	CASE 10
;
LD= @VM0 #10
NCJ #2020
;		'OUT2 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;
;		'		@DM100.T = "SW,OD,2,3"
;
;'OUT2 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;
;		@DM100.T = "SW,OD,2,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OD,2,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2021
LABEL #2020
;	CASE 11
;
LD= @VM0 #11
NCJ #2022
;'OUT1 測定0.001mm設定
;
;		@DM100.T = "SW,OG,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OG,1,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2023
LABEL #2022
;	CASE 12
;
LD= @VM0 #12
NCJ #2024
;'OUT2 測定0.001mm設定
;
;		@DM100.T = "SW,OG,2,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OG,2,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2025
LABEL #2024
;	CASE 13
;
LD= @VM0 #13
NCJ #2026
;'ｻﾝﾌﾟﾘﾝｸﾞ周期100μs設定
;
;		@DM100.T = "SW,CA,2"
;
LD CR2002                ; 常時ON
SMOV "SW,CA,2" @DM100    ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2027
LABEL #2026
;	CASE 14
;
LD= @VM0 #14
NCJ #2028
;'ﾃﾞｰﾀｽﾄﾚｰｼﾞ設定
;
;		@DM100.T = "SW,CI,3,65536,4"
;
LD CR2002                ; 常時ON
SMOV "SW,CI,3,65536,4" @DM100;送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2029
LABEL #2028
;	CASE 15
;
LD= @VM0 #15
NCJ #2030
;'通常ﾓｰﾄﾞ移行
;
;		@DM100.T = "R0"
;
LD CR2002                ; 常時ON
SMOV "R0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2031
LABEL #2030
;	CASE ELSE
;
;		'ｺﾏﾝﾄﾞ列終了SET
;
;		SET (@R104)
;
LD CR2002                ; 常時ON
SET @R104                ; ｺﾏﾝﾄﾞ列終了
;END SELECT
;
LABEL #2031
LABEL #2029
LABEL #2027
LABEL #2025
LABEL #2023
LABEL #2021
LABEL #2019
LABEL #2017
LABEL #2015
LABEL #2013
LABEL #2011
LABEL #2009
LABEL #2007
LABEL #2005
LABEL #2003
LABEL #2001
;	'ｺﾏﾝﾄﾞ確定SET
;
;	SET (@R103)
;
LD CR2002                ; 常時ON
SET @R103                ; ｺﾏﾝﾄﾞ確定
LABEL #1000
;
;'Prg No.1 初期設定ｺﾏﾝﾄﾞを送信
;
;SELECT CASE @DM12
;	CASE 0
;'通常ﾓｰﾄﾞ移行
;		@DM100.T = "R0"
;	CASE 1
;'ﾌﾟﾛｸﾞﾗﾑ切替
;		@DM100.T = "PW,1"
;	CASE 2
;'通信ﾓｰﾄﾞ移行
;		@DM100.T = "Q0"	
;	CASE 3
;'OUT1演算方法指定
;		@DM100.T = "SW,OA,1,0,0"		
;	CASE 4
;'OUT2演算方法指定
;		@DM100.T = "SW,OA,2,0,0"	
;	CASE 5
;'ﾍｯﾄﾞAｱﾗｰﾑ処理999設定
;		@DM100.T = "SW,HC,N,1,999"
;	CASE 6
;'OUT1 ﾄﾘｶﾞﾓｰﾄﾞ2
;		@DM100.T = "SW,OE,M,1,1"
;	CASE 7
;'OUT2 ﾄﾘｶﾞﾓｰﾄﾞ2
;		@DM100.T = "SW,OE,M,2,1"
;	CASE 8
;		'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;		'		@DM100.T = "SW,OD,1,3"		
;'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;		@DM100.T = "SW,OD,1,1"
;	CASE 9
;'OUT2 測定ﾓｰﾄﾞ ﾉｰﾏﾙ
;		@DM100.T = "SW,OD,2,0"
;	CASE 10
;'OUT1 測定0.001mm設定
;		@DM100.T = "SW,OG,1,1"
;	CASE 11
;'OUT2 測定0.001mm設定
;		@DM100.T = "SW,OG,2,1"
;	CASE 12
;'ｻﾝﾌﾟﾘﾝｸﾞ周期100μs設定
;		@DM100.T = "SW,CA,2"
;	CASE 13
;'ﾃﾞｰﾀｽﾄﾚｰｼﾞ設定
;		@DM100.T = "SW,CI,3,65536,4"
;	CASE 14
;'通常ﾓｰﾄﾞ移行
;		@DM100.T = "R0"
;	CASE ELSE
;		'ｺﾏﾝﾄﾞ列終了SET
;		SET (@R104)
;END SELECT
;	'ｺﾏﾝﾄﾞ確定SET
;	SET (@R103)
;
LD @R106
AND= @DM11 #1            ; PrgNo
NCJ #1001
;'Prg No.1 初期設定ｺﾏﾝﾄﾞを送信
;
;SELECT CASE @DM12
;
LD CR2002                ; 常時ON
MOV @DM12 @VM1           ; 送信STEP
;	CASE 0
;
LD= @VM1 #0
NCJ #2032
;'通常ﾓｰﾄﾞ移行
;
;		@DM100.T = "R0"
;
LD CR2002                ; 常時ON
SMOV "R0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2033
LABEL #2032
;	CASE 1
;
LD= @VM1 #1
NCJ #2034
;'ﾌﾟﾛｸﾞﾗﾑ切替
;
;		@DM100.T = "PW,1"
;
LD CR2002                ; 常時ON
SMOV "PW,1" @DM100       ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2035
LABEL #2034
;	CASE 2
;
LD= @VM1 #2
NCJ #2036
;'通信ﾓｰﾄﾞ移行
;
;		@DM100.T = "Q0"	
;
LD CR2002                ; 常時ON
SMOV "Q0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2037
LABEL #2036
;	CASE 3
;
LD= @VM1 #3
NCJ #2038
;'OUT1演算方法指定
;
;		@DM100.T = "SW,OA,1,0,0"		
;
LD CR2002                ; 常時ON
SMOV "SW,OA,1,0,0" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2039
LABEL #2038
;	CASE 4
;
LD= @VM1 #4
NCJ #2040
;'OUT2演算方法指定
;
;		@DM100.T = "SW,OA,2,0,0"	
;
LD CR2002                ; 常時ON
SMOV "SW,OA,2,0,0" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2041
LABEL #2040
;	CASE 5
;
LD= @VM1 #5
NCJ #2042
;'ﾍｯﾄﾞAｱﾗｰﾑ処理999設定
;
;		@DM100.T = "SW,HC,N,1,999"
;
LD CR2002                ; 常時ON
SMOV "SW,HC,N,1,999" @DM100;送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2043
LABEL #2042
;	CASE 6
;
LD= @VM1 #6
NCJ #2044
;'OUT1 ﾄﾘｶﾞﾓｰﾄﾞ2
;
;		@DM100.T = "SW,OE,M,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OE,M,1,1" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2045
LABEL #2044
;	CASE 7
;
LD= @VM1 #7
NCJ #2046
;'OUT2 ﾄﾘｶﾞﾓｰﾄﾞ2
;
;		@DM100.T = "SW,OE,M,2,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OE,M,2,1" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2047
LABEL #2046
;	CASE 8
;
LD= @VM1 #8
NCJ #2048
;		'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;
;		'		@DM100.T = "SW,OD,1,3"		
;
;'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;
;		@DM100.T = "SW,OD,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OD,1,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2049
LABEL #2048
;	CASE 9
;
LD= @VM1 #9
NCJ #2050
;'OUT2 測定ﾓｰﾄﾞ ﾉｰﾏﾙ
;
;		@DM100.T = "SW,OD,2,0"
;
LD CR2002                ; 常時ON
SMOV "SW,OD,2,0" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2051
LABEL #2050
;	CASE 10
;
LD= @VM1 #10
NCJ #2052
;'OUT1 測定0.001mm設定
;
;		@DM100.T = "SW,OG,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OG,1,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2053
LABEL #2052
;	CASE 11
;
LD= @VM1 #11
NCJ #2054
;'OUT2 測定0.001mm設定
;
;		@DM100.T = "SW,OG,2,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OG,2,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2055
LABEL #2054
;	CASE 12
;
LD= @VM1 #12
NCJ #2056
;'ｻﾝﾌﾟﾘﾝｸﾞ周期100μs設定
;
;		@DM100.T = "SW,CA,2"
;
LD CR2002                ; 常時ON
SMOV "SW,CA,2" @DM100    ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2057
LABEL #2056
;	CASE 13
;
LD= @VM1 #13
NCJ #2058
;'ﾃﾞｰﾀｽﾄﾚｰｼﾞ設定
;
;		@DM100.T = "SW,CI,3,65536,4"
;
LD CR2002                ; 常時ON
SMOV "SW,CI,3,65536,4" @DM100;送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2059
LABEL #2058
;	CASE 14
;
LD= @VM1 #14
NCJ #2060
;'通常ﾓｰﾄﾞ移行
;
;		@DM100.T = "R0"
;
LD CR2002                ; 常時ON
SMOV "R0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2061
LABEL #2060
;	CASE ELSE
;
;		'ｺﾏﾝﾄﾞ列終了SET
;
;		SET (@R104)
;
LD CR2002                ; 常時ON
SET @R104                ; ｺﾏﾝﾄﾞ列終了
;END SELECT
;
LABEL #2061
LABEL #2059
LABEL #2057
LABEL #2055
LABEL #2053
LABEL #2051
LABEL #2049
LABEL #2047
LABEL #2045
LABEL #2043
LABEL #2041
LABEL #2039
LABEL #2037
LABEL #2035
LABEL #2033
;	'ｺﾏﾝﾄﾞ確定SET
;
;	SET (@R103)
;
LD CR2002                ; 常時ON
SET @R103                ; ｺﾏﾝﾄﾞ確定
LABEL #1001
;
;'Prg No.2 初期設定ｺﾏﾝﾄﾞを送信
;
;SELECT CASE @DM12
;	CASE 0
;'通常ﾓｰﾄﾞ移行
;		@DM100.T = "R0"
;	CASE 1
;'ﾌﾟﾛｸﾞﾗﾑ切替
;		@DM100.T = "PW,2"
;	CASE 2
;'通信ﾓｰﾄﾞ移行
;		@DM100.T = "Q0"	
;	CASE 3
;'OUT1演算方法指定
;		@DM100.T = "SW,OA,1,1,0"		
;	CASE 4
;'OUT2演算方法指定
;		@DM100.T = "SW,OA,2,1,0"	
;	CASE 5
;'ﾍｯﾄﾞBｱﾗｰﾑ処理999設定
;		@DM100.T = "SW,HC,N,2,999"
;	CASE 6
;'OUT1 ﾄﾘｶﾞﾓｰﾄﾞ2
;		@DM100.T = "SW,OE,M,1,1"
;	CASE 7
;'OUT2 ﾄﾘｶﾞﾓｰﾄﾞ2
;		@DM100.T = "SW,OE,M,2,1"
;	CASE 8
;		'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;		'		@DM100.T = "SW,OD,1,3"
;'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;		@DM100.T = "SW,OD,1,1"
;	CASE 9
;'OUT2 測定ﾓｰﾄﾞ ﾉｰﾏﾙ
;		@DM100.T = "SW,OD,2,0"
;	CASE 10
;'OUT1 測定0.001mm設定
;		@DM100.T = "SW,OG,1,1"
;	CASE 11
;'OUT2 測定0.001mm設定
;		@DM100.T = "SW,OG,2,1"
;	CASE 12
;'ｻﾝﾌﾟﾘﾝｸﾞ周期100μs設定
;		@DM100.T = "SW,CA,2"
;	CASE 13
;'ﾃﾞｰﾀｽﾄﾚｰｼﾞ設定
;		@DM100.T = "SW,CI,3,65536,4"
;	CASE 14
;'通常ﾓｰﾄﾞ移行
;		@DM100.T = "R0"
;	CASE 15
;'ﾊﾟﾈﾙﾛｯｸ
;		@DM100.T = "KL,1"
;	CASE ELSE
;		'ｺﾏﾝﾄﾞ列終了SET
;		SET (@R104)
;END SELECT
;	'ｺﾏﾝﾄﾞ確定SET
;	SET (@R103)
;
LD @R106
AND= @DM11 #2            ; PrgNo
NCJ #1002
;'Prg No.2 初期設定ｺﾏﾝﾄﾞを送信
;
;SELECT CASE @DM12
;
LD CR2002                ; 常時ON
MOV @DM12 @VM2           ; 送信STEP
;	CASE 0
;
LD= @VM2 #0
NCJ #2062
;'通常ﾓｰﾄﾞ移行
;
;		@DM100.T = "R0"
;
LD CR2002                ; 常時ON
SMOV "R0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2063
LABEL #2062
;	CASE 1
;
LD= @VM2 #1
NCJ #2064
;'ﾌﾟﾛｸﾞﾗﾑ切替
;
;		@DM100.T = "PW,2"
;
LD CR2002                ; 常時ON
SMOV "PW,2" @DM100       ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2065
LABEL #2064
;	CASE 2
;
LD= @VM2 #2
NCJ #2066
;'通信ﾓｰﾄﾞ移行
;
;		@DM100.T = "Q0"	
;
LD CR2002                ; 常時ON
SMOV "Q0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2067
LABEL #2066
;	CASE 3
;
LD= @VM2 #3
NCJ #2068
;'OUT1演算方法指定
;
;		@DM100.T = "SW,OA,1,1,0"		
;
LD CR2002                ; 常時ON
SMOV "SW,OA,1,1,0" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2069
LABEL #2068
;	CASE 4
;
LD= @VM2 #4
NCJ #2070
;'OUT2演算方法指定
;
;		@DM100.T = "SW,OA,2,1,0"	
;
LD CR2002                ; 常時ON
SMOV "SW,OA,2,1,0" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2071
LABEL #2070
;	CASE 5
;
LD= @VM2 #5
NCJ #2072
;'ﾍｯﾄﾞBｱﾗｰﾑ処理999設定
;
;		@DM100.T = "SW,HC,N,2,999"
;
LD CR2002                ; 常時ON
SMOV "SW,HC,N,2,999" @DM100;送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2073
LABEL #2072
;	CASE 6
;
LD= @VM2 #6
NCJ #2074
;'OUT1 ﾄﾘｶﾞﾓｰﾄﾞ2
;
;		@DM100.T = "SW,OE,M,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OE,M,1,1" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2075
LABEL #2074
;	CASE 7
;
LD= @VM2 #7
NCJ #2076
;'OUT2 ﾄﾘｶﾞﾓｰﾄﾞ2
;
;		@DM100.T = "SW,OE,M,2,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OE,M,2,1" @DM100; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2077
LABEL #2076
;	CASE 8
;
LD= @VM2 #8
NCJ #2078
;		'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸtoﾋﾟｰｸ
;
;		'		@DM100.T = "SW,OD,1,3"
;
;'OUT1 測定ﾓｰﾄﾞ ﾋﾟｰｸﾎｰﾙﾄﾞ
;
;		@DM100.T = "SW,OD,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OD,1,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2079
LABEL #2078
;	CASE 9
;
LD= @VM2 #9
NCJ #2080
;'OUT2 測定ﾓｰﾄﾞ ﾉｰﾏﾙ
;
;		@DM100.T = "SW,OD,2,0"
;
LD CR2002                ; 常時ON
SMOV "SW,OD,2,0" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2081
LABEL #2080
;	CASE 10
;
LD= @VM2 #10
NCJ #2082
;'OUT1 測定0.001mm設定
;
;		@DM100.T = "SW,OG,1,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OG,1,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2083
LABEL #2082
;	CASE 11
;
LD= @VM2 #11
NCJ #2084
;'OUT2 測定0.001mm設定
;
;		@DM100.T = "SW,OG,2,1"
;
LD CR2002                ; 常時ON
SMOV "SW,OG,2,1" @DM100  ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2085
LABEL #2084
;	CASE 12
;
LD= @VM2 #12
NCJ #2086
;'ｻﾝﾌﾟﾘﾝｸﾞ周期100μs設定
;
;		@DM100.T = "SW,CA,2"
;
LD CR2002                ; 常時ON
SMOV "SW,CA,2" @DM100    ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2087
LABEL #2086
;	CASE 13
;
LD= @VM2 #13
NCJ #2088
;'ﾃﾞｰﾀｽﾄﾚｰｼﾞ設定
;
;		@DM100.T = "SW,CI,3,65536,4"
;
LD CR2002                ; 常時ON
SMOV "SW,CI,3,65536,4" @DM100;送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2089
LABEL #2088
;	CASE 14
;
LD= @VM2 #14
NCJ #2090
;'通常ﾓｰﾄﾞ移行
;
;		@DM100.T = "R0"
;
LD CR2002                ; 常時ON
SMOV "R0" @DM100         ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2091
LABEL #2090
;	CASE 15
;
LD= @VM2 #15
NCJ #2092
;'ﾊﾟﾈﾙﾛｯｸ
;
;		@DM100.T = "KL,1"
;
LD CR2002                ; 常時ON
SMOV "KL,1" @DM100       ; 送信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
CJ #2093
LABEL #2092
;	CASE ELSE
;
;		'ｺﾏﾝﾄﾞ列終了SET
;
;		SET (@R104)
;
LD CR2002                ; 常時ON
SET @R104                ; ｺﾏﾝﾄﾞ列終了
;END SELECT
;
LABEL #2093
LABEL #2091
LABEL #2089
LABEL #2087
LABEL #2085
LABEL #2083
LABEL #2081
LABEL #2079
LABEL #2077
LABEL #2075
LABEL #2073
LABEL #2071
LABEL #2069
LABEL #2067
LABEL #2065
LABEL #2063
;	'ｺﾏﾝﾄﾞ確定SET
;
;	SET (@R103)
;
LD CR2002                ; 常時ON
SET @R103                ; ｺﾏﾝﾄﾞ確定
LABEL #1002
;
STG @R106
MPS
AND @R103                ; ｺﾏﾝﾄﾞ確定
RES @R103                ; ｺﾏﾝﾄﾞ確定
CON
JMP @R107
MPP
AND> @DM11 #2            ; PrgNo
JMP @R109
STG @R107
MPS
LDB @R104                ; ｺﾏﾝﾄﾞ列終了
ANB @R502                ; 通信中
ANL
SET @R500                ; SERIAL_COM START
CON
JMP @R108
MPP
AND @R104                ; ｺﾏﾝﾄﾞ列終了
@INC @DM11               ; PrgNo
CON
DW #0 @DM12              ; 送信STEP
CON
JMP @R105
STG @R108
AND @R501                ; COM_Finish
MPS
ANB @R503                ; COM_Err
RES @R501                ; COM_Finish
CON
@INC @DM12               ; 送信STEP
CON
JMP @R105
MPP
AND @R503                ; COM_Err
RES @R501                ; COM_Finish
CON
JMP @R109
STG @R109
SET R37003               ; LK-G通信異常
CON
RES @R503                ; COM_Err
CON
JMP @R110
STG @R110
SET R37001               ; LK-G通信完了
CON
DW #0 @DM11              ; PrgNo
CON
DW #0 @DM12              ; 送信STEP
CON
JMP @R205                ; 終了
;<h1/>汎用通信
STG @R200                ; 汎用通信
ANB @R502                ; 通信中
SET @R500                ; SERIAL_COM START
CON
JMP @R201
STG @R201
AND @R501                ; COM_Finish
MPS
ANB @R503                ; COM_Err
RES @R501                ; COM_Finish
CON
JMP @R205                ; 終了
MPP
AND @R503                ; COM_Err
RES @R501                ; COM_Finish
CON
JMP @R202
STG @R202
SET R37003               ; LK-G通信異常
CON
RES @R503                ; COM_Err
CON
JMP @R205                ; 終了
STG @R205                ; 終了
SET R37001               ; LK-G通信完了
CON
RES R37002               ; LK-G通信中
CON
ENDS
;<h1/>SERIAL通信START
;'SERIAL_COM ﾏｸﾛ使用する為に以下の設定を行う
;@DM0 = $0000	'ﾃﾞｰﾀ格納単位設定
;@DM1 = $0001	'ﾓｰﾄﾞ設定
;@DM2 = #10		'ﾀｲﾑｱｳﾄﾁｪｯｸ時間設定
;@DM3 = $0000	'送信用ﾍｯﾀﾞ設定
;@DM4 = $0D00	'送信用ﾃﾞﾘﾐﾀ設定
;@DM5 = $0000	'受信用ﾍｯﾀﾞ設定
;@DM6 = $0D00	'受信用ﾃﾞﾘﾐﾀ設定
LD CR2002                ; 常時ON
NCJ #1003
;'SERIAL_COM ﾏｸﾛ使用する為に以下の設定を行う
;
;@DM0 = $0000	'ﾃﾞｰﾀ格納単位設定
;
LD CR2002                ; 常時ON
MOV $0000 @DM0           ; 格納単位
;@DM1 = $0001	'ﾓｰﾄﾞ設定
;
LD CR2002                ; 常時ON
MOV $0001 @DM1           ; ﾓｰﾄﾞ設定
;@DM2 = #10		'ﾀｲﾑｱｳﾄﾁｪｯｸ時間設定
;
LD CR2002                ; 常時ON
MOV #10 @DM2             ; ﾀｲﾑｱｳﾄ設定
;@DM3 = $0000	'送信用ﾍｯﾀﾞ設定
;
LD CR2002                ; 常時ON
MOV $0000 @DM3           ; 送信ﾍｯﾀﾞ
;@DM4 = $0D00	'送信用ﾃﾞﾘﾐﾀ設定
;
LD CR2002                ; 常時ON
MOV $0D00 @DM4           ; 送信ﾃﾞﾘﾐﾀ
;@DM5 = $0000	'受信用ﾍｯﾀﾞ設定
;
LD CR2002                ; 常時ON
MOV $0000 @DM5           ; 受信ﾍｯﾀﾞ
;@DM6 = $0D00	'受信用ﾃﾞﾘﾐﾀ設定
LD CR2002                ; 常時ON
MOV $0D00 @DM6           ; 送信ﾃﾞﾘﾐﾀ
LABEL #1003
;
STG @R500                ; SERIAL_COM START
SET @R502                ; 通信中
CON
DW #0 @DM10              ; 結果ｺｰﾄﾞ
CON
JMP @R504
STG @R504
MSTRT SERIAL_COM R24000 DM54000 @DM0 @DM100 @DM150 @DM10;軸1 軸ｴﾗｰｸﾘｱ  ﾕﾆｯﾄｴﾗｰ番号  格納単位  送信ﾃﾞｰﾀ先頭  受信ﾃﾞｰﾀ先頭  結果ｺｰﾄﾞ
MPS
AND= @DM10 #20           ; 結果ｺｰﾄﾞ
JMP @R505
MPP
LD<> @DM10 #20           ; 結果ｺｰﾄﾞ
AND<> @DM10 #0           ; 結果ｺｰﾄﾞ
ANL
SET @R503                ; COM_Err
CON
JMP @R515                ; 通信終了処理
;測定ﾃﾞｰﾀ保管処理分岐
STG @R505
MPS
LD> #16 @DM50            ; 通信ｺｰﾄﾞ
OR< #18 @DM50            ; 通信ｺｰﾄﾞ
ANL
JMP @R515                ; 通信終了処理
MPP
LD<= #16 @DM50           ; 通信ｺｰﾄﾞ
AND>= #18 @DM50          ; 通信ｺｰﾄﾞ
ANL
RES @R511                ; 変換完了
CON
JMP @R510                ; ﾃﾞｰﾀ変換
;結果ﾃﾞｰﾀ格納
;'文字列数値変換
;@DM20.F = VAL (SMID (@DM150.T,3,8))
;@DM22.F = VAL (SMID (@DM150.T,12,8))
;SET (@R511)
LD @R510                 ; ﾃﾞｰﾀ変換
NCJ #1004
;'文字列数値変換
;
;@DM20.F = VAL (SMID (@DM150.T,3,8))
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM3
LD CR2002                ; 常時ON
SMID @DM150 *@VM3 #3 #8  ; 受信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
MOV.F +0 @VM5
RFASC *@VM3 @VM5
LD CR2002                ; 常時ON
MOV.F @VM5 @DM20         ; 測定値1一時保管
;@DM22.F = VAL (SMID (@DM150.T,12,8))
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM7
LD CR2002                ; 常時ON
SMID @DM150 *@VM7 #12 #8 ; 受信ﾃﾞｰﾀ先頭
LD CR2002                ; 常時ON
MOV.F +0 @VM9
RFASC *@VM7 @VM9
LD CR2002                ; 常時ON
MOV.F @VM9 @DM22         ; 測定値2一時保管
;SET (@R511)
LD CR2002                ; 常時ON
SET @R511                ; 変換完了
LABEL #1004
;
STG @R510                ; ﾃﾞｰﾀ変換
AND @R511                ; 変換完了
LDA @DM13                ; 測定数
CON
MUL #2
CON
STA Z2
CON
JMP @R512
STG @R512
LDA.F @DM20              ; 測定値1一時保管
CON
STA.F EM2500:Z2          ; ﾚｰｻﾞｰ測定値1-1
CON
LDA.F @DM22              ; 測定値2一時保管
CON
STA.F EM2600:Z2          ; ﾚｰｻﾞｰ測定値2-1
CON
@INC @DM13               ; 測定数
CON
@INC @DM14               ; 測定ｶｳﾝﾄ2
CON
JMP @R513
;測定2個づつ
;2個目で演算
STG @R513
LD= #1 @DM14             ; 測定ｶｳﾝﾄ2
OR @R514                 ; 演算終了
ANL
RES @R514                ; 演算終了
CON
JMP @R515                ; 通信終了処理
;'演算値格納
;
;'data2 - data1を計算させる為
;@DM16 = (Z2)		'現在のｲﾝﾃﾞｯｸｽ修飾を反映し現在のﾃﾞｰﾀを呼出 (data2)
;@DM17 = @DM16 -2	'ｲﾝﾃﾞｯｸｽ修飾から-2(2ﾜｰﾄﾞ対策)して1つ前のﾃﾞｰﾀ呼出 (data1)
;
;'上記ｲﾝﾃﾞｯｸｽ修飾ををもとに、計算
;'格納個数の位置へ結果を格納する。(×2しているのは2ﾜｰﾄﾞ対策)
;DM5320.F:(@DM15*2) = EM2500.F:@DM16 - EM2500.F:@DM17
;
;DM5340.F:(@DM15*2) = EM2600.F:@DM16 - EM2600.F:@DM17
;
;INC (@DM15)		'格納個数をｶｳﾝﾄ
;@DM14 = 0		'次のｸﾞﾙｰﾌﾟの為に測定ｶｳﾝﾄ2をﾘｾｯﾄ
;
;SET (@R514)		'演算終了をSET
LDP @R513
AND= #2 @DM14            ; 測定ｶｳﾝﾄ2
NCJ #1005
;'演算値格納
;
;'data2 - data1を計算させる為
;
;@DM16 = (Z2)		'現在のｲﾝﾃﾞｯｸｽ修飾を反映し現在のﾃﾞｰﾀを呼出 (data2)
;
LD CR2002                ; 常時ON
MOV Z2 @DM16
;@DM17 = @DM16 -2	'ｲﾝﾃﾞｯｸｽ修飾から-2(2ﾜｰﾄﾞ対策)して1つ前のﾃﾞｰﾀ呼出 (data1)
;
LD CR2002                ; 常時ON
LDA @DM16
CON
EXT
CON
SUB.L +2
CON
STA @DM17
;'上記ｲﾝﾃﾞｯｸｽ修飾ををもとに、計算
;
;'格納個数の位置へ結果を格納する。(×2しているのは2ﾜｰﾄﾞ対策)
;
;DM5320.F:(@DM15*2) = EM2500.F:@DM16 - EM2500.F:@DM17
;
LD CR2002                ; 常時ON
LDA @DM15                ; 結果格納数
CON
EXT
CON
MUL.L +2
CON
STA.L Z11
CON
LDA @DM17
CON
EXT
CON
STA.L Z12
CON
ADRSET EM2500:Z12 @VM11  ; ﾚｰｻﾞｰ測定値1-1
LD CR2002                ; 常時ON
LDA @DM16
CON
EXT
CON
STA.L Z12
CON
LDA.F EM2500:Z12         ; ﾚｰｻﾞｰ測定値1-1
CON
SUB.F *@VM11
CON
STA.F DM5320:Z11         ; _ﾃﾞｰﾀ収集　Fﾃﾞｰﾀ2_1(ﾚｰｻﾞｰ左 NO1)
;DM5340.F:(@DM15*2) = EM2600.F:@DM16 - EM2600.F:@DM17
;
LD CR2002                ; 常時ON
LDA @DM15                ; 結果格納数
CON
EXT
CON
MUL.L +2
CON
STA.L Z11
CON
LDA @DM17
CON
EXT
CON
STA.L Z12
CON
ADRSET EM2600:Z12 @VM13  ; ﾚｰｻﾞｰ測定値2-1
LD CR2002                ; 常時ON
LDA @DM16
CON
EXT
CON
STA.L Z12
CON
LDA.F EM2600:Z12         ; ﾚｰｻﾞｰ測定値2-1
CON
SUB.F *@VM13
CON
STA.F DM5340:Z11         ; _ﾃﾞｰﾀ収集　Fﾃﾞｰﾀ3_1(ﾚｰｻﾞｰ右 NO1)
;INC (@DM15)		'格納個数をｶｳﾝﾄ
;
LD CR2002                ; 常時ON
INC @DM15                ; 結果格納数
;@DM14 = 0		'次のｸﾞﾙｰﾌﾟの為に測定ｶｳﾝﾄ2をﾘｾｯﾄ
;
LD CR2002                ; 常時ON
MOV #0 @DM14             ; 測定ｶｳﾝﾄ2
;SET (@R514)		'演算終了をSET
LD CR2002                ; 常時ON
SET @R514                ; 演算終了
LABEL #1005
;
STG @R515                ; 通信終了処理
TMS @0 #20               ; 通信間隔ﾀｲﾏ
CON
AND @T0                  ; 通信間隔ﾀｲﾏ
SET @R501                ; COM_Finish
CON
RES @R502                ; 通信中
CON
ENDS
END
ENDH
