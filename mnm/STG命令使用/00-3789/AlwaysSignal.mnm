DEVICE:53
;MODULE:AlwaysSignal
;MODULE_TYPE:0
;OneSystem Sub-Module
;
;---------------------------------------
;ModuleName	:	Always_Signal
;ModuleType	:	Sub Module
;Function	:	条件生成
;---------------------------------------
;<使用方法>
;ﾌﾟﾛｼﾞｪｸﾄ全体に関わる条件ｼｸﾞﾅﾙ生成は本ﾓｼﾞｭｰﾙに記述して下さい
;・ﾓｰｼｮﾝｺﾝﾄﾛｰﾙ動作許可
;・ｺﾐｭﾆｹｰｼｮﾝﾕﾆｯﾄ通信許可
;・ﾋｰﾀｰ電源ON
;など
;TPｶﾚﾝﾀﾞﾀｲﾏ自動同期
LD= CM703 #8             ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
AND= CM704 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
AND= CM705 #0            ; ｶﾚﾝﾀﾞﾀｲﾏ（秒）
SET @R010
STG @R010
MPS
LDA CM700                ; ｶﾚﾝﾀﾞﾀｲﾏ（年）
CON
ADD #32768
CON
TBCD
CON
STA DM3010               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM701                ; ｶﾚﾝﾀﾞﾀｲﾏ（月）
CON
TBCD
CON
STA DM3011               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM702                ; ｶﾚﾝﾀﾞﾀｲﾏ（日）
CON
TBCD
CON
STA DM3012               ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MRD
LDA CM703                ; ｶﾚﾝﾀﾞﾀｲﾏ（時）
CON
TBCD
CON
STA @DM21
MRD
LDA CM704                ; ｶﾚﾝﾀﾞﾀｲﾏ（分）
CON
TBCD
CON
STA @DM20
MRD
UNIB @DM20 DM3013 #2     ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
MPP
JMP @R011
STG @R011
TMH @1 #5
CON
AND @T1
BRES DM3010 #15          ; _MainTP　ｶﾚﾝﾀﾞﾀｲﾏ（設定値）
CON
ENDS
;TP表示用
LD= #0 DM5020            ; _生産ｶｳﾝﾀ1
MEP
ZRES DM13000 DM13119     ; 画像検査 IN総数
CON
ZRES DM13200 DM13269     ; 高さ検査 IN総数
LD CR2002                ; 常時ON
MPS
LDA.D DM13100            ; 画像検査左 IN数
CON
ADD.D DM13110            ; 画像検査右 IN数
CON
STA.D DM13000            ; 画像検査 IN総数
MRD
LDA.D DM13102            ; 画像検査左 OK総数
CON
ADD.D DM13112            ; 画像検査右 OK総数
CON
STA.D DM13002            ; 画像検査 OK総数
MRD
LDA.D DM13104            ; 画像検査左 NG総数
CON
ADD.D DM13114            ; 画像検査右 NG総数
CON
STA.D DM13004            ; 画像検査 NG総数
MRD
LDA.D DM13250            ; 高さ検査左 IN数
CON
ADD.D DM13260            ; 高さ検査右 IN数
CON
STA.D DM13200            ; 高さ検査 IN総数
MRD
LDA.D DM13252            ; 高さ検査左 OK総数
CON
ADD.D DM13262            ; 高さ検査右 OK総数
CON
STA.D DM13202            ; 高さ検査 OK総数
MPP
LDA.D DM13254            ; 高さ検査左 NG総数
CON
ADD.D DM13264            ; 高さ検査右 NG総数
CON
STA.D DM13204            ; 高さ検査 NG総数
LD CR2002                ; 常時ON
MOV.D DM13004 DM5034     ; 画像検査 NG総数  _生産ｶｳﾝﾀ8
;除材数表示
LD= #0 DM5022            ; _生産ｶｳﾝﾀ2
MEP
ZRES DM13300 DM13303     ; 除材数ｶｳﾝﾄ
LD CR2002                ; 常時ON
MPS
LDA.D DM13300            ; 除材数ｶｳﾝﾄ
CON
SUB.D DM13004            ; 画像検査 NG総数
CON
STA.D DM13302            ; 除材総数
MPP
MOV.D DM13302 DM5022     ; 除材総数  _生産ｶｳﾝﾀ2
;塗布機警告
LD R20107                ; 塗布1TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DISP #1 #41 #2 #1
LDB R20107               ; 塗布1TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DEL #1 #41
LD R20407                ; 塗布2TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DISP #1 #42 #2 #1
LDB R20407               ; 塗布2TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DEL #1 #42
LD R20707                ; 塗布3TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DISP #1 #43 #2 #1
LDB R20707               ; 塗布3TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DEL #1 #43
LD R21007                ; 塗布4TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DISP #1 #44 #2 #1
LDB R21007               ; 塗布4TP   ﾒﾝﾃﾌﾞｻﾞｰON
MSTRT WARNING_DEL #1 #44
;<h1/>機種切替
;1-1ｾﾙからの切替信号により機種No.をDM8640に代入し機種変更ﾌﾗｸﾞを立てる。
;No.1　=　BIJ-2
;No.3　=　DEPP
LD= W1000 #0             ; 1-1TCより機種切替要求
DW #0 W101A              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
LD= W1000 #1             ; 1-1TCより機種切替要求
AND= DM3008 #10          ; _MainTP　切替ﾍﾟｰｼﾞNo
AND R46103               ; _停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ANB R52210               ; 機種切替中
ANB MR100                ; 機種切替中
AND= W101A #0            ; 親ｾﾙへ切替完了ｺｰﾄﾞ
DW #1 W101A              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
SET MR100                ; 機種切替中
STG MR100                ; 機種切替中
MPS
AND= DM5260 W1001        ; 選択中ｺｰﾄﾞ  要求機種No
JMP MR101
MPP
AND<> DM5260 W1001       ; 選択中ｺｰﾄﾞ  要求機種No
MPS
AND= W1001 #1            ; 要求機種No
DW #0 DM9033             ; _機種変更種類
CON
DW #1 DM8641             ; _TP機種切替実行分類番号
CON
DW #1 DM8640             ; _TP選択中機種ｺｰﾄﾞ
CON
SET R54807               ; _機種切替要求(From TP)
CON
SET R52210               ; 機種切替中
CON
JMP MR101
MPP
AND= W1001 #3            ; 要求機種No
DW #0 DM9033             ; _機種変更種類
CON
DW #1 DM8641             ; _TP機種切替実行分類番号
CON
DW #3 DM8640             ; _TP選択中機種ｺｰﾄﾞ
CON
SET R54807               ; _機種切替要求(From TP)
CON
SET R52210               ; 機種切替中
CON
JMP MR101
STG MR101
ANB R52210               ; 機種切替中
MPS
AND= DM5260 W1001        ; 選択中ｺｰﾄﾞ  要求機種No
DW #2 W101A              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
ENDS
MPP
AND<> DM5260 W1001       ; 選択中ｺｰﾄﾞ  要求機種No
DW #3 W101A              ; 親ｾﾙへ切替完了ｺｰﾄﾞ
CON
ENDS
LD CR2002                ; 常時ON
MOV DM5260 W101B         ; 選択中ｺｰﾄﾞ  親ｾﾙへ完了機種No.
;　　SEﾃﾞﾊﾞｯｸflgON　(BIJ2_3-1のﾊﾞｯｸｱｯﾌﾟﾃﾞｰﾀをもらった。ONで使用しているようだが、ﾒﾓﾘｸﾘｱ等されると復旧出来ないため
;　　outを追加した)
LD CR2002                ; 常時ON
OUT LR005                ; SEﾃﾞﾊﾞｯｸﾞ
END
ENDH
