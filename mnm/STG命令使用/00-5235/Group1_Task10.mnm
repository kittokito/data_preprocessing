DEVICE:53
;MODULE:Group1_Task10
;MODULE_TYPE:0
;SCRIPT_TYPE:
;OneSystem Main-Module
;
;-----------------------------------------
;ModuleName	:	Group1_Task10
;ModuleType	:	Main Module
;Line		:	
;Cell		:	
;Function	:	MAINTENANCE Cylinder動作、RBﾃｨｰﾁﾝｸﾞ動作専用
;-----------------------------------------
;<h1/>※MAINTENANCE Cylinder動作及びRBﾃｨｰﾁﾝｸﾞはTASK9を介して動作させます。
;<<Task LocalDevice>>
;/*項目			/*割付ｴﾘｱ				/*備考
;---------------------------------------------------------------------			
;Emergency		@MR000〜@MR015			Emergency処理時RESET禁止ｴﾘｱ
;Free			@MR100〜@MR915			ﾕｰｻﾞｰﾌﾘｰｴﾘｱ
;HOME			@なし
;MAINTENANCE		@MR2000〜@MR2915		MAINTE動作時使用ｴﾘｱ
;AUTO(Main1)		なし
;	(Main2)		なし
;SubRoutine		なし
;----------------------------------------------------------------------
;<h1/>Device_Init/ﾃﾞﾊﾞｲｽ初期化
;[内容]
;・非常停止、優先ｴﾗｰ発生時に初期化したいﾃﾞﾊﾞｲｽを指定して下さい
;※本Taskで使用するﾛｰｶﾙﾃﾞﾊﾞｲｽなど
;※STG〜JMPにて使用しているﾃﾞﾊﾞｲｽは必須
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ZRES @MR100 @MR2915      ; Task10 ERROR  Mainte END
LD= DM60000 MyTask       ; TaskNo /ERROR_DISP  自ﾀｽｸ番号
AND R46208               ; _Group1　ｴﾗｰ発生中
OUT @MR001               ; TASK10　ERROR
;<h1/>Task_Monitor/ﾀｽｸﾓﾆﾀｰ
LD CR2002                ; 常時ON
FLIK #50 #50 @MR000
;<h1/>RB PLS列タイプ検出
;TYPE @DM10.U,DM50312.U
;
;IF DM50312<> @DM10 THEN 'RB番号変更時  PLS列RBﾌﾗｸﾞｸﾘｱ
;	RES(R39007)
;END IF
;@DM10=DM50312			'RB選択番号格納
;
;
;IF RB_TYPE[0,DM50312] = 6 OR RB_TYPE[0,DM50312] = 7  THEN  '選択されたRBがPLS列TYPEか確認 6 OR 7 はMC
;		SET(R39007)                						   'PLS列TYPEの場合 ﾌﾗｸﾞON
;END IF
;TYPE @DM10.U,DM50312.U
;
;IF DM50312<> @DM10 THEN 'RB番号変更時  PLS列RBﾌﾗｸﾞｸﾘｱ
;
LD<> DM50312 @DM10       ; RB選択
NCJ #2000
;	RES(R39007)
;
LD CR2002                ; 常時ON
RES R39007               ; PLS列TYPE
;END IF
;
LABEL #2000
;@DM10=DM50312			'RB選択番号格納
;
LD CR2002                ; 常時ON
MOV DM50312 @DM10        ; RB選択
;IF RB_TYPE[0,DM50312] = 6 OR RB_TYPE[0,DM50312] = 7  THEN  '選択されたRBがPLS列TYPEか確認 6 OR 7 はMC
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
ADD.L +0
CON
STA.L Z12
LD= W3A25:Z12 #6         ; RB1 TYPE
OUT @VB00
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
ADD.L +0
CON
STA.L Z12
LD= W3A25:Z12 #7         ; RB1 TYPE
OR @VB00
NCJ #2001
;		SET(R39007)                						   'PLS列TYPEの場合 ﾌﾗｸﾞON
;
LD CR2002                ; 常時ON
SET R39007               ; PLS列TYPE
;END IF
LABEL #2001
;
;<h1/>MC AXIS No.割出
;IF RB_TYPE[2,DM50312]<> 0 THEN
;		@DM14.T =STR(RB_TYPE[2,DM50312]) 'MC AxisNo.割出
;		DISB(@DM14,@DM16,2) 
;		BSWAP(@D16,2)             '桁分割
;		Axis_No= RDASC(@DM16.T)		     'AXIS No.格納
;		Unit_No= RDASC(@DM17.T)			 'UNIT No.格納
;END IF
;IF RB_TYPE[2,DM50312]<> 0 THEN
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
ADD.L +64
CON
STA.L Z12
LD<> W3A25:Z12 #0        ; RB1 TYPE
NCJ #2002
;		@DM14.T =STR(RB_TYPE[2,DM50312]) 'MC AxisNo.割出
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
ADD.L +64
CON
STA.L Z12
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM1
LD CR2002                ; 常時ON
MOV CR2800 @VM0          ; ﾌﾞﾚｰｸ信号送出
SET CR2814               ; ASCII変換ｾﾞﾛｻﾌﾟﾚｽ設定
SET CR2815               ; ASCII変換+符号省略
DASC W3A25:Z12 *@VM1     ; RB1 TYPE
MOV @VM0 CR2800          ; ﾌﾞﾚｰｸ信号送出
LD CR2002                ; 常時ON
SMOV *@VM1 @DM14
;		DISB(@DM14,@DM16,2) 
;
LD CR2002                ; 常時ON
DISB @DM14 @DM16 #2
;		BSWAP(@D16,2)             '桁分割
;
LD CR2002                ; 常時ON
BSWAP @DM16 #2
;		Axis_No= RDASC(@DM16.T)		     'AXIS No.格納
;
;;Warning[1103]: "=": (符号付き32ビット整数型->符号無し16ビット整数型) 代入によりデータが欠落する可能性があります。
LD CR2002                ; 常時ON
MOV.L +0 @VM3
RDASC.L @DM16 @VM3
LD CR2002                ; 常時ON
MOV @VM3 W3A22           ; Axis No.
;		Unit_No= RDASC(@DM17.T)			 'UNIT No.格納
;
;;Warning[1103]: "=": (符号付き32ビット整数型->符号無し16ビット整数型) 代入によりデータが欠落する可能性があります。
LD CR2002                ; 常時ON
MOV.L +0 @VM5
RDASC.L @DM17 @VM5
LD CR2002                ; 常時ON
MOV @VM5 W3A23           ; Unit No.
;END IF
LABEL #2002
;
;<h1/>Task_Init/ﾀｽｸ初期化
;[本STG内容]
;・本Task起動時に必要な初期化処理を記述して下さい
;・起動Taskの全Init処理終了後、Task_StartのSTGが起動します
STG LR810                ; _Grp1_Task10_Init.STG
ENDS
;<h1/>Task_Start/ﾀｽｸ開始
;[本STG内容]
;・Task起動後、以下運転ﾓｰﾄﾞに従い、各STGにJMPします
;【HOME】	→	LR5200
;【AUTO】	→	LR5400
;【MAINTE】	→	LR5600
;・本STGは追記、修正不要です
STG LR410                ; _Grp1_Task10_Start.STG
MPS
LD R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
ANL
JMP LR610                ; _Grp1_Task10_Fin.STG
MPP
AND R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
JMP LR5610               ; _Grp1_Task10_MAINTE.STG
;<h1/>Task_Finish/ﾀｽｸ終了
;[本STG内容]
;・各Taskの終了STGになります
;・運転ﾓｰﾄﾞに係わらず終了時は本STGを経由して終了して下さい
;・本STGは追記、修正不要です
STG LR610                ; _Grp1_Task10_Fin.STG
MPS
LDB R41210               ; TASK10 PAUSE 要求
ANB @MR001               ; TASK10　ERROR
ANL
RES R42610               ; Grp1_Task10_ﾎﾟｰｽﾞ許可
CON
RES R41010               ; _Grp1_Task10_起動中ﾌﾗｸﾞ
CON
ENDS
MPP
AND R41210               ; TASK10 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/>MAINTE/ﾒﾝﾃﾅﾝｽ動作
;[本STG内容]
;・各TaskのMAINTE動作を記述して下さい
;・動作ﾓｰﾄﾞは「MAINTEAC*」に格納されています(1〜32)
;・動作終了時は@MR2915にJMPして下さい
STG LR5610               ; _Grp1_Task10_MAINTE.STG
JMP @MR2000              ; Mainte
STG @MR2000              ; Mainte
SET @MR2002              ; ﾒﾝﾃ中
CON
JMP @MR2003
STG @MR2003
MPS
AND= DM4110 #25          ; _Group1　ﾒﾝﾃ動作番号
@DW #2010 DM3008         ; _MainTP　切替ﾍﾟｰｼﾞNo
CON
JMP @MR2400              ; ｼﾘﾝﾀﾞｰ手動操作
MRD
AND= DM4110 #26          ; _Group1　ﾒﾝﾃ動作番号
@DW #2150 DM3008         ; _MainTP　切替ﾍﾟｰｼﾞNo
CON
JMP @MR2100              ; RB ﾃｨｰﾁﾝｸﾞ
MPP
LD<> DM4110 #25          ; _Group1　ﾒﾝﾃ動作番号
AND<> DM4110 #26         ; _Group1　ﾒﾝﾃ動作番号
OR R47800                ; _Group1　ﾒﾝﾃ動作定停止移行中
ANL
JMP @MR2915              ; Mainte END
;<h1/>ﾒﾝﾃ Cylinder動作
STG @MR2400              ; ｼﾘﾝﾀﾞｰ手動操作
MPS
ANB R41210               ; TASK10 PAUSE 要求
OUT @MR2402              ; ｼﾘﾝﾀﾞｰ 手動操作中
CON
AND @MR1902              ; 終了確認
JMP @MR2914
MRD
AND R41210               ; TASK10 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
MPP
ANP MR22000              ; Cylinder動作終了
SET @MR1902              ; 終了確認
LD @MR2400               ; ｼﾘﾝﾀﾞｰ手動操作
OR @MR2102               ; ﾃｨｰﾁﾝｸﾞ中
ANB R41210               ; TASK10 PAUSE 要求
ANB R39900               ; RB動作中
MC
;SW1
LDP MR22100              ; SW1-1
ANB DM11023.2
SET MR7200               ; 板押圧ﾄﾚｲ押え 下降
CON
RES MR7201               ; (板押圧ﾄﾚｲ押え 上昇)
LDP MR22101              ; SW1-2
RES MR7200               ; 板押圧ﾄﾚｲ押え 下降
CON
SET MR7201               ; (板押圧ﾄﾚｲ押え 上昇)
;SW2
LDP MR22102              ; SW2-1
ANB DM11055.2
LD>.L DM11048 +25000     ; RB7 現在位置
LD<=.L DM11048 +25000    ; RB7 現在位置
ANB DM11023.2
ORL
ANL
SET MR7306               ; 板押圧吸着下降
CON
RES MR7307               ; 板押圧吸着上昇
LDP MR22103              ; SW2-2
RES MR7306               ; 板押圧吸着下降
CON
SET MR7307               ; 板押圧吸着上昇
;SW3
LDP MR22104              ; SW3-1
RES MR7605               ; 板押圧吸着ﾊﾟｯﾄﾞ真空破壊ON
CON
ALT MR7603               ; 板押圧吸着ﾊﾟｯﾄﾞ吸着ON
CON
MPS
AND MR7603               ; 板押圧吸着ﾊﾟｯﾄﾞ吸着ON
RES MR7604               ; 板押圧吸着ﾊﾟｯﾄﾞ吸着OFF
MPP
ANB MR7603               ; 板押圧吸着ﾊﾟｯﾄﾞ吸着ON
SET MR7604               ; 板押圧吸着ﾊﾟｯﾄﾞ吸着OFF
LDP MR22105              ; SW3-2
RES MR7603               ; 板押圧吸着ﾊﾟｯﾄﾞ吸着ON
CON
SET MR7604               ; 板押圧吸着ﾊﾟｯﾄﾞ吸着OFF
CON
SET MR7605               ; 板押圧吸着ﾊﾟｯﾄﾞ真空破壊ON
;SW4
LDP MR22106              ; SW4-1
RES MR7608               ; 溶着台_板押圧有無真空破壊ON
CON
ALT MR7606               ; 溶着台_板押圧有無吸着ON
CON
MPS
AND MR7606               ; 溶着台_板押圧有無吸着ON
RES MR7607               ; 溶着台_板押圧有無吸着OFF
MPP
ANB MR7606               ; 溶着台_板押圧有無吸着ON
SET MR7607               ; 溶着台_板押圧有無吸着OFF
LDP MR22107              ; SW4-2
RES MR7606               ; 溶着台_板押圧有無吸着ON
CON
SET MR7607               ; 溶着台_板押圧有無吸着OFF
CON
SET MR7608               ; 溶着台_板押圧有無真空破壊ON
;SW5
LDP MR22108              ; SW5-1
SET MR7414               ; 板押圧ﾁｬｯｸ閉
CON
RES MR7415               ; 板押圧ﾁｬｯｸ開
LDP MR22109              ; SW5-2
RES MR7414               ; 板押圧ﾁｬｯｸ閉
CON
SET MR7415               ; 板押圧ﾁｬｯｸ開
;SW6
LDP MR22110              ; SW6-1
RES MR7614               ; 板押圧ｾｯﾄ真空破壊ON
CON
ALT MR7612               ; 板押圧ｾｯﾄ吸着ON
CON
MPS
AND MR7612               ; 板押圧ｾｯﾄ吸着ON
RES MR7613               ; 板押圧ｾｯﾄ吸着OFF
MPP
ANB MR7612               ; 板押圧ｾｯﾄ吸着ON
SET MR7613               ; 板押圧ｾｯﾄ吸着OFF
LDP MR22111              ; SW6-2
RES MR7612               ; 板押圧ｾｯﾄ吸着ON
CON
SET MR7613               ; 板押圧ｾｯﾄ吸着OFF
CON
SET MR7614               ; 板押圧ｾｯﾄ真空破壊ON
;SW7
LDP MR22112              ; SW7-1
LDB R4104                ; 板押圧溶着台 溶着側
AND R4105                ; 板押圧溶着台 受取側
LD>=.L DM11040 +500      ; RB6 現在位置
LDB R4206                ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ下降端
AND R4207                ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ上昇端
ORL
LD>=.L DM11000 +13500    ; RB1 現在位置下位
AND<=.L DM11000 +24500   ; RB1 現在位置下位
ANB R4200                ; ﾌｨﾙﾑ搬送 親 下降端
AND R4201                ; ﾌｨﾙﾑ搬送 親 上昇端
ANB R4202                ; ﾌｨﾙﾑ搬送 子 下降端
AND R4203                ; ﾌｨﾙﾑ搬送 子 上昇端
ORL
OR<.L DM11000 +13500     ; RB1 現在位置下位
OR>.L DM11000 +24500     ; RB1 現在位置下位
LD>.L DM11048 +25000     ; RB7 現在位置
ANB R4212                ; 板押圧吸着下降端
AND R4213                ; 板押圧吸着上昇端
ORL
OR<=.L DM11048 +25000    ; RB7 現在位置
ANL
LD R4104                 ; 板押圧溶着台 溶着側
ANB R4105                ; 板押圧溶着台 受取側
ORL
ANL
SET MR7202               ; 板押圧溶着台_溶着側
CON
RES MR7203               ; 板押圧溶着台_受取側
LDP MR22113              ; SW7-2
LD R4104                 ; 板押圧溶着台 溶着側
ANB R4105                ; 板押圧溶着台 受取側
LD>=.L DM11040 +500      ; RB6 現在位置
LDB R4206                ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ下降端
AND R4207                ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ上昇端
ORL
LD>=.L DM11000 +13500    ; RB1 現在位置下位
AND<=.L DM11000 +24500   ; RB1 現在位置下位
ANB R4200                ; ﾌｨﾙﾑ搬送 親 下降端
AND R4201                ; ﾌｨﾙﾑ搬送 親 上昇端
ANB R4202                ; ﾌｨﾙﾑ搬送 子 下降端
AND R4203                ; ﾌｨﾙﾑ搬送 子 上昇端
ORL
OR<.L DM11000 +13500     ; RB1 現在位置下位
OR>.L DM11000 +24500     ; RB1 現在位置下位
LD>.L DM11048 +25000     ; RB7 現在位置
ANB R4212                ; 板押圧吸着下降端
AND R4213                ; 板押圧吸着上昇端
ORL
OR<=.L DM11048 +25000    ; RB7 現在位置
ANL
LDB R4104                ; 板押圧溶着台 溶着側
AND R4105                ; 板押圧溶着台 受取側
ORL
ANL
SET MR7203               ; 板押圧溶着台_受取側
CON
RES MR7202               ; 板押圧溶着台_溶着側
;SW8
LDP MR22114              ; SW8-1
SET MR7204               ; 板押圧溶着台上昇
CON
RES MR7205               ; 板押圧溶着台下降
LDP MR22115              ; SW8-2
RES MR7204               ; 板押圧溶着台上昇
CON
SET MR7205               ; 板押圧溶着台下降
;SW9
LDP MR22200              ; SW9-1
SET MR7214               ; 板押圧溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙOFF
CON
RES MR7215               ; (板押圧溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙON)
LDP MR22201              ; SW9-2
RES MR7214               ; 板押圧溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙOFF
CON
SET MR7215               ; (板押圧溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙON)
;SW10
LDP MR22202              ; SW10-1
SET MR7300               ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ下降
CON
RES MR7301               ; (板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ上昇)
LDP MR22203              ; SW10-2
RES MR7300               ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ下降
CON
SET MR7301               ; (板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ上昇)
;SW11
LDP MR22204              ; SW11-1
SET MR7000               ; ﾀﾞﾝｻｰﾛｰﾗｰ下降
CON
RES MR7001               ; (ﾀﾞﾝｻｰﾛｰﾗｰ上昇)
LDP MR22205              ; SW11-2
RES MR7000               ; ﾀﾞﾝｻｰﾛｰﾗｰ下降
CON
SET MR7001               ; (ﾀﾞﾝｻｰﾛｰﾗｰ上昇)
;SW12
LDP MR22206              ; SW12-1
LD R7002                 ; ﾌｨﾙﾑ押さえ前進
LDB R7002                ; ﾌｨﾙﾑ押さえ前進
ANB R4004                ; 切出し台連結ﾋﾟﾝ下降端
AND R4005                ; 切出し台連結ﾋﾟﾝ上昇端
ANB R4006                ; ﾌｨﾙﾑ押え下降端
AND R4007                ; ﾌｨﾙﾑ押え上昇端
LD<=.L DM11000 +6300     ; RB1 現在位置下位
OR>=.L DM11000 +12500    ; RB1 現在位置下位
ANL
ORL
ANL
ALT MR7002               ; ﾌｨﾙﾑ押さえ前進
CON
RES MR7003               ; ﾌｨﾙﾑ押さえ後退
LDP MR22207              ; SW12-2
LD R7003                 ; ﾌｨﾙﾑ押さえ後退
LDB R7003                ; ﾌｨﾙﾑ押さえ後退
ANB R4004                ; 切出し台連結ﾋﾟﾝ下降端
AND R4005                ; 切出し台連結ﾋﾟﾝ上昇端
ANB R4006                ; ﾌｨﾙﾑ押え下降端
AND R4007                ; ﾌｨﾙﾑ押え上昇端
ORL
ANL
RES MR7002               ; ﾌｨﾙﾑ押さえ前進
CON
ALT MR7003               ; ﾌｨﾙﾑ押さえ後退
;SW13
LDP MR22208              ; SW13-1
ANB R26404               ; 軸1 軸制御中
ANB R26500               ; 軸1 JOG中
SET MR7004               ; 切出し台連結ﾋﾟﾝ下降
CON
RES MR7005               ; 切出し台連結ﾋﾟﾝ上昇
LDP MR22209              ; SW13-2
RES MR7004               ; 切出し台連結ﾋﾟﾝ下降
CON
SET MR7005               ; 切出し台連結ﾋﾟﾝ上昇
;SW14
LDP MR22210              ; SW14-1
ANB R26404               ; 軸1 軸制御中
ANB R26500               ; 軸1 JOG中
SET MR7006               ; ﾌｨﾙﾑ押え下降
CON
RES MR7007               ; (ﾌｨﾙﾑ押え上昇)
LDP MR22211              ; SW14-2
RES MR7006               ; ﾌｨﾙﾑ押え下降
CON
SET MR7007               ; (ﾌｨﾙﾑ押え上昇)
;SW15
LDP MR22212              ; SW15-1
AND R4004                ; 切出し台連結ﾋﾟﾝ下降端
ANB R4005                ; 切出し台連結ﾋﾟﾝ上昇端
SET MR7008               ; ｶｯﾀｰ前後 前進
CON
RES MR7009               ; ｶｯﾀｰ前後 後退
LDP MR22213              ; SW15-2
AND R4004                ; 切出し台連結ﾋﾟﾝ下降端
ANB R4005                ; 切出し台連結ﾋﾟﾝ上昇端
RES MR7008               ; ｶｯﾀｰ前後 前進
CON
SET MR7009               ; ｶｯﾀｰ前後 後退
;SW16
LDP MR22214              ; SW16-1
LD<.L DM11000 +6300      ; RB1 現在位置下位
OR>.L DM11000 +13000     ; RB1 現在位置下位
ANL
ANB DM11007.2
SET MR7010               ; 切出し位置決めｾﾝｻ下降
CON
RES MR7011               ; (切出し位置決めｾﾝｻ上昇)
LDP MR22215              ; SW16-2
RES MR7010               ; 切出し位置決めｾﾝｻ下降
CON
SET MR7011               ; (切出し位置決めｾﾝｻ上昇)
;SW17
LDP MR22300              ; SW17-1
SET MR7012               ; ﾌｨﾙﾑｸﾗﾝﾌﾟ上昇
CON
RES MR7013               ; (ﾌｨﾙﾑｸﾗﾝﾌﾟ下降)
LDP MR22301              ; SW17-2
RES MR7012               ; ﾌｨﾙﾑｸﾗﾝﾌﾟ上昇
CON
SET MR7013               ; (ﾌｨﾙﾑｸﾗﾝﾌﾟ下降)
;SW18
LDP MR22302              ; SW18-1
RES MR7702               ; ﾌｨﾙﾑ通路真空破壊ON
CON
ALT MR7700               ; ﾌｨﾙﾑ通路吸着ON
CON
MPS
AND MR7700               ; ﾌｨﾙﾑ通路吸着ON
RES MR7701               ; ﾌｨﾙﾑ通路吸着OFF
MPP
ANB MR7700               ; ﾌｨﾙﾑ通路吸着ON
SET MR7701               ; ﾌｨﾙﾑ通路吸着OFF
LDP MR22303              ; SW18-2
RES MR7700               ; ﾌｨﾙﾑ通路吸着ON
CON
SET MR7701               ; ﾌｨﾙﾑ通路吸着OFF
CON
SET MR7702               ; ﾌｨﾙﾑ通路真空破壊ON
;SW19
LDP MR22304              ; SW19-1
RES MR7705               ; ﾌｨﾙﾑｶｯﾄ台真空破壊ON
CON
ALT MR7703               ; ﾌｨﾙﾑｶｯﾄ台吸着ON
CON
MPS
AND MR7703               ; ﾌｨﾙﾑｶｯﾄ台吸着ON
RES MR7704               ; ﾌｨﾙﾑｶｯﾄ台吸着OFF
MPP
ANB MR7703               ; ﾌｨﾙﾑｶｯﾄ台吸着ON
SET MR7704               ; ﾌｨﾙﾑｶｯﾄ台吸着OFF
LDP MR22305              ; SW19-2
RES MR7703               ; ﾌｨﾙﾑｶｯﾄ台吸着ON
CON
SET MR7704               ; ﾌｨﾙﾑｶｯﾄ台吸着OFF
CON
SET MR7705               ; ﾌｨﾙﾑｶｯﾄ台真空破壊ON
;SW20
LDP MR22306              ; SW20-1
RES MR7708               ; ﾌｨﾙﾑ押え真空破壊ON
CON
ALT MR7706               ; ﾌｨﾙﾑ押え吸着ON
CON
MPS
AND MR7706               ; ﾌｨﾙﾑ押え吸着ON
RES MR7707               ; ﾌｨﾙﾑ押え吸着OFF
MPP
ANB MR7706               ; ﾌｨﾙﾑ押え吸着ON
SET MR7707               ; ﾌｨﾙﾑ押え吸着OFF
LDP MR22307              ; SW20-2
RES MR7706               ; ﾌｨﾙﾑ押え吸着ON
CON
SET MR7707               ; ﾌｨﾙﾑ押え吸着OFF
CON
SET MR7708               ; ﾌｨﾙﾑ押え真空破壊ON
;SW21
LDP MR22308              ; SW21-1
RES MR7711               ; 不良ﾌｨﾙﾑ検出真空破壊ON
CON
ALT MR7709               ; 不良ﾌｨﾙﾑ検出吸着ON
CON
MPS
AND MR7709               ; 不良ﾌｨﾙﾑ検出吸着ON
RES MR7710               ; 不良ﾌｨﾙﾑ検出吸着OFF
MPP
ANB MR7709               ; 不良ﾌｨﾙﾑ検出吸着ON
SET MR7710               ; 不良ﾌｨﾙﾑ検出吸着OFF
LDP MR22309              ; SW21-2
RES MR7708               ; ﾌｨﾙﾑ押え真空破壊ON
CON
SET MR7709               ; 不良ﾌｨﾙﾑ検出吸着ON
CON
SET MR7711               ; 不良ﾌｨﾙﾑ検出真空破壊ON
;SW22
LDP MR22310              ; SW22-1
ANB DM11007.2
LD<=.L DM11000 +24000    ; RB1 現在位置下位
OR>=.L DM11000 +30000    ; RB1 現在位置下位
ANL
AND>=.L DM11000 -4500    ; RB1 現在位置下位
SET MR7210               ; ﾌｨﾙﾑ搬送 親 下降
CON
RES MR7211               ; ﾌｨﾙﾑ搬送 親 上昇
LDP MR22311              ; SW22-2
RES MR7210               ; ﾌｨﾙﾑ搬送 親 下降
CON
SET MR7211               ; ﾌｨﾙﾑ搬送 親 上昇
;SW23
LDP MR22312              ; SW23-1
ANB DM11007.2
LD<=.L DM11000 +24000    ; RB1 現在位置下位
OR>=.L DM11000 +30000    ; RB1 現在位置下位
ANL
AND>=.L DM11000 -4500    ; RB1 現在位置下位
SET MR7212               ; ﾌｨﾙﾑ搬送 子 下降
CON
RES MR7213               ; ﾌｨﾙﾑ搬送 子 上昇
LDP MR22313              ; SW23-2
RES MR7212               ; ﾌｨﾙﾑ搬送 子 下降
CON
SET MR7213               ; ﾌｨﾙﾑ搬送 子 上昇
;SW24
LDP MR22314              ; SW24-1
RES MR7602               ; 吸着治具真空破壊ON
CON
ALT MR7600               ; 吸着治具吸着ON
CON
MPS
AND MR7600               ; 吸着治具吸着ON
RES MR7601               ; 吸着治具吸着OFF
MPP
ANB MR7600               ; 吸着治具吸着ON
SET MR7601               ; 吸着治具吸着OFF
LDP MR22315              ; SW24-2
RES MR7600               ; 吸着治具吸着ON
CON
SET MR7601               ; 吸着治具吸着OFF
CON
SET MR7602               ; 吸着治具真空破壊ON
;SW25
LDP MR22400              ; SW25-1
SET MR7206               ; ﾌﾚｰﾑ押さえ下降
CON
RES MR7207               ; ﾌﾚｰﾑ押さえ上昇
LDP MR22401              ; SW25-2
RES MR7206               ; ﾌﾚｰﾑ押さえ下降
CON
SET MR7207               ; ﾌﾚｰﾑ押さえ上昇
;SW26
LDP MR22402              ; SW26-1
SET MR7208               ; ﾌﾚｰﾑ押さえ前進
CON
RES MR7209               ; ﾌﾚｰﾑ押さえ後退
LDP MR22403              ; SW26-2
RES MR7208               ; ﾌﾚｰﾑ押さえ前進
CON
SET MR7209               ; ﾌﾚｰﾑ押さえ後退
;SW27
LDP MR22404              ; SW27-1
ANB DM11095.2
AND<=.L DM11088 +1200    ; RB12 現在位置下位
SET MR7402               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞ反転B面
CON
RES MR7403               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞ反転A面
LDP MR22405              ; SW27-2
ANB DM11095.2
AND<=.L DM11088 +1200    ; RB12 現在位置下位
RES MR7402               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞ反転B面
CON
SET MR7403               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞ反転A面
;SW28
LDP MR22406              ; SW28-1
SET MR7404               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞﾁｬｯｸ閉
CON
RES MR7405               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞﾁｬｯｸ開
LDP MR22407              ; SW28-2
RES MR7404               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞﾁｬｯｸ閉
CON
SET MR7405               ; ﾌﾚｰﾑﾊﾞﾙﾌﾞﾁｬｯｸ開
;SW29
LDP MR22408              ; SW29-1
SET MR7406               ; 反転位置決めﾘﾘｰｽ
CON
RES MR7407               ; 反転位置決め
LDP MR22409              ; SW29-2
RES MR7406               ; 反転位置決めﾘﾘｰｽ
CON
SET MR7407               ; 反転位置決め
;SW30
LDP MR22410              ; SW30-1
SET MR7302               ; ﾌﾚｰﾑ溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙOFF
CON
RES MR7303               ; (ﾌﾚｰﾑ溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙON)
LDP MR22411              ; SW30-2
RES MR7302               ; ﾌﾚｰﾑ溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙOFF
CON
SET MR7303               ; (ﾌﾚｰﾑ溶着ﾍｯﾄﾞ上下自重ｷｬﾝｾﾙON)
;SW31
LDP MR22412              ; SW31-1
SET MR7304               ; ﾌﾚｰﾑ溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ下降
CON
RES MR7305               ; (ﾌﾚｰﾑ溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ上昇)
LDP MR22413              ; SW31-2
RES MR7304               ; ﾌﾚｰﾑ溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ下降
CON
SET MR7305               ; (ﾌﾚｰﾑ溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ上昇)
;SW32
LDP MR22414              ; SW32-1
SET MR7408               ; ﾌｨﾙﾑﾁｬｯｸ前進
CON
RES MR7409               ; ﾌｨﾙﾑﾁｬｯｸ後退
LDP MR22415              ; SW32-2
RES MR7408               ; ﾌｨﾙﾑﾁｬｯｸ前進
CON
SET MR7409               ; ﾌｨﾙﾑﾁｬｯｸ後退
;SW33
LDP MR22500              ; SW33-1
SET MR7410               ; ﾌｨﾙﾑﾁｬｯｸ下降
CON
RES MR7411               ; ﾌｨﾙﾑﾁｬｯｸ上昇
LDP MR22501              ; SW33-2
RES MR7410               ; ﾌｨﾙﾑﾁｬｯｸ下降
CON
SET MR7411               ; ﾌｨﾙﾑﾁｬｯｸ上昇
;SW34
LDP MR22502              ; SW34-1
SET MR7412               ; ｲｵﾅｲｻﾞON
CON
RES MR7413               ; (ｲｵﾅｲｻﾞOFF)
LDP MR22503              ; SW34-2
RES MR7412               ; ｲｵﾅｲｻﾞON
CON
SET MR7413               ; (ｲｵﾅｲｻﾞOFF)
;SW35
LDP MR22504              ; SW35-1
RES MR7611               ; 剥離ﾌｨﾙﾑ有無真空破壊ON
CON
ALT MR7609               ; 剥離ﾌｨﾙﾑ有無吸着ON
CON
MPS
AND MR7609               ; 剥離ﾌｨﾙﾑ有無吸着ON
RES MR7610               ; 剥離ﾌｨﾙﾑ有無吸着OFF
MPP
ANB MR7609               ; 剥離ﾌｨﾙﾑ有無吸着ON
SET MR7610               ; 剥離ﾌｨﾙﾑ有無吸着OFF
LDP MR22505              ; SW35-2
RES MR7609               ; 剥離ﾌｨﾙﾑ有無吸着ON
CON
SET MR7610               ; 剥離ﾌｨﾙﾑ有無吸着OFF
CON
SET MR7611               ; 剥離ﾌｨﾙﾑ有無真空破壊ON
;SW36
LDP MR22506              ; SW36-1
ANB DM11063.2
LD<.L DM11024 +28000     ; RB4 現在位置
LD>=.L DM11024 +28000    ; RB4 現在位置
ANB DM11031.2
ORL
ANL
SET MR7400               ; 圧縮ばね吸着下降
CON
RES MR7401               ; 圧縮ばね吸着上昇
LDP MR22507              ; SW36-2
RES MR7400               ; 圧縮ばね吸着下降
CON
SET MR7401               ; 圧縮ばね吸着上昇
;SW37
LDP MR22508              ; SW37-1
RES MR7714               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ真空破壊ON
CON
ALT MR7712               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ吸着ON
CON
MPS
AND MR7712               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ吸着ON
RES MR7713               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ吸着OFF
MPP
ANB MR7712               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ吸着ON
SET MR7713               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ吸着OFF
LDP MR22509              ; SW37-2
RES MR7712               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ吸着ON
CON
SET MR7713               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ吸着OFF
CON
SET MR7714               ; ばね吸着ﾄﾗﾝｽﾎﾟｰﾄ真空破壊ON
MCR
;<h1/>ﾒﾝﾃ RB ﾃｨｰﾁﾝｸﾞ
STG @MR2100              ; RB ﾃｨｰﾁﾝｸﾞ
MPS
LDB R39900               ; RB動作中
ANB @MR001               ; TASK10　ERROR
ANB @MR2110              ; RB_MOVE中
ANB @MR2202              ; RB_HOME中
ANL
MPS
ANB R41210               ; TASK10 PAUSE 要求
OUT @MR2102              ; ﾃｨｰﾁﾝｸﾞ中
CON
AND @MR1902              ; 終了確認
RES @MR1902              ; 終了確認
CON
JMP @MR2914
MPP
AND R41210               ; TASK10 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
MRD
LDP R44915               ; Teaching End
ORP R44914               ; Teaching End2
ANL
SET @MR1902              ; 終了確認
MRD
AND MR22000              ; Cylinder動作終了
DW #2150 DM3008          ; _MainTP　切替ﾍﾟｰｼﾞNo
MPP
AND MR20807              ; パレタイズ計算SW
SET @MR2300              ; ﾊﾟﾚﾀｲｽﾞ
;※RB選択は実際の軸番号-１なので注意
LD= DM50312 #2           ; RB選択
OR= DM50312 #6           ; RB選択
AND R34000               ; Teaching
OUT MR20808              ; 板押圧パレタイズ計算SW表示
LD= DM50312 #3           ; RB選択
OR= DM50312 #7           ; RB選択
AND R34000               ; Teaching
OUT MR20809              ; 板押圧パレタイズ計算SW表示
STG @MR2300              ; ﾊﾟﾚﾀｲｽﾞ
MPS
LD= DM50312 #2           ; RB選択
OR= DM50312 #6           ; RB選択
ANL
DW #1 tray               ; トレイ枚数
CON
DW #2 RBNo               ; RBNo-1
CON
LDA.L DM7034             ; 装置基礎ﾃﾞｰﾀ18
CON
STA.L Row                ; トレイ行数
CON
LDA.L DM7036             ; 装置基礎ﾃﾞｰﾀ19
CON
STA.L Column             ; トレイ列数
CON
JMP @MR2301
MRD
LD= DM50312 #3           ; RB選択
OR= DM50312 #7           ; RB選択
ANL
DW #2 tray               ; トレイ枚数
CON
DW #3 RBNo               ; RBNo-1
CON
LDA.L DM7038             ; 装置基礎ﾃﾞｰﾀ20
CON
STA.L Row                ; トレイ行数
CON
LDA.L DM7040             ; 装置基礎ﾃﾞｰﾀ21
CON
STA.L Column             ; トレイ列数
CON
JMP @MR2301
MPP
LDB MR20808              ; 板押圧パレタイズ計算SW表示
ANB MR20809              ; 板押圧パレタイズ計算SW表示
ANL
ENDS
;'パレタイズ計算
;for i = 0 to 1
;	for j = 0 to (tray-1) 	
;		ZRB = RBNo * DM9420 * 6 + j * 18	'RB_No * RBポイント数 * 6
;		Pos1 = EM10060.L:ZRB	'基準点1
;		Pos2 = EM10066.L:ZRB	'基準点2(X MAX)
;		Pos3 = EM10072.L:ZRB	'基準点3(Y MAX)
;
;		'計算
;		for N = 0 to (Row * column - 1)
;			Y_No = n / Column	'現在行(0〜Row-1）
;			X_No = n mod Column	'現在列(0〜Column-1)
;			Pos = Pos1 + (Pos2 - Pos1) * X_No / (Column - 1) + (Pos3 - Pos1) * Y_No / (Row - 1)
;
;			ZZ = n * 6 + RBNo * DM9420 * 6 + Row * Column * 6 * j'格納先のアドレス
;			EM10114.L:ZZ = Pos
;			EM10116.L:ZZ = EM10062.L:ZRB
;			EM10118:ZZ = EM10064:ZRB
;			EM10119:ZZ = EM10065:ZRB
;		next
;	next
;	RBNo = RBNo + 4 'トレイ側と搬送側2軸分
;next
;
;SET(CR2002,@MR605)
LD @MR2301
NCJ #1003
;'パレタイズ計算
;
;for i = 0 to 1
;
LD CR2002                ; 常時ON
MOV.S +0 i               ; 変数i
LABEL #2003
LD>.S i +1               ; 変数i
CJ #2004
;	for j = 0 to (tray-1) 	
;
LD CR2002                ; 常時ON
MOV.S +0 j
LABEL #2005
LD CR2002                ; 常時ON
LDA tray                 ; トレイ枚数
CON
EXT
CON
SUB.L +1
CON
STA.L @VM7
CON
LDA.S j
CON
EXT.S
CON
CMP.L @VM7
LD CR2011                ; 演算結果が正
CJ #2006
;		ZRB = RBNo * DM9420 * 6 + j * 18	'RB_No * RBポイント数 * 6
;
LD CR2002                ; 常時ON
LDA.S j
CON
EXT.S
CON
MUL.L +18
CON
STA.L @VM9
CON
LDA DM9420               ; IAI最大ポイント数
CON
EXT
CON
STA.L @VM11
CON
LDA.S RBNo               ; RBNo-1
CON
EXT.S
CON
MUL.L @VM11
CON
MUL.L +6
CON
ADD.L @VM9
CON
STA.L ZRB
;		Pos1 = EM10060.L:ZRB	'基準点1
;
LD CR2002                ; 常時ON
MOV.L ZRB Z12
MOV.L EM10060:Z12 Pos1   ; RB1 P11 POS(LO)  基準点1
;		Pos2 = EM10066.L:ZRB	'基準点2(X MAX)
;
LD CR2002                ; 常時ON
MOV.L ZRB Z12
MOV.L EM10066:Z12 Pos2   ; RB1 P12 POS(LO)  基準点2
;		Pos3 = EM10072.L:ZRB	'基準点3(Y MAX)
;
LD CR2002                ; 常時ON
MOV.L ZRB Z12
MOV.L EM10072:Z12 Pos3   ; RB1 P13 POS(LO)  基準点3
;		'計算
;
;		for N = 0 to (Row * column - 1)
;
LD CR2002                ; 常時ON
MOV.L +0 N               ; 現在番号
LABEL #2015
LD CR2002                ; 常時ON
LDA.L Row                ; トレイ行数
CON
MUL.L column             ; トレイ列数
CON
SUB.L +1
CON
CMP.L N                  ; 現在番号
LD CR2009                ; 演算結果が負
CJ #2016
;			Y_No = n / Column	'現在行(0〜Row-1）
;
LD CR2002                ; 常時ON
LDA.L n                  ; 現在番号
CON
EXT.L
CON
DIV.L Column             ; トレイ列数
CON
STA.L Y_No               ; 現在行数
;			X_No = n mod Column	'現在列(0〜Column-1)
;
LD CR2002                ; 常時ON
LDA.L n                  ; 現在番号
CON
EXT.L
CON
DIV.L Column             ; トレイ列数
CON
LDA.L TM2
CON
STA.L X_No               ; 現在列数
;			Pos = Pos1 + (Pos2 - Pos1) * X_No / (Column - 1) + (Pos3 - Pos1) * Y_No / (Row - 1)
;
LD CR2002                ; 常時ON
LDA.L Row                ; トレイ行数
CON
SUB.L +1
CON
STA.L @VM13
CON
LDA.L Pos3               ; 基準点3
CON
SUB.L Pos1               ; 基準点1
CON
MUL.L Y_No               ; 現在行数
CON
DIV.L @VM13
CON
STA.L @VM15
CON
LDA.L Column             ; トレイ列数
CON
SUB.L +1
CON
STA.L @VM17
CON
LDA.L Pos2               ; 基準点2
CON
SUB.L Pos1               ; 基準点1
CON
MUL.L X_No               ; 現在列数
CON
DIV.L @VM17
CON
ADD.L Pos1               ; 基準点1
CON
ADD.L @VM15
CON
STA.L Pos                ; 取り出し座標
;			ZZ = n * 6 + RBNo * DM9420 * 6 + Row * Column * 6 * j'格納先のアドレス
;
LD CR2002                ; 常時ON
LDA.L Row                ; トレイ行数
CON
MUL.L Column             ; トレイ列数
CON
MUL.L +6
CON
STA.L @VM19
CON
LDA.S j
CON
EXT.S
CON
MUL.L @VM19
CON
STA.L @VM21
CON
LDA DM9420               ; IAI最大ポイント数
CON
EXT
CON
STA.L @VM23
CON
LDA.S RBNo               ; RBNo-1
CON
EXT.S
CON
MUL.L @VM23
CON
MUL.L +6
CON
STA.L @VM25
CON
LDA.L n                  ; 現在番号
CON
MUL.L +6
CON
ADD.L @VM25
CON
ADD.L @VM21
CON
STA.L ZZ
;			EM10114.L:ZZ = Pos
;
LD CR2002                ; 常時ON
MOV.L ZZ Z11
MOV.L Pos EM10114:Z11    ; 取り出し座標  RB1 P20 POS(LO)
;			EM10116.L:ZZ = EM10062.L:ZRB
;
LD CR2002                ; 常時ON
MOV.L ZZ Z11
MOV.L ZRB Z12
MOV.L EM10062:Z12 EM10116:Z11;RB1 P11 Inp(Lo)  RB1 P20 Inp(Lo)
;			EM10118:ZZ = EM10064:ZRB
;
LD CR2002                ; 常時ON
MOV.L ZZ Z11
MOV.L ZRB Z12
MOV EM10064:Z12 EM10118:Z11;RB1 P11 Speed  RB1 P20 Speed
;			EM10119:ZZ = EM10065:ZRB
;
LD CR2002                ; 常時ON
MOV.L ZZ Z11
MOV.L ZRB Z12
MOV EM10065:Z12 EM10119:Z11;RB1 P11 G  RB1 P20 G
;		next
;
LD CR2002                ; 常時ON
INC.L N                  ; 現在番号
LDB CR2009               ; 演算結果が負
CJ #2015
LABEL #2016
;	next
;
LD CR2002                ; 常時ON
INC.S j
LDB CR2009               ; 演算結果が負
CJ #2005
LABEL #2006
;	RBNo = RBNo + 4 'トレイ側と搬送側2軸分
;
;;Warning[1103]: "=": (符号付き32ビット整数型->符号付き16ビット整数型) 代入によりデータが欠落する可能性があります。
LD CR2002                ; 常時ON
LDA.S RBNo               ; RBNo-1
CON
EXT.S
CON
ADD.L +4
CON
STA.S RBNo               ; RBNo-1
;next
;
LD CR2002                ; 常時ON
INC.S i                  ; 変数i
LDB CR2009               ; 演算結果が負
CJ #2003
LABEL #2004
;SET(CR2002,@MR605)
LD CR2002                ; 常時ON
SET @MR605
LABEL #1003
;
STG @MR2301
ANB @MR600               ; 算出完了
RES @MR600               ; 算出完了
CON
ENDS
;ﾃｨｰﾁRBmoveｲﾝﾀｰﾛｯｸ
;Teach RB move interlock
;RB1フィルム搬送インターロック
LD= DM50312 #0           ; RB選択
ANB MR20700              ; RB1移動不可
LD<> DM50300 #3          ; Position No
LD= DM50300 #3           ; Position No
ANB R4206                ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ下降端
AND R4207                ; 板押圧溶着ﾍｯﾄﾞｴｽｹｰﾌﾟ上昇端
ORL
ANL
OUT @MR500               ; RB1移動ｲﾝﾀｰﾛｯｸOK
;RB2フィルムカットインターロック
LD= DM50312 #1           ; RB選択
ANB MR20701              ; RB2移動不可
OUT @MR501               ; RB2移動ｲﾝﾀｰﾛｯｸOK
;RB3板押圧トレイ搬送インターロック
LD= DM50312 #2           ; RB選択
ANB MR20702              ; RB3移動不可
OUT @MR502               ; RB3移動ｲﾝﾀｰﾛｯｸOK
;RB4圧縮ばねトレイ搬送インターロック
LD= DM50312 #3           ; RB選択
ANB MR20703              ; RB4移動不可
OUT @MR503               ; RB4移動ｲﾝﾀｰﾛｯｸOK
;RB5フレーム溶着インターロック
LD= DM50312 #4           ; RB選択
LDB MR20704              ; RB5移動不可
OR MR22007               ; HOME
ANL
OUT @MR504               ; RB5移動ｲﾝﾀｰﾛｯｸOK
;RB6板押圧溶着インターロック
LD= DM50312 #5           ; RB選択
LDB MR20705              ; RB6移動不可
OR MR22007               ; HOME
ANL
OUT @MR505               ; RB6移動ｲﾝﾀｰﾛｯｸOK
;RB7板押圧搬送PPインターロック
LD= DM50312 #6           ; RB選択
ANB MR20706              ; RB7移動不可
OUT @MR506               ; RB7移動ｲﾝﾀｰﾛｯｸOK
;RB8ばね搬送PPインターロック
LD= DM50312 #7           ; RB選択
ANB MR20707              ; RB8移動不可
OUT @MR507               ; RB8移動ｲﾝﾀｰﾛｯｸOK
;RB9フィルム剥がしインターロック
LD= DM50312 #8           ; RB選択
ANB MR20708              ; RB9移動不可
OUT @MR508               ; RB9移動ｲﾝﾀｰﾛｯｸOK
;RB10フィルム回収上下インターロック
LD= DM50312 #9           ; RB選択
LDB MR20709              ; RB10移動不可
LD= DM50300 #1           ; Position No
ANB MR22007              ; HOME
ORL
ANL
OUT @MR509               ; RB10移動ｲﾝﾀｰﾛｯｸOK
;RB11フレーム搬送インターロック
LD= DM50312 #10          ; RB選択
ANB MR20710              ; RB11移動不可
OUT @MR510               ; RB11移動ｲﾝﾀｰﾛｯｸOK
;RB12フレーム反転上下インターロック
LD= DM50312 #11          ; RB選択
LDB MR20711              ; RB12移動不可
OR MR22007               ; HOME
ANL
OUT @MR511               ; RB12移動ｲﾝﾀｰﾛｯｸOK
LDB @MR500               ; RB1移動ｲﾝﾀｰﾛｯｸOK
ANB @MR501               ; RB2移動ｲﾝﾀｰﾛｯｸOK
ANB @MR502               ; RB3移動ｲﾝﾀｰﾛｯｸOK
ANB @MR503               ; RB4移動ｲﾝﾀｰﾛｯｸOK
ANB @MR504               ; RB5移動ｲﾝﾀｰﾛｯｸOK
ANB @MR505               ; RB6移動ｲﾝﾀｰﾛｯｸOK
ANB @MR506               ; RB7移動ｲﾝﾀｰﾛｯｸOK
ANB @MR507               ; RB8移動ｲﾝﾀｰﾛｯｸOK
ANB @MR508               ; RB9移動ｲﾝﾀｰﾛｯｸOK
ANB @MR509               ; RB10移動ｲﾝﾀｰﾛｯｸOK
ANB @MR510               ; RB11移動ｲﾝﾀｰﾛｯｸOK
ANB @MR511               ; RB12移動ｲﾝﾀｰﾛｯｸOK
INV
OUT @MR515               ; RB移動可能
;<h1/>デバイスネットTYPE
;※ﾒﾝﾃ RB 指定　Z3=動作STG指定用：Z4=IAI_状態信号デバイス指定用　Z5=RB Target POS格納ﾃﾞﾊﾞｲｽ参照先
LDB R39007               ; PLS列TYPE
MC
;Z1=D50312*16			'Z1:動作ﾌﾗｸﾞ修飾
;Z2=RB_OFFSET[D50312]	'Z2:軸ﾃﾞﾊﾞｲｽｵﾌｾｯﾄ修飾
;Z3=D50312*2				'Z3:動作Parameter格納先修飾
LD CR2002                ; 常時ON
NCJ #1002
;Z1=D50312*16			'Z1:動作ﾌﾗｸﾞ修飾
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
MUL.L +16
CON
STA.L Z1
;Z2=RB_OFFSET[D50312]	'Z2:軸ﾃﾞﾊﾞｲｽｵﾌｾｯﾄ修飾
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
STA.L Z12
CON
LDA W3AB0:Z12            ; RB_OFFSET
CON
EXT
CON
STA.L Z2
;Z3=D50312*2				'Z3:動作Parameter格納先修飾
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
MUL.L +2
CON
STA.L Z3
LABEL #1002
;
LD @MR2102               ; ﾃｨｰﾁﾝｸﾞ中
ANB R44200               ; Grp1 ﾎﾟｰｽﾞ要求
ANB R39900               ; RB動作中
BAND *W3A04:Z2 #4        ; RB_IN (STATUS)
BANB *W3A04:Z2 #3        ; RB_IN (STATUS)
MPS
LDP MR22007              ; HOME
AND @MR515               ; RB移動可能
ANL
SET @MR2200              ; RB_HOME
MRD
LDP MR22006              ; MOVE
BAND *W3A04:Z2 #4        ; RB_IN (STATUS)
BANB *W3A04:Z2 #3        ; RB_IN (STATUS)
AND @MR515               ; RB移動可能
ANL
SET @MR2108              ; RB_MOVE
MPP
AND B39B5                ; JISL ON=ｲﾝﾁﾝｸﾞ T.P
MPS
ANP MR22005              ; JOG-
SET MR22008              ; INC-
CON
SET @MR2108              ; RB_MOVE
MPP
ANP MR22004              ; JOG+
SET MR22009              ; INC+
CON
SET @MR2108              ; RB_MOVE
MCR
;<h1/>MC Unit PULSE列TYPE
LD R39007                ; PLS列TYPE
MC
;Z1=D50312*16									'Z1:動作ﾌﾗｸﾞ修飾
;Z3=D50312*2										'Z3:動作Parameter格納先修飾
;
;@DM60=W3AE0:(Unit_No*4)*16						'選択軸UNITのRﾃﾞﾊﾞｲｽ修飾
;ADRSET(R0:@DM60,Unit_R)							'指定UNIT先頭ﾃﾞﾊﾞｲｽ格納 R
;Z1=D50312*16									'Z1:動作ﾌﾗｸﾞ修飾
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
MUL.L +16
CON
STA.L Z1
;Z3=D50312*2										'Z3:動作Parameter格納先修飾
;
LD CR2002                ; 常時ON
LDA DM50312              ; RB選択
CON
EXT
CON
MUL.L +2
CON
STA.L Z3
;@DM60=W3AE0:(Unit_No*4)*16						'選択軸UNITのRﾃﾞﾊﾞｲｽ修飾
;
;;Warning[1103]: "=": (符号付き32ビット整数型->符号無し16ビット整数型) 代入によりデータが欠落する可能性があります。
LD CR2002                ; 常時ON
LDA W3A23                ; Unit No.
CON
EXT
CON
MUL.L +4
CON
STA.L Z12
CON
LDA W3AE0:Z12            ; UNIT_0 R
CON
EXT
CON
MUL.L +16
CON
STA @DM60
;ADRSET(R0:@DM60,Unit_R)							'指定UNIT先頭ﾃﾞﾊﾞｲｽ格納 R
LD CR2002                ; 常時ON
LDA @DM60
CON
EXT
CON
STA.L Z12
ADRSET R000:Z12 W3B20    ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
;
;IN FLG
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #708
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Busy                 ; 動作中
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #733
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Ready                ; Servo ON中
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #734
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Send                 ; Servo End
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #757
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT DRV_AL               ; ﾄﾞﾗｲｱﾗｰﾑ
LD CR2002                ; 常時ON
LDA #448
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT CReady               ; 準備完了
;出力 FLG
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #8
CON
ADD #0
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Cstr                 ; 位置決め開始
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #492
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Home                 ; 原点復帰
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #693
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT DRV_ALM_RES          ; Driver ALARM Reset
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #669
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Son                  ; Servo ON
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #656
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Jog_plus             ; JOG+
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #657
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Jog_minus            ; JOG-
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #658
CON
STA Z2
CON
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT Jog_hi               ; 高速JOG
;--
LD @MR2102               ; ﾃｨｰﾁﾝｸﾞ中
ANB R44200               ; Grp1 ﾎﾟｰｽﾞ要求
ANB R39900               ; RB動作中
ANB Busy                 ; 動作中
ANB DRV_AL               ; ﾄﾞﾗｲｱﾗｰﾑ
AND Ready                ; Servo ON中
MPS
LDP MR22007              ; HOME
AND @MR515               ; RB移動可能
ANL
SET @MR2200              ; RB_HOME
MRD
LDP MR22006              ; MOVE
AND R35011:Z1            ; RB1原点復帰済
AND @MR515               ; RB移動可能
ANL
SET @MR2108              ; RB_MOVE
MPP
AND B39B5                ; JISL ON=ｲﾝﾁﾝｸﾞ T.P
MPS
ANP MR22005              ; JOG-
SET MR22008              ; INC-
CON
SET @MR2108              ; RB_MOVE
MPP
ANP MR22004              ; JOG+
SET MR22009              ; INC+
CON
SET @MR2108              ; RB_MOVE
MCR
;<h1/>ﾒﾝﾃ Teaching MOVE
STG @MR2108              ; RB_MOVE
SET @MR2110              ; RB_MOVE中
CON
JMP @MR2111
;ｻｰﾎﾞON & ｱﾗｰﾑOFF
STG @MR2111
LDA DM50300              ; Position No
CON
STA EM1300:Z3            ; RB1Target Pos
CON
SET R35000:Z1            ; RB1 MOVE
CON
JMP @MR2112
STG @MR2112
AND R35001:Z1            ; RB1 MOVE END
RES R35001:Z1            ; RB1 MOVE END
CON
JMP @MR2113
STG @MR2113
MPS
ANB R35003:Z1            ; RB1 Alarm
JMP @MR2115              ; END
MPP
AND R35003:Z1            ; RB1 Alarm
RES R35003:Z1            ; RB1 Alarm
CON
SET @MR2208              ; RB_Alarm
CON
JMP @MR2114
STG @MR2114
AND @MR2209              ; RB_Alarm_END
RES @MR2209              ; RB_Alarm_END
CON
JMP @MR2115              ; END
STG @MR2115              ; END
RES MR22008              ; INC-
CON
RES MR22009              ; INC+
CON
RES @MR2110              ; RB_MOVE中
CON
ENDS
;<h1/>ﾒﾝﾃ Teaching HOME
STG @MR2200              ; RB_HOME
SET @MR2202              ; RB_HOME中
CON
JMP @MR2203
STG @MR2203
SET R35008:Z1            ; RB1 HOME
CON
JMP @MR2204
STG @MR2204
AND R35009:Z1            ; RB1 HOME END
RES R35009:Z1            ; RB1 HOME END
CON
JMP @MR2205
STG @MR2205
MPS
ANB R35003:Z1            ; RB1 Alarm
JMP @MR2207              ; END
MPP
AND R35003:Z1            ; RB1 Alarm
RES R35003:Z1            ; RB1 Alarm
CON
SET @MR2208              ; RB_Alarm
CON
JMP @MR2206
STG @MR2206
AND @MR2209              ; RB_Alarm_END
RES @MR2209              ; RB_Alarm_END
CON
JMP @MR2207              ; END
STG @MR2207              ; END
RES @MR2202              ; RB_HOME中
CON
ENDS
;<h1/>※現在値表示&格納
;デバイスネットTYPE
;TYPE D50300.L,D50312.D,@DM50.U,D50320.L,*RB_NOW_POS.L,DM11080.L
;'/// 現在位置 表示
;	DM50320 = *RB_NOW_POS:Z2 'Now Position 
;
;'DATA格納:現在位置 取込み/入力値取込み 
;IF R34001 = 1 THEN
;	@DM50 = ((D50300-1)*6)+(D50312*DM9422)
;	IF R34002 = 0 THEN 
;		EM10000.L:(@DM50) = DM50320.L	'Position
;	ELSE
;		EM10000.L:(@DM50) = DM50302.L	'Direct Position
;	END IF
;	
;	EM10004:(@DM50) = DM50306.U	'SPEED
;	EM10005:(@DM50) = DM50307.U	'ACC/DEC
;	D50302.L= E10000.L:@D50
;	D50306.U= E10004.U:@D50
;	D50307.U= E10005.U:@D50
;END IF
LD>= DM3000 #2150        ; _MainTP　表示中ﾍﾟｰｼﾞNo
AND<= DM3000 #2153       ; _MainTP　表示中ﾍﾟｰｼﾞNo
OR= DM3000 #2220         ; _MainTP　表示中ﾍﾟｰｼﾞNo
ANB R39007               ; PLS列TYPE
NCJ #1000
;TYPE D50300.L,D50312.D,@DM50.U,D50320.L,*RB_NOW_POS.L,DM11080.L
;
;'/// 現在位置 表示
;
;	DM50320 = *RB_NOW_POS:Z2 'Now Position 
;
LD CR2002                ; 常時ON
MOV.L *W3A00:Z2 DM50320  ; RB NOW_Pos  現在地
;'DATA格納:現在位置 取込み/入力値取込み 
;
;IF R34001 = 1 THEN
;
LD R34001                ; Teaching SW
NCJ #2007
;	@DM50 = ((D50300-1)*6)+(D50312*DM9422)
;
;;Warning[1104]: "*": (符号無し32ビット整数型->符号付き32ビット整数型) 演算によりデータが欠落する可能性があります。
;;Warning[1103]: "=": (符号付き32ビット整数型->符号無し16ビット整数型) 代入によりデータが欠落する可能性があります。
LD CR2002                ; 常時ON
LDA DM9422               ; 1軸あたり使用ﾃﾞﾊﾞｲｽ数
CON
EXT
CON
MUL.L DM50312            ; RB選択
CON
STA.L @VM27
CON
LDA.L DM50300            ; Position No
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM27
CON
STA @DM50
;	IF R34002 = 0 THEN 
;
LDB R34002               ; direct Teach T.P
NCJ #2008
;		EM10000.L:(@DM50) = DM50320.L	'Position
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV.L DM50320 EM10000:Z11; 現在地  RB1 P1 POS(LO)
;	ELSE
;
LD CR2002                ; 常時ON
CJ #2009
LABEL #2008
;		EM10000.L:(@DM50) = DM50302.L	'Direct Position
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV.L DM50302 EM10000:Z11; RB Position Low  RB1 P1 POS(LO)
;	END IF
;
LABEL #2009
;	EM10004:(@DM50) = DM50306.U	'SPEED
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV DM50306 EM10004:Z11  ; RB SPEED  RB1 P1 Speed
;	EM10005:(@DM50) = DM50307.U	'ACC/DEC
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV DM50307 EM10005:Z11  ; RB Acc/Dec  RB1 P1 G
;	D50302.L= E10000.L:@D50
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z12
CON
MOV.L EM10000:Z12 DM50302; RB1 P1 POS(LO)  RB Position Low
;	D50306.U= E10004.U:@D50
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z12
CON
MOV EM10004:Z12 DM50306  ; RB1 P1 Speed  RB SPEED
;	D50307.U= E10005.U:@D50
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z12
CON
MOV EM10005:Z12 DM50307  ; RB1 P1 G  RB Acc/Dec
;END IF
LABEL #2007
LABEL #1000
;
;MC UNIT TYPE
;TYPE D50300.L,D50312.D,@DM50.U,D50320.L,DM11080.L
;@DM62=W3AE2:(Unit_No*4)							'選択軸UNITのDMﾃﾞﾊﾞｲｽ修飾
;ADRSET(DM0:@DM62,Unit_DM)						'指定UNIT先頭ﾃﾞﾊﾞｲｽ格納 DM
;
;'/// 現在位置 表示
;D50320 = *Unit_DM.L:(290+((Axis_No-1)*60))	'MC Now pos
;
;
;'DATA格納:現在位置 取込み/入力値取込み 
;IF R34001 = 1 THEN
;	@DM50 = ((D50300-1)*6)+(D50312*DM9422)
;	IF R34002 = 0 THEN 
;		EM10000.L:(@DM50) = DM50320.L	'Position
;	ELSE
;		EM10000.L:(@DM50) = DM50302.L	'Direct Position
;	END IF
;	
;	EM10004:(@DM50) = DM50306.U	'SPEED
;	EM10005:(@DM50) = DM50307.U	'ACC/DEC
;	D50302.L= E10000.L:@D50
;	D50306.U= E10004.U:@D50
;	D50307.U= E10005.U:@D50
;END IF
LD>= DM3000 #2150        ; _MainTP　表示中ﾍﾟｰｼﾞNo
AND<= DM3000 #2153       ; _MainTP　表示中ﾍﾟｰｼﾞNo
OR= DM3000 #2220         ; _MainTP　表示中ﾍﾟｰｼﾞNo
AND R39007               ; PLS列TYPE
NCJ #1004
;TYPE D50300.L,D50312.D,@DM50.U,D50320.L,DM11080.L
;
;@DM62=W3AE2:(Unit_No*4)							'選択軸UNITのDMﾃﾞﾊﾞｲｽ修飾
;
LD CR2002                ; 常時ON
LDA W3A23                ; Unit No.
CON
EXT
CON
MUL.L +4
CON
STA.L Z12
CON
MOV W3AE2:Z12 @DM62      ; UNIT_0 DM
;ADRSET(DM0:@DM62,Unit_DM)						'指定UNIT先頭ﾃﾞﾊﾞｲｽ格納 DM
;
LD CR2002                ; 常時ON
LDA @DM62
CON
EXT
CON
STA.L Z12
ADRSET DM0:Z12 W3B22     ; 指定UNITﾃﾞﾊﾞｲｽ格納先 DM
;'/// 現在位置 表示
;
;D50320 = *Unit_DM.L:(290+((Axis_No-1)*60))	'MC Now pos
;
LD CR2002                ; 常時ON
LDA W3A22                ; Axis No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +60
CON
ADD.L +290
CON
STA.L Z12
CON
MOV.L *W3B22:Z12 DM50320 ; 指定UNITﾃﾞﾊﾞｲｽ格納先 DM  現在地
;'DATA格納:現在位置 取込み/入力値取込み 
;
;IF R34001 = 1 THEN
;
LD R34001                ; Teaching SW
NCJ #2010
;	@DM50 = ((D50300-1)*6)+(D50312*DM9422)
;
;;Warning[1104]: "*": (符号無し32ビット整数型->符号付き32ビット整数型) 演算によりデータが欠落する可能性があります。
;;Warning[1103]: "=": (符号付き32ビット整数型->符号無し16ビット整数型) 代入によりデータが欠落する可能性があります。
LD CR2002                ; 常時ON
LDA DM9422               ; 1軸あたり使用ﾃﾞﾊﾞｲｽ数
CON
EXT
CON
MUL.L DM50312            ; RB選択
CON
STA.L @VM29
CON
LDA.L DM50300            ; Position No
CON
SUB.L +1
CON
MUL.L +6
CON
ADD.L @VM29
CON
STA @DM50
;	IF R34002 = 0 THEN 
;
LDB R34002               ; direct Teach T.P
NCJ #2011
;		EM10000.L:(@DM50) = DM50320.L	'Position
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV.L DM50320 EM10000:Z11; 現在地  RB1 P1 POS(LO)
;	ELSE
;
LD CR2002                ; 常時ON
CJ #2012
LABEL #2011
;		EM10000.L:(@DM50) = DM50302.L	'Direct Position
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV.L DM50302 EM10000:Z11; RB Position Low  RB1 P1 POS(LO)
;	END IF
;
LABEL #2012
;	EM10004:(@DM50) = DM50306.U	'SPEED
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV DM50306 EM10004:Z11  ; RB SPEED  RB1 P1 Speed
;	EM10005:(@DM50) = DM50307.U	'ACC/DEC
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z11
CON
MOV DM50307 EM10005:Z11  ; RB Acc/Dec  RB1 P1 G
;	D50302.L= E10000.L:@D50
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z12
CON
MOV.L EM10000:Z12 DM50302; RB1 P1 POS(LO)  RB Position Low
;	D50306.U= E10004.U:@D50
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z12
CON
MOV EM10004:Z12 DM50306  ; RB1 P1 Speed  RB SPEED
;	D50307.U= E10005.U:@D50
;
LD CR2002                ; 常時ON
LDA @DM50
CON
EXT
CON
STA.L Z12
CON
MOV EM10005:Z12 DM50307  ; RB1 P1 G  RB Acc/Dec
;END IF
LABEL #2010
LABEL #1004
;
;<h1/>※入力モニター
BLD *W3A04:Z2 #0         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
LD Send                  ; Servo End
AND R39007               ; PLS列TYPE
ORL
OUT B39A0                ; PEND T.P
BLD *W3A04:Z2 #1         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
LD R35011:Z1             ; RB1原点復帰済
AND R39007               ; PLS列TYPE
ORL
OUT B39A1                ; HEND T.P
BLD *W3A04:Z2 #2         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
LD Busy                  ; 動作中
AND R39007               ; PLS列TYPE
ORL
OUT B39A2                ; MOVE T.P
BLD *W3A04:Z2 #3         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
LD DRV_AL                ; ﾄﾞﾗｲｱﾗｰﾑ
AND R39007               ; PLS列TYPE
ORL
OUT B39A3                ; ALM T.P
BLD *W3A04:Z2 #4         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
LD Ready                 ; Servo ON中
AND R39007               ; PLS列TYPE
ORL
OUT B39A4                ; SV T.P
BLD *W3A04:Z2 #5         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39A5                ; PSFL T.P
BLD *W3A04:Z2 #6         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39A6                ; -
BLD *W3A04:Z2 #7         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39A7                ; BALM ﾊﾞｯﾃﾘｰALM T.P
BLD *W3A04:Z2 #8         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39A8                ; Mend 移動指令完了 T.P
BLD *W3A04:Z2 #9         ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39A9                ; -
BLD *W3A04:Z2 #10        ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39AA                ; -
BLD *W3A04:Z2 #11        ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39AB                ; Pzone T.P
BLD *W3A04:Z2 #12        ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39AC                ; ZONE1 T.P
BLD *W3A04:Z2 #13        ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39AD                ; ZONE2 T.P
BLD *W3A04:Z2 #14        ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
LD CReady                ; 準備完了
AND R39007               ; PLS列TYPE
ORL
OUT B39AE                ; CRDY ｺﾝﾄﾛｰﾗ準備完了 T.P
BLD *W3A04:Z2 #15        ; RB_IN (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39AF                ; EMGS T.P
LDB R39007               ; PLS列TYPE
LDA *W3A02:Z2            ; RB_Alarm
CON
EXT
CON
STA DM50310              ; RB ｱﾗｰﾑ表示
LD R39007                ; PLS列TYPE
LDA #0
CON
EXT
CON
STA DM50310              ; RB ｱﾗｰﾑ表示
;<h1/>※出力モニター
BLD *W3A14:Z2 #0         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD Cstr                  ; 位置決め開始
AND R39007               ; PLS列TYPE
ORL
OUT B39B0                ; CSTR 位置決めｽﾀｰﾄ T.P
BLD *W3A14:Z2 #1         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD Home                  ; 原点復帰
AND R39007               ; PLS列TYPE
ORL
OUT B39B1                ; HOME T.P
BLD *W3A14:Z2 #2         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39B2                ; STP　一時停止 T.P
BLD *W3A14:Z2 #3         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD DRV_ALM_RES           ; Driver ALARM Reset
AND R39007               ; PLS列TYPE
ORL
OUT B39B3                ; RES ﾘｾｯﾄ T.P
BLD *W3A14:Z2 #4         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD Son                   ; Servo ON
AND R39007               ; PLS列TYPE
ORL
OUT B39B4                ; SON T.P
BLD *W3A14:Z2 #5         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD MR22002               ; JISL ON=Inch OFF=JOG
AND R39007               ; PLS列TYPE
ORL
OUT B39B5                ; JISL ON=ｲﾝﾁﾝｸﾞ T.P
BLD *W3A14:Z2 #6         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD Jog_hi                ; 高速JOG
AND R39007               ; PLS列TYPE
ORL
OUT B39B6                ; JVEL JOG速度切替 Low T.P
BLD *W3A14:Z2 #7         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD Jog_minus             ; JOG-
AND R39007               ; PLS列TYPE
ORL
OUT B39B7                ; JOG- T.P
BLD *W3A14:Z2 #8         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
LD Jog_plus              ; JOG+
AND R39007               ; PLS列TYPE
ORL
OUT B39B8                ; JOG+ T.P
BLD *W3A14:Z2 #9         ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39B9                ; -
BLD *W3A14:Z2 #10        ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39BA                ; -
BLD *W3A14:Z2 #11        ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39BB                ; -
BLD *W3A14:Z2 #12        ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39BC                ; PUSH T.P
BLD *W3A14:Z2 #13        ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39BD                ; DIR T.P
BLD *W3A14:Z2 #14        ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39BE                ; INC T.P
BLD *W3A14:Z2 #15        ; RB_OUT (STATUS)
ANB R39007               ; PLS列TYPE
OUT B39BF                ; BKRL T.P
;<h1/>※出力信号
;<h1/>IAI RB DEVICENET  出力
LDB R44200               ; Grp1 ﾎﾟｰｽﾞ要求
ANB R39007               ; PLS列TYPE
AND R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
MC
;Alarm RESET
BLD DM50314 #3
BOUT *W3A14:Z2 #3        ; RB_OUT (STATUS)
;Servo ON
LDB R39900               ; RB動作中
BAND DM50314 #4
MEP
MPS
BAND *W3A14:Z2 #4        ; RB_OUT (STATUS)
OUT @R000
CON
BRES *W3A14:Z2 #4        ; RB_OUT (STATUS)
MPP
BLDB *W3A14:Z2 #4        ; RB_OUT (STATUS)
ANB @R000
ANL
BSET *W3A14:Z2 #4        ; RB_OUT (STATUS)
;JISL
LD MR22002               ; JISL ON=Inch OFF=JOG
BOUT *W3A14:Z2 #5        ; RB_OUT (STATUS)
;JVEL
LD MR22003               ; JVEL
BOUT *W3A14:Z2 #6        ; RB_OUT (STATUS)
;JOG
LDB B39B5                ; JISL ON=ｲﾝﾁﾝｸﾞ T.P
MPS
AND MR22005              ; JOG-
BOUT *W3A14:Z2 #7        ; RB_OUT (STATUS)
MPP
AND MR22004              ; JOG+
BOUT *W3A14:Z2 #8        ; RB_OUT (STATUS)
;Brake Release　※使用する軸のみ記述する事。
BLD DM50314 #15
MEP
MPS
BAND *W3A14:Z2 #15       ; RB_OUT (STATUS)
OUT @R001
CON
BRES *W3A14:Z2 #15       ; RB_OUT (STATUS)
MPP
BLDB *W3A14:Z2 #15       ; RB_OUT (STATUS)
ANB @R001
ANL
BSET *W3A14:Z2 #15       ; RB_OUT (STATUS)
MCR
;<h1/>MC UNIT PULSE列制御出力
LDB R44200               ; Grp1 ﾎﾟｰｽﾞ要求
AND R39007               ; PLS列TYPE
AND R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
MC
;Alarm RESET
LD CR2002                ; 常時ON
ANB Busy                 ; 動作中
MPS
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #693
CON
STA Z2
CON
BAND DM50314 #3
OUT *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
MPP
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #640
CON
STA Z2
CON
BAND DM50314 #3
OUT *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
;Servo ON
LDB R39900               ; RB動作中
ANB Busy                 ; 動作中
BAND DM50314 #4
MEP
MPS
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #669
CON
STA Z2
MRD
AND *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
OUT @R002
CON
RES *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
MPP
LDB *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
ANB @R002
ANL
SET *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
;JVEL  ON=高速
LD CR2002                ; 常時ON
ANB Busy                 ; 動作中
MPS
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #658
CON
STA Z2
MPP
ANB MR22003              ; JVEL
OUT *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
;JOG-
LDB B39B5                ; JISL ON=ｲﾝﾁﾝｸﾞ T.P
ANB MR22002              ; JISL ON=Inch OFF=JOG
MPS
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #657
CON
STA Z2
MPP
AND MR22005              ; JOG-
OUT *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
;JOG+
LDB B39B5                ; JISL ON=ｲﾝﾁﾝｸﾞ T.P
ANB MR22002              ; JISL ON=Inch OFF=JOG
MPS
LDA W3A22                ; Axis No.
CON
SUB #1
CON
MUL #128
CON
ADD #656
CON
STA Z2
MPP
AND MR22004              ; JOG+
OUT *W3B20:Z2            ; 指定UNIT　ﾃﾞﾊﾞｲｽ格納先 R
MCR
;安全の為Brake解除OFF
;'///// Brake解除 OFF
;FOR  I =0 TO DM9412
;	*RB_OUT_STATUS:RB_OFFSET[I]=ANDA(*RB_OUT_STATUS:RB_OFFSET[I],$7FFF)
;NEXT
;
LDB @MR2102              ; ﾃｨｰﾁﾝｸﾞ中
NCJ #1001
;'///// Brake解除 OFF
;
;FOR  I =0 TO DM9412
;
LD CR2002                ; 常時ON
MOV.S +0 I               ; 変数i
LABEL #2013
LD CR2002                ; 常時ON
LDA DM9412               ; IAI最大軸数
CON
EXT
CON
STA.L @VM31
CON
LDA.S I                  ; 変数i
CON
EXT.S
CON
CMP.L @VM31
LD CR2011                ; 演算結果が正
CJ #2014
;	*RB_OUT_STATUS:RB_OFFSET[I]=ANDA(*RB_OUT_STATUS:RB_OFFSET[I],$7FFF)
;
LD CR2002                ; 常時ON
LDA.S I                  ; 変数i
CON
EXT.S
CON
STA.L Z12
CON
LDA W3AB0:Z12            ; RB_OFFSET
CON
EXT
CON
STA.L Z11
CON
LDA.S I                  ; 変数i
CON
EXT.S
CON
STA.L Z12
CON
LDA W3AB0:Z12            ; RB_OFFSET
CON
EXT
CON
STA.L Z12
CON
LDA *W3A14:Z12           ; RB_OUT (STATUS)
CON
ANDA $7FFF
CON
STA @VM33
CON
MOV @VM33 *W3A14:Z11     ; RB_OUT (STATUS)
;NEXT
;
LD CR2002                ; 常時ON
INC.S I                  ; 変数i
LDB CR2009               ; 演算結果が負
CJ #2013
LABEL #2014
LABEL #1001
;
;<h1/>ﾒﾝﾃ RB ALARM
STG @MR2208              ; RB_Alarm
ANB @MR001               ; TASK10　ERROR
ANB R39900               ; RB動作中
MPS
LDB R44200               ; Grp1 ﾎﾟｰｽﾞ要求
ANB R39004               ; ｴﾗｰ中
ANL
MPS
SET R39004               ; ｴﾗｰ中
CON
DW $100F @DM9            ; ReturnSW /ERROR_DISP
CON
DW #0 @DM2               ; SensorNo /ERROR_DISP
CON
SET @MR100               ; Task10 ERROR
CON
JMP @MR2210
MRD
ANB R39007               ; PLS列TYPE
SET B3990                ; ｱﾗｰﾑ詳細表示
CON
LDA *W3A02:Z2            ; RB_Alarm
CON
STA DM50310              ; RB ｱﾗｰﾑ表示
MPP
LDA DM50312              ; RB選択
CON
ADD #1
CON
STA @DM1                 ; ErrorNo /ERROR_DISP
MPP
AND R44200               ; Grp1 ﾎﾟｰｽﾞ要求
SET @MR1900              ; Main1 HALT許可
STG @MR2210
SET @MR1900              ; Main1 HALT許可
CON
AND @MR101               ; TASK10 ERROR_End
RES @MR101               ; TASK10 ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
AND @MR105               ; SW1
RES B3990                ; ｱﾗｰﾑ詳細表示
CON
DW #0 DM50310            ; RB ｱﾗｰﾑ表示
CON
SET @MR2209              ; RB_Alarm_END
CON
ENDS
;<h1/>MAINTENANCE終了
STG @MR2914
MCALL MODE_INDI #1
MCALL HOLD_REQUEST MyGroup;自ｸﾞﾙｰﾌﾟ番号
MPS
MSTRT CHANGE_PAGE #1 #211 @MR2908
MPP
AND @MR2908
RES @MR2908
CON
JMP @MR2915              ; Mainte END
STG @MR2915              ; Mainte END
MPS
LDB R41210               ; TASK10 PAUSE 要求
ANB @MR001               ; TASK10　ERROR
ANB R39900               ; RB動作中
ANL
RES @MR1902              ; 終了確認
CON
RES @MR2002              ; ﾒﾝﾃ中
CON
JMP LR610                ; _Grp1_Task10_Fin.STG
MPP
AND R41210               ; TASK10 PAUSE 要求
SET @MR1900              ; Main1 HALT許可
;<h1/>-----------------------------------------------------------
;<h1/>*ERROR
;MyTask Error Process Substance/エラー処理実体
STG @MR100               ; Task10 ERROR
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @MR105 @MR108       ; SW1  SW4
CON
DISN @DM9 @DM3 #4        ; ReturnSW /ERROR_DISP
MRD
DW MyTask @DM0           ; 自ﾀｽｸ番号  TaskNo /ERROR_DISP
CON
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP  TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @MR102               ; TASK10 ERROR Busy
CON
JMP @MR103
STG @MR103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP  ErrorNo /ERROR_DISP
MPS
AND= DM60007 @DM6        ; ReturnSW /ERROR_DISP
SET @MR105               ; SW1
CON
JMP @MR104
MRD
AND= DM60007 @DM5        ; ReturnSW /ERROR_DISP
SET @MR106               ; SW2
CON
JMP @MR104
MRD
AND= DM60007 @DM4        ; ReturnSW /ERROR_DISP  1軸あたり使用ﾃﾞﾊﾞｲｽ数
SET @MR107               ; SW3
CON
JMP @MR104
MPP
AND= DM60007 @DM3        ; ReturnSW /ERROR_DISP
SET @MR108               ; SW4
CON
JMP @MR104
STG @MR104
ANB R39002               ; ERROR_DISP Busy
RES @MR102               ; TASK10 ERROR Busy
CON
SET @MR101               ; TASK10 ERROR_End
CON
ENDS
;<h1/>*Select_Y_N 
;MyTask Select_Y_N Process Substance/SELECT_Y_N処理実体
STG @MR300               ; TASK10 SELECT_Y_N
ANB R39102               ; SELECT_Y_N Busy
MPS
ZRES @MR306 @MR307       ; TASK10 Y/N
CON
DW #0 @DM20              ; TaskNo /SELECT_Y_N
CON
BMOV @DM20 DM60020 #3    ; TaskNo /SELECT_Y_N  TaskNo /SELECT_Y_N
MPP
SET R39100               ; SELECT_Y_N Start
CON
SET @MR302               ; TASK10 Y_N Busy
CON
JMP @MR303
STG @MR303
AND R39102               ; SELECT_Y_N Busy
MPS
AND= DM60023 #1          ; Y_N /SELECT_Y_N
SET @MR306               ; TASK10 Y/N
CON
JMP @MR304
MPP
AND= DM60023 #2          ; Y_N /SELECT_Y_N
RES @MR306               ; TASK10 Y/N
CON
JMP @MR304
STG @MR304
ANB R39102               ; SELECT_Y_N Busy
RES @MR302               ; TASK10 Y_N Busy
CON
SET @MR301               ; TASK10 Y/N END
CON
ENDS
;<h1/>*TIMEUP ERROR
;MyTask TIMEUP_ERROR Process Substance/TIMEUP_ERROR処理実体
STG @MR400               ; TASK10 TIMEUP_ERR
ANB R39302               ; TIMEUP_ERR Busy
MPS
DW #0 @DM40              ; TaskNo /TIMEUP_ERR
CON
BMOV @DM40 DM60040 #2    ; TaskNo /TIMEUP_ERR  TaskNo /TIMEUP_ERR
MPP
SET R39300               ; TIMEUP_ERR Start
CON
SET @MR402               ; TASK10 TIMEUP Busy
CON
JMP @MR403
STG @MR403
AND R39302               ; TIMEUP_ERR Busy
JMP @MR404
STG @MR404
ANB R39302               ; TIMEUP_ERR Busy
RES @MR402               ; TASK10 TIMEUP Busy
CON
SET @MR401               ; TASK10 TIMEUP_END
CON
ENDS
;<h1/>*Select_ACT 
;MyTask Select_ACT Process Substance/SELECT_ACT処理実体
STG @MR200               ; TASK10 SELECT_ACT
ANB R39202               ; SELECT_ACT Busy
MPS
ZRES @MR205 @MR208       ; SW1  SW4
CON
DW #0 @DM30              ; TaskNo /SELECT_ACT
CON
BMOV @DM30 DM60030 #7    ; TaskNo /SELECT_ACT  TaskNo /SELECT_ACT
MPP
SET R39200               ; SELECT_ACT Start
CON
SET @MR202               ; TASK10 SEL_ACT Busy
CON
JMP @MR203
STG @MR203
AND R39202               ; SELECT_ACT Busy
AND<> DM60037 #0         ; SelectSW /SELECT_ACT
MPS
AND= DM60037 #1          ; SelectSW /SELECT_ACT
SET @MR205               ; SW1
CON
JMP @MR204
MRD
AND= DM60037 #2          ; SelectSW /SELECT_ACT
SET @MR206               ; SW2
CON
JMP @MR204
MRD
AND= DM60037 #3          ; SelectSW /SELECT_ACT
SET @MR207               ; SW3
CON
JMP @MR204
MPP
AND= DM60037 #4          ; SelectSW /SELECT_ACT
SET @MR208               ; SW4
CON
JMP @MR204
STG @MR204
ANB R39202               ; SELECT_ACT Busy
RES @MR202               ; TASK10 SEL_ACT Busy
CON
SET @MR201               ; TASK10 SEL_ACT END
CON
ENDS
;<h1/>※機能Macro呼出し見本- 削除して下さい。-------------------------------------
;<h1/>※Error:記述見本
;ERR163 "****Error"
;<h1/>※SELECT_ACT　:記述見本
;画面番号33をブザー有りで選択SW番号を左から#5,#10,#0(無し),#34の並びで表示する
;<h1/>※ SELECT_Y_N　記述見本
;//*Select_Y_N
;<h1/>HALT
LD R41210                ; TASK10 PAUSE 要求
AND @MR1900              ; Main1 HALT許可
TMH @40 #5
CON
AND @T40
SET R42610               ; Grp1_Task10_ﾎﾟｰｽﾞ許可
LD R42610                ; Grp1_Task10_ﾎﾟｰｽﾞ許可
ORB R41210               ; TASK10 PAUSE 要求
ANB @MR001               ; TASK10　ERROR
RES @MR1900              ; Main1 HALT許可
CON
RES @MR1901              ; Main2 HALT許可
END
ENDH
