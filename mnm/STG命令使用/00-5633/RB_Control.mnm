DEVICE:53
;MODULE:RB_Control
;MODULE_TYPE:0
;SCRIPT_TYPE:
LD R50010                ; Emergency　Stop
ZRES @MR000 @MR515
LDF R50010               ; Emergency　Stop
ORF MR2009               ; RB1 電源ON
SHOT #10 MR12003         ; RB1:ﾏｸﾛ強制終了
;RB1
LD CR2002                ; 常時ON
ANB MR12003              ; RB1:ﾏｸﾛ強制終了
MSTRT IAI_CON_HALF DM2000 DM2200 MR12000 DM10100 EM10000 R50010 #50 DM1200;RB1_PCON 現在位置  RB1_PCON 目標位置  RB1:動作完了  RB1 ResultCode  RB1 Pos0 目標値  Emergency　Stop  RB1押付け電流値(0-100)
;RB定義
;<ﾕｰｻﾞ変更必要>
;EM2000 = 1		'RB数
;
;EM2000 = 1		'RB数
;
LD CR2002                ; 常時ON
MOV #1 EM2000            ; RB数
;
LD CR2002                ; 常時ON
DW #1 EM2106             ; ﾃｨｰﾁﾝｸﾞﾀｲﾌﾟ
CON
DW #1 EM2104             ; Axis No
;ﾃｨｰﾁﾝｸﾞ画面呼び出し
LDP MR21000              ; 各RB画面呼び出し
MPS
AND= EM2106 #1           ; ﾃｨｰﾁﾝｸﾞﾀｲﾌﾟ
DW #52 DM4008            ; TP 切り替え画面No
MRD
AND= EM2106 #3           ; ﾃｨｰﾁﾝｸﾞﾀｲﾌﾟ
DW #51 DM4008            ; TP 切り替え画面No
MPP
AND= EM2106 #4           ; ﾃｨｰﾁﾝｸﾞﾀｲﾌﾟ
DW #55 DM4008            ; TP 切り替え画面No
LD= DM4000 #50           ; TP 現在表示中画面
@DW #1 EM2104            ; Axis No
;RB選択ﾗﾝﾌﾟ / RB choice LP
LD= EM2103 #1            ; RB No
OUT MR21101              ; RB1 選択中
;ﾃｷｽﾄNo初期設定
;Text No initialization
LD CR2008                ; 運転開始時1ｽｷｬﾝON
DW #30 EM2100            ; RBﾃｷｽﾄNo
CON
DW #31 EM2101            ; AxisﾃｷｽﾄNo
CON
DW #41 EM2102            ; PointﾃｷｽﾄNo
;RB名,軸名ﾃｷｽﾄNo指定
;EM2101 = EM2103 + 30
;EM2102 = EM2103 + 40
;EM2101 = EM2103 + 30
;
LD CR2002                ; 常時ON
LDA EM2103               ; RB No
CON
EXT
CON
ADD.L +30
CON
STA EM2101               ; AxisﾃｷｽﾄNo
;EM2102 = EM2103 + 40
LD CR2002                ; 常時ON
LDA EM2103               ; RB No
CON
EXT
CON
ADD.L +40
CON
STA EM2102               ; PointﾃｷｽﾄNo
;
;RB No 制限
LD CR2002                ; 常時ON
MPS
AND<= EM2103 #0          ; RB No
DW #1 EM2103             ; RB No
MPP
AND> EM2103 EM2000       ; RB No  RB数
DW #1 EM2103             ; RB No
;Axis No制限
;IF EM2104 <= 0 THEN
;	EM2104 = 1
;END IF
;
;SELECT CASE EM2103
;	CASE 1
;		IF EM2104 > EM2011 THEN
;			EM2104 = 1
;		END IF
;	CASE 2
;		IF EM2104 > EM2016 THEN
;			EM2104 = 1
;		END IF
;END SELECT
;IF EM2104 <= 0 THEN
;
LD<= EM2104 #0           ; Axis No
NCJ #2000
;	EM2104 = 1
;
LD CR2002                ; 常時ON
MOV #1 EM2104            ; Axis No
;END IF
;
LABEL #2000
;SELECT CASE EM2103
;
LD CR2002                ; 常時ON
MOV EM2103 @VM0          ; RB No
;	CASE 1
;
LD= @VM0 #1
NCJ #2001
;		IF EM2104 > EM2011 THEN
;
LD> EM2104 EM2011        ; Axis No  RB1 軸数
NCJ #2002
;			EM2104 = 1
;
LD CR2002                ; 常時ON
MOV #1 EM2104            ; Axis No
;		END IF
;
LABEL #2002
LD CR2002                ; 常時ON
CJ #2003
LABEL #2001
;	CASE 2
;
LD= @VM0 #2
NCJ #2004
;		IF EM2104 > EM2016 THEN
;
LD> EM2104 EM2016        ; Axis No  RB2 軸数
NCJ #2005
;			EM2104 = 1
;
LD CR2002                ; 常時ON
MOV #1 EM2104            ; Axis No
;		END IF
;
LABEL #2005
;END SELECT
LABEL #2004
LABEL #2003
;
;
;<共通部>
;ﾎﾟｲﾝﾄﾃﾞｰﾀ表示制御
;
;SELECT CASE EM2106
;	CASE 1
;		EM2512.L = EM10000.L:((EM2103-1)*600+(EM2500)*6)		'Disp 1  全行(EM2104-1)*○○○の○には占有ﾜｰﾄﾞ数を入力
;		EM2514.L = EM10000.L:((EM2103-1)*600+(EM2501)*6)		'Disp 2  例：1軸で100ﾎﾟｼﾞｼｮﾝ占有、1pos/6ﾜｰﾄﾞなので、600
;		EM2516.L = EM10000.L:((EM2103-1)*600+(EM2502)*6)		'Disp 3  (EM2104-1)*200	
;		EM2518.L = EM10000.L:((EM2103-1)*600+(EM2503)*6)		'Disp 4  例：1軸で50ﾎﾟｼﾞｼｮﾝ占有
;		EM2520.L = EM10000.L:((EM2103-1)*600+(EM2504)*6)		'Disp 5  (EM2104-1)*50	
;		EM2531 = EM2500
;		EM2532 = EM2501
;		EM2533 = EM2502
;		EM2534 = EM2503
;		EM2535 = EM2504
;
;END SELECT
;
;SELECT CASE EM2106
;
LD CR2002                ; 常時ON
MOV EM2106 @VM1          ; ﾃｨｰﾁﾝｸﾞﾀｲﾌﾟ
;	CASE 1
;
LD= @VM1 #1
NCJ #2006
;		EM2512.L = EM10000.L:((EM2103-1)*600+(EM2500)*6)		'Disp 1  全行(EM2104-1)*○○○の○には占有ﾜｰﾄﾞ数を入力
;
LD CR2002                ; 常時ON
LDA EM2500               ; POINTNO1
CON
EXT
CON
MUL.L +6
CON
STA.L @VM2
CON
LDA EM2103               ; RB No
CON
EXT
CON
SUB.L +1
CON
MUL.L +600
CON
ADD.L @VM2
CON
STA.L Z12
CON
MOV.L EM10000:Z12 EM2512 ; RB1 Pos0 目標値  POINT1 DATA
;		EM2514.L = EM10000.L:((EM2103-1)*600+(EM2501)*6)		'Disp 2  例：1軸で100ﾎﾟｼﾞｼｮﾝ占有、1pos/6ﾜｰﾄﾞなので、600
;
LD CR2002                ; 常時ON
LDA EM2501               ; POINTNO2
CON
EXT
CON
MUL.L +6
CON
STA.L @VM4
CON
LDA EM2103               ; RB No
CON
EXT
CON
SUB.L +1
CON
MUL.L +600
CON
ADD.L @VM4
CON
STA.L Z12
CON
MOV.L EM10000:Z12 EM2514 ; RB1 Pos0 目標値  POINT2 DATA
;		EM2516.L = EM10000.L:((EM2103-1)*600+(EM2502)*6)		'Disp 3  (EM2104-1)*200	
;
LD CR2002                ; 常時ON
LDA EM2502               ; POINTNO3
CON
EXT
CON
MUL.L +6
CON
STA.L @VM6
CON
LDA EM2103               ; RB No
CON
EXT
CON
SUB.L +1
CON
MUL.L +600
CON
ADD.L @VM6
CON
STA.L Z12
CON
MOV.L EM10000:Z12 EM2516 ; RB1 Pos0 目標値  POINT3 DATA
;		EM2518.L = EM10000.L:((EM2103-1)*600+(EM2503)*6)		'Disp 4  例：1軸で50ﾎﾟｼﾞｼｮﾝ占有
;
LD CR2002                ; 常時ON
LDA EM2503               ; POINTNO4
CON
EXT
CON
MUL.L +6
CON
STA.L @VM8
CON
LDA EM2103               ; RB No
CON
EXT
CON
SUB.L +1
CON
MUL.L +600
CON
ADD.L @VM8
CON
STA.L Z12
CON
MOV.L EM10000:Z12 EM2518 ; RB1 Pos0 目標値  POINT4 DATA
;		EM2520.L = EM10000.L:((EM2103-1)*600+(EM2504)*6)		'Disp 5  (EM2104-1)*50	
;
LD CR2002                ; 常時ON
LDA EM2504               ; POINTNO5
CON
EXT
CON
MUL.L +6
CON
STA.L @VM10
CON
LDA EM2103               ; RB No
CON
EXT
CON
SUB.L +1
CON
MUL.L +600
CON
ADD.L @VM10
CON
STA.L Z12
CON
MOV.L EM10000:Z12 EM2520 ; RB1 Pos0 目標値  POINT5 DATA
;		EM2531 = EM2500
;
LD CR2002                ; 常時ON
MOV EM2500 EM2531        ; POINTNO1  POINT DATA1 ﾃｷｽﾄ行No
;		EM2532 = EM2501
;
LD CR2002                ; 常時ON
MOV EM2501 EM2532        ; POINTNO2  POINT DATA2 ﾃｷｽﾄ行No
;		EM2533 = EM2502
;
LD CR2002                ; 常時ON
MOV EM2502 EM2533        ; POINTNO3  POINT DATA3 ﾃｷｽﾄ行No
;		EM2534 = EM2503
;
LD CR2002                ; 常時ON
MOV EM2503 EM2534        ; POINTNO4  POINT DATA4 ﾃｷｽﾄ行No
;		EM2535 = EM2504
;
LD CR2002                ; 常時ON
MOV EM2504 EM2535        ; POINTNO5  POINT DATA5 ﾃｷｽﾄ行No
;END SELECT
;
LABEL #2006
;
LD MR21308               ; Next
AND< EM2500 #95          ; POINTNO1
@SET @MR001
;EM2500 = EM2500 + 5
;EM2501 = EM2501 + 5
;EM2502 = EM2502 + 5
;EM2503 = EM2503 + 5
;EM2504 = EM2504 + 5
;
;RES(@MR001)
LD @MR001
NCJ #1000
;EM2500 = EM2500 + 5
;
LD CR2002                ; 常時ON
LDA EM2500               ; POINTNO1
CON
EXT
CON
ADD.L +5
CON
STA EM2500               ; POINTNO1
;EM2501 = EM2501 + 5
;
LD CR2002                ; 常時ON
LDA EM2501               ; POINTNO2
CON
EXT
CON
ADD.L +5
CON
STA EM2501               ; POINTNO2
;EM2502 = EM2502 + 5
;
LD CR2002                ; 常時ON
LDA EM2502               ; POINTNO3
CON
EXT
CON
ADD.L +5
CON
STA EM2502               ; POINTNO3
;EM2503 = EM2503 + 5
;
LD CR2002                ; 常時ON
LDA EM2503               ; POINTNO4
CON
EXT
CON
ADD.L +5
CON
STA EM2503               ; POINTNO4
;EM2504 = EM2504 + 5
;
LD CR2002                ; 常時ON
LDA EM2504               ; POINTNO5
CON
EXT
CON
ADD.L +5
CON
STA EM2504               ; POINTNO5
;RES(@MR001)
LD CR2002                ; 常時ON
RES @MR001
LABEL #1000
;
LD MR21309               ; Back
AND>= EM2500 #1          ; POINTNO1
@SET @MR002
;EM2500 = EM2500 - 5
;EM2501 = EM2501 - 5
;EM2502 = EM2502 - 5
;EM2503 = EM2503 - 5
;EM2504 = EM2504 - 5
;
;RES(@MR002)
LD @MR002
NCJ #1001
;EM2500 = EM2500 - 5
;
LD CR2002                ; 常時ON
LDA EM2500               ; POINTNO1
CON
EXT
CON
SUB.L +5
CON
STA EM2500               ; POINTNO1
;EM2501 = EM2501 - 5
;
LD CR2002                ; 常時ON
LDA EM2501               ; POINTNO2
CON
EXT
CON
SUB.L +5
CON
STA EM2501               ; POINTNO2
;EM2502 = EM2502 - 5
;
LD CR2002                ; 常時ON
LDA EM2502               ; POINTNO3
CON
EXT
CON
SUB.L +5
CON
STA EM2502               ; POINTNO3
;EM2503 = EM2503 - 5
;
LD CR2002                ; 常時ON
LDA EM2503               ; POINTNO4
CON
EXT
CON
SUB.L +5
CON
STA EM2503               ; POINTNO4
;EM2504 = EM2504 - 5
;
LD CR2002                ; 常時ON
LDA EM2504               ; POINTNO5
CON
EXT
CON
SUB.L +5
CON
STA EM2504               ; POINTNO5
;RES(@MR002)
LD CR2002                ; 常時ON
RES @MR002
LABEL #1001
;
LD MR21310               ; Direct
@SET @MR003
;EM2501 = EM2500 + 1
;EM2502 = EM2500 + 2
;EM2503 = EM2500 + 3
;EM2504 = EM2500 + 4
;
;RES(@MR003)
LD @MR003
TMH @0 #10
CON
AND @T0
NCJ #1002
;EM2501 = EM2500 + 1
;
LD CR2002                ; 常時ON
LDA EM2500               ; POINTNO1
CON
EXT
CON
ADD.L +1
CON
STA EM2501               ; POINTNO2
;EM2502 = EM2500 + 2
;
LD CR2002                ; 常時ON
LDA EM2500               ; POINTNO1
CON
EXT
CON
ADD.L +2
CON
STA EM2502               ; POINTNO3
;EM2503 = EM2500 + 3
;
LD CR2002                ; 常時ON
LDA EM2500               ; POINTNO1
CON
EXT
CON
ADD.L +3
CON
STA EM2503               ; POINTNO4
;EM2504 = EM2500 + 4
;
LD CR2002                ; 常時ON
LDA EM2500               ; POINTNO1
CON
EXT
CON
ADD.L +4
CON
STA EM2504               ; POINTNO5
;RES(@MR003)
LD CR2002                ; 常時ON
RES @MR003
LABEL #1002
;
;ﾎﾟｲﾝﾄNo選択
;IF MR21301 = ON THEN
;	EM2105 = EM2500
;ELSE IF MR21302 = ON THEN
;	EM2105 = EM2501
;ELSE IF MR21303 = ON THEN
;	EM2105 = EM2502
;ELSE IF MR21304 = ON THEN
;	EM2105 = EM2503
;ELSE IF MR21305 = ON THEN
;	EM2105 = EM2504
;ELSE IF MR21306 = ON THEN
;	EM2105 = EM2505
;END IF
;IF MR21301 = ON THEN
;
LD MR21301               ; POINT DATA1 選択
NCJ #2007
;	EM2105 = EM2500
;
LD CR2002                ; 常時ON
MOV EM2500 EM2105        ; POINTNO1  ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
LD CR2002                ; 常時ON
CJ #2008
LABEL #2007
;ELSE IF MR21302 = ON THEN
;
LD MR21302               ; POINT DATA2 選択
NCJ #2009
;	EM2105 = EM2501
;
LD CR2002                ; 常時ON
MOV EM2501 EM2105        ; POINTNO2  ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
LD CR2002                ; 常時ON
CJ #2010
LABEL #2009
;ELSE IF MR21303 = ON THEN
;
LD MR21303               ; POINT DATA3 選択
NCJ #2011
;	EM2105 = EM2502
;
LD CR2002                ; 常時ON
MOV EM2502 EM2105        ; POINTNO3  ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
LD CR2002                ; 常時ON
CJ #2012
LABEL #2011
;ELSE IF MR21304 = ON THEN
;
LD MR21304               ; POINT DATA4 選択
NCJ #2013
;	EM2105 = EM2503
;
LD CR2002                ; 常時ON
MOV EM2503 EM2105        ; POINTNO4  ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
LD CR2002                ; 常時ON
CJ #2014
LABEL #2013
;ELSE IF MR21305 = ON THEN
;
LD MR21305               ; POINT DATA5 選択
NCJ #2015
;	EM2105 = EM2504
;
LD CR2002                ; 常時ON
MOV EM2504 EM2105        ; POINTNO5  ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
LD CR2002                ; 常時ON
CJ #2016
LABEL #2015
;ELSE IF MR21306 = ON THEN
;
LD MR21306
NCJ #2017
;	EM2105 = EM2505
;
LD CR2002                ; 常時ON
MOV EM2505 EM2105        ; ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
;END IF
LABEL #2017
LABEL #2016
LABEL #2014
LABEL #2012
LABEL #2010
LABEL #2008
;
;RB TYPE 1
;CON
;初期表示処理
LD= DM4008 #52           ; TP 切り替え画面No
@SET @MR000
;EM2500 = 1					'Disp 1
;EM2501 = 2					'Disp 2
;EM2502 = 3					'Disp 3
;EM2503 = 4					'Disp 4
;EM2504 = 5					'Disp 5
;
;EM2530 = EM2102				'RBﾎﾟｲﾝﾄﾃｷｽﾄNo表示
;
;SET(MR21300)	'現在値選択
;
;SET(MR21400) 	'AUTO
;RES(MR21405) 	'+,-切替
;RES(MR21406)	'0.1,0.01切替
;
;RES(MR21311)	'
;RES(MR21312)	'
;
;EM2524 = 2 		'少数点位置指定
;
;ZRES(MR21004,MR21006)	'座標変更確認画面用リレー
;
;RES(@MR000)
LD @MR000
NCJ #1003
;EM2500 = 1					'Disp 1
;
LD CR2002                ; 常時ON
MOV #1 EM2500            ; POINTNO1
;EM2501 = 2					'Disp 2
;
LD CR2002                ; 常時ON
MOV #2 EM2501            ; POINTNO2
;EM2502 = 3					'Disp 3
;
LD CR2002                ; 常時ON
MOV #3 EM2502            ; POINTNO3
;EM2503 = 4					'Disp 4
;
LD CR2002                ; 常時ON
MOV #4 EM2503            ; POINTNO4
;EM2504 = 5					'Disp 5
;
LD CR2002                ; 常時ON
MOV #5 EM2504            ; POINTNO5
;EM2530 = EM2102				'RBﾎﾟｲﾝﾄﾃｷｽﾄNo表示
;
LD CR2002                ; 常時ON
MOV EM2102 EM2530        ; PointﾃｷｽﾄNo  ﾎﾟｲﾝﾄﾃﾞｰﾀﾃｷｽﾄNo
;SET(MR21300)	'現在値選択
;
LD CR2002                ; 常時ON
SET MR21300              ; 現在値選択
;SET(MR21400) 	'AUTO
;
LD CR2002                ; 常時ON
SET MR21400              ; TEACH:AUTO
;RES(MR21405) 	'+,-切替
;
LD CR2002                ; 常時ON
RES MR21405              ; TEACH:+-切替 ON=-
;RES(MR21406)	'0.1,0.01切替
;
LD CR2002                ; 常時ON
RES MR21406              ; TEACH:0.1-0.01切替 ON=0.01
;RES(MR21311)	'
;
LD CR2002                ; 常時ON
RES MR21311              ; TEACH
;RES(MR21312)	'
;
LD CR2002                ; 常時ON
RES MR21312              ; DIRECT CHANGE
;EM2524 = 2 		'少数点位置指定
;
LD CR2002                ; 常時ON
MOV #2 EM2524            ; 直接変更仮データ小数点位置
;ZRES(MR21004,MR21006)	'座標変更確認画面用リレー
;
LD CR2002                ; 常時ON
ZRES MR21004 MR21006     ; PosData変更確認画面呼び出し  PosData変更確認NO選択
;RES(@MR000)
LD CR2002                ; 常時ON
RES @MR000
LABEL #1003
;
;TEACH
LD= DM4008 #50           ; TP 切り替え画面No
OR= DM4008 #52           ; TP 切り替え画面No
ANB R50001               ; AUTO
ANB R50002               ; STEP
ANB R50003               ; HOME
OUT MR21008              ; RB 手動許可
;<h1/>CON
;TEACH TYPE 2
;<h1/>RB IL
;M21008がONなら手動時
LD CR2002                ; 常時ON
OUT @MR100               ; RB-IL 給除材ｴﾘｱ
LD R4210                 ; 吸着ﾍｯﾄﾞ 右行限(溶着側)
ANB R4211                ; 吸着ﾍｯﾄﾞ 左行限(切出し側)
AND R4212                ; 吸着ﾍｯﾄﾞ 下降限1(溶着側)
ANB R4214                ; 吸着ﾍｯﾄﾞ 上昇限
LD R4211                 ; 吸着ﾍｯﾄﾞ 左行限(切出し側)
ANB R4210                ; 吸着ﾍｯﾄﾞ 右行限(溶着側)
ORL
LDB R4300                ; 吸着ﾍｯﾄﾞ 旋回限(45°)
AND R4301                ; 吸着ﾍｯﾄﾞ 旋回戻し限(0°)
ORL
OUT @MR101               ; RB-IL ﾌｨﾙﾑPP
LD CR2002                ; 常時ON
OUT @MR102
LD CR2002                ; 常時ON
OUT @MR103
LD= EM2103 #1            ; RB No
LD MR21008               ; RB 手動許可
ORB MR21008              ; RB 手動許可
ANL
OR R50001                ; AUTO
AND @MR100               ; RB-IL 給除材ｴﾘｱ
LD @MR101                ; RB-IL ﾌｨﾙﾑPP
OR= #1 DM10108           ; RB1 目標ﾎﾟｲﾝﾄ番号
ANL
AND @MR102
AND @MR103
ANB DM2207.2             ; RB1_PCON 一時停止=ON
TMR @5 #5
CON
AND @T5
OUT MR21200              ; RB1 IL
LD<> MR21200 #0          ; RB1 IL
OUT @MR215               ; RB HOME/MOVE IL
LD R4201                 ; ﾌｨﾙﾑｸﾗﾝﾌﾟ 上下 下降限
AND R4203                ; ﾌｨﾙﾑ押え 前後 後退限
AND R4205                ; ｶｯﾀｰ前後 後退限(外側)
OUT @MR104               ; ｼｬｯﾀｰ開
LD MR21008               ; RB 手動許可
MC
LD CR2002                ; 常時ON
MOV.D DM2000 EM2510      ; RB1_PCON 現在位置  現在ﾎﾟｼﾞｼｮﾝﾃﾞｰﾀ表示
;POWER ON/OFF
LDP MR21407              ; TEACH:電源ON
AND= EM2103 #1           ; RB No
SET MR2008               ; RB非常停止=OFF
CON
SET MR2009               ; RB1 電源ON
LDF MR21407              ; TEACH:電源ON
AND= EM2103 #1           ; RB No
RES MR2008               ; RB非常停止=OFF
CON
RES MR2009               ; RB1 電源ON
LD= EM2103 #1            ; RB No
AND R2009                ; RB1 電源ON
OUT MR21408              ; TEACH:電源表示
;AUTO/MANU切替
LD MR21400               ; TEACH:AUTO
@RES DM2207.14           ; RB1_PCON 運転ﾓｰﾄﾞ MANU=ON
LD MR21401               ; TEACH:MANU
@SET DM2207.14           ; RB1_PCON 運転ﾓｰﾄﾞ MANU=ON
;Servo ON/ Servo OFF
LDP MR21411              ; TEACH:SV
SET DM2207.4             ; RB1_PCON ｻｰﾎﾞON指令
LDF MR21411              ; TEACH:SV
RES DM2207.4             ; RB1_PCON ｻｰﾎﾞON指令
LD DM2007.4              ; RB1_PCON 運転準備完了 ｻｰﾎﾞONでON
OUT MR21412              ; TEACH:SV表示
;Servo ON/ Servo OFF
LDP MR21506              ; TEACH:RB BK RLS　SW
SET DM2207.15            ; RB1_PCON ﾌﾞﾚｰｷ強制解除=ON
LDF MR21506              ; TEACH:RB BK RLS　SW
LDB R50001               ; AUTO
ANB R50002               ; STEP
ANB R50003               ; HOME
INV
MEP
ORL
RES DM2207.15            ; RB1_PCON ﾌﾞﾚｰｷ強制解除=ON
LD DM2207.15             ; RB1_PCON ﾌﾞﾚｰｷ強制解除=ON
OUT MR21507              ; TEACH:RB BK RLS
;RB RDY
;RBﾃｨｰﾁﾝｸﾞ可能な場合にONする
LD DM2007.4              ; RB1_PCON 運転準備完了 ｻｰﾎﾞONでON
AND DM2007.14            ; RB1_PCON PCON準備完了
OUT MR21414              ; TEACH:RB RDY
;<h1/>HOME
LD MR21410               ; TEACH:HOME
AND MR21412              ; TEACH:SV表示
AND MR21414              ; TEACH:RB RDY
AND @MR215               ; RB HOME/MOVE IL
@SET MR12004             ; RB1:HOME
CON
@SET @MR200
STG @MR200
AND MR12000              ; RB1:動作完了
RES MR12000              ; RB1:動作完了
CON
JMP @MR201
STG @MR201
MPS
AND= DM10100 #20         ; RB1 ResultCode
JMP @MR203
MPP
AND<> DM10100 #20        ; RB1 ResultCode
SET @MR500               ; RB1 Err141
CON
JMP @MR202
STG @MR202
AND @MR503               ; RB1 Err141 Release
RES @MR503               ; RB1 Err141 Release
CON
ENDS
STG @MR203
RES MR21410              ; TEACH:HOME
CON
ENDS
;<h1/>POSMOVE
LD MR21402               ; TEACH:POSMOVE
AND MR21412              ; TEACH:SV表示
AND MR21414              ; TEACH:RB RDY
AND @MR215               ; RB HOME/MOVE IL
MOV EM2105 DM10108       ; ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo  RB1 目標ﾎﾟｲﾝﾄ番号
@SET MR12005             ; RB1:MOVE
CON
@SET @MR208
STG @MR208
AND MR12000              ; RB1:動作完了
RES MR12000              ; RB1:動作完了
CON
MPS
ANB R50208               ; RB動作中LC遮光
JMP @MR209
MPP
AND R50208               ; RB動作中LC遮光
JMP @MR211
STG @MR209
MPS
AND= DM10100 #20         ; RB1 ResultCode
JMP @MR211
MPP
AND<> DM10100 #20        ; RB1 ResultCode
SET @MR500               ; RB1 Err141
CON
JMP @MR210
STG @MR210
AND @MR503               ; RB1 Err141 Release
RES @MR500               ; RB1 Err141
CON
JMP @MR211
STG @MR211
RES MR21402              ; TEACH:POSMOVE
CON
ENDS
;<h1/>JOG/INCH
LD MR21400               ; TEACH:AUTO
AND MR21408              ; TEACH:電源表示
AND MR21412              ; TEACH:SV表示
MPS
AND MR21403              ; TEACH:JOG
DW #0 DM10104            ; RB1 現在ﾎﾟｼﾞｼｮﾝ番号
CON
RES DM2207.5             ; RB1_PCON JOG/ｲﾝﾁﾝｸﾞ ON=INCH
MPS
AND MR21406              ; TEACH:0.1-0.01切替 ON=0.01
RES DM2207.6             ; RB1_PCON JOG/INCH 速度切替
MRD
ANB MR21406              ; TEACH:0.1-0.01切替 ON=0.01
SET DM2207.6             ; RB1_PCON JOG/INCH 速度切替
MRD
AND MR21405              ; TEACH:+-切替 ON=-
OUT MR21502              ; -JOG
MPP
ANB MR21405              ; TEACH:+-切替 ON=-
OUT MR21501              ; +JOG
MPP
AND MR21404              ; TEACH:INCH
DW #0 DM10104            ; RB1 現在ﾎﾟｼﾞｼｮﾝ番号
CON
SET DM2207.5             ; RB1_PCON JOG/ｲﾝﾁﾝｸﾞ ON=INCH
MPS
AND MR21406              ; TEACH:0.1-0.01切替 ON=0.01
RES DM2207.6             ; RB1_PCON JOG/INCH 速度切替
MRD
ANB MR21406              ; TEACH:0.1-0.01切替 ON=0.01
SET DM2207.6             ; RB1_PCON JOG/INCH 速度切替
MRD
AND MR21405              ; TEACH:+-切替 ON=-
SHOT #3 MR21504          ; -INCH
MPP
ANB MR21405              ; TEACH:+-切替 ON=-
SHOT #3 MR21503          ; +INCH
LD MR21502               ; -JOG
OR MR21504               ; -INCH
OUT DM2207.7             ; RB1_PCON JOG-
LD MR21501               ; +JOG
OR MR21503               ; +INCH
OUT DM2207.8             ; RB1_PCON JOG+
;<h1/>★WRITE
LDP MR21409              ; TEACH:WRITE
ANB MR21500              ; 現在値選択
RES MR21005              ; PosData変更確認YES選択
CON
RES MR21006              ; PosData変更確認NO選択
CON
SET MR21004              ; PosData変更確認画面呼び出し
CON
@SET @MR400              ; Data Write
STG @MR400               ; Data Write
MPS
AND MR21005              ; PosData変更確認YES選択
@SET @MR401
CON
RES MR21004              ; PosData変更確認画面呼び出し
CON
JMP @MR402
MPP
AND MR21006              ; PosData変更確認NO選択
RES MR21004              ; PosData変更確認画面呼び出し
CON
ENDS
;@DM1 = (EM2103-1)*600+((EM2105)*6) '*600は1軸の占有ﾜｰﾄﾞ数です
;EM10000.L:@DM1 = EM2510.L		'位置ﾃﾞｰﾀ = RB現在値
;EM10002.L:@DM1 = 10				'位置決め幅 0.1mm
;EM10004:@DM1 = EM2526			'速度ﾃﾞｰﾀ = TPから指定
;EM10005:@DM1 = 30				'加減速 0.3G
;
;RES(@MR401)
;
LD @MR401
NCJ #1004
;@DM1 = (EM2103-1)*600+((EM2105)*6) '*600は1軸の占有ﾜｰﾄﾞ数です
;
LD CR2002                ; 常時ON
LDA EM2105               ; ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
CON
EXT
CON
MUL.L +6
CON
STA.L @VM12
CON
LDA EM2103               ; RB No
CON
EXT
CON
SUB.L +1
CON
MUL.L +600
CON
ADD.L @VM12
CON
STA @DM1
;EM10000.L:@DM1 = EM2510.L		'位置ﾃﾞｰﾀ = RB現在値
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV.L EM2510 EM10000:Z11 ; 現在ﾎﾟｼﾞｼｮﾝﾃﾞｰﾀ表示  RB1 Pos0 目標値
;EM10002.L:@DM1 = 10				'位置決め幅 0.1mm
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV.L +10 EM10002:Z11    ; RB1 Pos0 位置決め幅
;EM10004:@DM1 = EM2526			'速度ﾃﾞｰﾀ = TPから指定
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV EM2526 EM10004:Z11   ; RB1 Pos0 速度
;EM10005:@DM1 = 30				'加減速 0.3G
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV #30 EM10005:Z11      ; RB1 Pos0 加減速
;RES(@MR401)
;
LD CR2002                ; 常時ON
RES @MR401
LABEL #1004
;
STG @MR402
ANB @MR401
ENDS
;<h1/>POINT DATA DIRECT CHANGE
LDP MR21413              ; TEACH:DIRECT CHANGE
ANB MR21500              ; 現在値選択
RES MR21005              ; PosData変更確認YES選択
CON
RES MR21006              ; PosData変更確認NO選択
CON
SET MR21004              ; PosData変更確認画面呼び出し
CON
@SET @MR404              ; Data Change
STG @MR404               ; Data Change
MPS
AND MR21005              ; PosData変更確認YES選択
@SET @MR405
CON
RES MR21004              ; PosData変更確認画面呼び出し
CON
JMP @MR406
MPP
AND MR21006              ; PosData変更確認NO選択
RES MR21004              ; PosData変更確認画面呼び出し
CON
ENDS
;@DM1 = (EM2103-1)*600+((EM2105)*6) '*600は1軸の占有ﾜｰﾄﾞ数です
;EM10000.L:@DM1 = EM2522.L		'位置ﾃﾞｰﾀ = TPから指定
;EM10002.L:@DM1 = 10				'位置決め幅 0.1mm
;EM10004:@DM1 = EM2526			'速度ﾃﾞｰﾀ = TPから指定
;EM10005:@DM1 = 30				'加減速 0.3G
;
;RES(@MR405)
;
LD @MR405
NCJ #1005
;@DM1 = (EM2103-1)*600+((EM2105)*6) '*600は1軸の占有ﾜｰﾄﾞ数です
;
LD CR2002                ; 常時ON
LDA EM2105               ; ﾃｨｰﾁﾝｸﾞﾎﾟｲﾝﾄNo
CON
EXT
CON
MUL.L +6
CON
STA.L @VM14
CON
LDA EM2103               ; RB No
CON
EXT
CON
SUB.L +1
CON
MUL.L +600
CON
ADD.L @VM14
CON
STA @DM1
;EM10000.L:@DM1 = EM2522.L		'位置ﾃﾞｰﾀ = TPから指定
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV.L EM2522 EM10000:Z11 ; 直接変更仮データ  RB1 Pos0 目標値
;EM10002.L:@DM1 = 10				'位置決め幅 0.1mm
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV.L +10 EM10002:Z11    ; RB1 Pos0 位置決め幅
;EM10004:@DM1 = EM2526			'速度ﾃﾞｰﾀ = TPから指定
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV EM2526 EM10004:Z11   ; RB1 Pos0 速度
;EM10005:@DM1 = 30				'加減速 0.3G
;
LD CR2002                ; 常時ON
LDA @DM1
CON
EXT
CON
STA.L Z11
CON
MOV #30 EM10005:Z11      ; RB1 Pos0 加減速
;RES(@MR405)
;
LD CR2002                ; 常時ON
RES @MR405
LABEL #1005
;
STG @MR406
ANB @MR404               ; Data Change
ENDS
MCR
;<h1/>RB AUTO MODE
;MOVE
STG MR15500              ; RB1 MOVE
AND MR21200              ; RB1 IL
ANB MR12001              ; RB1:動作中
SET MR12005              ; RB1:MOVE
CON
SET MR15502              ; RB1 MOVE Busy
CON
JMP @MR300               ; RB AUTO MODE PosMOVE
STG @MR300               ; RB AUTO MODE PosMOVE
AND MR12000              ; RB1:動作完了
RES MR12000              ; RB1:動作完了
CON
MPS
ANB R50208               ; RB動作中LC遮光
JMP @MR301
MPP
AND R50208               ; RB動作中LC遮光
RES MR15502              ; RB1 MOVE Busy
CON
SET MR15501              ; RB1 MOVE comp
CON
ENDS
;
STG @MR301
MPS
AND= DM10100 #20         ; RB1 ResultCode
RES MR15502              ; RB1 MOVE Busy
CON
SET MR15501              ; RB1 MOVE comp
CON
ENDS
MPP
LD<> DM10100 #20         ; RB1 ResultCode
OR DM2007.3              ; RB1_PCON ｱﾗｰﾑ ONで異常
ANL
SET MR15504              ; RB1_ALM
CON
RES MR15502              ; RB1 MOVE Busy
CON
SET @MR500               ; RB1 Err141
CON
JMP @MR302
STG @MR302
AND @MR503               ; RB1 Err141 Release
RES MR15504              ; RB1_ALM
CON
RES @MR503               ; RB1 Err141 Release
CON
ENDS
;HOME
STG MR15508              ; RB1 HOME
SET MR12004              ; RB1:HOME
CON
SET MR15510              ; RB1 HOME Busy
CON
JMP @MR304               ; RB AUTO MODE HOME
STG @MR304               ; RB AUTO MODE HOME
AND MR12000              ; RB1:動作完了
RES MR12000              ; RB1:動作完了
CON
JMP @MR305
STG @MR305
MPS
AND= DM10100 #20         ; RB1 ResultCode
RES MR15510              ; RB1 HOME Busy
CON
SET MR15509              ; RB1 HOME comp
CON
ENDS
MPP
AND<> DM10100 #20        ; RB1 ResultCode
RES MR15510              ; RB1 HOME Busy
CON
SET @MR500               ; RB1 Err141
CON
JMP @MR306
STG @MR306
AND @MR503               ; RB1 Err141 Release
RES @MR503               ; RB1 Err141 Release
CON
ENDS
;PUSH
STG MR15600              ; RB1 PUSH
AND MR21200              ; RB1 IL
ANB MR12001              ; RB1:動作中
SET MR12012              ; RB1:PUSH
CON
SET MR15602              ; RB1 PUSH Busy
CON
JMP @MR308
STG @MR308
AND MR12000              ; RB1:動作完了
RES MR12000              ; RB1:動作完了
CON
JMP @MR309
;
STG @MR309
MPS
AND= DM10100 #20         ; RB1 ResultCode
RES MR15602              ; RB1 PUSH Busy
CON
SET MR15601              ; RB1 PUSH comp
CON
ENDS
MRD
LD= DM10100 #24          ; RB1 ResultCode
OR= DM2006 $00DC         ; RB1_PCON ｱﾗｰﾑｺｰﾄﾞ
ANL
SET @MR504               ; RB1 Err142
CON
RES MR15602              ; RB1 PUSH Busy
CON
SET MR15603              ; RB1 PUSH ERROR
CON
JMP @MR310
MPP
LD<> DM10100 #20         ; RB1 ResultCode
AND<> DM10100 #24        ; RB1 ResultCode
AND<> DM2006 $00DC       ; RB1_PCON ｱﾗｰﾑｺｰﾄﾞ
ANL
SET MR15504              ; RB1_ALM
CON
RES MR15602              ; RB1 PUSH Busy
CON
SET @MR500               ; RB1 Err141
CON
JMP @MR310
STG @MR310
MPS
AND @MR503               ; RB1 Err141 Release
RES @MR503               ; RB1 Err141 Release
CON
ENDS
MPP
AND @MR507               ; RB1 Err142 Release
RES @MR507               ; RB1 Err142 Release
CON
ENDS
;<h1/>RB Err
;RB1 Err
STG @MR500               ; RB1 Err141
ANB R50008               ; Error
SET R50111               ; Err ST1
CON
SET R50008               ; Error
CON
JMP @MR501
MOV #141 DM400           ; ﾒｯｾｰｼﾞNo.
STG @MR501
AND R50008               ; Error
JMP @MR502
STG @MR502
ANB R50008               ; Error
SET @MR503               ; RB1 Err141 Release
CON
ENDS
;RB1  PUSH Err
STG @MR504               ; RB1 Err142
ANB R50008               ; Error
SET R50111               ; Err ST1
CON
SET R50008               ; Error
CON
JMP @MR505
MOV #142 DM400           ; ﾒｯｾｰｼﾞNo.
STG @MR505
AND R50008               ; Error
JMP @MR506
STG @MR506
ANB R50008               ; Error
SET @MR507               ; RB1 Err142 Release
CON
ENDS
END
ENDH
