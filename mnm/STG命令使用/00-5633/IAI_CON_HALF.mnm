DEVICE:53
;MODULE:IAI_CON_HALF
;MODULE_TYPE:1
;SCRIPT_TYPE:
;SupportMacro
;
;-----------------------------------------
;Macro Name 	: 	IAI_CON_HOME
;Macro Type	:	Self Holding
;Function	:	IAI CON系原点復帰ﾏｸﾛ
;-----------------------------------------
;**************
;I/F Bit
;**************
;#0	:Macro->Prog	:動作完了
;#1	:Macro->Prog	:動作中
;#2	:Macro->Prog	:原点復帰完了
;#3	:Prog->Macro	:ﾏｸﾛ強制終了
;#4	:Prog->Macro	:HOME
;#5	:Prog->Macro	:MOVE
;#6	:Prog->Macro	:RTN
;#7	:Prog->Macro	:JOG
;#8	:Prog->Macro	:INCH
;#9	:Prog->Macro	:ARMRST
;#10	:Prog->Macro	:
;#11	:Prog->Macro	:
;#12	:Prog->Macro	:押付け動作
;#13	:Prog->Macro	:MOVE-PAUSE  (一時停止指令)
;#14	:Prog->Macro	:MOVE-RST  （リセット指令）
;#15	:Prog->Macro	:DN正常通信中
;
;**************
;I/F Word
;**************
;#0	:Macro->Prog	:ResultCode
;#1	:Macro->Prog	:
;#2	:Macro->Prog	:DATA0	現在位置1
;#3	:Macro->Prog	:DATA1	現在位置2
;#4	:Macro->Prog	:DATA2	現在ﾎﾟｼﾞｼｮﾝ番号
;#5	:Macro->Prog	:DATA3		
;#6	:Prog->Macro	:DATA10	方向切替
;#7	:Prog->Macro	:DATA11	ｲﾝﾁﾝｸﾞ切替
;#8	:Prog->Macro	:DATA12	ﾎﾟｼﾞｼｮﾝ番号  
;#9	:Prog->Macro	:DATA13  
;#10	:Prog->Macro	:DATA14
;
;******************
;完了コード
;******************								
;#20 	= 正常終了							#20 = No Error
;#21 	= RB応答なし						#21 = Non Responce
;#22 	= ｽﾃｰﾀｽ異常							#22 = Status Abnormal
;#23		= 設定異常							#23 = 設定異常
;#24		= 押しつけ空振り
;引数：
;	P0	=	RB入力先頭番地			R番号で指定	P0 = Input Leading Address for RB
;	P1  =	RB出力先頭番地			R番号で指定	P1 = Output Leading Address for RB
;	P2  =   I/Fﾋﾞｯﾄ先頭番地、先頭より16bit占有、割り当ては上記参照
;	P3  =   I/Fﾜｰﾄﾞ先頭番地、先頭より20word占有、割り当ては上記参照
;	P4  =   ﾎﾟｼﾞｼｮﾝ格納DM先頭番地
;	P5  =   非常停止ﾌﾗｸﾞ指定
;	P6  =   押し当て完了座標
;
;
;機能：
;	ACON/PCON/SCON用  操作ﾏｸﾛ/ Robot Homimng Macro for Half Move Mode
;	ﾊｰﾌ直値仕様
;	ｴﾘｱｾﾝｻｰ遮断などによる一時停止機能付き
LD @CR2008
SET @MR000
;RBｽﾃｰﾀｽﾓﾆﾀｰ / Status Monitoring
BLD P0:#7 #3             ; RB_IN
OUT @MR014               ; ｱﾗｰﾑ発生
BLD P0:#7 #4             ; RB_IN
BANB P0:#7 #8            ; RB_IN
BANB P0:#7 #10           ; RB_IN
BAND P0:#7 #14           ; RB_IN
BANB P0:#7 #15           ; RB_IN
OUT @MR001               ; RB移動許可
LD CR2002                ; 常時ON
MOV.L P0:#0 P3:#2        ; RB_IN  I/F Word
;ｱﾗｰﾑ処理
LD @MR014                ; ｱﾗｰﾑ発生
AND P2:#1                ; I/F Bit
@MOV P0:#1 P3:#0         ; RB_IN  I/F Word
@ZRES P2:#4 P2:#14       ; I/F Bit  I/F Bit
CON
@ZRES @MR100 @MR615      ; HOME
CON
@SET @MR015
;RB状態ﾁｪｯｸ /　Robot Status Check
STG @MR000
MPS
AND P2:#4                ; I/F Bit
DW #0 P3:#0              ; I/F Word
CON
SET P2:#1                ; I/F Bit
CON
JMP @MR100               ; HOME
MRD
AND P2:#5                ; I/F Bit
DW #0 P3:#0              ; I/F Word
CON
SET P2:#1                ; I/F Bit
CON
JMP @MR200               ; MOVE
MRD
AND P2:#6                ; I/F Bit
DW #0 P3:#0              ; I/F Word
CON
SET P2:#1                ; I/F Bit
CON
JMP @MR300               ; RTN
MRD
AND P2:#7                ; I/F Bit
DW #0 P3:#0              ; I/F Word
CON
SET P2:#1                ; I/F Bit
CON
JMP @MR400               ; JOG
MRD
AND P2:#8                ; I/F Bit
DW #0 P3:#0              ; I/F Word
CON
SET P2:#1                ; I/F Bit
CON
JMP @MR500               ; INCH
MRD
AND P2:#9                ; I/F Bit
DW #0 P3:#0              ; I/F Word
CON
SET P2:#1                ; I/F Bit
CON
JMP @MR600               ; ARMRST
MPP
AND P2:#12               ; I/F Bit
DW #0 P3:#0              ; I/F Word
CON
SET P2:#1                ; I/F Bit
CON
JMP @MR700
;<h1/>*****#04:HOME*****
;
STG @MR100               ; HOME
ANB @MR014               ; ｱﾗｰﾑ発生
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #0            ; RB_OUT
CON
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #3            ; RB_OUT
CON
BSET P1:#7 #4            ; RB_OUT
CON
JMP @MR101
STG @MR101
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
LD @MR001                ; RB移動許可
BANB P0:#7 #2            ; RB_IN
ANL
JMP @MR102
MPP
ANB @MR001               ; RB移動許可
TMR @12 #100
CON
AND @T12
DW #22 P3:#0             ; I/F Word
CON
JMP @MR115
STG @MR102
ANB @MR014               ; ｱﾗｰﾑ発生
BSET P1:#7 #1            ; RB_OUT
CON
JMP @MR103
STG @MR103
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BANB P0:#7 #0            ; RB_IN
BRES P1:#7 #1            ; RB_OUT
CON
JMP @MR104
MPP
BLD P0:#7 #0             ; RB_IN
BANB P1:#7 #2            ; RB_OUT
ANL
TMR @0 V0                ; TIMEOUT
CON
AND @T0
BRES P1:#7 #1            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR115
STG @MR104
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BLDB P0:#7 #2            ; RB_IN
BAND P0:#7 #0            ; RB_IN
ANL
BRES P1:#7 #1            ; RB_OUT
CON
JMP @MR105
MPP
BLDB P0:#7 #0            ; RB_IN
BANB P1:#7 #2            ; RB_OUT
ANL
TMR @1 #600
CON
AND @T1
BRES P1:#7 #1            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR115
STG @MR105
ANB @MR014               ; ｱﾗｰﾑ発生
SET P2:#2                ; I/F Bit
CON
DW #0 P3:#2              ; I/F Word
CON
DW #0 P3:#4              ; I/F Word
CON
DW #20 P3:#0             ; I/F Word
CON
JMP @MR115
STG @MR115
ANB @MR014               ; ｱﾗｰﾑ発生
RES P2:#4                ; I/F Bit
CON
JMP @MR015
;<h1/>*****#05:MOVE*****
;
STG @MR200               ; MOVE
BSET P1:#7 #4            ; RB_OUT
CON
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
LD @MR001                ; RB移動許可
BANB P0:#7 #2            ; RB_IN
ANL
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #3            ; RB_OUT
CON
JMP @MR201
MPP
ANB @MR001               ; RB移動許可
TMR @2 V0                ; TIMEOUT
CON
AND @T2
DW #22 P3:#0             ; I/F Word
CON
JMP @MR215
;@DM0 = (((P3:8))*6) 	'ﾎﾟｲﾝﾄﾃﾞｰﾀ(EM10000〜)修飾用
;@DM2 = @DM0+2		'位置決め幅修飾用
;@DM4 = @DM0+4		'速度/加減速修飾用
;
;
;P1.D:0 = P4.D:@DM0	'ﾎﾟｲﾝﾄﾃﾞｰﾀ転送
;P1.D:2 = P4.D:@DM2	'位置決め幅転送
;P1.D:4 = P4.D:@DM4	'速度/加減速転送
LD @MR201
NCJ #1000
;@DM0 = (((P3:8))*6) 	'ﾎﾟｲﾝﾄﾃﾞｰﾀ(EM10000〜)修飾用
;
LD CR2002                ; 常時ON
LDA P3:#8                ; I/F Word
CON
EXT
CON
MUL.L +6
CON
STA @DM0
;@DM2 = @DM0+2		'位置決め幅修飾用
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
ADD.L +2
CON
STA @DM2
;@DM4 = @DM0+4		'速度/加減速修飾用
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
ADD.L +4
CON
STA @DM4
;P1.D:0 = P4.D:@DM0	'ﾎﾟｲﾝﾄﾃﾞｰﾀ転送
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
MOV.D P4:Z12 P1          ; PD_DATA  RB_OUT
;P1.D:2 = P4.D:@DM2	'位置決め幅転送
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z12
CON
MOV.D P4:Z12 P1:#2       ; PD_DATA  RB_OUT
;P1.D:4 = P4.D:@DM4	'速度/加減速転送
LD CR2002                ; 常時ON
LDA @DM4
CON
EXT
CON
STA.L Z12
CON
MOV.D P4:Z12 P1:#4       ; PD_DATA  RB_OUT
LABEL #1000
;
STG @MR201
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
AND>= P3:#8 #0           ; I/F Word
TMS @3 #10
CON
AND @T3
BSET P1:#7 #0            ; RB_OUT
CON
JMP @MR202
MPP
AND< P3:#8 #0            ; I/F Word
DW #23 P3:#0             ; I/F Word
CON
JMP @MR215
STG @MR202
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BANB P1:#7 #2            ; RB_OUT
MPS
BANB P0:#7 #0            ; RB_IN
BRES P1:#7 #0            ; RB_OUT
CON
JMP @MR203
MPP
BAND P0:#7 #0            ; RB_IN
TMR @4 V0                ; TIMEOUT
CON
AND @T4
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR215
MPP
BAND P1:#7 #2            ; RB_OUT
JMP @MR215
STG @MR203
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BANB P1:#7 #2            ; RB_OUT
MPS
BLDB P0:#7 #2            ; RB_IN
BAND P0:#7 #0            ; RB_IN
ANL
TMH @11 #10
CON
AND @T11
JMP @MR204
MRD
BLD P0:#7 #2             ; RB_IN
AND P2:#14               ; I/F Bit
ANL
JMP @MR208
MPP
BANB P0:#7 #2            ; RB_IN
TMR @5 #600
CON
AND @T5
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR215
MPP
BAND P1:#7 #2            ; RB_OUT
JMP @MR215
STG @MR208
BSET P1:#7 #2            ; RB_OUT
CON
BANB P0:#7 #2            ; RB_IN
JMP @MR209
STG @MR209
BSET P1:#7 #3            ; RB_OUT
CON
TMH @18 #7
CON
AND @T18
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #3            ; RB_OUT
CON
JMP @MR210
STG @MR210
MPS
BAND P0:#7 #0            ; RB_IN
JMP @MR204
MPP
BLDB P1:#7 #2            ; RB_OUT
BANB P0:#7 #0            ; RB_IN
ANL
TMR @19 V0               ; TIMEOUT
CON
AND @T19
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR215
STG @MR204
ANB @MR014               ; ｱﾗｰﾑ発生
MOV.L P0:#0 P3:#2        ; RB_IN  I/F Word
MOV P3:#8 P3:#4          ; I/F Word  I/F Word
DW #20 P3:#0             ; I/F Word
CON
JMP @MR215
STG @MR215
ANB @MR014               ; ｱﾗｰﾑ発生
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #3            ; RB_OUT
CON
RES P2:#5                ; I/F Bit
CON
RES P2:#14               ; I/F Bit
CON
JMP @MR015
;<h1/>*****#06:RTN*****
;
STG @MR300               ; RTN
ANB @MR014               ; ｱﾗｰﾑ発生
BSET P1:#7 #4            ; RB_OUT
CON
MPS
LD @MR001                ; RB移動許可
BANB P0:#7 #2            ; RB_IN
ANL
JMP @MR301
MPP
ANB @MR001               ; RB移動許可
TMR @6 V0                ; TIMEOUT
CON
AND @T6
DW #22 P3:#0             ; I/F Word
CON
JMP @MR315
;@DM0.U = P3:8 * 2
;P1.D:0 = P4.D:@DM0	'ﾎﾟｲﾝﾄﾃﾞｰﾀ転送
;P1:2 = P3:8			'ﾎﾟｲﾝﾄNo設定
LD @MR301
NCJ #1001
;@DM0.U = P3:8 * 2
;
LD CR2002                ; 常時ON
LDA P3:#8                ; I/F Word
CON
EXT
CON
MUL.L +2
CON
STA @DM0
;P1.D:0 = P4.D:@DM0	'ﾎﾟｲﾝﾄﾃﾞｰﾀ転送
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
MOV.D P4:Z12 P1          ; PD_DATA  RB_OUT
;P1:2 = P3:8			'ﾎﾟｲﾝﾄNo設定
LD CR2002                ; 常時ON
MOV P3:#8 P1:#2          ; I/F Word  RB_OUT
LABEL #1001
;
STG @MR301
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
AND>= P3:#8 #0           ; I/F Word
TMS @7 #10
CON
AND @T7
BSET P1:#7 #0            ; RB_OUT
CON
JMP @MR302
MPP
AND< P3:#8 #0            ; I/F Word
DW #23 P3:#0             ; I/F Word
CON
JMP @MR315
STG @MR302
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BANB P0:#7 #0            ; RB_IN
BRES P1:#7 #0            ; RB_OUT
CON
JMP @MR303
MPP
BAND P0:#7 #0            ; RB_IN
TMR @8 V0                ; TIMEOUT
CON
AND @T8
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR315
STG @MR303
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BLDB P0:#7 #2            ; RB_IN
BAND P0:#7 #0            ; RB_IN
ANL
TMH @20 #10
CON
AND @T20
JMP @MR304
MPP
BANB P2:#3 #0            ; I/F Bit
TMR @9 V0                ; TIMEOUT
CON
AND @T9
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR315
STG @MR304
ANB @MR014               ; ｱﾗｰﾑ発生
DW #20 P3:#0             ; I/F Word
CON
JMP @MR315
STG @MR315
ANB @MR014               ; ｱﾗｰﾑ発生
RES P2:#6                ; I/F Bit
CON
JMP @MR015
;<h1/>*****#07:JOG******
;
STG @MR400               ; JOG
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
LD @MR001                ; RB移動許可
BANB P2:#3 #2            ; I/F Bit
ANL
JMP @MR401
MPP
ANB @MR001               ; RB移動許可
TMR @10 V0               ; TIMEOUT
CON
AND @T10
DW #22 P3:#0             ; I/F Word
CON
JMP @MR415
STG @MR401
ANB @MR014               ; ｱﾗｰﾑ発生
BRES P1:#7 #5            ; RB_OUT
CON
MPS
AND<> P3:#6 #1           ; I/F Word
BRES P1:#7 #6            ; RB_OUT
CON
JMP @MR402
MPP
AND= P3:#6 #1            ; I/F Word
BSET P1:#7 #6            ; RB_OUT
CON
JMP @MR402
STG @MR402
ANB @MR014               ; ｱﾗｰﾑ発生
MOV.L P0:#0 P3:#2        ; RB_IN  I/F Word
MPS
AND P2:#7                ; I/F Bit
MPS
AND= P3:#7 #1            ; I/F Word
BRES P1:#7 #7            ; RB_OUT
CON
BSET P1:#7 #8            ; RB_OUT
MPP
AND<> P3:#7 #1           ; I/F Word
BSET P1:#7 #7            ; RB_OUT
CON
BRES P1:#7 #8            ; RB_OUT
MPP
ANB P2:#7                ; I/F Bit
BRES P1:#7 #7            ; RB_OUT
CON
BRES P1:#7 #8            ; RB_OUT
CON
JMP @MR403
STG @MR403
ANB @MR014               ; ｱﾗｰﾑ発生
BRES P1:#7 #6            ; RB_OUT
CON
BRES P1:#7 #7            ; RB_OUT
CON
BRES P1:#7 #8            ; RB_OUT
CON
JMP @MR404
STG @MR404
ANB @MR014               ; ｱﾗｰﾑ発生
MOV.L P0:#0 P3:#2        ; RB_IN  I/F Word
DW #20 P3:#0             ; I/F Word
CON
JMP @MR415
STG @MR415
ANB @MR014               ; ｱﾗｰﾑ発生
RES P2:#7                ; I/F Bit
CON
JMP @MR015
;<h1/>*****#08:INCH*****
;
STG @MR500               ; INCH
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
LD @MR001                ; RB移動許可
BANB P2:#3 #2            ; I/F Bit
ANL
JMP @MR501
MPP
ANB @MR001               ; RB移動許可
TMR @13 V0               ; TIMEOUT
CON
AND @T13
DW #22 P3:#0             ; I/F Word
CON
JMP @MR515
STG @MR501
ANB @MR014               ; ｱﾗｰﾑ発生
BSET P1:#7 #5            ; RB_OUT
CON
MPS
AND<> P3:#6 #1           ; I/F Word
BRES P1:#7 #6            ; RB_OUT
CON
JMP @MR502
MPP
AND= P3:#6 #1            ; I/F Word
BSET P1:#7 #6            ; RB_OUT
CON
JMP @MR502
STG @MR502
ANB @MR014               ; ｱﾗｰﾑ発生
MOV.L P0:#0 P3:#2        ; RB_IN  I/F Word
MPS
AND= P3:#7 #1            ; I/F Word
BRES P1:#7 #7            ; RB_OUT
CON
BSET P1:#7 #8            ; RB_OUT
CON
JMP @MR503
MPP
AND<> P3:#7 #1           ; I/F Word
BSET P1:#7 #7            ; RB_OUT
CON
BRES P1:#7 #8            ; RB_OUT
CON
JMP @MR503
STG @MR503
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BANB P0:#7 #2            ; RB_IN
TMH @17 #50
CON
AND @T17
BRES P1:#7 #6            ; RB_OUT
CON
BRES P1:#7 #7            ; RB_OUT
CON
BRES P1:#7 #8            ; RB_OUT
CON
JMP @MR504
MPP
BAND P0:#7 #2            ; RB_IN
TMR @14 V0               ; TIMEOUT
CON
AND @T14
BRES P1:#7 #6            ; RB_OUT
CON
BRES P1:#7 #7            ; RB_OUT
CON
BRES P1:#7 #8            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR515
STG @MR504
ANB @MR014               ; ｱﾗｰﾑ発生
MOV.L P0:#0 P3:#2        ; RB_IN  I/F Word
DW #20 P3:#0             ; I/F Word
CON
JMP @MR515
STG @MR515
ANB @MR014               ; ｱﾗｰﾑ発生
RES P2:#8                ; I/F Bit
CON
JMP @MR015
;<h1/>*****#09:ARMRST*****
;
STG @MR600               ; ARMRST
BSET P1:#7 #3            ; RB_OUT
CON
MPS
BANB P0:#7 #3            ; RB_IN
JMP @MR601
MPP
BAND P0:#7 #3            ; RB_IN
TMH @15 V0               ; TIMEOUT
CON
AND @T15
DW #21 P3:#0             ; I/F Word
CON
JMP @MR607
STG @MR601
BRES P1:#7 #3            ; RB_OUT
CON
BSET P1:#7 #4            ; RB_OUT
CON
MPS
BLDB P0:#7 #3            ; RB_IN
BAND P0:#7 #4            ; RB_IN
BAND P0:#7 #14           ; RB_IN
ANL
DW #20 P3:#0             ; I/F Word
CON
JMP @MR607
MPP
BLD P0:#7 #3             ; RB_IN
BORB P0:#7 #14           ; RB_IN
BORB P0:#7 #4            ; RB_IN
ANL
TMR @16 #100
CON
AND @T16
DW #21 P3:#0             ; I/F Word
CON
JMP @MR607
STG @MR607
RES P2:#9                ; I/F Bit
CON
JMP @MR015
;<h1/>*****#12:Push*****
;
STG @MR700
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
LD @MR001                ; RB移動許可
BANB P0:#7 #2            ; RB_IN
ANL
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #3            ; RB_OUT
CON
JMP @MR701
MPP
ANB @MR001               ; RB移動許可
TMR @21 V0               ; TIMEOUT
CON
AND @T21
DW #22 P3:#0             ; I/F Word
CON
JMP @MR715
;@DM0 = (((P3:8))*6) 	'ﾎﾟｲﾝﾄﾃﾞｰﾀ(EM10000〜)修飾用
;@DM2 = @DM0+2		'位置決め幅修飾用
;@DM4 = @DM0+4		'速度/加減速修飾用
;
;
;P1.D:0 = P4.D:@DM0	'ﾎﾟｲﾝﾄﾃﾞｰﾀ転送
;P1.D:2 = P4.D:@DM2	'位置決め幅転送
;P1.D:4 = P4.D:@DM4	'速度/加減速転送
;
;@DM7 = P6.U *51 / 20 '(電流値は0-255での指定)
;P1.U:6 = @DM7
LD @MR701
NCJ #1002
;@DM0 = (((P3:8))*6) 	'ﾎﾟｲﾝﾄﾃﾞｰﾀ(EM10000〜)修飾用
;
LD CR2002                ; 常時ON
LDA P3:#8                ; I/F Word
CON
EXT
CON
MUL.L +6
CON
STA @DM0
;@DM2 = @DM0+2		'位置決め幅修飾用
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
ADD.L +2
CON
STA @DM2
;@DM4 = @DM0+4		'速度/加減速修飾用
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
ADD.L +4
CON
STA @DM4
;P1.D:0 = P4.D:@DM0	'ﾎﾟｲﾝﾄﾃﾞｰﾀ転送
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
MOV.D P4:Z12 P1          ; PD_DATA  RB_OUT
;P1.D:2 = P4.D:@DM2	'位置決め幅転送
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z12
CON
MOV.D P4:Z12 P1:#2       ; PD_DATA  RB_OUT
;P1.D:4 = P4.D:@DM4	'速度/加減速転送
;
LD CR2002                ; 常時ON
LDA @DM4
CON
EXT
CON
STA.L Z12
CON
MOV.D P4:Z12 P1:#4       ; PD_DATA  RB_OUT
;@DM7 = P6.U *51 / 20 '(電流値は0-255での指定)
;
LD CR2002                ; 常時ON
LDA P6                   ; RB_TRQS
CON
EXT
CON
MUL.L +51
CON
DIV.L +20
CON
STA @DM7
;P1.U:6 = @DM7
LD CR2002                ; 常時ON
MOV @DM7 P1:#6           ; RB_OUT
LABEL #1002
;
STG @MR701
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
AND>= P3:#8 #0           ; I/F Word
TMS @22 #10
CON
AND @T22
BSET P1:#7 #13           ; RB_OUT
CON
BSET P1:#7 #12           ; RB_OUT
CON
BSET P1:#7 #0            ; RB_OUT
CON
JMP @MR702
MPP
AND< P3:#8 #0            ; I/F Word
DW #23 P3:#0             ; I/F Word
CON
JMP @MR715
STG @MR702
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BANB P0:#7 #0            ; RB_IN
BRES P1:#7 #0            ; RB_OUT
CON
JMP @MR703
MPP
BAND P0:#7 #0            ; RB_IN
TMR @23 V0               ; TIMEOUT
CON
AND @T23
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR715
STG @MR703
ANB @MR014               ; ｱﾗｰﾑ発生
MPS
BANB P0:#7 #2            ; RB_IN
MPS
BLDB P0:#7 #5            ; RB_IN
BAND P0:#7 #0            ; RB_IN
ANL
TMH @24 #10
CON
AND @T24
JMP @MR704
MPP
BAND P0:#7 #5            ; RB_IN
DW #24 P3:#0             ; I/F Word
CON
JMP @MR715
MRD
BLD P0:#7 #2             ; RB_IN
AND P2:#14               ; I/F Bit
ANL
JMP @MR708
MPP
BANB P0:#7 #2            ; RB_IN
TMR @25 #600
CON
AND @T25
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR715
STG @MR708
BSET P1:#7 #2            ; RB_OUT
CON
BANB P0:#7 #2            ; RB_IN
JMP @MR709
STG @MR709
BSET P1:#7 #3            ; RB_OUT
CON
TMH @26 #7
CON
AND @T26
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #3            ; RB_OUT
CON
JMP @MR710
STG @MR710
MPS
BAND P0:#7 #0            ; RB_IN
JMP @MR704
MPP
BLDB P1:#7 #2            ; RB_OUT
BANB P0:#7 #0            ; RB_IN
ANL
TMR @27 V0               ; TIMEOUT
CON
AND @T27
BRES P1:#7 #0            ; RB_OUT
CON
DW #21 P3:#0             ; I/F Word
CON
JMP @MR715
STG @MR704
ANB @MR014               ; ｱﾗｰﾑ発生
MOV.L P0:#0 P3:#2        ; RB_IN  I/F Word
MOV P3:#8 P3:#4          ; I/F Word  I/F Word
DW #20 P3:#0             ; I/F Word
CON
JMP @MR715
STG @MR715
ANB @MR014               ; ｱﾗｰﾑ発生
BRES P1:#7 #12           ; RB_OUT
CON
BRES P1:#7 #2            ; RB_OUT
CON
BRES P1:#7 #3            ; RB_OUT
CON
RES P2:#12               ; I/F Bit
CON
RES P2:#14               ; I/F Bit
CON
JMP @MR015
;終了処理
STG @MR015
SET P2:#0                ; I/F Bit
CON
RES P2:#1                ; I/F Bit
CON
JMP @MR000
LD P2:#3                 ; I/F Bit
OR P5                    ; EMG_FLAG
ZRES P1:#0 P1:#7         ; RB_OUT  RB_OUT
CON
ZRES P2:#0 P2:#2         ; I/F Bit  I/F Bit
CON
ZRES P2:#4 P2:#15        ; I/F Bit  I/F Bit
CON
ZRES @MR000 @MR615
LD P2:#3                 ; I/F Bit
OR P5                    ; EMG_FLAG
MEND
END
ENDH
