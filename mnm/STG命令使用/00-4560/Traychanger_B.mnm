DEVICE:53
;MODULE:Traychanger_B
;MODULE_TYPE:0
;SCRIPT_TYPE:
;非常停止 / Emergency stop
LD R50000                ; 即停止
OR R50415                ; TRAP
OR R50010                ; 非常停止
ZRES @MR002 @MR3915
;条件ﾌﾗｸﾞ / Flug
LD R6712                 ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
AND R5000                ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
AND R4206                ; OK_B級品 ﾄﾚｲ浮き1(上流側)
AND R4207                ; OK_B級品 ﾄﾚｲ浮き2(下流側)
OUT @MR008               ; Bﾗﾝｸﾄﾚｲ有
LDB R4206                ; OK_B級品 ﾄﾚｲ浮き1(上流側)
ORB R4207                ; OK_B級品 ﾄﾚｲ浮き2(下流側)
OUT @MR009               ; Bﾗﾝｸﾄﾚｲ浮き
LDB R50300               ; PAUSE中
ANB R51001               ; 全体･ｼｽﾃﾑ部ｴﾗｰ中
ANB R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
ANB R50108               ; ｴﾗｰ発生中
OUT @MR010               ; Main部一時停止ｴﾗｰ無し
LDB R50300               ; PAUSE中
ANB R50301               ; ﾄﾚﾁｪﾝ     PAUSE中
ANB R51001               ; 全体･ｼｽﾃﾑ部ｴﾗｰ中
ANB R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
ANB R50108               ; ｴﾗｰ発生中
OUT @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
LD R6712                 ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
ANB R5000                ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
TMR @5 #30               ; ﾄﾚｲｸﾗﾝﾌﾟ閉後一定時間経過
;<h1/>■■■　AUTO動作 / AUTO OPERATION
LD R50011                ; AUTO MODE
ANB MR11301              ; ﾄﾚﾁｪﾝB_ｻｲｸﾙ中
AND MR11101              ; ﾄﾚﾁｪﾝB_ Start
MPS
LD LR41000               ; 自動ﾊﾟﾗﾒｰﾀ1　通常動作
OR LR41001               ; 自動ﾊﾟﾗﾒｰﾀ2　払い出し
ANL
RES MR11501              ; ﾄﾚﾁｪﾝB_ｻｲｸﾙ終了
CON
SET MR11301              ; ﾄﾚﾁｪﾝB_ｻｲｸﾙ中
CON
RES MR11101              ; ﾄﾚﾁｪﾝB_ Start
CON
SET @MR1900              ; 初期ﾄﾚｲ確認
MPP
AND LR41008              ; 自動ﾊﾟﾗﾒｰﾀ9  PASS
RES MR11501              ; ﾄﾚﾁｪﾝB_ｻｲｸﾙ終了
CON
RES MR11301              ; ﾄﾚﾁｪﾝB_ｻｲｸﾙ中
CON
RES MR11101              ; ﾄﾚﾁｪﾝB_ Start
CON
SET @MR2300              ; ｻｲｸﾙ終了
;初期ﾄﾚｲ確認
STG @MR1900              ; 初期ﾄﾚｲ確認
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
DW #0 @DM0               ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR1901
STG @MR1901
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
SET MR6712               ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
LD R5000                 ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
OR @T5                   ; ﾄﾚｲｸﾗﾝﾌﾟ閉後一定時間経過
ANL
@INC @DM0                ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR1902
STG @MR1902
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND>= @DM0 DM100         ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR1906
MPP
AND< @DM0 DM100          ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR1903
STG @MR1903
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @32 #3
CON
AND @T32
JMP @MR1904
STG @MR1904
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6712               ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R5001                ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 開限
JMP @MR1905
STG @MR1905
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @33 #3
CON
AND @T33
JMP @MR1901
STG @MR1906
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
DW #0 @DM0               ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR1907
STG @MR1907
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @34 #10
CON
AND @T34
MPS
ANB R52903               ; 段数ﾘｾｯﾄ無
JMP @MR2000              ; AUTO MAIN
MPP
AND R52903               ; 段数ﾘｾｯﾄ無
MPS
AND<> DM514 #0           ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
JMP @MR2000              ; AUTO MAIN
MPP
AND= DM514 #0            ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
DIFU R52500              ; TC_B 取出No.Inc
CON
JMP @MR2000              ; AUTO MAIN
;AUTO動作MAIN
STG @MR2000              ; AUTO MAIN
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
AND @MR008               ; Bﾗﾝｸﾄﾚｲ有
MPS
LD<> DM514 #0            ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
ANB R46001               ; Bﾄﾚｲﾁｪﾝｼﾞ要求
ANL
JMP @MR2100
MPP
LD= DM514 #0             ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
OR R46001                ; Bﾄﾚｲﾁｪﾝｼﾞ要求
ANL
DIFU R52504              ; TC_B 取出No.ﾘｾｯﾄ2
CON
JMP @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
MPP
ANB @MR008               ; Bﾗﾝｸﾄﾚｲ有
MPS
ANB @MR009               ; Bﾗﾝｸﾄﾚｲ浮き
DIFU R52505              ; TC_B 取出No.ﾘｾｯﾄ3
CON
JMP @MR2600              ; 空ﾄﾚｲ在荷確認
MPP
AND @MR009               ; Bﾗﾝｸﾄﾚｲ浮き
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
SET @MR400               ; ERR47Bﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2001
;☆　ﾄﾚｲｸﾗﾝﾌﾟ異常 / Tray clamp error
STG @MR2001
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR407               ; ERR47解除
RES @MR407               ; ERR47解除
CON
JMP @MR2002
STG @MR2002
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
ANB R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2000              ; AUTO MAIN
MPP
AND R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2003
STG @MR2003
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
MPS
LDB @MR008               ; Bﾗﾝｸﾄﾚｲ有
ANB @MR009               ; Bﾗﾝｸﾄﾚｲ浮き
ANL
JMP @MR2000              ; AUTO MAIN
MPP
LD @MR008                ; Bﾗﾝｸﾄﾚｲ有
OR @MR009                ; Bﾗﾝｸﾄﾚｲ浮き
ANL
SET @MR400               ; ERR47Bﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2001
;<h1/>       ・次取出し位置へ移動 / Move to next pick up point
;ｸﾗﾝﾌﾟ閉じ / Close tray clamp
STG @MR2100
AND @MR010               ; Main部一時停止ｴﾗｰ無し
SET MR6712               ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
TMH @11 #10
CON
AND @T11
AND R5000                ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
OUT R50400               ; Call Post
CON
AND R50402               ; Post Ok
JMP @MR2101
STG @MR2101
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2105
MPP
AND R52905               ; ﾄﾚｲ押さえ有り
MPS
AND= DM516 DM512         ; RB3取出しPosition No.  RB3現在Position No.
JMP @MR2200              ; TC_B　給材要求ON
MPP
AND<> DM516 DM512        ; RB3取出しPosition No.  RB3現在Position No.
JMP @MR2102
;移動高さへ下降 / Down to slide position
STG @MR2102
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2103
STG @MR2103
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2104
MPP
MCALL POINT_MOVE1 #2 #4 #1 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2104
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2105
;受渡位置へ移動 / Move to delivery
STG @MR2105
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R22003               ; TCb Y軸_移動可
ANB R22101               ; TCb Y軸_移動中
ANB R22102               ; TCb Y軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2106
STG @MR2106
MPS
AND R22102               ; TCb Y軸_移動完了
JMP @MR2107
MPP
MCALL POINT_MOVE1 #2 #3 DM516 R22111 R22102;RB3取出しPosition No.  TCb Y軸_位置決め異常  TCb Y軸_移動完了
STG @MR2107
RES R22102               ; TCb Y軸_移動完了
CON
ANB R22102               ; TCb Y軸_移動完了
RES @MR3900              ; 一時停止禁止
CON
MPS
AND R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2108
MPP
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2200              ; TC_B　給材要求ON
;受取高さへ上昇 / Up to resive position
STG @MR2108
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2109
STG @MR2109
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2110
MPP
MCALL POINT_MOVE1 #2 #4 #6 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2110
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23505               ; TCb Z軸 P6 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2200              ; TC_B　給材要求ON
;反転　除材完了待ち / Waiting for End of Reverser remove
STG @MR2200              ; TC_B　給材要求ON
AND @MR010               ; Main部一時停止ｴﾗｰ無し
SET R52510               ; TC_B 給材要求
CON
JMP @MR2201
STG @MR2201
MPS
ANB MR11406              ; 除材PPｻｲｸﾙ終了
MPS
AND R52511               ; TC_B 給材中
JMP @MR2203
MPP
LDB R52511               ; TC_B 給材中
AND R46001               ; Bﾄﾚｲﾁｪﾝｼﾞ要求
ANL
RES R52510               ; TC_B 給材要求
CON
JMP @MR2202
MPP
AND MR11406              ; 除材PPｻｲｸﾙ終了
RES R52510               ; TC_B 給材要求
CON
JMP @MR2301
STG @MR2202
MPS
ANB R52511               ; TC_B 給材中
TMR @40 #5
CON
AND @T40
DIFU R52501              ; TC_B 取出No.ﾘｾｯﾄ1
CON
JMP @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
MPP
AND R52511               ; TC_B 給材中
JMP @MR2203
STG @MR2203
ANB R52511               ; TC_B 給材中
AND R52512               ; TC_B 給材完了
RES R52510               ; TC_B 給材要求
CON
RES R52512               ; TC_B 給材完了
CON
JMP @MR2204
;取出しNo.+1 / Pick up No. +1
STG @MR2204
DIFU R52500              ; TC_B 取出No.Inc
CON
JMP @MR2300              ; ｻｲｸﾙ終了
;ｻｲｸﾙ終了処理 / cycle end process
STG @MR2300              ; ｻｲｸﾙ終了
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB MR11406              ; 除材PPｻｲｸﾙ終了
JMP @MR2000              ; AUTO MAIN
MPP
AND MR11406              ; 除材PPｻｲｸﾙ終了
JMP @MR2301
STG @MR2301
RES R46001               ; Bﾄﾚｲﾁｪﾝｼﾞ要求
CON
RES MR11301              ; ﾄﾚﾁｪﾝB_ｻｲｸﾙ中
CON
SET MR11501              ; ﾄﾚﾁｪﾝB_ｻｲｸﾙ終了
CON
ENDS
;<h1/>       ・ﾄﾚｲﾁｪﾝｼﾞ / Tray change
;移動高さへ下降 / Down to slide position
STG @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2403
MPP
LD R52905                ; ﾄﾚｲ押さえ有り
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
ANL
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2401
STG @MR2401
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2402
MPP
MCALL POINT_MOVE1 #2 #4 #1 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2402
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2403
;実ﾄﾚｲ排出位置へ / move to Empty tray eject point
STG @MR2403
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R22003               ; TCb Y軸_移動可
ANB R22101               ; TCb Y軸_移動中
ANB R22102               ; TCb Y軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2404
STG @MR2404
MPS
AND R22102               ; TCb Y軸_移動完了
JMP @MR2405
MPP
MCALL POINT_MOVE1 #2 #3 #9 R22111 R22102;TCb Y軸_位置決め異常  TCb Y軸_移動完了
STG @MR2405
RES R22102               ; TCb Y軸_移動完了
CON
ANB R22102               ; TCb Y軸_移動完了
AND R22508               ; TCb Y軸 P9 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2406
;実ﾄﾚｲ下位置へ / move to tray low level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2406
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
AND R22508               ; TCb Y軸 P9 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2407
STG @MR2407
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2408
MPP
MCALL POINT_MOVE1 #2 #4 #4 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2408
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23503               ; TCb Z軸 P4 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2500
;実ﾄﾚｲｾﾊﾟﾚｰﾀ　開 / Empty tray separater open
STG @MR2500
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6709               ; OK_B級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ1 閉
CON
SET MR6708               ; OK_B級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ 開
CON
AND R4908                ; B級実ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 開限
AND R4910                ; B級実ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 開限
JMP @MR2501
;実ﾄﾚｲ上位置へ / move to Empty tray upper level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2501
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
AND R22508               ; TCb Y軸 P9 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2502
STG @MR2502
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2503
MPP
MCALL POINT_MOVE1 #2 #4 #5 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2503
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23504               ; TCb Z軸 P5 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2504
;ﾄﾚｲｸﾗﾝﾌﾟ 開 / Tray clamp open
STG @MR2504
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6712               ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R5001                ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 開限
JMP @MR2505
;実ﾄﾚｲｾﾊﾟﾚｰﾀ 閉 / Empty tray separater close
STG @MR2505
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6708               ; OK_B級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ 開
CON
SET MR6709               ; OK_B級品 実ﾄﾚｲｾﾊﾟﾚｰﾀ1 閉
CON
AND R4909                ; B級実ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 閉限
AND R4911                ; B級実ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 閉限
JMP @MR2506
;受渡位置へ / move to delevery point
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2506
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
AND R22508               ; TCb Y軸 P9 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2507
STG @MR2507
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2508
MPP
MCALL POINT_MOVE1 #2 #4 #1 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2508
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2509              ; 実ﾄﾚｲ満杯検出
;実ﾄﾚｲ満杯確認 / Empty tray full detection check
STG @MR2509              ; 実ﾄﾚｲ満杯検出
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND R4114                ; OK_B級品 実ﾄﾚｲ満杯検出
JMP @MR2600              ; 空ﾄﾚｲ在荷確認
MPP
ANB R4114                ; OK_B級品 実ﾄﾚｲ満杯検出
SET @MR300               ; ERR45B実ﾄﾚｲ満杯
CON
JMP @MR2510
;実ﾄﾚｲ満杯 / Empty tray Full error
STG @MR2510
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR307               ; ERR45解除
RES @MR307               ; ERR45解除
CON
JMP @MR2509              ; 実ﾄﾚｲ満杯検出
;空在荷確認前　移動高さへ下降 / Down to slide position before empty tray check
STG @MR2600              ; 空ﾄﾚｲ在荷確認
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR2603
MPP
LD R52905                ; ﾄﾚｲ押さえ有り
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
ANL
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2601
STG @MR2601
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2602
MPP
MCALL POINT_MOVE1 #2 #4 #1 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2602
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2603
;空ﾄﾚｲ在荷確認 / Enough tray check
STG @MR2603
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND R4113                ; OK_B級品 空ﾄﾚｲ検出　ON=有
JMP @MR2700
MPP
ANB R4113                ; OK_B級品 空ﾄﾚｲ検出　ON=有
SET @MR308               ; ERR46B空ﾄﾚｲ残少
CON
JMP @MR2604
;実ﾄﾚｲ残少 / Supply tray low
STG @MR2604
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR315               ; ERR46解除
RES @MR315               ; ERR46解除
CON
JMP @MR2700
;空ﾄﾚｲ受取位置へ / move to tray Supply point
STG @MR2700
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES R46001               ; Bﾄﾚｲﾁｪﾝｼﾞ要求
CON
RES MR6712               ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R22003               ; TCb Y軸_移動可
ANB R22101               ; TCb Y軸_移動中
ANB R22102               ; TCb Y軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2701
STG @MR2701
MPS
AND R22102               ; TCb Y軸_移動完了
JMP @MR2702
MPP
MCALL POINT_MOVE1 #2 #3 #8 R22111 R22102;TCb Y軸_位置決め異常  TCb Y軸_移動完了
STG @MR2702
RES R22102               ; TCb Y軸_移動完了
CON
ANB R22102               ; TCb Y軸_移動完了
AND R22507               ; TCb Y軸 P8 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2703
;空ﾄﾚｲ上位置へ / move to tray supply upper level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2703
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
AND R22507               ; TCb Y軸 P8 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2704
STG @MR2704
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2705
MPP
MCALL POINT_MOVE1 #2 #4 #3 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2705
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23502               ; TCb Z軸 P3 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2706
;空ﾄﾚｲｾﾊﾟﾚｰﾀ 開 / Supply tray separater open
STG @MR2706
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6711               ; OK_B級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ 閉
CON
SET MR6710               ; OK_B級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ1 開
CON
AND R4912                ; B級空ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 開限
AND R4914                ; B級空ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 開限
JMP @MR2707
;空ﾄﾚｲ下位置へ / move to tray supply lower level
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2707
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
AND R22507               ; TCb Y軸 P8 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2708
STG @MR2708
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2709
MPP
MCALL POINT_MOVE1 #2 #4 #2 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2709
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23501               ; TCb Z軸 P2 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2710
;空ﾄﾚｲｾﾊﾟﾚｰﾀ 閉 / Supply tray separater close
STG @MR2710
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6710               ; OK_B級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ1 開
CON
SET MR6711               ; OK_B級品 空ﾄﾚｲｾﾊﾟﾚｰﾀ 閉
CON
AND R4913                ; B級空ﾄﾚｲｾﾊﾟﾚｰﾀ1(上) 閉限
AND R4915                ; B級空ﾄﾚｲｾﾊﾟﾚｰﾀ2(下) 閉限
JMP @MR2711
;受渡位置へ / move to delevery point
;0:原点   1:受渡位置   2:空ﾄﾚｲ下   3:空ﾄﾚｲ上   4:実ﾄﾚｲ下   5:実ﾄﾚｲ上
STG @MR2711
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
AND R22507               ; TCb Y軸 P8 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR2712
STG @MR2712
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR2713
MPP
MCALL POINT_MOVE1 #2 #4 #1 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR2713
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR2800
;ﾄﾚｲｸﾗﾝﾌﾟ操作 / Tray clamp operation
STG @MR2800
DW #0 @DM0               ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR2801
STG @MR2801
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
SET MR6712               ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R5000                ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉限
@INC @DM0                ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR2802
STG @MR2802
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
AND>= @DM0 DM100         ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR2806
MPP
AND< @DM0 DM100          ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数  ﾄﾚｲｸﾗﾝﾌﾟ設定回数
JMP @MR2803
STG @MR2803
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @30 #3
CON
AND @T30
JMP @MR2804
STG @MR2804
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES MR6712               ; OK_B級品 ﾄﾚｲｸﾗﾝﾌﾟ 閉
CON
AND R5001                ; B級品 ﾄﾚｲｸﾗﾝﾌﾟ 開限
JMP @MR2805
STG @MR2805
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @31 #3
CON
AND @T31
JMP @MR2801
STG @MR2806
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
@INC @DM0                ; ﾄﾚｲｸﾗﾝﾌﾟ実行回数
CON
JMP @MR2900
;ﾄﾚｲ確認	/ Tray check　
STG @MR2900
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
TMR @10 #10
CON
AND @T10
MPS
AND @MR008               ; Bﾗﾝｸﾄﾚｲ有
MPS
ANB R52903               ; 段数ﾘｾｯﾄ無
DIFU R52500              ; TC_B 取出No.Inc
CON
JMP @MR3000
MPP
AND R52903               ; 段数ﾘｾｯﾄ無
JMP @MR3000
MPP
ANB @MR008               ; Bﾗﾝｸﾄﾚｲ有
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
SET @MR400               ; ERR47Bﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2901
;ﾄﾚｲ未検出 / No tray
STG @MR2901
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
AND @MR407               ; ERR47解除
RES @MR407               ; ERR47解除
CON
JMP @MR2902
STG @MR2902
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
MPS
ANB R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2900
MPP
AND R310                 ; ﾊﾟｽｽｲｯﾁON
JMP @MR2903
STG @MR2903
AND @MR011               ; ﾄﾚﾁｪﾝ部一時停止ｴﾗｰ無し
RES R310                 ; ﾊﾟｽｽｲｯﾁON
CON
MPS
LDB @MR008               ; Bﾗﾝｸﾄﾚｲ有
ANB @MR009               ; Bﾗﾝｸﾄﾚｲ浮き
ANL
JMP @MR2600              ; 空ﾄﾚｲ在荷確認
MPP
LD @MR008                ; Bﾗﾝｸﾄﾚｲ有
OR @MR009                ; Bﾗﾝｸﾄﾚｲ浮き
ANL
SET @MR400               ; ERR47Bﾗﾝｸﾄﾚｲ異常
CON
JMP @MR2901
;空ﾄﾚｲ受渡位置へ / move to tray Delivery point
STG @MR3000
AND @MR010               ; Main部一時停止ｴﾗｰ無し
TMR @41 #5
CON
AND @T41
AND R22003               ; TCb Y軸_移動可
ANB R22101               ; TCb Y軸_移動中
ANB R22102               ; TCb Y軸_移動完了
AND R23500               ; TCb Z軸 P1 位置　表示
SET @MR3900              ; 一時停止禁止
CON
JMP @MR3001
STG @MR3001
MPS
AND R22102               ; TCb Y軸_移動完了
JMP @MR3002
MPP
MCALL POINT_MOVE1 #2 #3 DM516 R22111 R22102;RB3取出しPosition No.  TCb Y軸_位置決め異常  TCb Y軸_移動完了
STG @MR3002
RES R22102               ; TCb Y軸_移動完了
CON
ANB R22102               ; TCb Y軸_移動完了
RES @MR3900              ; 一時停止禁止
CON
MPS
AND R52905               ; ﾄﾚｲ押さえ有り
JMP @MR3003
MPP
ANB R52905               ; ﾄﾚｲ押さえ有り
JMP @MR3006
;受取高さへ上昇 / Up to resive position
STG @MR3003
AND @MR010               ; Main部一時停止ｴﾗｰ無し
AND R23003               ; TCb Z軸_移動可
ANB R23101               ; TCb Z軸_移動中
ANB R23102               ; TCb Z軸_移動完了
SET @MR3900              ; 一時停止禁止
CON
JMP @MR3004
STG @MR3004
MPS
AND R23102               ; TCb Z軸_移動完了
JMP @MR3005
MPP
MCALL POINT_MOVE1 #2 #4 #6 R23111 R23102;TCb Z軸_位置決め異常  TCb Z軸_移動完了
STG @MR3005
RES R23102               ; TCb Z軸_移動完了
CON
ANB R23102               ; TCb Z軸_移動完了
AND R23505               ; TCb Z軸 P6 位置　表示
RES @MR3900              ; 一時停止禁止
CON
JMP @MR3006
STG @MR3006
AND @MR010               ; Main部一時停止ｴﾗｰ無し
MPS
ANB R50002               ; 手動中
JMP @MR2200              ; TC_B　給材要求ON
MPP
AND R50002               ; 手動中
JMP @MR3801              ; STEP終了処理
;<h1/>■■■　STEP動作
LD LR41102               ; Bﾗﾝｸﾄﾚｲ交換
ANB R50210               ; STEPｻｲｸﾙ終了
ANP R50211               ; STEP動作開始
RES R50211               ; STEP動作開始
CON
SET @MR3800
STG @MR3800
AND @MR010               ; Main部一時停止ｴﾗｰ無し
DIFU R52504              ; TC_B 取出No.ﾘｾｯﾄ2
CON
JMP @MR2400              ; ﾄﾚｲﾁｪﾝｼﾞ 実ﾄﾚｲ排出
;・・・　ﾄﾚｲﾁｪﾝｼﾞ動作
STG @MR3801              ; STEP終了処理
AND @MR010               ; Main部一時停止ｴﾗｰ無し
SET R50210               ; STEPｻｲｸﾙ終了
CON
ENDS
;<h1/>/// ｱﾗｰﾑ処理
;ERR45
STG @MR300               ; ERR45B実ﾄﾚｲ満杯
ANB R50008               ; 全体ｴﾗｰ発生
SET R50008               ; 全体ｴﾗｰ発生
CON
SET R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
CON
SET R50713               ; ERR45 
CON
JMP @MR301
MOV #45 DM400            ; 表示画面No.
STG @MR301
AND R50008               ; 全体ｴﾗｰ発生
JMP @MR302
STG @MR302
ANB R50008               ; 全体ｴﾗｰ発生
SET @MR307               ; ERR45解除
CON
ENDS
;ERR46
STG @MR308               ; ERR46B空ﾄﾚｲ残少
ANB R50008               ; 全体ｴﾗｰ発生
SET R50008               ; 全体ｴﾗｰ発生
CON
SET R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
CON
SET R50714               ; ERR46 
CON
JMP @MR309
MOV #46 DM400            ; 表示画面No.
STG @MR309
AND R50008               ; 全体ｴﾗｰ発生
JMP @MR310
STG @MR310
ANB R50008               ; 全体ｴﾗｰ発生
SET @MR315               ; ERR46解除
CON
ENDS
;ERR47
STG @MR400               ; ERR47Bﾗﾝｸﾄﾚｲ異常
ANB R50008               ; 全体ｴﾗｰ発生
SET R50008               ; 全体ｴﾗｰ発生
CON
SET R51012               ; ﾄﾚﾁｪﾝ部ｴﾗｰ中
CON
SET R50715               ; ERR47
CON
SET R210                 ; RETRY SW　目隠し解除
CON
JMP @MR401
MOV #47 DM400            ; 表示画面No.
STG @MR401
AND R50008               ; 全体ｴﾗｰ発生
JMP @MR402
STG @MR402
ANB R50008               ; 全体ｴﾗｰ発生
RES R210                 ; RETRY SW　目隠し解除
CON
SET @MR407               ; ERR47解除
CON
ENDS
;<h1/>■■■　ﾄﾚｲ取出し番号管理 / Tray Pick up No. Check
LD R52500                ; TC_B 取出No.Inc
INC DM514                ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
LD> DM514 #60            ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
LD R52501                ; TC_B 取出No.ﾘｾｯﾄ1
ANB R52903               ; 段数ﾘｾｯﾄ無
ORL
LD R52504                ; TC_B 取出No.ﾘｾｯﾄ2
ANB R52903               ; 段数ﾘｾｯﾄ無
ORL
LD R52505                ; TC_B 取出No.ﾘｾｯﾄ3
ANB R52903               ; 段数ﾘｾｯﾄ無
ORL
MPS
ANB R52903               ; 段数ﾘｾｯﾄ無
DW #0 DM514              ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
MPP
AND R52903               ; 段数ﾘｾｯﾄ無
DW #1 DM514              ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
SET R46001               ; Bﾄﾚｲﾁｪﾝｼﾞ要求
;IF DM514=0 THEN
;    DM516 =1
;    DM518 =30
;ELSE
;    DM516 = ((DM514-1)/10)+1
;    DM518 = DM514-((DM516-1)*10)+30 
;END IF
LDB R52906               ; ﾄﾚｲ移載順＝縦
NCJ #1001
;IF DM514=0 THEN
;
LD= DM514 #0             ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
NCJ #2000
;    DM516 =1
;
LD CR2002                ; 常時ON
MOV #1 DM516             ; RB3取出しPosition No.
;    DM518 =30
;
LD CR2002                ; 常時ON
MOV #30 DM518            ; TC_B RB5取出しPosition No.
;ELSE
;
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;    DM516 = ((DM514-1)/10)+1
;
LD CR2002                ; 常時ON
LDA DM514                ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L +1
CON
EXT.L
CON
DIV.L +10
CON
ADD.L +1
CON
STA DM516                ; RB3取出しPosition No.
;    DM518 = DM514-((DM516-1)*10)+30 
;
LD CR2002                ; 常時ON
LDA DM516                ; RB3取出しPosition No.
CON
EXT
CON
SUB.L +1
CON
MUL.L +10
CON
STA.L @VM0
CON
LDA DM514                ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L @VM0
CON
ADD.L +30
CON
STA DM518                ; TC_B RB5取出しPosition No.
;END IF
LABEL #2001
LABEL #1001
;
;IF DM514=0 THEN
;    DM516 =1
;    DM518 =31
;ELSE
;  @DM1 = (DM514-1)/6
;  DM516 = DM514-(@DM1*6)
;  DM518 = @DM1+31
;END IF
LD R52906                ; ﾄﾚｲ移載順＝縦
NCJ #1000
;IF DM514=0 THEN
;
LD= DM514 #0             ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
NCJ #2002
;    DM516 =1
;
LD CR2002                ; 常時ON
MOV #1 DM516             ; RB3取出しPosition No.
;    DM518 =31
;
LD CR2002                ; 常時ON
MOV #31 DM518            ; TC_B RB5取出しPosition No.
;ELSE
;
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;  @DM1 = (DM514-1)/6
;
LD CR2002                ; 常時ON
LDA DM514                ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L +1
CON
EXT.L
CON
DIV.L +6
CON
STA @DM1                 ; 取出し段数計算
;  DM516 = DM514-(@DM1*6)
;
LD CR2002                ; 常時ON
LDA @DM1                 ; 取出し段数計算
CON
EXT
CON
MUL.L +6
CON
STA.L @VM2
CON
LDA DM514                ; TC_B ﾄﾚｲ上取出ﾜｰｸNo.
CON
EXT
CON
SUB.L @VM2
CON
STA DM516                ; RB3取出しPosition No.
;  DM518 = @DM1+31
;
LD CR2002                ; 常時ON
LDA @DM1                 ; 取出し段数計算
CON
EXT
CON
ADD.L +31
CON
STA DM518                ; TC_B RB5取出しPosition No.
;END IF
LABEL #2003
LABEL #1000
;
;<h1/>/// PACK処理
LD @MR3900               ; 一時停止禁止
OUT R51113               ; ﾄﾚﾁｪﾝ_B   PACK
END
ENDH
