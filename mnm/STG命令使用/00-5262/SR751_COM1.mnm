DEVICE:53
;MODULE:SR751_COM1
;MODULE_TYPE:0
;SCRIPT_TYPE:
;PCÇ∆ÇÃí êM
LDP R46104               ; _ESTOP_MODE
ZRES @R100 @R115
;<h1/>í êM MAIN
LD CR2003                ; Normal OFF
ANB R37102               ; SR751-1 communication busy
@SET R37100              ; SR751-1 communication start
STG R37100               ; SR751-1 communication start
ZRES DM40018 DM40027     ; SR-750 Series[1] data (0000)  SR-750 Series[1] data (0018)
CON
ZRES EM30400 EM30599
CON
RES R37101               ; SR751-1 communication finish
CON
RES R37107               ; SR751-1 communication NG
CON
SET R37102               ; SR751-1 communication busy
CON
JMP @R100
STG @R100
SET R38600               ; SR-750 Series[1]reading clear
CON
SET R38507               ; SR-750 Series [1] Error Clear
CON
ANB R38000               ; SR-750 Series [1] error
ANB R38100               ; SR-750 Series [1] reading finish
JMP @R101
STG @R101
RES R38600               ; SR-750 Series[1]reading clear
CON
RES R38507               ; SR-750 Series [1] Error Clear
CON
JMP @R102
STG @R102
SET R38508               ; SR-750 Series [1] Read request
CON
JMP @R103
STG @R103
MPS
AND R38100               ; SR-750 Series [1] reading finish
@BMOV DM40018 EM30400 #10; SR-750 Series[1] data (0000)
@DISS EM30400 EM30420
RES R38508               ; SR-750 Series [1] Read request
CON
JMP @R104
MPP
ANB R38100               ; SR-750 Series [1] reading finish
TMR @0 #50
CON
AND @T0
RES R38508               ; SR-750 Series [1] Read request
CON
JMP @R114
;QR∫∞ƒﬁÅ@ASC=>BINÇ…ïœä∑Å@4åÖópÅ@5åÖópÇ™Ç†ÇÈÅB
STG @R104
MPS
AND= EM30424 $003A
@BMOV EM30420 EM30440 #4 ; á@ T-code ASC Byte
@UNIS EM30440 EM30470 #4 ; á@ T-code ASC Byte  á@ T-code ASC Word
@BMOV EM30425 EM30450 #3 ; á@ X cordinate ASC Byte
@UNIS EM30450 EM30480 #3 ; á@ X cordinate ASC Byte  á@ X cordinate ASC Word
@BMOV EM30429 EM30460 #3 ; á@ Y cordinate ASC Byte
@UNIS EM30460 EM30490 #3 ; á@ Y cordinate ASC Byte  á@ Y cordinate ASC Word
MRD
AND= EM30425 $003A
@BMOV EM30420 EM30440 #5 ; á@ T-code ASC Byte
@UNIS EM30440 EM30470 #5 ; á@ T-code ASC Byte  á@ T-code ASC Word
@BMOV EM30426 EM30450 #3 ; á@ X cordinate ASC Byte
@UNIS EM30450 EM30480 #3 ; á@ X cordinate ASC Byte  á@ X cordinate ASC Word
@BMOV EM30430 EM30460 #3 ; á@ Y cordinate ASC Byte
@UNIS EM30460 EM30490 #3 ; á@ Y cordinate ASC Byte  á@ Y cordinate ASC Word
MPP
JMP @R107
;EM30500 Xç¿ïWílÅ@EM30510 Yç¿ïWíl
STG @R107
MPS
LD= EM30424 $003A
OR= EM30425 $003A
ANL
@RDASC EM30480 EM30500   ; á@ X cordinate ASC Word  á@ X cordinate BIN
@RDASC EM30490 EM30510   ; á@ Y cordinate ASC Word  á@ Y cordinate BIN
MPP
ZRES @R109 @R110
CON
JMP @R108
;1ë§QRì«éÊílÇ©ÇÁÇÃâÒì]äpìxââéZ
;'1ST_LINE É∆=0.0041X^3-0.4023X^2+16.099X-239.6
;FM110.F = 0.0041 'X~3åWêî
;FM112.F = 0.4023 'X~2åWêî
;FM114.F = 16.099 'XåWêî
;FM116.F = 239.6
LD= FM100 #1
NCJ #1002
;'1ST_LINE É∆=0.0041X^3-0.4023X^2+16.099X-239.6
;
;FM110.F = 0.0041 'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0041 FM110
;FM112.F = 0.4023 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.4023 FM112
;FM114.F = 16.099 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +16.099 FM114
;FM116.F = 239.6
LD CR2002                ; Normal ON
MOV.F +239.6 FM116
LABEL #1002
;
;'2ND_LINE É∆=0.0084X^3-0.8889X^2+33.703X-450
;FM110.F = 0.0084 'X~3åWêî
;FM112.F = 0.8889 'X~2åWêî
;FM114.F = 33.703 'XåWêî
;FM116.F = 450
LD= FM100 #2
NCJ #1003
;'2ND_LINE É∆=0.0084X^3-0.8889X^2+33.703X-450
;
;FM110.F = 0.0084 'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0084 FM110
;FM112.F = 0.8889 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.8889 FM112
;FM114.F = 33.703 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +33.703 FM114
;FM116.F = 450
LD CR2002                ; Normal ON
MOV.F +450 FM116
LABEL #1003
;
;EM35000.F = EM30500.L*+0.093883		'Piccel=>áoïœä∑
;
;EM35010.F = EM35000.F*EM35000.F*EM35000.F'X^3
;EM35020.F = FM110.F*EM35010.F			'0.0041*X^3
;EM35012.F = EM35000.F*EM35000.F			'X^2
;EM35022.F = FM112.F*EM35012.F			'0.4023*X^2
;EM35014.F = EM35000.F					'X
;EM35024.F = FM114.F*EM35014.F			'16.099*X
;
;EM35028.F = EM35020.F-EM35022.F+EM35024.F-FM116.F
LD CR2002                ; Normal ON
NCJ #1000
;EM35000.F = EM30500.L*+0.093883		'Piccel=>áoïœä∑
;
LD CR2002                ; Normal ON
LDA.L EM30500            ; á@ X cordinate BIN
CON
FLOAT.L
CON
MUL.F +0.093883
CON
STA.F EM35000
;EM35010.F = EM35000.F*EM35000.F*EM35000.F'X^3
;
LD CR2002                ; Normal ON
LDA.F EM35000
CON
MUL.F EM35000
CON
MUL.F EM35000
CON
STA.F EM35010
;EM35020.F = FM110.F*EM35010.F			'0.0041*X^3
;
LD CR2002                ; Normal ON
LDA.F FM110
CON
MUL.F EM35010
CON
STA.F EM35020
;EM35012.F = EM35000.F*EM35000.F			'X^2
;
LD CR2002                ; Normal ON
LDA.F EM35000
CON
MUL.F EM35000
CON
STA.F EM35012
;EM35022.F = FM112.F*EM35012.F			'0.4023*X^2
;
LD CR2002                ; Normal ON
LDA.F FM112
CON
MUL.F EM35012
CON
STA.F EM35022
;EM35014.F = EM35000.F					'X
;
LD CR2002                ; Normal ON
MOV.F EM35000 EM35014
;EM35024.F = FM114.F*EM35014.F			'16.099*X
;
LD CR2002                ; Normal ON
LDA.F FM114
CON
MUL.F EM35014
CON
STA.F EM35024
;EM35028.F = EM35020.F-EM35022.F+EM35024.F-FM116.F
LD CR2002                ; Normal ON
LDA.F EM35020
CON
SUB.F EM35022
CON
ADD.F EM35024
CON
SUB.F FM116
CON
STA.F EM35028
LABEL #1000
;
LD CR2002                ; Normal ON
MPS
LDA.F EM35028
CON
MUL.F +100
CON
STA.F EM30544            ; á@ X angle (Åã)4 digit
MRD
LDA.F EM30544            ; á@ X angle (Åã)4 digit
CON
INTG.L
CON
STA.L EM30546            ; á@ X angle (Åã)4 digit integer
MPP
LDA.L EM30546            ; á@ X angle (Åã)4 digit integer
CON
ADD.L +6600
CON
STA.L EM30560            ; á@ X  before angle amount
;1ë§QRì«éÊílÇ©ÇÁÇÃYà⁄ìÆó ââéZÅ@âÊëúíÜêS(560/2picsel=280)Ç©ÇÁì«éÊâÊëúíÜêS(EM30532.F)ÇÃãóó£
LD CR2002                ; Normal ON
MPS
LDA.L EM30510            ; á@ Y cordinate BIN
CON
SUB.L +280
CON
STA.L EM30530            ; á@ Y distance of CENTER(Pixel)
MRD
LDA.L EM30530            ; á@ Y distance of CENTER(Pixel)
CON
FLOAT.L
CON
STA.F EM30532            ; á@ Y distance of CENTER FLOT
MRD
LDA.F EM30532            ; á@ Y distance of CENTER FLOT
CON
MUL.F -0.09375
CON
STA.F EM30534            ; á@ Y distance of CENTER mm
MRD
LDA.F EM30534            ; á@ Y distance of CENTER mm
CON
MUL.F +100
CON
STA.F EM30536            ; á@ Y distance of CENTER 4 digit
MPP
LDA.L EM30536            ; á@ Y distance of CENTER 4 digit
CON
INTG.L
CON
STA.L EM30538            ; á@ Y distance of CENTER 4 digit 
;1ë§Yé≤ï‚ê≥ó ââéZ
;'1ST_LINE Y=0.0072x2-0.4799x+7.9027
;FM120.F = 0		'X~3åWêî
;FM122.F = 0.0072 'X~2åWêî
;FM124.F = 0.4799 'XåWêî
;FM126.F = 7.9027
LD= FM100 #1
NCJ #1004
;'1ST_LINE Y=0.0072x2-0.4799x+7.9027
;
;FM120.F = 0		'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0 FM120
;FM122.F = 0.0072 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0072 FM122
;FM124.F = 0.4799 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +0.4799 FM124
;FM126.F = 7.9027
LD CR2002                ; Normal ON
MOV.F +7.9027 FM126
LABEL #1004
;
;'2ND_LINE Y=0.0072x2-0.5092x+8.9216
;FM120.F = 0 'X~3åWêî
;FM122.F = 0.0072 'X~2åWêî
;FM124.F = 0.5092 'XåWêî
;FM126.F = 8.9216
LD= FM100 #2
NCJ #1005
;'2ND_LINE Y=0.0072x2-0.5092x+8.9216
;
;FM120.F = 0 'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0 FM120
;FM122.F = 0.0072 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0072 FM122
;FM124.F = 0.5092 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +0.5092 FM124
;FM126.F = 8.9216
LD CR2002                ; Normal ON
MOV.F +8.9216 FM126
LABEL #1005
;
;EM35100.F = EM30510.L*0.09375	'Piccel=>áoïœä∑
;
;EM35112.F = EM35100.F*EM35100.F			'X^2
;EM35122.F = FM122.F*EM35112.F			'0.0072*X^2
;EM35114.F = EM35100.F					'X
;EM35124.F = FM124.F*EM35114.F			'0.4799*X
;
;EM35128.F = EM35122.F-EM35124.F+FM126.F
;
;EM35130.F = EM35128.F*100		'åÖçáÇÌÇπ(0.00)
;EM35132.L = INT(EM35130.F)
LD CR2002                ; Normal ON
NCJ #1001
;EM35100.F = EM30510.L*0.09375	'Piccel=>áoïœä∑
;
LD CR2002                ; Normal ON
LDA.L EM30510            ; á@ Y cordinate BIN
CON
FLOAT.L
CON
MUL.F +0.09375
CON
STA.F EM35100
;EM35112.F = EM35100.F*EM35100.F			'X^2
;
LD CR2002                ; Normal ON
LDA.F EM35100
CON
MUL.F EM35100
CON
STA.F EM35112
;EM35122.F = FM122.F*EM35112.F			'0.0072*X^2
;
LD CR2002                ; Normal ON
LDA.F FM122
CON
MUL.F EM35112
CON
STA.F EM35122
;EM35114.F = EM35100.F					'X
;
LD CR2002                ; Normal ON
MOV.F EM35100 EM35114
;EM35124.F = FM124.F*EM35114.F			'0.4799*X
;
LD CR2002                ; Normal ON
LDA.F FM124
CON
MUL.F EM35114
CON
STA.F EM35124
;EM35128.F = EM35122.F-EM35124.F+FM126.F
;
LD CR2002                ; Normal ON
LDA.F EM35122
CON
SUB.F EM35124
CON
ADD.F FM126
CON
STA.F EM35128
;EM35130.F = EM35128.F*100		'åÖçáÇÌÇπ(0.00)
;
LD CR2002                ; Normal ON
LDA.F EM35128
CON
MUL.F +100
CON
STA.F EM35130
;EM35132.L = INT(EM35130.F)
LD CR2002                ; Normal ON
LDA.F EM35130
CON
INTG.L
CON
STA.L EM35132
LABEL #1001
;
LD CR2002                ; Normal ON
LDA.L EM30538            ; á@ Y distance of CENTER 4 digit 
CON
ADD.L EM35132
CON
STA.L EM30550            ; á@ Y  mm
;ï‚ê≥íl(0.00)
STG @R108
MPS
AND= EM30424 $003A
MPS
LD= EM30470 $3636        ; á@ T-code ASC Word
ANB @R109
ANL
LDA.L EM30560            ; á@ X  before angle amount
CON
ADD.L DM15010            ; 4-digit á@ X direction (66 **) a
CON
STA.L EM30580            ; á@ X  After angle amount
CON
SET @R109
MRD
LD= EM30470 $3637        ; á@ T-code ASC Word
ANB @R109
ANL
LDA.L EM30560            ; á@ X  before angle amount
CON
ADD.L DM15014            ; 4-digit á@ X direction (67 **) a
CON
STA.L EM30580            ; á@ X  After angle amount
CON
SET @R109
MRD
LD= EM30423 $0031
OR= EM30423 $0033
ANB @R110
ANL
LDA.L EM30550            ; á@ Y  mm
CON
ADD.L DM15020            ; 1 height correction 4-digit á@ Y
CON
STA.L EM30590            ; á@ Y  After angle amount
CON
SET @R110
MPP
LD= EM30423 $0032
OR= EM30423 $0034
ANB @R110
ANL
LDA.L EM30550            ; á@ Y  mm
CON
ADD.L DM15022            ; 1 height correction 4-digit á@ Y
CON
STA.L EM30590            ; á@ Y  After angle amount
CON
SET @R110
MRD
AND= EM30425 $003A
MPS
ANB @R109
LDA.L EM30560            ; á@ X  before angle amount
CON
ADD.L DM15110            ; á@ X direction 5-digit angle cor
CON
STA.L EM30580            ; á@ X  After angle amount
CON
SET @R109
MRD
LD= EM30423 $0031
OR= EM30423 $0033
ANB @R110
ANL
LDA.L EM30550            ; á@ Y  mm
CON
ADD.L DM15120            ; 1 height correction 5-digit á@ Y
CON
STA.L EM30590            ; á@ Y  After angle amount
CON
SET @R110
MPP
LD= EM30423 $0032
OR= EM30423 $0034
ANB @R110
ANL
LDA.L EM30550            ; á@ Y  mm
CON
ADD.L DM15122            ; 1 height correction 5-digit á@ Y
CON
STA.L EM30590            ; á@ Y  After angle amount
CON
SET @R110
MRD
LD @R109
AND @R110
ANL
JMP @R112
MPP
LD<> EM30424 $003A
AND<> EM30425 $003A
ANL
JMP @R114
STG @R112
ZRES @R109 @R110
CON
MPS
LD= EM30424 $003A
OR= EM30425 $003A
ANL
JMP @R105
MPP
LD= EM30400 $4552
AND= EM30401 $524F
AND= EM30402 $520D
ANL
JMP @R114
STG @R105
SET R38600               ; SR-750 Series[1]reading clear
CON
ANB R38100               ; SR-750 Series [1] reading finish
JMP @R106
STG @R106
RES R38600               ; SR-750 Series[1]reading clear
CON
JMP @R115
STG @R114
TMS @4 #1
CON
AND @T4
RES R37102               ; SR751-1 communication busy
CON
SET R37107               ; SR751-1 communication NG
CON
ENDS
STG @R115
TMS @5 #1
CON
AND @T5
RES R37102               ; SR751-1 communication busy
CON
SET R37101               ; SR751-1 communication finish
CON
ENDS
END
ENDH
