DEVICE:53
;MODULE:Index
;MODULE_TYPE:0
;Index 制御
;Index Control 
;
;非常停止
;Emergency Stop
LD R50010                ; Emaegency Stop
OR @MR001
ZRES @MR002 @MR3915      ; STEP END
CON
OUT @MR001
TMR @0 #5
LD @T0
MDSTOP Index
;<h1/>HOME
LD R50003                ; HOME mode
ANB R50200               ; INDEX Do
SET R50200               ; INDEX Do
CON
SET @MR1003
STG @MR1003
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
RES MR8411               ; Index Brake up
CON
SET MR8410               ; Index Brake down
CON
AND R5414                ; MAIN INDEX brake lower limit
ANB R8411                ; Index Brake up
JMP @MR1004
STG @MR1004
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
MPS
LDB LR000                ; Step/Manual Oparation Memory
ANB CR2002               ; Normal ON
ANL
JMP @MR1112
MPP
LD LR000                 ; Step/Manual Oparation Memory
OR CR2002                ; Normal ON
ANL
JMP @MR1005
LDB R4800                ; INDEX chuck 1-1 work existence
ANB R4801                ; INDEX chuck 1-2 work existence
ANB R4802                ; INDEX chuck 2-1 work existence
ANB R4803                ; INDEX chuck 2-2 work existence
ANB R4804                ; INDEX chuck 3-1 work existence
ANB R4805                ; INDEX chuck 3-2 work existence
ANB R4806                ; INDEX chuck 4-1 work existence
ANB R4807                ; INDEX chuck 4-2 work existence
ANB R4808                ; INDEX chuck 5-1 work existence
ANB R4809                ; INDEX chuck 5-2 work existence
ANB R4810                ; INDEX chuck 6-1 work existence
ANB R4811                ; INDEX chuck 6-2 work existence
ANB R4812                ; INDEX chuck 7-1 work existence
ANB R4813                ; INDEX chuck 7-2 work existence
ANB R4814                ; INDEX chuck 8-1 work existence
ANB R4815                ; INDEX chuck 8-2 work existence
ANB R5200                ; CAP SET chuck1-1 close limit
ANB R5202                ; CAP SET chuck1-2 close limit
ANB R5204                ; CAP SET chuck2-1 close limit
ANB R5206                ; CAP SET chuck2-2 close limit
INV
OUT @MR1000              ; There is work on the index
STG @MR1005
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
MPS
ANB @MR1000              ; There is work on the index
JMP @MR1112
MPP
AND @MR1000              ; There is work on the index
JMP @MR1006
STG @MR1006
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
RES MR7800               ; INDEX chuck1 close
CON
SET MR7801               ; INDEX chuck1 open
CON
RES MR7802               ; INDEX chuck2 close
CON
SET MR7803               ; INDEX chuck2 open
CON
RES MR7804               ; INDEX chuck3 close
CON
SET MR7805               ; INDEX chuck3 open
CON
RES MR7806               ; INDEX chuck4 close
CON
SET MR7807               ; INDEX chuck4 open
CON
RES MR7808               ; INDEX chuck5 close
CON
SET MR7809               ; INDEX chuck5 open
CON
RES MR7810               ; INDEX chuck6 close
CON
SET MR7811               ; INDEX chuck6 open
CON
RES MR7812               ; INDEX chuck7 close
CON
SET MR7813               ; INDEX chuck7 open
CON
RES MR7814               ; INDEX chuck8 close
CON
SET MR7815               ; INDEX chuck8 open
CON
SET MR8201               ; CAP SET chuck1-1 open
CON
RES MR8200               ; CAP SET chuck1-1 close
CON
SET MR8203               ; CAP SET chuck1-2 open
CON
RES MR8202               ; CAP SET chuck1-2 close
CON
SET MR8205               ; CAP SET chuck2-1 open
CON
RES MR8204               ; CAP SET chuck2-1 close
CON
SET MR8207               ; CAP SET chuck2-2 open
CON
RES MR8206               ; CAP SET chuck2-2 close
CON
SET @MR100               ; ALL st work removing request
CON
JMP @MR1007
STG @MR1007
ANB R50300               ; Pause
AND @MR102
JMP @MR1008
STG @MR1008
ANB R50300               ; Pause
ANB @MR102
SET MR8410               ; Index Brake down
CON
RES MR8411               ; Index Brake up
CON
AND R5414                ; MAIN INDEX brake lower limit
ANB R5415                ; MAIN INDEX brake upper limit
JMP @MR1005
STG @MR1112
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
AND MR3200               ; Main index rotaion I/L
LDB MR700                ; Upper stream non H/S
AND B2012                ; from up  Interlock
ANB B2013                ; from up  Operation Start 
ANB B2016                ; from up  Operati  AuOper Start 
OR MR700                 ; Upper stream non H/S
ANL
SET R50100               ; PACK INDEX
CON
JMP @MR1113
STG @MR1113
ANB MR1003               ; Main index rotation completed
MPS
ANB LR000                ; Step/Manual Oparation Memory
LDA EM1206               ; Main INDEX Auto current POS
CON
STA EM1200               ; Main INDEX terget POS
CON
SET MR1002               ; Main index rotation request
CON
JMP @MR1114
MPP
AND LR000                ; Step/Manual Oparation Memory
LDA EM1208               ; Main INDEX step current POS
CON
STA EM1200               ; Main INDEX terget POS
CON
SET MR1002               ; Main index rotation request
CON
JMP @MR1114
STG @MR1114
AND MR1003               ; Main index rotation completed
RES MR1003               ; Main index rotation completed
CON
RES R50100               ; PACK INDEX
CON
JMP @MR1115
STG @MR1115
MPS
ANB LR000                ; Step/Manual Oparation Memory
JMP @MR1200
@FMOV #0 DM20100 #900    ; UT1-1 Work detection
MPP
AND LR000                ; Step/Manual Oparation Memory
@MOV EM1208 EM1206       ; Main INDEX step current POS  Main INDEX Auto current POS
@FMOV #0 DM20100 #900    ; UT1-1 Work detection
JMP @MR1200
STG @MR1200
RES LR000                ; Step/Manual Oparation Memory
CON
SET R51900               ; Index 1cycle finished
CON
ENDS
;<h1/>AUTO
LD R50001                ; AUTO mode
ANB R50300               ; Pause
ANB R50200               ; INDEX Do
ANB @MR2001              ; During automatic operation
AND= EM1202 EM1206       ; Main INDEX current POS  Main INDEX Auto current POS
SET R50200               ; INDEX Do
CON
SET @MR2000              ; INDEX AUTO START
STG @MR2000              ; INDEX AUTO START
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
JMP @MR2100
STG @MR2100
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
RES MR7801               ; INDEX chuck1 open
CON
RES MR7803               ; INDEX chuck2 open
CON
RES MR7805               ; INDEX chuck3 open
CON
RES MR7807               ; INDEX chuck4 open
CON
RES MR7809               ; INDEX chuck5 open
CON
RES MR7811               ; INDEX chuck6 open
CON
RES MR7813               ; INDEX chuck7 open
CON
RES MR7815               ; INDEX chuck8 open
CON
SET MR7800               ; INDEX chuck1 close
CON
SET MR7802               ; INDEX chuck2 close
CON
SET MR7804               ; INDEX chuck3 close
CON
SET MR7806               ; INDEX chuck4 close
CON
SET MR7808               ; INDEX chuck5 close
CON
SET MR7810               ; INDEX chuck6 close
CON
SET MR7812               ; INDEX chuck7 close
CON
SET MR7814               ; INDEX chuck8 close
CON
JMP @MR2101
STG @MR2101
TMH @1 #30
CON
AND @T1
JMP @MR2107
STG @MR2107
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
AND T500                 ; Main INDEX ALL chuck close
LDB MR700                ; Upper stream non H/S
AND B2012                ; from up  Interlock
ANB B2013                ; from up  Operation Start 
ANB B2016                ; from up  Operati  AuOper Start 
OR MR700                 ; Upper stream non H/S
ANL
SET R50100               ; PACK INDEX
CON
JMP @MR2102
STG @MR2102
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
ANB MR1003               ; Main index rotation completed
ANB MR106                ; 6UT index rotation Prohibited
MPS
AND<= EM1200 #8          ; Main INDEX terget POS
@INC EM1200              ; Main INDEX terget POS
MRD
AND> EM1200 #8           ; Main INDEX terget POS
@DW #1 EM1200            ; Main INDEX terget POS
MRD
AND R50001               ; AUTO mode
@MOV EM1200 EM1206       ; Main INDEX terget POS  Main INDEX Auto current POS
MRD
AND R50002               ; STEP mode
SET LR000                ; Step/Manual Oparation Memory
CON
@MOV EM1200 EM1208       ; Main INDEX terget POS  Main INDEX step current POS
MPP
SET MR1002               ; Main index rotation request
CON
JMP @MR2103
STG @MR2103
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
AND MR1003               ; Main index rotation completed
RES MR1003               ; Main index rotation completed
CON
JMP @MR2104
STG @MR2104
@WSR DM20100 #700 #100   ; UT1-1 Work detection
JMP @MR2105
STG @MR2105
RES R50100               ; PACK INDEX
CON
MPS
ANB R50002               ; STEP mode
JMP @MR2115
MPP
AND R50002               ; STEP mode
JMP @MR2106
STG @MR2106
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
SET MR7801               ; INDEX chuck1 open
CON
SET MR7803               ; INDEX chuck2 open
CON
SET MR7805               ; INDEX chuck3 open
CON
SET MR7807               ; INDEX chuck4 open
CON
SET MR7809               ; INDEX chuck5 open
CON
SET MR7811               ; INDEX chuck6 open
CON
SET MR7813               ; INDEX chuck7 open
CON
SET MR7815               ; INDEX chuck8 open
CON
RES MR7800               ; INDEX chuck1 close
CON
RES MR7802               ; INDEX chuck2 close
CON
RES MR7804               ; INDEX chuck3 close
CON
RES MR7806               ; INDEX chuck4 close
CON
RES MR7808               ; INDEX chuck5 close
CON
RES MR7810               ; INDEX chuck6 close
CON
RES MR7812               ; INDEX chuck7 close
CON
RES MR7814               ; INDEX chuck8 close
CON
SET @MR3915              ; STEP END
CON
ENDS
;動作終了
STG @MR2115
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
MPS
ANB MR104                ; 4UT index data shift Prohibited
RES MR105                ; Index data shift 
CON
SET R51900               ; Index 1cycle finished
CON
ENDS
MPP
AND MR104                ; 4UT index data shift Prohibited
SET MR105                ; Index data shift 
CON
SET R51900               ; Index 1cycle finished
CON
ENDS
;<h1/>STEP
LD R50002                ; STEP mode
ANB R50300               ; Pause
ANB R50205               ; INDEX Do(STEP)
SET R50205               ; INDEX Do(STEP)
CON
SET @MR3600
STG @MR3600
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
MPS
AND LR40100              ; STEP INDEX-0 selection lamp
JMP @MR3601
MPP
ANB LR40100              ; STEP INDEX-0 selection lamp
SET @MR3915              ; STEP END
CON
JMP @MR3609
STG @MR3601
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
MPS
LDB R4814                ; INDEX chuck 8-1 work existence
ANB R4815                ; INDEX chuck 8-2 work existence
ANL
JMP @MR3608
MPP
LD R4814                 ; INDEX chuck 8-1 work existence
OR R4815                 ; INDEX chuck 8-2 work existence
ANL
SET @MR108               ; 8st work removing request
CON
JMP @MR3607
STG @MR3607
ANB R50300               ; Pause
AND R50110               ; INDEX Error
JMP @MR3600
STG @MR3608
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
SET @MR2000              ; INDEX AUTO START
CON
JMP @MR3609
STG @MR3609
ANB R50300               ; Pause
ANB R50110               ; INDEX Error
AND @MR3915              ; STEP END
RES @MR3915              ; STEP END
CON
SET R51900               ; Index 1cycle finished
CON
ENDS
;サブルーチン
;Subroutine
;<h1/>INDEX sub
;The starting point return of an index is program No.5.  
;By 5 division specification, it moves to a starting point position by the shortest. 
;/ ｲﾝﾃﾞｯｸｽの原点復帰は、ﾌﾟﾛｸﾞﾗﾑNo.10　8分割指定で、近周りで原点位置へ移動する
;72 degrees positive rotation of an index chooses program No.0 to 3 and 7 in order, and starts it. 
;By 5 division specification, it moves to the following position of five positions. 
;If movement is completed, the following specification will be written in DM. 
;ﾌﾟﾛｸﾞﾗﾑNo.1から8を順に選択し起動する
;8分割指定で、移動が完了したらDMに次の指定を書込む
STG MR1002               ; Main index rotation request
RES MR8411               ; Index Brake up
CON
SET MR8410               ; Index Brake down
CON
AND R5414                ; MAIN INDEX brake lower limit
ANB R8411                ; Index Brake up
AND MR3200               ; Main index rotaion I/L
RES DM10850.11           ; Main INDEX anser
CON
SET MR1011               ; Main index moving
CON
JMP @MR3000
STG @MR3000
AND DM10650.10           ; Main INDEX waitting Start
AND<> EM1200 #0          ; Main INDEX terget POS
AND<> EM1204 #0          ; Main INDEX current terget POS
AND= EM1200 EM1204       ; Main INDEX terget POS  Main INDEX current terget POS
DW #0 EM1202             ; Main INDEX current POS
CON
SET DM10850.8            ; Main INDEX input Start
CON
JMP @MR3001
STG @MR3001
ANB DM10650.10           ; Main INDEX waitting Start
RES DM10850.8            ; Main INDEX input Start
CON
JMP @MR3002
STG @MR3002
AND DM10650.9            ; Main INDEX inposition complete
SET DM10850.11           ; Main INDEX anser
CON
JMP @MR3003
STG @MR3003
ANB DM10650.9            ; Main INDEX inposition complete
RES DM10850.11           ; Main INDEX anser
CON
JMP @MR3004
STG @MR3004
AND DM10651.0            ; Main INDEX split position Strobe
TMH @2 #10
CON
AND @T2
LDA DM10650              ; Main INDEX status 1
CON
ANDA $00FF
CON
STA EM1202               ; Main INDEX current POS
CON
SET DM10850.11           ; Main INDEX anser
CON
JMP @MR3005
STG @MR3005
ANB DM10651.0            ; Main INDEX split position Strobe
RES DM10850.11           ; Main INDEX anser
CON
AND= EM1200 EM1202       ; Main INDEX terget POS  Main INDEX current POS
JMP @MR3006
STG @MR3006
JMP @MR3007
STG @MR3007
RES MR1011               ; Main index moving
CON
SET MR1003               ; Main index rotation completed
CON
ENDS
;ﾒｲﾝINDEX 現在指令POS読込
LD CR2002                ; Normal ON
LDA DM10850              ; Main INDEX command
CON
ANDA $003F
CON
STA EM1204               ; Main INDEX current terget POS
;ﾒｲﾝINDEX 指令POS出力
LD CR2002                ; Normal ON
MPS
AND EM1200.0
OUT DM10850.0            ; Main INDEX PROG 0
MRD
AND EM1200.1
OUT DM10850.1            ; Main INDEX PROG 1
MRD
AND EM1200.2
OUT DM10850.2            ; Main INDEX PROG 2
MRD
AND EM1200.3
OUT DM10850.3            ; Main INDEX PROG 3
MRD
AND EM1200.4
OUT DM10850.4            ; Main INDEX PROG 4
MPP
AND EM1200.5
OUT DM10850.5            ; Main INDEX PROG 5
;<h1/>ｴﾗｰ表示
;Error Display
;Error07 7st ﾜｰｸ除材要求
;Error07 7st Remove Works Request
STG @MR100               ; ALL st work removing request
ANB R50008               ; Whole ERROR
SET @MR102
CON
SET R50008               ; Whole ERROR
CON
SET R50110               ; INDEX Error
CON
SET R50506               ; 7.UT7 work removeing request
CON
JMP @MR103
MOV #7 DM400             ; Message NO.
STG @MR103
AND R50008               ; Whole ERROR
JMP @MR104
STG @MR104
ANB R50008               ; Whole ERROR
JMP @MR105
STG @MR105
RES @MR102
CON
ENDS
;<h1/>ｴﾗｰ表示
;Error Display
;Error08 8st ﾜｰｸ除材要求
;Error08 8st  Remove Works Request
STG @MR108               ; 8st work removing request
ANB R50008               ; Whole ERROR
SET @MR110
CON
SET R50008               ; Whole ERROR
CON
SET R50110               ; INDEX Error
CON
SET R50507               ; 8.UT8 work removeing request
CON
JMP @MR111
MOV #8 DM400             ; Message NO.
STG @MR111
AND R50008               ; Whole ERROR
JMP @MR112
STG @MR112
ANB R50008               ; Whole ERROR
JMP @MR113
STG @MR113
RES @MR110
CON
ENDS
END
ENDH
