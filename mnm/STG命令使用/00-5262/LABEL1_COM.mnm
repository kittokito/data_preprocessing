DEVICE:53
;MODULE:LABEL1_COM
;MODULE_TYPE:0
;SCRIPT_TYPE:
;PCとの通信
LDP R46104               ; _ESTOP_MODE
ZRES @R100 @R315
;<h1/>LABEL1通信 MAIN
;ｺﾏﾝﾄﾞ番号説明　(EM1924)
;#0	'A012.34'	;A0ﾗﾍﾞﾙ発行①,②　12.34計量ﾃﾞｰﾀ
;#1	'A112.34'	;A1ﾗﾍﾞﾙ発行①　	  12.34計量ﾃﾞｰﾀ
;#2	'A212,34'	;A2ﾗﾍﾞﾙ発行②　　 12.34計量ﾃﾞｰﾀ
;
LD CR2003                ; Normal OFF
ANB R37202               ; LBL1 for PC communication Busy
@SET R37200              ; LBL1 for PC communication start
STG R37200               ; LBL1 for PC communication start
RES R37201               ; LBL1 for PC communication finis
CON
RES @R301
CON
SET R37202               ; LBL1 for PC communication Busy
CON
ZRES @DM0 @DM12
CON
ZRES @DM16 @DM599
CON
JMP @R100
STG @R100
LDA EM1924               ; Label1 command NO
CON
STA @DM7
CON
LDA EM1924               ; Label1 command NO
CON
STA @DM50
CON
JMP @R101
;<<送信ｺﾏﾝﾄﾞ>>
STG @R101
MPS
AND= @DM50 #0
SMOV "A0" @DM100
MPS
LD= EM1926 #3            ; Label1 send data Reference NO
OR= EM1926 #5            ; Label1 send data Reference NO
ANL
@BMOV DM20350 @DM101 #3  ; UT3-1 weight(ASCⅡ）
@BMOV DM20360 @DM104 #3  ; UT3-2 weight(ASCⅡ）
MRD
AND= EM1926 #4           ; Label1 send data Reference NO
@BMOV DM20450 @DM101 #3  ; UT4-1 weight(ASCⅡ）
@BMOV DM20460 @DM104 #3  ; UT4-2 weight(ASCⅡ）
MPP
JMP @R200
MRD
AND= @DM50 #1
SMOV "A1" @DM100
MPS
LD= EM1926 #3            ; Label1 send data Reference NO
OR= EM1926 #5            ; Label1 send data Reference NO
ANL
@BMOV DM20350 @DM101 #3  ; UT3-1 weight(ASCⅡ）
MRD
AND= EM1926 #4           ; Label1 send data Reference NO
@BMOV DM20450 @DM101 #3  ; UT4-1 weight(ASCⅡ）
MPP
JMP @R200
MRD
AND= @DM50 #2
SMOV "A2" @DM100
MPS
LD= EM1926 #3            ; Label1 send data Reference NO
OR= EM1926 #5            ; Label1 send data Reference NO
ANL
@BMOV DM20360 @DM101 #3  ; UT3-2 weight(ASCⅡ）
MRD
AND= EM1926 #4           ; Label1 send data Reference NO
@BMOV DM20460 @DM101 #3  ; UT4-2 weight(ASCⅡ）
MPP
JMP @R200
MPP
AND= @DM50 #3
SMOV "B1" @DM100
MPS
AND= EM1926 #3           ; Label1 send data Reference NO
@BMOV DM20350 @DM101 #3  ; UT3-1 weight(ASCⅡ）
MPP
JMP @R200
;<<受信用>>
STG @R102
JMP @R200
;<h1/>汎用通信
STG @R200
ANB @R302
SET @R300
CON
JMP @R201
STG @R201
AND @R301
MPS
ANB @R303
RES @R301
CON
JMP @R205
MPP
AND @R303
RES @R301
CON
JMP @R202
STG @R202
SET R37203               ; LBL1 for PC communication NG
CON
RES @R303
CON
JMP @R205
STG @R205
SET R37201               ; LBL1 for PC communication finis
CON
RES R37202               ; LBL1 for PC communication Busy
CON
ENDS
;<h1/>Port3通信START
;'SERIAL_COM ﾏｸﾛ使用する為に以下の設定を行う
;@DM0 = $0000	'ﾃﾞｰﾀ格納単位設定(ﾊﾞｲﾄ単位)
;@DM1 = $0000	'ﾓｰﾄﾞ設定(ﾉｰﾏﾙﾓｰﾄﾞ-ｺﾏﾚｽﾓｰﾄﾞ)
;@DM2 = #0000	'ﾀｲﾑｱｳﾄﾁｪｯｸ時間設定(無し)
;@DM3 = $0000	'送信用ﾍｯﾀﾞ設定(無し)
;@DM4 = $0D00	'送信用ﾃﾞﾘﾐﾀ設定(CR)
;@DM5 = $0000	'受信用ﾍｯﾀﾞ設定(無し)
;@DM6 = $0D00	'受信用ﾃﾞﾘﾐﾀ設定(CR)
LD CR2002                ; Normal ON
NCJ #1000
;'SERIAL_COM ﾏｸﾛ使用する為に以下の設定を行う
;
;@DM0 = $0000	'ﾃﾞｰﾀ格納単位設定(ﾊﾞｲﾄ単位)
;
LD CR2002                ; Normal ON
MOV $0000 @DM0
;@DM1 = $0000	'ﾓｰﾄﾞ設定(ﾉｰﾏﾙﾓｰﾄﾞ-ｺﾏﾚｽﾓｰﾄﾞ)
;
LD CR2002                ; Normal ON
MOV $0000 @DM1
;@DM2 = #0000	'ﾀｲﾑｱｳﾄﾁｪｯｸ時間設定(無し)
;
LD CR2002                ; Normal ON
MOV #0 @DM2
;@DM3 = $0000	'送信用ﾍｯﾀﾞ設定(無し)
;
LD CR2002                ; Normal ON
MOV $0000 @DM3
;@DM4 = $0D00	'送信用ﾃﾞﾘﾐﾀ設定(CR)
;
LD CR2002                ; Normal ON
MOV $0D00 @DM4
;@DM5 = $0000	'受信用ﾍｯﾀﾞ設定(無し)
;
LD CR2002                ; Normal ON
MOV $0000 @DM5
;@DM6 = $0D00	'受信用ﾃﾞﾘﾐﾀ設定(CR)
LD CR2002                ; Normal ON
MOV $0D00 @DM6
LABEL #1000
;
STG @R300
SET @R302
CON
DW #0 @DM10
CON
JMP @R304
LDP @R304
MSTRT SERIAL_PC R26500 DM26500 @DM0 @DM100 @DM500 @DM10;Port1 Cominucation enable  Unit error number
STG @R304
MPS
AND= @DM10 #20
JMP @R305
MPP
LD<> @DM10 #20
AND<> @DM10 #0
ANL
SET @R303
CON
JMP @R315
;
STG @R305
JMP @R315
STG @R315
TMS @0 #10
CON
AND @T0
SET @R301
CON
RES @R302
CON
ENDS
END
ENDH
