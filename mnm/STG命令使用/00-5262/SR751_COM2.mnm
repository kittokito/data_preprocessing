DEVICE:53
;MODULE:SR751_COM2
;MODULE_TYPE:0
;SCRIPT_TYPE:
;PCÇ∆ÇÃí êM
LDP R46104               ; _ESTOP_MODE
ZRES @R100 @R115
;<h1/>í êM MAIN
LD CR2003                ; Normal OFF
ANB R37110               ; SR751-2 communication busy
@SET R37108              ; SR751-2 communication start
STG R37108               ; SR751-2 communication start
ZRES DM40518 DM40527     ; SR-750 Series[2] data (0000)  SR-750 Series[2] data (0018)
CON
ZRES EM30600 EM30799
CON
RES R37109               ; SR751-2 communication finish
CON
RES R37115               ; SR751-2 communication NG
CON
SET R37110               ; SR751-2 communication busy
CON
JMP @R100
STG @R100
SET R39600               ; SR-750 Series[1]reading clear
CON
SET R39507               ; SR-750 Series [1] Error Clear
CON
ANB R39000               ; SR-750 Series [1] error
ANB R39100               ; SR-750 Series [1] reading finish
JMP @R101
STG @R101
RES R39600               ; SR-750 Series[1]reading clear
CON
RES R39507               ; SR-750 Series [1] Error Clear
CON
JMP @R102
STG @R102
SET R39508               ; SR-750 Series [1] Read request
CON
JMP @R103
STG @R103
MPS
AND R39100               ; SR-750 Series [1] reading finish
@BMOV DM40518 EM30600 #10; SR-750 Series[2] data (0000)
@DISS EM30600 EM30620
RES R39508               ; SR-750 Series [1] Read request
CON
JMP @R104
MPP
ANB R39100               ; SR-750 Series [1] reading finish
TMR @0 #50
CON
AND @T0
RES R39508               ; SR-750 Series [1] Read request
CON
JMP @R114
;QR∫∞ƒﬁÅ@ASC=>BINÇ…ïœä∑Å@4åÖópÅ@5åÖópÇ™Ç†ÇÈÅB
STG @R104
MPS
AND= EM30624 $003A
@BMOV EM30620 EM30640 #4 ; áA T-code ASC Byte
@BMOV EM30625 EM30650 #3 ; áA X ASC Byte
@BMOV EM30629 EM30660 #3 ; áA Y ASC Byte
@UNIS EM30640 EM30670 #4 ; áA T-code ASC Byte  áA T-code ASC Word
@UNIS EM30650 EM30680 #3 ; áA X ASC Byte  áA X ASC Word
@UNIS EM30660 EM30690 #3 ; áA Y ASC Byte  áA Y ASC Word
MRD
AND= EM30625 $003A
@BMOV EM30620 EM30640 #5 ; áA T-code ASC Byte
@BMOV EM30626 EM30650 #3 ; áA X ASC Byte
@BMOV EM30630 EM30660 #3 ; áA Y ASC Byte
@UNIS EM30640 EM30670 #5 ; áA T-code ASC Byte  áA T-code ASC Word
@UNIS EM30650 EM30680 #3 ; áA X ASC Byte  áA X ASC Word
@UNIS EM30660 EM30690 #3 ; áA Y ASC Byte  áA Y ASC Word
MPP
JMP @R107
;EM30700 Xç¿ïWílÅ@EM30710 Yç¿ïWíl
STG @R107
MPS
LD= EM30624 $003A
OR= EM30625 $003A
ANL
@RDASC EM30680 EM30700   ; áA X ASC Word  áA X BIN
@RDASC EM30690 EM30710   ; áA Y ASC Word  áA Y BIN
MPP
ZRES @R109 @R110
CON
JMP @R108
;2ë§QRì«éÊílÇ©ÇÁÇÃâÒì]äpìxââéZ
;'1ST_LINE É∆=0.0037X^3-0.4067X^2+17.954X-293.98
;FM130.F = 0.0037 'X~3åWêî
;FM132.F = 0.4067 'X~2åWêî
;FM134.F = 17.954 'XåWêî
;FM136.F = 293.98
LD= FM100 #1
NCJ #1001
;'1ST_LINE É∆=0.0037X^3-0.4067X^2+17.954X-293.98
;
;FM130.F = 0.0037 'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0037 FM130
;FM132.F = 0.4067 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.4067 FM132
;FM134.F = 17.954 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +17.954 FM134
;FM136.F = 293.98
LD CR2002                ; Normal ON
MOV.F +293.98 FM136
LABEL #1001
;
;'2ND_LINE É∆=0.0051X^3-0.5704X^2+23.889X-356.18
;FM130.F = 0.0051 'X~3åWêî
;FM132.F = 0.5704 'X~2åWêî
;FM134.F = 23.889 'XåWêî
;FM136.F = 356.18
LD= FM100 #2
NCJ #1002
;'2ND_LINE É∆=0.0051X^3-0.5704X^2+23.889X-356.18
;
;FM130.F = 0.0051 'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0051 FM130
;FM132.F = 0.5704 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.5704 FM132
;FM134.F = 23.889 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +23.889 FM134
;FM136.F = 356.18
LD CR2002                ; Normal ON
MOV.F +356.18 FM136
LABEL #1002
;
;EM35050.F = EM30700.L*+0.093883		'Piccel=>áoïœä∑
;
;EM35060.F = EM35050.F*EM35050.F*EM35050.F'X^3
;EM35070.F = FM130.F*EM35060.F			'0.0037*X^3
;EM35062.F = EM35050.F*EM35050.F			'X^2
;EM35072.F = FM132.F*EM35062.F			'0.40667*X^2
;EM35064.F = EM35050.F					'X
;EM35074.F = FM134.F*EM35064.F			'17.954*X
;
;EM35078.F = EM35070.F-EM35072.F+EM35074.F-FM136.F
LD CR2002                ; Normal ON
NCJ #1000
;EM35050.F = EM30700.L*+0.093883		'Piccel=>áoïœä∑
;
LD CR2002                ; Normal ON
LDA.L EM30700            ; áA X BIN
CON
FLOAT.L
CON
MUL.F +0.093883
CON
STA.F EM35050
;EM35060.F = EM35050.F*EM35050.F*EM35050.F'X^3
;
LD CR2002                ; Normal ON
LDA.F EM35050
CON
MUL.F EM35050
CON
MUL.F EM35050
CON
STA.F EM35060
;EM35070.F = FM130.F*EM35060.F			'0.0037*X^3
;
LD CR2002                ; Normal ON
LDA.F FM130
CON
MUL.F EM35060
CON
STA.F EM35070
;EM35062.F = EM35050.F*EM35050.F			'X^2
;
LD CR2002                ; Normal ON
LDA.F EM35050
CON
MUL.F EM35050
CON
STA.F EM35062
;EM35072.F = FM132.F*EM35062.F			'0.40667*X^2
;
LD CR2002                ; Normal ON
LDA.F FM132
CON
MUL.F EM35062
CON
STA.F EM35072
;EM35064.F = EM35050.F					'X
;
LD CR2002                ; Normal ON
MOV.F EM35050 EM35064
;EM35074.F = FM134.F*EM35064.F			'17.954*X
;
LD CR2002                ; Normal ON
LDA.F FM134
CON
MUL.F EM35064
CON
STA.F EM35074
;EM35078.F = EM35070.F-EM35072.F+EM35074.F-FM136.F
LD CR2002                ; Normal ON
LDA.F EM35070
CON
SUB.F EM35072
CON
ADD.F EM35074
CON
SUB.F FM136
CON
STA.F EM35078
LABEL #1000
;
LD CR2002                ; Normal ON
MPS
LDA.F EM35078
CON
MUL.F +100
CON
STA.F EM30744            ; áA X angle (Åã)4 digit
MRD
LDA.F EM30744            ; áA X angle (Åã)4 digit
CON
INTG.L
CON
STA.L EM30746            ; áA X angle (Åã)4 digit integer
MPP
LDA.L EM30746            ; áA X angle (Åã)4 digit integer
CON
ADD.L +6600
CON
STA.L EM30760            ; áA X before angle amount
;2ë§QRì«éÊílÇ©ÇÁÇÃYà⁄ìÆó ââéZÅ@âÊëúíÜêS(560/2picsel=280)Ç©ÇÁì«éÊâÊëúíÜêS(EM30732.F)ÇÃãóó£
LD CR2002                ; Normal ON
MPS
LDA.L EM30710            ; áA Y BIN
CON
SUB.L +280
CON
STA.L EM30730            ; áA Y distance of CENTER(Pixel)
MRD
LDA.L EM30730            ; áA Y distance of CENTER(Pixel)
CON
FLOAT.L
CON
STA.F EM30732            ; áA Y distance of CENTER FLOT
MRD
LDA.F EM30732            ; áA Y distance of CENTER FLOT
CON
MUL.F -0.09375
CON
STA.F EM30734            ; áA Y distance of CENTER mm
MRD
LDA.F EM30734            ; áA Y distance of CENTER mm
CON
MUL.F +100
CON
STA.F EM30736            ; áA X distance of CENTER 4 digit
MPP
LDA.L EM30736            ; áA X distance of CENTER 4 digit
CON
INTG.L
CON
STA.L EM30738
;2ë§Yé≤ï‚ê≥ó ââéZ
;'1ST_LINE Y=0.0067x2-0.5092x+9.6918
;FM140.F = 0		'X~3åWêî
;FM142.F = 0.0067 'X~2åWêî
;FM144.F = 0.5092 'XåWêî
;FM146.F = 9.6918
LD= FM100 #1
NCJ #1003
;'1ST_LINE Y=0.0067x2-0.5092x+9.6918
;
;FM140.F = 0		'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0 FM140
;FM142.F = 0.0067 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0067 FM142
;FM144.F = 0.5092 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +0.5092 FM144
;FM146.F = 9.6918
LD CR2002                ; Normal ON
MOV.F +9.6918 FM146
LABEL #1003
;
;'2ND_LINE Y=0.0078x2-0.5876x+11.103
;FM140.F = 0 'X~3åWêî
;FM142.F = 0.0078 'X~2åWêî
;FM144.F = 0.5876 'XåWêî
;FM146.F = 11.103
LD= FM100 #2
NCJ #1004
;'2ND_LINE Y=0.0078x2-0.5876x+11.103
;
;FM140.F = 0 'X~3åWêî
;
LD CR2002                ; Normal ON
MOV.F +0 FM140
;FM142.F = 0.0078 'X~2åWêî
;
LD CR2002                ; Normal ON
MOV.F +0.0078 FM142
;FM144.F = 0.5876 'XåWêî
;
LD CR2002                ; Normal ON
MOV.F +0.5876 FM144
;FM146.F = 11.103
LD CR2002                ; Normal ON
MOV.F +11.103 FM146
LABEL #1004
;
;EM35150.F = EM30710.L*+0.09375	'Piccel=>áoïœä∑
;
;EM35162.F = EM35150.F*EM35150.F			'X^2
;EM35172.F = FM142.F*EM35162.F			'0.0072*X^2
;EM35164.F = EM35150.F					'X
;EM35174.F = FM144.F*EM35164.F			'0.4799*X
;
;EM35178.F = EM35172.F-EM35174.F+FM146.F
;
;EM35180.F = EM35178.F*100		'åÖçáÇÌÇπ(0.00)
;EM35182.L = INT(EM35180.F)
LD CR2002                ; Normal ON
NCJ #1005
;EM35150.F = EM30710.L*+0.09375	'Piccel=>áoïœä∑
;
LD CR2002                ; Normal ON
LDA.L EM30710            ; áA Y BIN
CON
FLOAT.L
CON
MUL.F +0.09375
CON
STA.F EM35150
;EM35162.F = EM35150.F*EM35150.F			'X^2
;
LD CR2002                ; Normal ON
LDA.F EM35150
CON
MUL.F EM35150
CON
STA.F EM35162
;EM35172.F = FM142.F*EM35162.F			'0.0072*X^2
;
LD CR2002                ; Normal ON
LDA.F FM142
CON
MUL.F EM35162
CON
STA.F EM35172
;EM35164.F = EM35150.F					'X
;
LD CR2002                ; Normal ON
MOV.F EM35150 EM35164
;EM35174.F = FM144.F*EM35164.F			'0.4799*X
;
LD CR2002                ; Normal ON
LDA.F FM144
CON
MUL.F EM35164
CON
STA.F EM35174
;EM35178.F = EM35172.F-EM35174.F+FM146.F
;
LD CR2002                ; Normal ON
LDA.F EM35172
CON
SUB.F EM35174
CON
ADD.F FM146
CON
STA.F EM35178
;EM35180.F = EM35178.F*100		'åÖçáÇÌÇπ(0.00)
;
LD CR2002                ; Normal ON
LDA.F EM35178
CON
MUL.F +100
CON
STA.F EM35180
;EM35182.L = INT(EM35180.F)
LD CR2002                ; Normal ON
LDA.F EM35180
CON
INTG.L
CON
STA.L EM35182
LABEL #1005
;
LD CR2002                ; Normal ON
LDA.L EM30738
CON
ADD.L EM35182
CON
STA.L EM30750            ; á@ Y  mm
;ï‚ê≥(åÖ0.00)
STG @R108
MPS
AND= EM30624 $003A
MPS
LD= EM30670 $3636        ; áA T-code ASC Word
ANB @R109
ANL
LDA.L EM30760            ; áA X before angle amount
CON
ADD.L DM15210            ; 4-digit áA X direction (66 **) a
CON
STA.L EM30780            ; áA X  After angle amount
CON
SET @R109
MRD
LD= EM30670 $3637        ; áA T-code ASC Word
ANB @R109
ANL
LDA.L EM30760            ; áA X before angle amount
CON
ADD.L DM15214            ; 4-digit áA X direction (67 **) a
CON
STA.L EM30780            ; áA X  After angle amount
CON
SET @R109
MRD
LD= EM30623 $0031
OR= EM30623 $0033
ANB @R110
ANL
LDA.L EM30750            ; á@ Y  mm
CON
ADD.L DM15220            ; 1 height correction 4-digit áA Y
CON
STA.L EM30790            ; áA Y  After angle amount
CON
SET @R110
MPP
LD= EM30623 $0032
OR= EM30623 $0034
ANB @R110
ANL
LDA.L EM30750            ; á@ Y  mm
CON
ADD.L DM15222            ; 2 height correction 4-digit á@ Y
CON
STA.L EM30790            ; áA Y  After angle amount
CON
SET @R110
MRD
AND= EM30625 $003A
MPS
ANB @R109
LDA.L EM30760            ; áA X before angle amount
CON
ADD.L DM15310            ; áA X direction 5-digit angle cor
CON
STA.L EM30780            ; áA X  After angle amount
CON
SET @R109
MRD
LD= EM30623 $0031
OR= EM30623 $0033
ANB @R110
ANL
LDA.L EM30750            ; á@ Y  mm
CON
ADD.L DM15320            ; 1 height correction 5-digit áA Y
CON
STA.L EM30790            ; áA Y  After angle amount
CON
SET @R110
MPP
LD= EM30623 $0032
OR= EM30623 $0034
ANB @R110
ANL
LDA.L EM30750            ; á@ Y  mm
CON
ADD.L DM15322            ; 2 height correction 5-digit áA Y
CON
STA.L EM30790            ; áA Y  After angle amount
CON
SET @R110
MRD
LD @R109
AND @R110
ANL
JMP @R112
MPP
LD<> EM30624 $003A
AND<> EM30625 $003A
ANL
JMP @R114
STG @R112
ZRES @R109 @R110
CON
MPS
LD= EM30624 $003A
OR= EM30625 $003A
ANL
JMP @R105
MPP
LD= EM30600 $4552
AND= EM30601 $524F
AND= EM30602 $520D
ANL
JMP @R114
STG @R105
SET R39600               ; SR-750 Series[1]reading clear
CON
ANB R39100               ; SR-750 Series [1] reading finish
JMP @R106
STG @R106
RES R39600               ; SR-750 Series[1]reading clear
CON
JMP @R115
STG @R114
TMS @4 #1
CON
AND @T4
RES R37110               ; SR751-2 communication busy
CON
SET R37115               ; SR751-2 communication NG
CON
ENDS
STG @R115
TMS @5 #1
CON
AND @T5
RES R37110               ; SR751-2 communication busy
CON
SET R37109               ; SR751-2 communication finish
CON
ENDS
END
ENDH
