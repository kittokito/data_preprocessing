DEVICE:53
;MODULE:SM2_SUB
;MODULE_TYPE:0
;SCRIPT_TYPE:
;非常停止　出力クリア
LD R50010                ; Emargency Stop
ZRES @MR000 @MR1015      ; 原点復帰完了確認
;現在値表示 軸2
LD CR2002                ; 常時ON
UREAD.L #2 #2308 DM20774 #1;軸2現在座標
UREAD.L #2 #13808 DM20816 #2;軸２ｿﾌﾄﾘﾐｯﾄ＋
LDA.L DM20816            ; 軸２ｿﾌﾄﾘﾐｯﾄ＋
CON
SUB.L +300
CON
STA.L DM20816            ; 軸２ｿﾌﾄﾘﾐｯﾄ＋
CON
LDA.L DM20818            ; 軸２ｿﾌﾄﾘﾐｯﾄ-
CON
ADD.L +300
CON
STA.L DM20818            ; 軸２ｿﾌﾄﾘﾐｯﾄ-
;軸2_入力状態
LD CR2002                ; 常時ON
MOV DM20348 DM53028      ; 軸2 入力状態1  軸2 入力状態1
;ｻｰﾎﾞON　軸1
LD T2020                 ; 動作中遅延
SET R34913               ; 軸2 ｻｰﾎﾞON
MEP
RES R34800               ; 軸2 軸ｴﾗｰｸﾘｱ
LD R50015                ; ｴﾗｰﾘｾｯﾄSW ON
LD R35200                ; 軸2 軸ｴﾗｰ中
OR R35201                ; 軸2 軸ﾜｰﾆﾝｸﾞ中
ANL
SET R34800               ; 軸2 軸ｴﾗｰｸﾘｱ
LD MR10010               ; ｻｰﾎﾞ軸動作可能条件_共通
AND R35313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
ANB R50008               ; Error
ANB R50300               ; Pause
OUT MR10200              ; 軸2動作可
LD T2020                 ; 動作中遅延
MPS
LD R35200                ; 軸2 軸ｴﾗｰ中
AND R32802               ; ｴﾗｰ中
LD R35201                ; 軸2 軸ﾜｰﾆﾝｸﾞ中
ANB R62008               ; ｴﾗｰID1_No.8
ORL
ANL
SET @MR900               ; 軸ｴﾗｰ
U_RDAERC #2 #2 DM53020   ; 軸2_ｴﾗｰNo
UREAD #2 #1250 DM53021 #2; 軸2_ｴﾗｰ詳細1
MPP
ANB R35200               ; 軸2 軸ｴﾗｰ中
FMOV #0 DM53020 #4       ; 軸2_ｴﾗｰNo
;ｺﾝﾄﾛｰﾗ ｱﾗｰﾑ
LD R35505                ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
SET R35105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
LDB R35505               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R35105               ; 軸2 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
;一時停止/復帰
LD R50300                ; Pause
AND MR10211              ; 軸2原点復帰完了
ANB MR10212              ; 軸2ﾎﾟｲﾝﾄ移動完了
OR R49908                ; RB、INDEX非常停止
AND R35204               ; 軸2 軸制御中
MPS
OUT R34802               ; 軸2 減速停止
MPP
ANB R50003               ; HOME
@ZRES @MR200 @MR201      ; 軸2動作開始  軸2 ﾎﾟｲﾝﾄ_停止中
CON
@ZRES @MR210 @MR211      ; 軸2_現在値_確認  軸2_現在値_確認完了
CON
RES MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
CON
SET @MR110               ; 軸2制御中記憶
LDF R50300               ; Pause
AND R32800               ; 動作可能
AND R35313               ; 軸2 ｻｰﾎﾞﾚﾃﾞｨ
ANB R30808               ; 軸2 位置決め制御開始完了
ANB R35204               ; 軸2 軸制御中
ANB R35200               ; 軸2 軸ｴﾗｰ中
AND @MR110               ; 軸2制御中記憶
AND CR2003               ; 常時OFF
RES @MR110               ; 軸2制御中記憶
CON
SET R34805               ; 軸2 位置決め運転再開
LD R35205                ; 軸2 位置決め運転再開完了
RES R34805               ; 軸2 位置決め運転再開
;軸1原点復帰
LD MR10201               ; 軸2原点復帰要求
AND MR10200              ; 軸2動作可
RES MR10211              ; 軸2原点復帰完了
CON
OUT MR902                ; 軸2原点復帰中
CON
MPS
MCALL GENTEN #2 #2 R2002 R2012;測定Y軸 原点復帰完了  測定Y軸 原点復帰異常
MPP
LDF R2002                ; 測定Y軸 原点復帰完了
ORB R2002                ; 測定Y軸 原点復帰完了
ANL
SET @MR000               ; 原点復帰完了確認
STG @MR000               ; 原点復帰完了確認
AND R2002                ; 測定Y軸 原点復帰完了
RES MR10201              ; 軸2原点復帰要求
CON
SET MR10211              ; 軸2原点復帰完了
CON
ENDS
;ﾎﾟｲﾝﾄ移動(MANUAL)
;MANUAL時のJUMP速度、移動先ﾎﾟｲﾝﾄNo.をｾｯﾄする
LDP MR7809               ; 軸2JUMP SW(ﾊﾟﾈﾙ)
AND MR101                ; TP[0015]: TEACH画面
AND MR10200              ; 軸2動作可
MPS
RES @MR105
CON
SET @MR100               ; 軸2JUMP操作
MRD
SET MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
MPP
LDA.D DM604              ; 軸2速度設定値
CON
DIV.D #100
CON
MUL.D DM632              ; JUMP時速度ﾚｰﾄ
CON
STA.D DM20590            ; JUMP時移動速度
LD MR10200               ; 軸2動作可
MPS
ANP R80107               ; UT1-08 SW
@MOV #7 DM1020           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
SET MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
MRD
ANP R80100               ; UT1-01 SW
@MOV #1 DM1020           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
SET MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
MRD
ANP R80101               ; UT1-02 SW
@MOV #2 DM1020           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
SET MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
MRD
ANP R80102               ; UT1-03 SW
@MOV #3 DM1020           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
SET MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
MPP
ANP R80103               ; UT1-04 SW
@MOV #4 DM1020           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
SET MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
;位置移動
LD MR10202               ; 軸2ﾎﾟｲﾝﾄ移動要求
AND MR10200              ; 軸2動作可
@ZRES @MR200 @MR201      ; 軸2動作開始  軸2 ﾎﾟｲﾝﾄ_停止中
CON
@ZRES @MR210 @MR211      ; 軸2_現在値_確認  軸2_現在値_確認完了
CON
MPS
SET @MR210               ; 軸2_現在値_確認
CON
RES @MR211               ; 軸2_現在値_確認完了
CON
MPS
ANB @MR212               ; 軸2_現在値_停止中
SET @MR200               ; 軸2動作開始
MPP
AND @MR212               ; 軸2_現在値_停止中
RES MR10212              ; 軸2ﾎﾟｲﾝﾄ移動完了
CON
SET @MR201               ; 軸2 ﾎﾟｲﾝﾄ_停止中
MRD
OUT @MR300               ; 軸2_移動位置
MPP
AND @MR300               ; 軸2_移動位置
MPS
AND= DM1020 #1           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1040 DM1022     ; 運用_開始位置(左)P1_Y  軸2 移動先座標
MRD
AND= DM1020 #2           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1042 DM1022     ; 運用_終了位置(左)P2_Y  軸2 移動先座標
MRD
AND= DM1020 #3           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1044 DM1022     ; 運用_開始位置(右)P3_Y  軸2 移動先座標
MRD
AND= DM1020 #4           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1046 DM1022     ; 運用_終了位置(右)P4_Y  軸2 移動先座標
MRD
AND= DM1020 #7           ; 軸2 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1090 DM1022     ; 運用_待機位置(P7)Y  軸2 移動先座標
MPP
ANP @MR100               ; 軸2JUMP操作
@MOV.L DM20852 DM1022    ; 軸2ﾃｰﾁﾝｸﾞ画面"数値入力"  軸2 移動先座標
;IF D1022.L=DM20774.L THEN     '軸2 移動先のﾎﾟｲﾝﾄにいるか？
;	SET (@MR212)
;ELSE
;	RES (@MR212)
;END IF
;SET (@MR211)
LD @MR210                ; 軸2_現在値_確認
ANB @MR211               ; 軸2_現在値_確認完了
NCJ #1000
;IF D1022.L=DM20774.L THEN     '軸2 移動先のﾎﾟｲﾝﾄにいるか？
;
LD=.L DM1022 DM20774     ; 軸2 移動先座標  軸2現在座標
NCJ #2000
;	SET (@MR212)
;
LD CR2002                ; 常時ON
SET @MR212               ; 軸2_現在値_停止中
;ELSE
;
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;	RES (@MR212)
;
LD CR2002                ; 常時ON
RES @MR212               ; 軸2_現在値_停止中
;END IF
;
LABEL #2001
;SET (@MR211)
LD CR2002                ; 常時ON
SET @MR211               ; 軸2_現在値_確認完了
LABEL #1000
;
STG @MR201               ; 軸2 ﾎﾟｲﾝﾄ_停止中
TMH @0 #7                ; 軸2_DLY
CON
AND @T0                  ; 軸2_DLY
RES MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
CON
SET MR10212              ; 軸2ﾎﾟｲﾝﾄ移動完了
CON
RES @MR210               ; 軸2_現在値_確認
CON
RES @MR211               ; 軸2_現在値_確認完了
CON
ENDS
;ﾎﾟｲﾝﾄ移動
;軸2動作
STG @MR200               ; 軸2動作開始
RES MR10212              ; 軸2ﾎﾟｲﾝﾄ移動完了
CON
MPS
ANB @MR100               ; 軸2JUMP操作
OUT @MR301               ; 軸2_速度低速
MPS
AND @MR301               ; 軸2_速度低速
@MOV.L DM608 DM1024      ; 軸2(1)速度設定値(ﾌｨﾙﾀ間)  軸2 速度
@MOV.L DM610 DM1026      ; 軸2(1)加減速ﾚｰﾄ設定値(ﾌｨﾙﾀ間)  軸2 加速度
@MOV.L DM610 DM1028      ; 軸2(1)加減速ﾚｰﾄ設定値(ﾌｨﾙﾀ間)  軸2 減速度
MPP
LD MR1207                ; 軸XY_待機位置P7
OR MR1202                ; 軸XY_測定終了(左)P2
OR MR1204                ; 軸XY_測定終了(左)P4
OR= DM1020 #7            ; 軸2 移動先ﾎﾟｲﾝﾄNo.
ANL
MPS
OUT @MR302               ; 軸2_速度高速
MPP
AND @MR302               ; 軸2_速度高速
@MOV.L DM604 DM1024      ; 軸2速度設定値  軸2 速度
@MOV.L DM606 DM1026      ; 軸2加減速ﾚｰﾄ設定値  軸2 加速度
@MOV.L DM606 DM1028      ; 軸2加減速ﾚｰﾄ設定値  軸2 減速度
MRD
AND @MR100               ; 軸2JUMP操作
MPS
OUT @MR303               ; 軸2_JUMP操作
MPP
AND @MR303               ; 軸2_JUMP操作
@MOV.L DM20590 DM1024    ; JUMP時移動速度  軸2 速度
@MOV.L DM606 DM1026      ; 軸2加減速ﾚｰﾄ設定値  軸2 加速度
@MOV.L DM606 DM1028      ; 軸2加減速ﾚｰﾄ設定値  軸2 減速度
MRD
OUT @MR304               ; 軸2_ﾊﾞｯﾌｧﾒﾓﾘへ転送
MRD
AND @MR304               ; 軸2_ﾊﾞｯﾌｧﾒﾓﾘへ転送
@UWRIT.D #2 #18048 DM1022 #1;軸2 移動先座標
@UWRIT.D #2 #18060 DM1024 #1;軸2 速度
@UWRIT.D #2 #18062 DM1026 #1;軸2 加速度
@UWRIT.D #2 #18064 DM1028 #1;軸2 減速度
MRD
MCALL POINT_MOVE #2 #2 #1 @MR1000 @MR1001;ﾏｸﾛ動作完了
MPP
AND @MR1000              ; ﾏｸﾛ動作完了
RES @MR1000              ; ﾏｸﾛ動作完了
CON
RES MR10202              ; 軸2ﾎﾟｲﾝﾄ移動要求
CON
SET MR10212              ; 軸2ﾎﾟｲﾝﾄ移動完了
CON
RES @MR210               ; 軸2_現在値_確認
CON
RES @MR211               ; 軸2_現在値_確認完了
CON
RES @MR100               ; 軸2JUMP操作
CON
ENDS
;軸2ｴﾗｰ(ﾘｾｯﾄ後TRAP処理)
STG @MR900               ; 軸ｴﾗｰ
ANB R49900               ; Main_Error
SET R49900               ; Main_Error
CON
JMP @MR901               ; STG_Error_No.5表示
SET R62005               ; ｴﾗｰID1_No.5
CON
SET R61005               ; ｴﾗｰID2_No.5
CON
MOV #5 DM1461            ; ｴﾗｰ詳細   (ﾊﾟﾈﾙ)
STG @MR901               ; STG_Error_No.5表示
AND R50008               ; Error
RES R49900               ; Main_Error
CON
JMP @MR902               ; STG_Error_No.5発報確認
STG @MR902               ; STG_Error_No.5発報確認
ANB R50008               ; Error
SET R34800               ; 軸2 軸ｴﾗｰｸﾘｱ
CON
SET R50011               ; TRAP
CON
ENDS
;変位ｾﾝｻへ出力
LD CR2002                ; 常時ON
MPS
AND @MR210               ; 軸2_現在値_確認
MPS
LD MR1201                ; 軸XY_測定開始(左)P1
LD MR1210                ; 軸XY_日常点検開始(X_P5・Y_P1)
AND LR604                ; 日常点検ﾓｰﾄﾞ
ORL
ANL
OUT MR501                ; 変位ｾﾝｻへ START信号_A
MPP
AND MR1203               ; 軸XY_測定開始(左)P3
OUT MR502                ; 変位ｾﾝｻへ START信号_B
MRD
LD MR1202                ; 軸XY_測定終了(左)P2
LD MR1211                ; 軸XY_日常点検終了(X_P5・Y_P2)
AND LR604                ; 日常点検ﾓｰﾄﾞ
ORL
ANL
OUT MR511                ; 変位ｾﾝｻへ STOP信号_A
MPP
AND MR1204               ; 軸XY_測定終了(左)P4
OUT MR512                ; 変位ｾﾝｻへ STOP信号_B
END
ENDH
