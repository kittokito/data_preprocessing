DEVICE:53
;MODULE:LASER_SUB
;MODULE_TYPE:0
;EIP ｻｲｸﾘｯｸ通信開始
LD CR2002                ; 常時ON
UWRIT #0 #1648 #1 #1
TMR #2005 #80            ; EIP ｻｲｸﾘｯｸ通信開始DLY
MPS
LDP T2005                ; EIP ｻｲｸﾘｯｸ通信開始DLY
ANB R41005               ; ｻｲｸﾘｯｸ通信再開完了
ANL
@SET R40005              ; ｻｲｸﾘｯｸ通信再開要求
MPP
AND R41005               ; ｻｲｸﾘｯｸ通信再開完了
RES R40005               ; ｻｲｸﾘｯｸ通信再開要求
;変位計・画像処理 準備OK
LD CR2002                ; 常時ON
MPS
AND R013                 ; 変位ｾﾝｻ_ERR
OUT MR31000              ; 変位ｾﾝｻ 正常
MPP
LD B02                   ; XG-8000/7000[1]Cmd ready
AND R015                 ; 画像処理RUN
OR MR400                 ; 画像処理 無ﾃｽﾄ
ANL
TMR #2105 #5             ; 画像 Ready Delay
CON
AND T2105                ; 画像 Ready Delay
OUT MR31001              ; 画像処理 正常
;変位計へ検査設定を送信
LD MR31110               ; 画像 検査設定指令
ANB MR400                ; 画像処理 無ﾃｽﾄ
MPS
ANB LR115                ; 画像へ検査設定完了
MPS
@RES MR31200             ; Command Request ON
CON
@RES MR31206             ; Reault Ack ON
CON
@DW.D #2 DM700           ; L側 検査結果
CON
@DW.D #2 DM702           ; R側 検査結果
CON
@SET @MR100              ; 画像 検査設定開始
MPP
TMR #2120 #600           ; 画像 検査設定ﾀｲﾑｱｳﾄ
MPP
AND LR115                ; 画像へ検査設定完了
RES MR31110              ; 画像 検査設定指令
STG @MR100               ; 画像 検査設定開始
MPS
AND MR105                ; ﾓｰﾄﾞ選択有
DW.D #1 W0F8             ; XG-8000/7000[1]OutDat(0016)
CON
MPS
AND LR600                ; 通常検査ﾓｰﾄﾞ
DW.D #0 W0FA             ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR601                ; ﾌｨﾙﾀ検査ﾓｰﾄﾞ
DW.D #1 W0FA             ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR602                ; ﾌｨﾙﾀAssy検査ﾓｰﾄﾞ
DW.D #2 W0FA             ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR603                ; ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査ﾓｰﾄﾞ
DW.D #3 W0FA             ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR604                ; 日常点検ﾓｰﾄﾞ
DW.D #4 W0FA             ; XG-8000/7000[1]OutDat(0020)
MPP
JMP @MR101               ; 検査ﾓｰﾄﾞ設定
MPP
ANB MR105                ; ﾓｰﾄﾞ選択有
JMP @MR103               ; 検査ﾓｰﾄﾞ設定完了
STG @MR101               ; 検査ﾓｰﾄﾞ設定
AND=.D W0F8 #1           ; XG-8000/7000[1]OutDat(0016)
LD LR600                 ; 通常検査ﾓｰﾄﾞ
AND=.D W0FA #0           ; XG-8000/7000[1]OutDat(0020)
LD LR601                 ; ﾌｨﾙﾀ検査ﾓｰﾄﾞ
AND=.D W0FA #1           ; XG-8000/7000[1]OutDat(0020)
ORL
LD LR602                 ; ﾌｨﾙﾀAssy検査ﾓｰﾄﾞ
AND=.D W0FA #2           ; XG-8000/7000[1]OutDat(0020)
ORL
LD LR603                 ; ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査ﾓｰﾄﾞ
AND=.D W0FA #3           ; XG-8000/7000[1]OutDat(0020)
ORL
LD LR604                 ; 日常点検ﾓｰﾄﾞ
AND=.D W0FA #4           ; XG-8000/7000[1]OutDat(0020)
ORL
ANL
TMR #2100 #2             ; Command Request-1 ON_DLY
CON
AND T2100                ; Command Request-1 ON_DLY
SET MR31200              ; Command Request ON
CON
JMP @MR102               ; 検査ﾓｰﾄﾞ設定ｺﾏﾝﾄﾞ出力
STG @MR102               ; 検査ﾓｰﾄﾞ設定ｺﾏﾝﾄﾞ出力
AND B00                  ; XG-8000/7000[1]Cmd complete
MPS
AND=.D W06 #0            ; XG-8000/7000[1]InDat(0020)
RES MR31200              ; Command Request ON
CON
JMP @MR103               ; 検査ﾓｰﾄﾞ設定完了
MPP
AND<>.D W06 #0           ; XG-8000/7000[1]InDat(0020)
JMP @MR200               ; ｺﾏﾝﾄﾞNG
STG @MR103               ; 検査ﾓｰﾄﾞ設定完了
AND B02                  ; XG-8000/7000[1]Cmd ready
JMP @MR110               ; Cmd Ready ON待ち
STG @MR110               ; Cmd Ready ON待ち
DW #2 W0F8               ; XG-8000/7000[1]OutDat(0016)
CON
MPS
AND LR500                ; 機種1選択
DW #0 W0FA               ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR501                ; 機種2選択
DW.D #1 W0FA             ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR502                ; 機種3選択
DW.D #2 W0FA             ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR503                ; 機種4選択
DW.D #3 W0FA             ; XG-8000/7000[1]OutDat(0020)
MRD
AND LR504                ; 機種5選択
DW.D #4 W0FA             ; XG-8000/7000[1]OutDat(0020)
MPP
JMP @MR111               ; ﾜｰｸ種別設定
STG @MR111               ; ﾜｰｸ種別設定
AND=.D W0F8 #2           ; XG-8000/7000[1]OutDat(0016)
LD LR500                 ; 機種1選択
AND=.D W0FA #0           ; XG-8000/7000[1]OutDat(0020)
LD LR501                 ; 機種2選択
AND=.D W0FA #1           ; XG-8000/7000[1]OutDat(0020)
ORL
LD LR502                 ; 機種3選択
AND=.D W0FA #2           ; XG-8000/7000[1]OutDat(0020)
ORL
LD LR503                 ; 機種4選択
AND=.D W0FA #3           ; XG-8000/7000[1]OutDat(0020)
ORL
LD LR504                 ; 機種5選択
AND=.D W0FA #4           ; XG-8000/7000[1]OutDat(0020)
ORL
ANL
TMR #2101 #2             ; Command Request-2 ON_DLY
CON
AND T2101                ; Command Request-2 ON_DLY
SET MR31200              ; Command Request ON
CON
JMP @MR112               ; ﾜｰｸ種別設定ｺﾏﾝﾄﾞ出力
STG @MR112               ; ﾜｰｸ種別設定ｺﾏﾝﾄﾞ出力
AND B00                  ; XG-8000/7000[1]Cmd complete
MPS
AND=.D W06 #0            ; XG-8000/7000[1]InDat(0020)
RES MR31200              ; Command Request ON
CON
JMP @MR113               ; ﾜｰｸ種別設定完了
MPP
AND<>.D W06 #0           ; XG-8000/7000[1]InDat(0020)
JMP @MR200               ; ｺﾏﾝﾄﾞNG
STG @MR113               ; ﾜｰｸ種別設定完了
@INC DM5100
CON
RES MR31110              ; 画像 検査設定指令
CON
MPS
AND MR105                ; ﾓｰﾄﾞ選択有
SET LR115                ; 画像へ検査設定完了
MPP
ENDS
STG @MR200               ; ｺﾏﾝﾄﾞNG
RES MR31200              ; Command Request ON
CON
RES MR31110              ; 画像 検査設定指令
CON
SET MR31112              ; 画像ｺﾏﾝﾄﾞ異常
CON
ENDS
;画像へ検査設定完了ｸﾘｱ
LDP T2000                ; 起動遅延
ORP LR600                ; 通常検査ﾓｰﾄﾞ
ORP LR601                ; ﾌｨﾙﾀ検査ﾓｰﾄﾞ
ORP LR602                ; ﾌｨﾙﾀAssy検査ﾓｰﾄﾞ
ORP LR603                ; ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査ﾓｰﾄﾞ
ORP LR604                ; 日常点検ﾓｰﾄﾞ
ORP LR500                ; 機種1選択
ORP LR501                ; 機種2選択
ORP LR502                ; 機種3選択
ORP LR503                ; 機種4選択
ORP LR504                ; 機種5選択
ORP R014                 ; 画像処理_ERR
ORF R015                 ; 画像処理RUN
RES LR115                ; 画像へ検査設定完了
INC DM960
;機種切替→画像処理 設定No変更
LDP LR500                ; 機種1選択
ORP LR501                ; 機種2選択
ORP LR502                ; 機種3選択
ORP LR503                ; 機種4選択
ORP LR504                ; 機種5選択
ORP LR600                ; 通常検査ﾓｰﾄﾞ
ORP LR601                ; ﾌｨﾙﾀ検査ﾓｰﾄﾞ
ORP LR602                ; ﾌｨﾙﾀAssy検査ﾓｰﾄﾞ
ORP LR603                ; ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査ﾓｰﾄﾞ
LDP LR604                ; 日常点検ﾓｰﾄﾞ
ANB MR800                ; 日常点検 無効
ORL
AND R015                 ; 画像処理RUN
MPS
OUT MR115                ; 機種切替→画像処理設定No変更
MPP
ANB MR400                ; 画像処理 無ﾃｽﾄ
@SET MR31110             ; 画像 検査設定指令
;測定結果を取得
LD B03                   ; XG-8000/7000[1]Result ready
LD R50001                ; AUTO
OR R50002                ; STEP
ANL
TMR #2110 #2             ; Result Ready DLY
CON
AND T2110                ; Result Ready DLY
ANB MR400                ; 画像処理 無ﾃｽﾄ
@MOV.D W038 DM700        ; XG-8000/7000[1]InDat(0120)  L側 検査結果
@MOV.D W03A DM702        ; XG-8000/7000[1]InDat(0124)  R側 検査結果
SET MR31206              ; Reault Ack ON
SET MR31114              ; 検査結果取得完了
LD MR400                 ; 画像処理 無ﾃｽﾄ
ANF R55801               ; ST1 C/T  計測中
@MOV.D DM710 DM700       ; L側 ﾃｽﾄ  L側 検査結果
@MOV.D DM712 DM702       ; R側 ﾃｽﾄ  R側 検査結果
SET MR31114              ; 検査結果取得完了
LD MR31206               ; Reault Ack ON
ANB B03                  ; XG-8000/7000[1]Result ready
RES MR31206              ; Reault Ack ON
LDB MR31114              ; 検査結果取得完了
LD R50001                ; AUTO
OR R50002                ; STEP
ANL
ANB R55801               ; ST1 C/T  計測中
TMR #2121 #100           ; 画像 結果取得ﾀｲﾑｱｳﾄ
;画像処理へ出力
LD MR31200               ; Command Request ON
OUT B040                 ; XG-8000/7000[1]Cmd request
LD MR31206               ; Reault Ack ON
OUT B043                 ; XG-8000/7000[1]Result ack
;判定結果
LD MR31114               ; 検査結果取得完了
MPS
AND=.D DM700 #0          ; L側 検査結果
OUT MR600                ; L側 測定NG
MRD
LD=.D DM700 #1000        ; L側 検査結果
AND LR600                ; 通常検査ﾓｰﾄﾞ
ANL
OUT MR601                ; L側 通常検査OK
MRD
LD=.D DM700 #2000        ; L側 検査結果
AND LR601                ; ﾌｨﾙﾀ検査ﾓｰﾄﾞ
ANL
OUT MR602                ; L側 ﾌｨﾙﾀ検査OK
MRD
LD=.D DM700 #3000        ; L側 検査結果
AND LR602                ; ﾌｨﾙﾀAssy検査ﾓｰﾄﾞ
ANL
OUT MR603                ; L側 ﾌｨﾙﾀAssy検査OK
MRD
LD=.D DM700 #4000        ; L側 検査結果
AND LR603                ; ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査ﾓｰﾄﾞ
ANL
OUT MR604                ; L側 ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査OK
MRD
LD=.D DM700 #5000        ; L側 検査結果
AND LR604                ; 日常点検ﾓｰﾄﾞ
ANL
OUT MR605                ; L側 日常点検検査OK
MPP
AND=.D DM700 #9000       ; L側 検査結果
OUT MR609                ; L側 ﾜｰｸ無
LD MR31114               ; 検査結果取得完了
MPS
AND=.D DM702 #0          ; R側 検査結果
OUT MR700                ; R側 測定NG
MRD
LD=.D DM702 #1000        ; R側 検査結果
AND LR600                ; 通常検査ﾓｰﾄﾞ
ANL
OUT MR701                ; R側 通常検査OK
MRD
LD=.D DM702 #2000        ; R側 検査結果
AND LR601                ; ﾌｨﾙﾀ検査ﾓｰﾄﾞ
ANL
OUT MR702                ; R側 ﾌｨﾙﾀ検査OK
MRD
LD=.D DM702 #3000        ; R側 検査結果
AND LR602                ; ﾌｨﾙﾀAssy検査ﾓｰﾄﾞ
ANL
OUT MR703                ; R側 ﾌｨﾙﾀAssy検査OK
MRD
LD=.D DM702 #4000        ; R側 検査結果
AND LR603                ; ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査ﾓｰﾄﾞ
ANL
OUT MR704                ; R側 ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査OK
MRD
LD=.D DM702 #5000        ; R側 検査結果
AND LR604                ; 日常点検ﾓｰﾄﾞ
ANL
OUT MR705                ; R側 日常点検検査OK
MPP
AND=.D DM702 #9000       ; R側 検査結果
OUT MR709                ; R側 ﾜｰｸ無
LD MR601                 ; L側 通常検査OK
OR MR602                 ; L側 ﾌｨﾙﾀ検査OK
OR MR603                 ; L側 ﾌｨﾙﾀAssy検査OK
OR MR604                 ; L側 ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査OK
OR MR605                 ; L側 日常点検検査OK
OR MR609                 ; L側 ﾜｰｸ無
OUT MR610                ; L側 OKまとめ
LD MR701                 ; R側 通常検査OK
OR MR702                 ; R側 ﾌｨﾙﾀ検査OK
OR MR703                 ; R側 ﾌｨﾙﾀAssy検査OK
OR MR704                 ; R側 ﾌﾟﾘﾝﾄﾍｯﾄﾞ検査OK
OR MR705                 ; R側 日常点検検査OK
OR MR709                 ; R側 ﾜｰｸ無
OUT MR710                ; R側 OKまとめ
END
ENDH
