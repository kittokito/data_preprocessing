DEVICE:53
;MODULE:SM1_SUB
;MODULE_TYPE:0
;SCRIPT_TYPE:
;非常停止　出力クリア
LD R50010                ; Emargency Stop
ZRES @MR000 @MR1015      ; 原点復帰完了確認
;現在値表示 軸1
LD CR2002                ; 常時ON
UREAD.L #2 #2158 DM20770 #1;軸1 現在座標
UREAD.L #2 #13788 DM20812 #2;軸１ｿﾌﾄﾘﾐｯﾄ＋
LDA.L DM20812            ; 軸１ｿﾌﾄﾘﾐｯﾄ＋
CON
SUB.L +300
CON
STA.L DM20812            ; 軸１ｿﾌﾄﾘﾐｯﾄ＋
CON
LDA.L DM20814            ; 軸１ｿﾌﾄﾘﾐｯﾄ-
CON
ADD.L +300
CON
STA.L DM20814            ; 軸１ｿﾌﾄﾘﾐｯﾄ-
;軸1_入力状態
LD CR2002                ; 常時ON
MOV DM20288 DM53018      ; 軸1 入力状態1  軸1 入力状態1
;ｻｰﾎﾞON　軸1
LD T2020                 ; 動作中遅延
SET R34113               ; 軸1 ｻｰﾎﾞON
MEP
RES R34000               ; 軸1 軸ｴﾗｰｸﾘｱ
LD R50015                ; ｴﾗｰﾘｾｯﾄSW ON
LD R34400                ; 軸1 軸ｴﾗｰ中
OR R34401                ; 軸1 軸ﾜｰﾆﾝｸﾞ中
ANL
SET R34000               ; 軸1 軸ｴﾗｰｸﾘｱ
LD MR10010               ; ｻｰﾎﾞ軸動作可能条件_共通
AND R34513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
ANB R50008               ; Error
ANB R50300               ; Pause
OUT MR10000              ; 軸1動作可
LD T2020                 ; 動作中遅延
MPS
LD R34400                ; 軸1 軸ｴﾗｰ中
AND R32802               ; ｴﾗｰ中
LD R34401                ; 軸1 軸ﾜｰﾆﾝｸﾞ中
ANB R62008               ; ｴﾗｰID1_No.8
ORL
ANL
SET @MR900               ; 軸ｴﾗｰ
U_RDAERC #2 #1 DM53010   ; 軸1_ｴﾗｰNo
UREAD #2 #1248 DM53011 #2; 軸1_ｴﾗｰ詳細1
MPP
ANB R34400               ; 軸1 軸ｴﾗｰ中
FMOV #0 DM53010 #4       ; 軸1_ｴﾗｰNo
;ｺﾝﾄﾛｰﾗ ｱﾗｰﾑ
LD R34705                ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
SET R34305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
LDB R34705               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑ
RES R34305               ; 軸1 ﾄﾞﾗｲﾊﾞｱﾗｰﾑﾘｾｯﾄ
;一時停止/復帰
LD R50300                ; Pause
AND MR10011              ; 軸1原点復帰完了
ANB MR10012              ; 軸1ﾎﾟｲﾝﾄ移動完了
OR R49908                ; RB、INDEX非常停止
AND R34404               ; 軸1 軸制御中
MPS
OUT R34002               ; 軸1 減速停止
MPP
ANB R50003               ; HOME
@ZRES @MR200 @MR201      ; 軸1動作開始  軸1 ﾎﾟｲﾝﾄ_停止中
CON
@ZRES @MR210 @MR211      ; 軸1_現在値_確認  軸1_現在値_確認完了
CON
RES MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
CON
SET @MR110               ; 軸1制御中記憶
LDF R50300               ; Pause
AND R32800               ; 動作可能
AND R34513               ; 軸1 ｻｰﾎﾞﾚﾃﾞｨ
ANB R30800               ; 軸1 位置決め制御開始完了
ANB R34404               ; 軸1 軸制御中
ANB R34400               ; 軸1 軸ｴﾗｰ中
AND @MR110               ; 軸1制御中記憶
AND CR2003               ; 常時OFF
RES @MR110               ; 軸1制御中記憶
CON
SET R34005               ; 軸1 位置決め運転再開
LD R34405                ; 軸1 位置決め運転再開完了
RES R34005               ; 軸1 位置決め運転再開
;軸1原点復帰
LD MR10001               ; 軸1原点復帰要求
AND MR10000              ; 軸1動作可
RES MR10011              ; 軸1原点復帰完了
CON
OUT MR901                ; 軸1原点復帰中
CON
MPS
MCALL GENTEN #2 #1 R2000 R2010;測定X軸 原点復帰完了  測定X軸 原点復帰異常
MPP
LDF R2000                ; 測定X軸 原点復帰完了
ORB R2000                ; 測定X軸 原点復帰完了
ANL
SET @MR000               ; 原点復帰完了確認
STG @MR000               ; 原点復帰完了確認
AND R2000                ; 測定X軸 原点復帰完了
RES MR10001              ; 軸1原点復帰要求
CON
SET MR10011              ; 軸1原点復帰完了
CON
ENDS
;ﾎﾟｲﾝﾄ移動(MANUAL)
;MANUAL時のJUMP速度、移動先ﾎﾟｲﾝﾄNo.をｾｯﾄする
LDP MR7609               ; 軸1JUMP SW(ﾊﾟﾈﾙ)
AND MR101                ; TP[0015]: TEACH画面
AND MR10000              ; 軸1動作可
SET @MR100               ; 軸1JUMP操作(ﾃｨｰﾁﾝｸﾞ)
SET MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
LDA.D DM600              ; 軸1速度設定値
CON
DIV.D #100
CON
MUL.D DM632              ; JUMP時速度ﾚｰﾄ
CON
STA.D DM20590            ; JUMP時移動速度
LD MR10000               ; 軸1動作可
MPS
ANP R80107               ; UT1-08 SW
@MOV #7 DM1000           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
SET MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
MRD
ANP R80100               ; UT1-01 SW
@MOV #1 DM1000           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
SET MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
MRD
ANP R80101               ; UT1-02 SW
@MOV #2 DM1000           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
SET MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
MRD
ANP R80102               ; UT1-03 SW
@MOV #3 DM1000           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
SET MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
MPP
ANP R80103               ; UT1-04 SW
@MOV #4 DM1000           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
SET MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
;位置移動
LD MR10002               ; 軸1ﾎﾟｲﾝﾄ移動要求
AND MR10000              ; 軸1動作可
@ZRES @MR200 @MR201      ; 軸1動作開始  軸1 ﾎﾟｲﾝﾄ_停止中
CON
@ZRES @MR210 @MR211      ; 軸1_現在値_確認  軸1_現在値_確認完了
CON
MPS
SET @MR210               ; 軸1_現在値_確認
CON
AND @MR211               ; 軸1_現在値_確認完了
MPS
ANB @MR212               ; 軸1_現在値_停止中
SET @MR200               ; 軸1動作開始
MPP
AND @MR212               ; 軸1_現在値_停止中
RES MR10012              ; 軸1ﾎﾟｲﾝﾄ移動完了
CON
SET @MR201               ; 軸1 ﾎﾟｲﾝﾄ_停止中
MRD
OUT @MR300               ; 軸1_移動位置
MPP
AND @MR300               ; 軸1_移動位置
MPS
AND= DM1000 #1           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1020 DM1002     ; 運用_開始位置(左)P1_X  軸1 移動先座標
MRD
AND= DM1000 #2           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1022 DM1002     ; 運用_終了位置(左)P2_X  軸1 移動先座標
MRD
AND= DM1000 #3           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1024 DM1002     ; 運用_開始位置(右)P3_X  軸1 移動先座標
MRD
AND= DM1000 #4           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1026 DM1002     ; 運用_終了位置(右)P4_X  軸1 移動先座標
MRD
AND= DM1000 #5           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1028 DM1002     ; 軸1 移動先座標
MRD
AND= DM1000 #7           ; 軸1 移動先ﾎﾟｲﾝﾄNo.
@MOV.L EM1080 DM1002     ; 運用_待機位置(P7)_X  軸1 移動先座標
MPP
ANP @MR100               ; 軸1JUMP操作(ﾃｨｰﾁﾝｸﾞ)
@MOV.L DM20850 DM1002    ; 軸1ﾃｰﾁﾝｸﾞ画面"数値入力"  軸1 移動先座標
;IF D1002.L=DM20770.L THEN     '軸1 移動先のﾎﾟｲﾝﾄにいるか？
;	SET (@MR212)
;ELSE
;	RES (@MR212)
;END IF
;SET (@MR211)
LD @MR210                ; 軸1_現在値_確認
ANB @MR211               ; 軸1_現在値_確認完了
NCJ #1001
;IF D1002.L=DM20770.L THEN     '軸1 移動先のﾎﾟｲﾝﾄにいるか？
;
LD=.L DM1002 DM20770     ; 軸1 移動先座標  軸1 現在座標
NCJ #2000
;	SET (@MR212)
;
LD CR2002                ; 常時ON
SET @MR212               ; 軸1_現在値_停止中
;ELSE
;
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;	RES (@MR212)
;
LD CR2002                ; 常時ON
RES @MR212               ; 軸1_現在値_停止中
;END IF
;
LABEL #2001
;SET (@MR211)
LD CR2002                ; 常時ON
SET @MR211               ; 軸1_現在値_確認完了
LABEL #1001
;
STG @MR201               ; 軸1 ﾎﾟｲﾝﾄ_停止中
TMH @0 #7                ; 軸1_DLY
CON
AND @T0                  ; 軸1_DLY
RES MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
CON
SET MR10012              ; 軸1ﾎﾟｲﾝﾄ移動完了
CON
RES @MR210               ; 軸1_現在値_確認
CON
RES @MR211               ; 軸1_現在値_確認完了
CON
ENDS
;ﾎﾟｲﾝﾄ移動
;軸1動作
STG @MR200               ; 軸1動作開始
RES MR10012              ; 軸1ﾎﾟｲﾝﾄ移動完了
CON
MPS
ANB @MR100               ; 軸1JUMP操作(ﾃｨｰﾁﾝｸﾞ)
OUT @MR301               ; 軸1_速度低速
MPS
AND @MR301               ; 軸1_速度低速
@MOV.L DM608 DM1004      ; 軸2(1)速度設定値(ﾌｨﾙﾀ間)  軸1 速度
@MOV.L DM610 DM1006      ; 軸2(1)加減速ﾚｰﾄ設定値(ﾌｨﾙﾀ間)  軸1 加速度
@MOV.L DM610 DM1008      ; 軸2(1)加減速ﾚｰﾄ設定値(ﾌｨﾙﾀ間)  軸1 減速度
MPP
LD MR1207                ; 軸XY_待機位置P7
OR MR1202                ; 軸XY_測定終了(左)P2
OR MR1204                ; 軸XY_測定終了(左)P4
OR= DM1000 #7            ; 軸1 移動先ﾎﾟｲﾝﾄNo.
ANL
MPS
OUT @MR302               ; 軸1_速度高速
MPP
AND @MR302               ; 軸1_速度高速
@MOV.L DM600 DM1004      ; 軸1速度設定値  軸1 速度
@MOV.L DM602 DM1006      ; 軸1加減速ﾚｰﾄ設定値  軸1 加速度
@MOV.L DM602 DM1008      ; 軸1加減速ﾚｰﾄ設定値  軸1 減速度
MRD
AND @MR100               ; 軸1JUMP操作(ﾃｨｰﾁﾝｸﾞ)
MPS
OUT @MR303               ; 軸1_JUMP操作
MPP
AND @MR303               ; 軸1_JUMP操作
@MOV.L DM20590 DM1004    ; JUMP時移動速度  軸1 速度
@MOV.L DM602 DM1006      ; 軸1加減速ﾚｰﾄ設定値  軸1 加速度
@MOV.L DM602 DM1008      ; 軸1加減速ﾚｰﾄ設定値  軸1 減速度
MRD
OUT @MR304               ; 軸1_ﾊﾞｯﾌｧﾒﾓﾘへ転送
MRD
AND @MR304               ; 軸1_ﾊﾞｯﾌｧﾒﾓﾘへ転送
@UWRIT.D #2 #18016 DM1002 #1;軸1 移動先座標
@UWRIT.D #2 #18028 DM1004 #1;軸1 速度
@UWRIT.D #2 #18030 DM1006 #1;軸1 加速度
@UWRIT.D #2 #18032 DM1008 #1;軸1 減速度
MRD
MCALL POINT_MOVE #2 #1 #1 @MR1000 @MR1001;ﾏｸﾛ動作完了
MPP
AND @MR1000              ; ﾏｸﾛ動作完了
RES @MR1000              ; ﾏｸﾛ動作完了
CON
RES MR10002              ; 軸1ﾎﾟｲﾝﾄ移動要求
CON
SET MR10012              ; 軸1ﾎﾟｲﾝﾄ移動完了
CON
RES @MR210               ; 軸1_現在値_確認
CON
RES @MR211               ; 軸1_現在値_確認完了
CON
RES @MR100               ; 軸1JUMP操作(ﾃｨｰﾁﾝｸﾞ)
CON
ENDS
;軸1ｴﾗｰ(ﾘｾｯﾄ後TRAP処理)
STG @MR900               ; 軸ｴﾗｰ
ANB R49900               ; Main_Error
SET R49900               ; Main_Error
CON
JMP @MR901               ; STG_Error_No.4表示
SET R62004               ; ｴﾗｰID1_No.4
CON
SET R61004               ; ｴﾗｰID2_No.4
CON
MOV #4 DM1461            ; ｴﾗｰ詳細   (ﾊﾟﾈﾙ)
STG @MR901               ; STG_Error_No.4表示
AND R50008               ; Error
RES R49900               ; Main_Error
CON
JMP @MR902               ; STG_Error_No.4発報確認
STG @MR902               ; STG_Error_No.4発報確認
ANB R50008               ; Error
SET R50011               ; TRAP
CON
ENDS
END
ENDH
