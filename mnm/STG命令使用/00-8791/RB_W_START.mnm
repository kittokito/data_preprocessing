DEVICE:53
;MODULE:RB_W_START
;MODULE_TYPE:1
;***** RB Control Macro *****
;RB Type      : Weld
;RB Controler : PSEL / ASEL
;Version      : 1.00
;Date         : 2011/08/12
;ACTION 		 : 溶着動作
;<引数>
;P0 : RB_W DeviceNet入力割付先頭
;P1 : RB_W DeviceNet出力割付先頭
;P2 : ﾏｸﾛ実行完了ﾌﾗｸﾞ
;P3 : 結果ｺｰﾄﾞ
;P4 : ｿﾌﾄ非常停止信号
;V0 : ﾀｲﾑｱｳﾄ設定(ms) 
;
;<結果ｺｰﾄﾞ一覧>
;#20 : 正常完了
;#21 : 応答なし
;#22 : RBステータス異常
;#23 : 設定異常
LD @CR2008
DW #0 P3                 ; Result_Code
CON
SET @MR000
STG @MR000
MPS
LD P0:#0                 ; RB_DV_IN
AND P0:#1                ; RB_DV_IN
ANL
RES P1:#9                ; RB_DV_OUT
CON
JMP @MR001
MPP
LDB P0:#0                ; RB_DV_IN
ORB P0:#1                ; RB_DV_IN
ANL
TMR @0 V0                ; TIMEOUT
CON
AND @T0
DW #22 P3                ; Result_Code
CON
JMP @MR015
STG @MR001
MPS
ANB P5                   ; STEP_Flag
RES P1:#11               ; RB_DV_OUT
CON
JMP @MR002
MPP
AND P5                   ; STEP_Flag
SET P1:#11               ; RB_DV_OUT
CON
JMP @MR002
STG @MR002
SET P1:#8                ; RB_DV_OUT
CON
JMP @MR003
STG @MR003
MPS
AND P0:#7                ; RB_DV_IN
RES P1:#8                ; RB_DV_OUT
CON
JMP @MR004
MPP
ANB P0:#7                ; RB_DV_IN
TMR @1 V0                ; TIMEOUT
CON
AND @T1
RES P1:#6                ; RB_DV_OUT
CON
DW #21 P3                ; Result_Code
CON
JMP @MR015
STG @MR004
MPS
LDB P0:#7                ; RB_DV_IN
AND P0:#6                ; RB_DV_IN
ANL
JMP @MR005
MPP
ANB P5                   ; STEP_Flag
TMR @2 V0                ; TIMEOUT
CON
AND @T2
RES P1:#6                ; RB_DV_OUT
CON
DW #21 P3                ; Result_Code
CON
JMP @MR015
STG @MR005
DW #20 P3                ; Result_Code
CON
JMP @MR015
STG @MR015
RES P1:#11               ; RB_DV_OUT
CON
SET P2                   ; End_Flag
CON
ENDS
LD P5                    ; STEP_Flag
OUT P1:#11               ; RB_DV_OUT
;終了処理
LD P4                    ; EMG_Flag
ZRES @MR000 @MR115
LD P2                    ; End_Flag
OR P4                    ; EMG_Flag
MEND
END
ENDH
