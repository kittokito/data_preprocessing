DEVICE:53
;MODULE:Group1_Task1
;MODULE_TYPE:0
;SCRIPT_TYPE:
;OneSystem Main-Module
;
;-----------------------------------------
;ModuleName	:	Group1_Task1
;ModuleType	:	Main Module
;Line		:	
;Cell		: 
;Function	: 	ﾏｶﾞｼﾞﾝﾗｯｸ
;-----------------------------------------
;<<Task LocalDevice>>
;/*項目			/*割付ｴﾘｱ				/*備考
;---------------------------------------------------------------------			
;Emergency		@MR000〜@MR015			Emergency処理時RESET禁止ｴﾘｱ
;Free			@MR100〜@MR915			ﾕｰｻﾞｰﾌﾘｰｴﾘｱ
;HOME			@MR1000〜@MR1515		HOME動作時使用ｴﾘｱ
;MAINTENANCE		@MR2000〜@MR2915		MAINTE動作時使用ｴﾘｱ
;AUTO(Main1)		@MR3000〜@MR3915		AUTO(Main1)動作時使用ｴﾘｱ
;	(Main2)		@MR4000〜@MR4415		AUTO(Main2)動作時使用ｴﾘｱ
;SubRoutine		@MR4500〜@MR6415		ｻﾌﾞﾙｰﾁﾝ共通動作使用ｴﾘｱ　※状況により増設してください。
;----------------------------------------------------------------------
;<h1/>Device_Init/ﾃﾞﾊﾞｲｽ初期化
;[内容]
;・非常停止、優先ｴﾗｰ発生時に初期化したいﾃﾞﾊﾞｲｽを指定して下さい
;※本Taskで使用するﾛｰｶﾙﾃﾞﾊﾞｲｽなど
;※STG〜JMPにて使用しているﾃﾞﾊﾞｲｽは必須
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ZRES @MR100 @MR6415
;<h1/>Task_Monitor/ﾀｽｸﾓﾆﾀｰ
LD CR2002                ; 常時ON
FLIK #50 #50 @MR000
LD= DM60000 MyTask       ; TaskNo /ERROR_DISP  自ﾀｽｸ番号
AND R46208               ; _Group1　ｴﾗｰ発生中
OUT @MR001
;ON STG Main1
;TYPE EM608.U,EM609.U,@MR000.U,@MR3000.U
;
;FOR EM608 = EM608 TO 160 STEP 16
;	IF @MR3000:EM608 <> 0 THEN
;		BREAK
;	END IF	
;NEXT
;	
;IF EM608 < 160 THEN
;	EM609 = (EM608 / 16) * 100 + DMX(@MR3000:EM608) + #3000
;END IF		
;		
;EM608 = EM608 + 16		
;IF EM608 > 160 THEN		
;	EM608 = 0		
;END IF
LDP @MR000
NCJ #1000
;TYPE EM608.U,EM609.U,@MR000.U,@MR3000.U
;
;FOR EM608 = EM608 TO 160 STEP 16
;
LD CR2002                ; 常時ON
MOV EM608 EM608          ; Task1 Main1@MR  Task1 Main1@MR
LABEL #2000
LD> EM608 #160           ; Task1 Main1@MR
CJ #2001
;	IF @MR3000:EM608 <> 0 THEN
;
LD CR2002                ; 常時ON
LDA EM608                ; Task1 Main1@MR
CON
EXT
CON
STA.L Z12
LD<> @MR3000:Z12 #0
NCJ #2002
;		BREAK
;
LD CR2002                ; 常時ON
CJ #2003
;	END IF	
;
LABEL #2002
;NEXT
;
LD CR2002                ; 常時ON
LDA EM608                ; Task1 Main1@MR
CON
ADD #16
CON
STA EM608                ; Task1 Main1@MR
LDB CR2009               ; 演算結果が負
CJ #2000
LABEL #2003
LABEL #2001
;IF EM608 < 160 THEN
;
LD< EM608 #160           ; Task1 Main1@MR
NCJ #2004
;	EM609 = (EM608 / 16) * 100 + DMX(@MR3000:EM608) + #3000
;
LD CR2002                ; 常時ON
LDA EM608                ; Task1 Main1@MR
CON
EXT
CON
STA.L Z12
CON
LDA @MR3000:Z12
CON
DMX
CON
STA @VM0
CON
LDA EM608                ; Task1 Main1@MR
CON
EXT
CON
EXT.L
CON
DIV.L +16
CON
MUL.L +100
CON
STA.L @VM1
CON
LDA @VM0
CON
EXT
CON
ADD.L @VM1
CON
ADD.L +3000
CON
STA EM609                ; Task1 Main1@MR
;END IF		
;
LABEL #2004
;EM608 = EM608 + 16		
;
LD CR2002                ; 常時ON
LDA EM608                ; Task1 Main1@MR
CON
EXT
CON
ADD.L +16
CON
STA EM608                ; Task1 Main1@MR
;IF EM608 > 160 THEN		
;
LD> EM608 #160           ; Task1 Main1@MR
NCJ #2005
;	EM608 = 0		
;
LD CR2002                ; 常時ON
MOV #0 EM608             ; Task1 Main1@MR
;END IF
LABEL #2005
LABEL #1000
;
;ON STG Main2
;TYPE EM610.U,EM611.U,@MR4000.U
;
;FOR EM610 = EM610 TO 80 STEP 16
;	IF @MR4000:EM610 <> 0 THEN
;		BREAK
;	END IF	
;NEXT	
;
;IF EM610 < 80 THEN
;	EM611 = (EM610 / 16) * 100 + DMX(@MR4000:EM610) + #4000
;END IF
;
;EM610 = EM610 + 16		
;
;IF EM610 > 80 THEN
;	EM610 = 0	
;END IF
LDP @MR000
NCJ #1001
;TYPE EM610.U,EM611.U,@MR4000.U
;
;FOR EM610 = EM610 TO 80 STEP 16
;
LD CR2002                ; 常時ON
MOV EM610 EM610          ; Task1 Main2@MR  Task1 Main2@MR
LABEL #2006
LD> EM610 #80            ; Task1 Main2@MR
CJ #2007
;	IF @MR4000:EM610 <> 0 THEN
;
LD CR2002                ; 常時ON
LDA EM610                ; Task1 Main2@MR
CON
EXT
CON
STA.L Z12
LD<> @MR4000:Z12 #0
NCJ #2008
;		BREAK
;
LD CR2002                ; 常時ON
CJ #2009
;	END IF	
;
LABEL #2008
;NEXT	
;
LD CR2002                ; 常時ON
LDA EM610                ; Task1 Main2@MR
CON
ADD #16
CON
STA EM610                ; Task1 Main2@MR
LDB CR2009               ; 演算結果が負
CJ #2006
LABEL #2009
LABEL #2007
;IF EM610 < 80 THEN
;
LD< EM610 #80            ; Task1 Main2@MR
NCJ #2010
;	EM611 = (EM610 / 16) * 100 + DMX(@MR4000:EM610) + #4000
;
LD CR2002                ; 常時ON
LDA EM610                ; Task1 Main2@MR
CON
EXT
CON
STA.L Z12
CON
LDA @MR4000:Z12
CON
DMX
CON
STA @VM3
CON
LDA EM610                ; Task1 Main2@MR
CON
EXT
CON
EXT.L
CON
DIV.L +16
CON
MUL.L +100
CON
STA.L @VM4
CON
LDA @VM3
CON
EXT
CON
ADD.L @VM4
CON
ADD.L +4000
CON
STA EM611                ; Task1 Main2@MR
;END IF
;
LABEL #2010
;EM610 = EM610 + 16		
;
LD CR2002                ; 常時ON
LDA EM610                ; Task1 Main2@MR
CON
EXT
CON
ADD.L +16
CON
STA EM610                ; Task1 Main2@MR
;IF EM610 > 80 THEN
;
LD> EM610 #80            ; Task1 Main2@MR
NCJ #2011
;	EM610 = 0	
;
LD CR2002                ; 常時ON
MOV #0 EM610             ; Task1 Main2@MR
;END IF
LABEL #2011
LABEL #1001
;
;ON STG SubRoutine
;TYPE EM612.U,EM613.U,@MR4500.U
;	
;FOR EM612 = EM612 TO 320 STEP 16
;	IF @MR4500:EM612 <> 0 THEN
;		BREAK
;	END IF	
;NEXT
;		
;IF EM612 < 320 THEN
;	EM613 = (EM612 / 16) * 100 + DMX(@MR4500:EM612) + #4500
;END IF
;		
;EM612 = EM612 + 16	
;
;IF EM612 > 320 THEN
;   EM612 = 0	
;END IF
LDP @MR000
NCJ #1002
;TYPE EM612.U,EM613.U,@MR4500.U
;
;FOR EM612 = EM612 TO 320 STEP 16
;
LD CR2002                ; 常時ON
MOV EM612 EM612          ; Task1 Sub@MR  Task1 Sub@MR
LABEL #2012
LD> EM612 #320           ; Task1 Sub@MR
CJ #2013
;	IF @MR4500:EM612 <> 0 THEN
;
LD CR2002                ; 常時ON
LDA EM612                ; Task1 Sub@MR
CON
EXT
CON
STA.L Z12
LD<> @MR4500:Z12 #0
NCJ #2014
;		BREAK
;
LD CR2002                ; 常時ON
CJ #2015
;	END IF	
;
LABEL #2014
;NEXT
;
LD CR2002                ; 常時ON
LDA EM612                ; Task1 Sub@MR
CON
ADD #16
CON
STA EM612                ; Task1 Sub@MR
LDB CR2009               ; 演算結果が負
CJ #2012
LABEL #2015
LABEL #2013
;IF EM612 < 320 THEN
;
LD< EM612 #320           ; Task1 Sub@MR
NCJ #2016
;	EM613 = (EM612 / 16) * 100 + DMX(@MR4500:EM612) + #4500
;
LD CR2002                ; 常時ON
LDA EM612                ; Task1 Sub@MR
CON
EXT
CON
STA.L Z12
CON
LDA @MR4500:Z12
CON
DMX
CON
STA @VM6
CON
LDA EM612                ; Task1 Sub@MR
CON
EXT
CON
EXT.L
CON
DIV.L +16
CON
MUL.L +100
CON
STA.L @VM7
CON
LDA @VM6
CON
EXT
CON
ADD.L @VM7
CON
ADD.L +4500
CON
STA EM613                ; Task1 Sub@MR
;END IF
;
LABEL #2016
;EM612 = EM612 + 16	
;
LD CR2002                ; 常時ON
LDA EM612                ; Task1 Sub@MR
CON
EXT
CON
ADD.L +16
CON
STA EM612                ; Task1 Sub@MR
;IF EM612 > 320 THEN
;
LD> EM612 #320           ; Task1 Sub@MR
NCJ #2017
;   EM612 = 0	
;
LD CR2002                ; 常時ON
MOV #0 EM612             ; Task1 Sub@MR
;END IF
LABEL #2017
LABEL #1002
;
;<h1/>Task_Init/ﾀｽｸ初期化
;[本STG内容]
;・本Task起動時に必要な初期化処理を記述して下さい
;・起動Taskの全Init処理終了後、Task_StartのSTGが起動します
STG LR801                ; _Grp1_Task1_Init.STG
ENDS
;<h1/>Task_Start/ﾀｽｸ開始
;[本STG内容]
;・Task起動後、以下運転ﾓｰﾄﾞに従い、各STGにJMPします
;【HOME】	→	LR5200
;【AUTO】	→	LR5400
;【MAINTE】	→	LR5600
;・本STGは追記、修正不要です
STG LR401                ; _Grp1_Task1_Start.STG
MPS
AND R46101               ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
JMP LR5201               ; _Grp1_Task1_HOME.STG
MRD
AND R46100               ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
JMP LR5401               ; _Grp1_Task1_AUTO.STG
MPP
AND R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
JMP LR5601               ; _Grp1_Task1_MAINTE.STG
;<h1/>Task_Finish/ﾀｽｸ終了
;[本STG内容]
;・各Taskの終了STGになります
;・運転ﾓｰﾄﾞに係わらず終了時は本STGを経由して終了して下さい
;・本STGは追記、修正不要です
STG LR601                ; _Grp1_Task1_Fin.STG
MPS
LDB R41201               ; TASK1 PAUSE 要求
ANB @MR001
ANL
RES R41001               ; _Grp1_Task1_起動中ﾌﾗｸﾞ
CON
ENDS
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;<h1/>HOME/原点復帰
;[本STG内容]
;・STG @MR1000の続きから各Taskの原点復帰動作を記述する
;・動作終了時は@MR1515にJMPする事
STG LR5201               ; _Grp1_Task1_HOME.STG
JMP @MR1000
STG @MR1000
SET @MR1002
CON
JMP @MR1008
STG @MR1008
SET MR1105               ; RB1 非常停止
CON
SET MR1100               ; RB1 Power ON
CON
JMP @MR1009
STG @MR1009
TMR @10 #5
CON
AND @T10
JMP @MR1010
STG @MR1010
MPS
LDB R41201               ; TASK1 PAUSE 要求
AND MR10000              ; Task0 HOME退避完了
ANL
JMP @MR1100
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;飛出し確認
STG @MR1100
SET @MR5800
CON
JMP @MR1101
STG @MR1101
AND @MR5801
RES @MR5801
CON
JMP @MR1108
;ﾏｶﾞｼﾞﾝﾗｯｸ状態確認
STG @MR1108
MPS
ANB R41201               ; TASK1 PAUSE 要求
MPS
LDB R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
ANB R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
ANB R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANB R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
LD R4104                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
AND R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
AND R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
AND R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
ORL
ANL
JMP @MR1200
MRD
LD R4104                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
LDB R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
ORB R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
LDB R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
LD R4105                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
OR R4106                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
ORL
ANL
JMP @MR1109
MPP
LD R4104                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
ANB R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
LDB R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
AND R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
ORL
ANL
JMP @MR1110
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR1109
RES MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
SET MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
MPS
LDB MR4101               ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
ANB R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
AND R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
ANL
JMP @MR1111
MPP
LD MR4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
STG @MR1110
RES MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
SET MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
MPS
LDB MR4101               ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
ANB R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
AND R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
ANL
JMP @MR1112
MPP
LD MR4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
;*** Err82 ﾏｶﾞｼﾞﾝﾗｯｸ浮き
STG @MR1111
SET @MR1900
CON
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #82 @DM1
CON
DW #4105 @DM2
CON
DW $1000 @DM9
CON
SET @MR100
CON
JMP @MR1113
;*** Err83 ﾏｶﾞｼﾞﾝﾗｯｸ逆入れ
STG @MR1112
SET @MR1900
CON
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #83 @DM1
CON
DW #4107 @DM2
CON
DW $1000 @DM9
CON
SET @MR100
CON
JMP @MR1113
STG @MR1113
SET @MR1900
CON
AND @MR101
RES @MR101
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR1108
;***
STG @MR1200
RES MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
SET MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
MPS
LDB MR4101               ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
ANB R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
AND R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
ANL
JMP @MR1202
MPP
LD MR4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
;RB1 待機位置移動
STG @MR1202
MPS
ANB R41201               ; TASK1 PAUSE 要求
DW #10 EM1300            ; RB1Target Pos
CON
SET @MR5900
CON
JMP @MR1203
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR1203
AND @MR5901
RES @MR5901
CON
JMP @MR1204
;ｸﾗﾝﾌﾟ 開き
STG @MR1204
RES MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
SET MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
MPS
LDB MR4101               ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
ANB R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
AND R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
ANL
JMP @MR1515
MPP
LD MR4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
STG @MR1515
MPS
LDB R41201               ; TASK1 PAUSE 要求
ANB @MR001
ANL
RES @MR1002
CON
JMP LR601                ; _Grp1_Task1_Fin.STG
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;<h1/>AUTO/自動動作
STG LR5401               ; _Grp1_Task1_AUTO.STG
JMP @MR3000
;<h1/>Auto-Main1/Autoﾒｲﾝﾙｰﾁﾝ1
;[本STG内容]
;・各TaskのAUTO動作を記述して下さい
;・動作ﾓｰﾄﾞは「AUTOAC」に格納されています(1〜32)
;・@MR3000:AUTO_Main1開始、@MR3001:AUTO_Main1完了、@MR3002:AUTO_Main1動作中
STG @MR3000
MPS
ANB R47800               ; _Group1　ﾒﾝﾃ動作定停止移行中
MPS
ANB R57301               ; Task1 停止要求
SET @MR3002
CON
JMP @MR3003
MPP
AND R57301               ; Task1 停止要求
JMP @MR3900
MPP
AND R47800               ; _Group1　ﾒﾝﾃ動作定停止移行中
JMP @MR3900
;<h1/>  初期ﾛｯﾄ設定
STG @MR3003
MPS
LDB R41201               ; TASK1 PAUSE 要求
AND MR20904              ; Task2→1在荷処理完了
AND MR20905              ; Task3→1在荷処理完了
ANL
JMP @MR3004
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR3004
JMP @MR3100
;<h1/>  ﾏｶﾞｼﾞﾝﾗｯｸ ｸﾗﾝﾌﾟ
STG @MR3100
MPS
ANB R57301               ; Task1 停止要求
MPS
LDB R41201               ; TASK1 PAUSE 要求
ANB MR20410              ; Task1→ﾛｯﾄｻｲｸﾙ停止中
ANL
SET @MR4600
CON
JMP @MR3101
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
MPP
AND R57301               ; Task1 停止要求
JMP @MR3900
STG @MR3101
AND @MR4601
RES @MR4601
CON
MPS
ANB @MR4603
JMP @MR3103
MPP
AND @MR4603
JMP @MR3102
STG @MR3102
RES @MR4603
CON
JMP @MR3600
;飛出し確認
STG @MR3103
SET @MR5800
CON
JMP @MR3104
STG @MR3104
AND @MR5801
RES @MR5801
CON
JMP @MR3200
;<h1/>  次ﾘﾝｸﾞ準備
STG @MR3200
MPS
ANB R57301               ; Task1 停止要求
MPS
ANB R41201               ; TASK1 PAUSE 要求
MPS
LD>.L DM22210 +0         ; 残CAV数_ｸﾘｰﾆﾝｸﾞ_1ﾛｯﾄ
OR @MR3310
ANL
SET @MR4700
CON
JMP @MR3201
MPP
LD<=.L DM22210 +0        ; 残CAV数_ｸﾘｰﾆﾝｸﾞ_1ﾛｯﾄ
ANB @MR3310
ANL
JMP @MR3304
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
MPP
AND R57301               ; Task1 停止要求
JMP @MR3900
STG @MR3201
AND @MR4701
RES @MR4701
CON
MPS
ANB @MR4703
JMP @MR3300
MPP
AND @MR4703
JMP @MR3202
STG @MR3202
RES @MR4703
CON
JMP @MR3600
;<h1/>  ﾜｰｸ受渡し
STG @MR3300
MPS
ANB R41201               ; TASK1 PAUSE 要求
MPS
LD>.L DM22210 +0         ; 残CAV数_ｸﾘｰﾆﾝｸﾞ_1ﾛｯﾄ
OR @MR3310
ANL
SET @MR5200
CON
JMP @MR3301
MPP
LD<=.L DM22210 +0        ; 残CAV数_ｸﾘｰﾆﾝｸﾞ_1ﾛｯﾄ
ANB @MR3310
ANL
JMP @MR3304
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR3301
AND @MR5201
RES @MR5201
CON
MPS
ANB @MR5203
INC.D DM5020             ; _生産ｶｳﾝﾀ1
CON
JMP @MR3303
MPP
AND @MR5203
JMP @MR3302
STG @MR3302
RES @MR5203
CON
RES @MR4703
CON
JMP @MR3900
;ﾛｯﾄ終了確認
STG @MR3303
MPS
LDB R41201               ; TASK1 PAUSE 要求
AND MR20011              ; Task2→1 CAV前検査完了
ANL
RES MR20011              ; Task2→1 CAV前検査完了
CON
MPS
LD>.L DM22210 +0         ; 残CAV数_ｸﾘｰﾆﾝｸﾞ_1ﾛｯﾄ
OR @MR3310
ANL
JMP @MR3100
MPP
LD<=.L DM22210 +0        ; 残CAV数_ｸﾘｰﾆﾝｸﾞ_1ﾛｯﾄ
ANB @MR3310
ANL
MPS
JMP @MR3304
MPP
LDB LR10106              ; USｸﾘｰﾆﾝｸﾞ在荷記憶
AND<=.L DM22214 +0       ; 残CAV数_剥離
ANL
SET @MR3308
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;ﾛｯﾄ終了  →  作業者へｻｲｸﾙ停止確認
STG @MR3304
SET MR20410              ; Task1→ﾛｯﾄｻｲｸﾙ停止中
CON
ANB R39104               ; SELECT_Y_N Interlock
SET @MR1900
CON
SET R39104               ; SELECT_Y_N Interlock
CON
DW #10 @DM21
CON
DW #1 @DM22
CON
SET @MR300
CON
JMP @MR3305
STG @MR3305
SET @MR1900
CON
AND @MR301
RES @MR301
CON
RES R39104               ; SELECT_Y_N Interlock
CON
MPS
AND @MR306
MPS
SET MR20410              ; Task1→ﾛｯﾄｻｲｸﾙ停止中
CON
JMP @MR3100
MPP
AND @MR3308
RES @MR3308
CON
MCALL HOLD_REQUEST #1
MPP
ANB @MR306
MPS
JMP @MR3304
MPP
ANB CR2002               ; 常時ON
SET @MR3310
;<h1/>  □ﾏｶﾞｼﾞﾝﾁｪﾝｼﾞ
LD CR2002                ; 常時ON
LDA DM7022               ; 装置基礎ﾃﾞｰﾀ12 CAV数/ﾘﾝｸﾞ
CON
MUL #2
CON
ADD #2
CON
STA @DM14
STG @MR3600
JMP @MR3601
;同一ﾛｯﾄ次ﾏｶﾞｼﾞﾝ有り
STG @MR3601
SET @MR4500
CON
JMP @MR3602
STG @MR3602
AND @MR4501
RES @MR4501
CON
JMP @MR3100
;<h1/>Auto終了処理
;RB1 待機位置移動
STG @MR3900
MPS
ANB R41201               ; TASK1 PAUSE 要求
DW #10 EM1300            ; RB1Target Pos
CON
SET @MR5900
CON
JMP @MR3901
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR3901
AND @MR5901
RES @MR5901
CON
JMP @MR3902
;ｸﾗﾝﾌﾟ 開き
STG @MR3902
RES MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
SET MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
MPS
LDB MR4101               ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
ANB R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
AND R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
ANL
JMP @MR3915
MPP
LD MR4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
STG @MR3915
MPS
LDB R41201               ; TASK1 PAUSE 要求
ANB @MR001
ANB @MR4002
ANL
RES @MR3002
CON
JMP LR601                ; _Grp1_Task1_Fin.STG
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;<h1/>Auto-Main2/Autoﾒｲﾝﾙｰﾁﾝ2
;[本STG内容]
;・@MR4000の起動はMain1にて行う事
;・@MR4000:AUTO_Main2開始、@MR4001:AUTO_Main2完了、@MR4002:AUTO_Main2動作中
STG @MR4000
SET @MR4002
CON
JMP @MR4003
STG @MR4003
JMP @MR4415
STG @MR4415
SET @MR4001
CON
RES @MR4002
CON
ENDS
;<h1/>MAINTE/ﾒﾝﾃﾅﾝｽ動作
;[本STG内容]
;・各TaskのMAINTE動作を記述して下さい
;・動作ﾓｰﾄﾞは「MAINTEAC*」に格納されています(1〜32)
;・動作終了時は@MR2915にJMPして下さい
STG LR5601               ; _Grp1_Task1_MAINTE.STG
JMP @MR2000
STG @MR2000
SET @MR2002
CON
JMP @MR2003
STG @MR2003
MPS
LD= DM4110 #1            ; _Group1　ﾒﾝﾃ動作番号
OR= DM4110 #3            ; _Group1　ﾒﾝﾃ動作番号
ANL
JMP @MR2004
MPP
LD<> DM4110 #1           ; _Group1　ﾒﾝﾃ動作番号
AND<> DM4110 #3          ; _Group1　ﾒﾝﾃ動作番号
ANL
JMP @MR2915
;ｽﾃｯﾌﾟor通常　か選択
STG @MR2004
MPS
AND= DM4110 #1           ; _Group1　ﾒﾝﾃ動作番号
MPS
SET @MR1900
CON
MSTRT SELECT_POST #1 MyTask #0 MR11001;自ﾀｽｸ番号  Mainte_Select_01
MPP
AND MR11001              ; Mainte_Select_01
JMP @MR2008
MPP
LD= DM4110 #3            ; _Group1　ﾒﾝﾃ動作番号
AND MR11003              ; Mainte_Select_03
ANL
JMP @MR2100
;<h1/>  STEP1 ﾏｶﾞｼﾞﾝ交換
STG @MR2008
SET @MR4500
CON
JMP @MR2009
STG @MR2009
AND @MR4501
RES @MR4501
CON
JMP @MR2914
;<h1/>  STEP3 ﾗｯｸから取出し
;ﾏｶﾞｼﾞﾝﾗｯｸ ｸﾗﾝﾌﾟ
STG @MR2100
SET @MR4600
CON
JMP @MR2101
STG @MR2101
AND @MR4601
RES @MR4601
CON
MPS
ANB @MR4603
JMP @MR2102
MPP
AND @MR4603
JMP @MR2107
;ﾜｰｸ準備
STG @MR2102
SET @MR4700
CON
JMP @MR2103
STG @MR2103
AND @MR4701
RES @MR4701
CON
MPS
ANB @MR4703
JMP @MR2104
MPP
AND @MR4703
JMP @MR2107
;ﾜｰｸ取出し
STG @MR2104
SET @MR5200
CON
JMP @MR2105
STG @MR2105
AND @MR5201
RES @MR5201
CON
MPS
ANB @MR5203
JMP @MR2914
MPP
AND @MR5203
JMP @MR2106
STG @MR2106
RES @MR5203
CON
JMP @MR2914
;□ﾏｶﾞｼﾞﾝﾁｪﾝｼﾞ
STG @MR2107
RES @MR4703
CON
RES @MR4603
CON
SET @MR4500
CON
JMP @MR2108
STG @MR2108
AND @MR4501
RES @MR4501
CON
JMP @MR2914
;Maintenance 終了
STG @MR2914
MCALL MODE_INDI #2
MCALL HOLD_REQUEST MyGroup;自ｸﾞﾙｰﾌﾟ番号
RES MR11001              ; Mainte_Select_01
CON
JMP @MR2915
STG @MR2915
MPS
LD R41201                ; TASK1 PAUSE 要求
ANB @MR001
ANL
SET @MR1900
MPP
ANB R41201               ; TASK1 PAUSE 要求
RES @MR2002
CON
JMP LR601                ; _Grp1_Task1_Fin.STG
;<h1/>SubRoutines/ｻﾌﾞﾙｰﾁﾝ
;<h1/> ﾏｶﾞｼﾞﾝﾗｯｸ交換動作 @MR4500
STG @MR4500
DW #1 DM20004            ; SUSﾘﾝｸﾞ取出し段No.
CON
RES MR20510              ; 初期取出し位置確認記憶
CON
SET @MR4502
CON
JMP @MR4503
;RB1 待機位置移動
STG @MR4503
MPS
ANB R41201               ; TASK1 PAUSE 要求
DW #10 EM1300            ; RB1Target Pos
CON
SET @MR5900
CON
JMP @MR4504
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR4504
AND @MR5901
RES @MR5901
CON
JMP @MR4505
STG @MR4505
RES MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
SET MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
MPS
LDB MR4101               ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
ANB R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
AND R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
ANL
JMP @MR4506
MPP
LD MR4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
;*** Err84 ﾏｶﾞｼﾞﾝﾗｯｸ交換要求
STG @MR4506
SET @MR801
CON
SET @MR1900
CON
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #84 @DM1
CON
DW #4104 @DM2
CON
DW $5000 @DM9
CON
SET @MR100
CON
JMP @MR4507
STG @MR4507
SET @MR1900
CON
AND @MR101
RES @MR101
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR4508
;***
;ﾏｶﾞｼﾞﾝ取出し確認
LD @MR801
AND R1114                ; MG部扉 開
ANB R1005                ; MGｾｯﾄ扉 閉検出
ANB R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
RES @MR801
STG @MR4508
MPS
LDB R41201               ; TASK1 PAUSE 要求
ANB R29000               ; MG扉部PAUSE要求
ANL
MPS
LDB @MR801
AND R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
OR R57301                ; Task1 停止要求
OR R47500                ; _Group1　ﾒﾝﾃ動作中
ANL
JMP @MR4515
MPP
TMR @20 #3000
CON
AND @T20
JMP @MR4506
MRD
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
MPP
AND R29000               ; MG扉部PAUSE要求
SET @MR1904
STG @MR4515
SET @MR4501
CON
RES @MR4502
CON
ENDS
;<h1/> ﾏｶﾞｼﾞﾝﾗｯｸｸﾗﾝﾌﾟ動作   ＠MR4600
STG @MR4600
SET @MR4602
CON
JMP @MR4604
;ﾏｶﾞｼﾞﾝ状態確認
STG @MR4604
MPS
LDB R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
ANB R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
ANB R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
ANB R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
SET @MR4603
CON
JMP @MR4615
MRD
LD R4107                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
AND R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
AND R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
AND R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
JMP @MR4609
MPP
LDB R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
LD R4104                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
OR R4105                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
OR R4106                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
LD R4104                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
LDB R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
ORB R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
ORL
LDB R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
LD R4105                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
OR R4106                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
ORL
ANL
JMP @MR4605
STG @MR4605
RES MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
SET MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
MPS
LDB MR4101               ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
ANB R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
AND R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
ANL
MPS
ANB R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
JMP @MR4606
MPP
AND R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
JMP @MR4607
MPP
LD MR4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
;*** Err82 ﾏｶﾞｼﾞﾝﾗｯｸ浮き
STG @MR4606
SET @MR1900
CON
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #82 @DM1
CON
DW #4105 @DM2
CON
DW $1000 @DM9
CON
SET @MR100
CON
JMP @MR4608
;*** Err83 ﾏｶﾞｼﾞﾝﾗｯｸ逆入れ
STG @MR4607
SET @MR1900
CON
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #83 @DM1
CON
DW #4107 @DM2
CON
DW $1000 @DM9
CON
SET @MR100
CON
JMP @MR4608
STG @MR4608
SET @MR1900
CON
AND @MR101
RES @MR101
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR4604
;***
; ﾏｶﾞｼﾞﾝｸﾗﾝﾌﾟ
STG @MR4609
RES MR7301               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ解除
CON
SET MR7300               ; ﾏｶﾞｼﾞﾝｾｯﾄ ｸﾗﾝﾌﾟ
CON
MPS
LDB MR4100               ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端異常
ANB R4101                ; MGｾｯﾄ ｸﾗﾝﾌﾟ開き端
AND R4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端
ANL
JMP @MR4610
MPP
LD MR4100                ; MGｾｯﾄ ｸﾗﾝﾌﾟ閉じ端異常
AND R41201               ; TASK1 PAUSE 要求
ANL
SET @MR1900
STG @MR4610
MPS
LD R4107                 ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
AND R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
AND R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
AND R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
JMP @MR4615
MPP
LDB R4107                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ逆入れ検出
ORB R4104                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ検出
ORB R4105                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出1
ORB R4106                ; MGｾｯﾄ部 ﾏｶﾞｼﾞﾝ着座検出2
ANL
JMP @MR4605
;終了
STG @MR4615
MPS
ANB R41201               ; TASK1 PAUSE 要求
SET @MR4601
CON
RES @MR4602
CON
ENDS
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;<h1/> ﾜｰｸ準備動作   @MR4700
; 初期段確認
STG @MR4700
SET @MR4702
CON
JMP @MR4704
STG @MR4704
MPS
AND MR20510              ; 初期取出し位置確認記憶
JMP @MR4800
MPP
ANB MR20510              ; 初期取出し位置確認記憶
DW #1 DM20004            ; SUSﾘﾝｸﾞ取出し段No.
CON
JMP @MR4800
;次段へ移動
STG @MR4800
MPS
ANB R41201               ; TASK1 PAUSE 要求
MPS
SET @MR5900
CON
JMP @MR4801
MPP
MOV DM20004 EM1300       ; SUSﾘﾝｸﾞ取出し段No.  RB1Target Pos
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR4801
AND @MR5901
RES @MR5901
CON
JMP @MR4802
;飛出し確認
STG @MR4802
SET @MR5800
CON
JMP @MR4803
STG @MR4803
AND @MR5801
RES @MR5801
CON
JMP @MR4804
; ﾜｰｸ確認
STG @MR4804
MPS
ANB R4102                ; MGｾｯﾄ部 切り出し高さ検出
MPS
AND< DM20004 #6          ; SUSﾘﾝｸﾞ取出し段No.
JMP @MR4805
MPP
AND>= DM20004 #6         ; SUSﾘﾝｸﾞ取出し段No.
JMP @MR4806
MPP
AND R4102                ; MGｾｯﾄ部 切り出し高さ検出
JMP @MR4807
;ﾜｰｸ無し  次段へ
STG @MR4805
INC DM20004              ; SUSﾘﾝｸﾞ取出し段No.
CON
JMP @MR4800
;全段ﾜｰｸ無し
STG @MR4806
SET @MR4703
CON
RES MR20510              ; 初期取出し位置確認記憶
CON
JMP @MR4815
;ﾜｰｸ検出
STG @MR4807
SET MR20510              ; 初期取出し位置確認記憶
CON
JMP @MR4815
;終了
STG @MR4815
MPS
ANB R41201               ; TASK1 PAUSE 要求
SET @MR4701
CON
RES @MR4702
CON
ENDS
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;<h1/> ﾜｰｸ受渡し動作   @MR5200
STG @MR5200
SET @MR5202
CON
JMP @MR5204
STG @MR5204
MPS
ANB R57301               ; Task1 停止要求
SET MR20000              ; Task1→0 取出し要求
CON
JMP @MR5205
MPP
AND R57301               ; Task1 停止要求
SET @MR5203
CON
JMP @MR5215
STG @MR5205
MPS
ANB R41201               ; TASK1 PAUSE 要求
MPS
LDB R57301               ; Task1 停止要求
AND MR20005              ; Task0→1 取り出し動作中
ANL
SET MR20001              ; Task1→0 取出し動作受動中
CON
JMP @MR5206
MPP
AND R57301               ; Task1 停止要求
SET @MR5203
CON
RES MR20000              ; Task1→0 取出し要求
CON
JMP @MR5215
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR5206
MPS
LDB R41201               ; TASK1 PAUSE 要求
AND MR20006              ; Task0→1 MG逃げ要求
ANL
LDA DM20004              ; SUSﾘﾝｸﾞ取出し段No.
CON
ADD #10
CON
STA @DM12
CON
JMP @MR5207
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR5207
MPS
SET @MR5900
CON
JMP @MR5208
MPP
MOV @DM12 EM1300         ; RB1Target Pos
STG @MR5208
AND @MR5901
RES @MR5901
CON
JMP @MR5209
STG @MR5209
SET MR20002              ; Task1→0 MG逃げ完了
CON
JMP @MR5210
STG @MR5210
ANB MR20005              ; Task0→1 取り出し動作中
AND MR20004              ; Task0→1 取出し動作完了
RES MR20000              ; Task1→0 取出し要求
CON
RES MR20001              ; Task1→0 取出し動作受動中
CON
RES MR20002              ; Task1→0 MG逃げ完了
CON
LDB MR20007              ; Task0→1 取り出し動作ｴﾗｰ
OR MR20007               ; Task0→1 取り出し動作ｴﾗｰ
ANL
JMP @MR5211
STG @MR5211
ANB MR20004              ; Task0→1 取出し動作完了
ANB MR20007              ; Task0→1 取り出し動作ｴﾗｰ
MPS
LDB R4102                ; MGｾｯﾄ部 切り出し高さ検出
AND R4103                ; MG ﾌﾚｰﾑ飛出検出【ON=正常】
ANL
JMP @MR5215
MPP
LD R4102                 ; MGｾｯﾄ部 切り出し高さ検出
ORB R4103                ; MG ﾌﾚｰﾑ飛出検出【ON=正常】
ANL
JMP @MR5213
;*** Err85 取出し異常ﾜｰｸ残
STG @MR5213
SET @MR1900
CON
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #85 @DM1
CON
DW #4102 @DM2
CON
DW $4200 @DM9
CON
SET @MR100
CON
JMP @MR5214
STG @MR5214
SET @MR1900
CON
AND @MR101
RES @MR101
CON
RES R39004               ; ｴﾗｰ中
CON
MPS
AND @MR105
JMP @MR5211
MPP
AND @MR106
JMP @MR5215
;***
STG @MR5215
MPS
ANB R41201               ; TASK1 PAUSE 要求
SET @MR5201
CON
RES @MR5202
CON
ENDS
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
;<h1/>  ﾏｶﾞｼﾞﾝﾗｯｸ ﾌﾚｰﾑ飛出し確認   @MR5800
STG @MR5800
SET @MR5802
CON
JMP @MR5803
STG @MR5803
MPS
AND R4103                ; MG ﾌﾚｰﾑ飛出検出【ON=正常】
RES @MR5802
CON
SET @MR5801
CON
ENDS
MPP
ANB R4103                ; MG ﾌﾚｰﾑ飛出検出【ON=正常】
JMP @MR5804
;*** Error 81 MGﾌﾚｰﾑ飛出し検出
STG @MR5804
SET @MR1900
CON
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #81 @DM1
CON
DW #4103 @DM2
CON
DW $2000 @DM9
CON
SET @MR100
CON
JMP @MR5805
STG @MR5805
SET @MR1900
CON
AND @MR101
RES @MR101
CON
RES R39004               ; ｴﾗｰ中
CON
JMP @MR5803
;<h1/>  RB1 ﾏｶﾞｼﾞﾝﾗｯｸ昇降 移動   @MR5900
STG @MR5900
SET @MR5902
CON
JMP @MR5903
STG @MR5903
MPS
SET DM11207.3            ; RB1 RES
CON
ANB DM11007.3            ; RB1 ALM
SET DM11207.4            ; RB1 SON
CON
AND DM11007.4            ; RB1 SV
RES DM11207.3            ; RB1 RES
CON
JMP @MR5904
MPP
TMR @49 #20
CON
AND @T49
RES DM11207.3            ; RB1 RES
CON
RES DM11207.4            ; RB1 SON
CON
JMP @MR700
STG @MR5904
SET R35000               ; RB1 MOVE
CON
JMP @MR5905
STG @MR5905
AND R35001               ; RB1 MOVE END
RES R35001               ; RB1 MOVE END
CON
JMP @MR5906
STG @MR5906
MPS
ANB R35003               ; RB1 Alarm
JMP @MR5907
MPP
AND R35003               ; RB1 Alarm
RES R35003               ; RB1 Alarm
CON
JMP @MR700
STG @MR5907
SET @MR5901
CON
RES @MR5902
CON
ENDS
;<h1/>  RB1 ﾏｶﾞｼﾞﾝﾗｯｸ昇降 HOME   @MR5908
STG @MR5908
SET @MR5910
CON
JMP @MR5911
STG @MR5911
MPS
SET DM11207.3            ; RB1 RES
CON
ANB DM11007.3            ; RB1 ALM
SET DM11207.4            ; RB1 SON
CON
AND DM11007.4            ; RB1 SV
RES DM11207.3            ; RB1 RES
CON
JMP @MR5912
MPP
TMR @47 #20
CON
AND @T47
RES DM11207.3            ; RB1 RES
CON
RES DM11207.4            ; RB1 SON
CON
JMP @MR700
STG @MR5912
MPS
AND DM11007.1            ; RB1 HEND
JMP @MR5915
MPP
ANB DM11007.1            ; RB1 HEND
SET R35008               ; RB1 HOME
CON
JMP @MR5913
STG @MR5913
AND R35009               ; RB1 HOME END
RES R35009               ; RB1 HOME END
CON
JMP @MR5914
STG @MR5914
MPS
ANB R35003               ; RB1 Alarm
JMP @MR5915
MPP
AND R35003               ; RB1 Alarm
RES R35003               ; RB1 Alarm
CON
JMP @MR700
STG @MR5915
SET @MR5909
CON
RES @MR5910
CON
ENDS
;Error 1 RB1動作異常
STG @MR700
ANB R39900               ; RB動作中
MPS
LDB R41201               ; TASK1 PAUSE 要求
ANB R39004               ; ｴﾗｰ中
ANL
SET R39004               ; ｴﾗｰ中
CON
MPS
DW #1 @DM1
CON
DW #4001 @DM2
CON
DW $1000 @DM9
CON
SET @MR100
CON
JMP @MR701
MPP
SET B3990                ; ｱﾗｰﾑ詳細表示
CON
LDA DM11006              ; RB1 ｱﾗｰﾑｺｰﾄﾞ
CON
STA DM50310              ; RB ｱﾗｰﾑ表示
MPP
AND R41201               ; TASK1 PAUSE 要求
SET @MR1900
STG @MR701
SET @MR1900
CON
AND @MR101
RES @MR101
CON
RES R39004               ; ｴﾗｰ中
CON
AND @MR105
RES B3990                ; ｱﾗｰﾑ詳細表示
CON
DW #0 DM50310            ; RB ｱﾗｰﾑ表示
CON
MPS
AND @MR5910
JMP @MR5911
MPP
AND @MR5902
JMP @MR5903
;<h1/>I/F
;FOR @DM18 = 0 TO 8
;	Z1 = @DM18 * 6
;	EM10060.L:Z1 = EM10000.L:Z1 - DM7020.D
;	EM10064:Z1   = 10
;	EM10065:Z1   = 100
;NEXT
;FOR @DM18 = 0 TO 8
;
LD CR2002                ; 常時ON
MOV #0 @DM18
LABEL #2018
LD> @DM18 #8
CJ #2019
;	Z1 = @DM18 * 6
;
LD CR2002                ; 常時ON
LDA @DM18
CON
EXT
CON
MUL.L +6
CON
STA.L Z1
;	EM10060.L:Z1 = EM10000.L:Z1 - DM7020.D
;
LD CR2002                ; 常時ON
LDA.L EM10000:Z1         ; RB1 P1 POS(LO)
CON
SUB.L DM7020             ; 装置基礎ﾃﾞｰﾀ11 取出し逃げ量
CON
STA.L EM10060:Z1         ; RB1 P11 POS(LO)
;	EM10064:Z1   = 10
;
LD CR2002                ; 常時ON
MOV #10 EM10064:Z1       ; RB1 P11 Speed
;	EM10065:Z1   = 100
;
LD CR2002                ; 常時ON
MOV #100 EM10065:Z1      ; RB1 P11 G
;NEXT
LD CR2002                ; 常時ON
INC @DM18
LDB CR2009               ; 演算結果が負
CJ #2018
LABEL #2019
;
;<h1/>-----------------------------------------------------------
;<h1/>*ERROR
;MyTask Error Process Substance/エラー処理実体
STG @MR100
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @MR105 @MR108
CON
DISN @DM9 @DM3 #4
MRD
DW MyTask @DM0           ; 自ﾀｽｸ番号
CON
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @MR102
CON
JMP @MR103
STG @MR103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP
MPS
AND= DM60007 @DM6        ; ReturnSW /ERROR_DISP
SET @MR105
CON
JMP @MR104
MRD
AND= DM60007 @DM5        ; ReturnSW /ERROR_DISP
SET @MR106
CON
JMP @MR104
MRD
AND= DM60007 @DM4        ; ReturnSW /ERROR_DISP
SET @MR107
CON
JMP @MR104
MPP
AND= DM60007 @DM3        ; ReturnSW /ERROR_DISP
SET @MR108
CON
JMP @MR104
STG @MR104
ANB R39002               ; ERROR_DISP Busy
RES @MR102
CON
SET @MR101
CON
ENDS
;<h1/>*Select_Y_N 
;MyTask Select_Y_N Process Substance/SELECT_Y_N処理実体
STG @MR300
ANB R39102               ; SELECT_Y_N Busy
MPS
ZRES @MR306 @MR307
CON
DW MyTask @DM20          ; 自ﾀｽｸ番号
CON
BMOV @DM20 DM60020 #3    ; TaskNo /SELECT_Y_N
MPP
SET R39100               ; SELECT_Y_N Start
CON
SET @MR302
CON
JMP @MR303
STG @MR303
AND R39102               ; SELECT_Y_N Busy
MPS
AND= DM60023 #1          ; Y_N /SELECT_Y_N
SET @MR306
CON
JMP @MR304
MPP
AND= DM60023 #2          ; Y_N /SELECT_Y_N
RES @MR306
CON
JMP @MR304
STG @MR304
ANB R39102               ; SELECT_Y_N Busy
RES @MR302
CON
SET @MR301
CON
ENDS
;<h1/>*TIMEUP ERROR
;MyTask TIMEUP_ERROR Process Substance/TIMEUP_ERROR処理実体
STG @MR400
ANB R39302               ; TIMEUP_ERR Busy
MPS
DW MyTask @DM40          ; 自ﾀｽｸ番号
CON
BMOV @DM40 DM60040 #2    ; TaskNo /TIMEUP_ERR
MPP
SET R39300               ; TIMEUP_ERR Start
CON
SET @MR402
CON
JMP @MR403
STG @MR403
AND R39302               ; TIMEUP_ERR Busy
JMP @MR404
STG @MR404
ANB R39302               ; TIMEUP_ERR Busy
RES @MR402
CON
SET @MR401
CON
ENDS
;<h1/>*Select_ACT 
;MyTask Select_ACT Process Substance/SELECT_ACT処理実体
STG @MR200
ANB R39202               ; SELECT_ACT Busy
MPS
ZRES @MR205 @MR208
CON
DW MyTask @DM30          ; 自ﾀｽｸ番号
CON
BMOV @DM30 DM60030 #7    ; TaskNo /SELECT_ACT
MPP
SET R39200               ; SELECT_ACT Start
CON
SET @MR202
CON
JMP @MR203
STG @MR203
AND R39202               ; SELECT_ACT Busy
AND<> DM60037 #0         ; SelectSW /SELECT_ACT
MPS
AND= DM60037 #1          ; SelectSW /SELECT_ACT
SET @MR205
CON
JMP @MR204
MRD
AND= DM60037 #2          ; SelectSW /SELECT_ACT
SET @MR206
CON
JMP @MR204
MRD
AND= DM60037 #3          ; SelectSW /SELECT_ACT
SET @MR207
CON
JMP @MR204
MPP
AND= DM60037 #4          ; SelectSW /SELECT_ACT
SET @MR208
CON
JMP @MR204
STG @MR204
ANB R39202               ; SELECT_ACT Busy
RES @MR202
CON
SET @MR201
CON
ENDS
;<h1/>HALT
;HALT1
LD R41201                ; TASK1 PAUSE 要求
AND @MR1900
LD @MR1901
ORB @MR4002
ANL
TMR @40 #5
CON
AND @T40
SET R42601               ; Grp1_Task1_ﾎﾟｰｽﾞ許可
LD R42601                ; Grp1_Task1_ﾎﾟｰｽﾞ許可
ORB R41201               ; TASK1 PAUSE 要求
ANB @MR001
RES @MR1900
CON
RES @MR1901
;HALT2
LD R29000                ; MG扉部PAUSE要求
AND @MR1904
TMR @41 #5
CON
AND @T41
SET R29002               ; TASK1 HALT2
LD R29002                ; TASK1 HALT2
ORB R29000               ; MG扉部PAUSE要求
ANB @MR001
RES @MR1904
;<h1/>ﾏｶﾞｼﾞﾝ給材扉処理
;●安全ｶﾊﾞｰ有効sig出力
;●電源投入時安全ｶﾊﾞｰﾛｯｸ&確認
;(ﾛｯｸしたのにﾛｯｸ入力が入らなければﾛｯｸ要求処理へ)
;●ｶﾊﾞｰ開要求ｽｲｯﾁ(COVER_SW)待ち
;●安全ｶﾊﾞｰ不正開監視
;	安全ｶﾊﾞｰ開要求が出ていないのに安全ｶﾊﾞｰ入力がOFFした
;●各Taskへﾎﾟｰｽﾞ要求通知(PAUSE)
;●各TaskからのHALT出力待ち
;・起動中全TaskからのHALT待ち
;●安全ｶﾊﾞｰﾛｯｸ解除
;●安全ｶﾊﾞｰﾛｯｸ要求(操作BOXｽﾀｰﾄSW or 3連BOXｽﾀｰﾄSW)待ち
;●安全ｶﾊﾞｰﾛｯｸ〜入力確認
;(ﾛｯｸ入力入らなければ再度ﾛｯｸ要求待ちへ)
;●SC_After
;ｶﾊﾞｰﾛｯｸ可／不可確認(ﾕｰｻﾞｰ解放)
;MG部扉 START SWﾗﾝﾌﾟ
;・点灯：安全ｶﾊﾞｰ閉動作中
;・点滅：安全ｶﾊﾞｰ開中
;MG部扉 PAUSE SWﾗﾝﾌﾟ
;・点灯：安全ｶﾊﾞｰ開中
;・点滅：安全ｶﾊﾞｰ開処理中
END
ENDH
