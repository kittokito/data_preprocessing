DEVICE:53
;MODULE:BringDown_Standby
;MODULE_TYPE:0
;OneSystem UserOpen Module
;
;-----------------------------------------
;ModuleName	:	BringDown_Standby
;ModuleType	:	UserOpen Module
;Function	:	User Open Function
;-----------------------------------------
;
;Copylight(C) 2011 SEIKO EPSON Corp. All rights reserved.
LDP R46104               ; _非常停止中　ﾓｰﾄﾞﾌﾗｸﾞ
ZRES @R000 @R115
;<h1/>CHK_Start/Auto動作可否判断
;[作成上の注意点]
;・ﾕｰｻﾞｰｵｰﾌﾟﾝｴﾘｱ以外は修正しないで下さい。
;・ﾒｲﾝﾓｼﾞｭｰﾙと同様、安全ｶﾊﾞｰ、非常停止などの影響を受けます。
;・動作記述をする事ができます。
;・STG〜JMP命令は@R(ﾛｰｶﾙﾘﾚｰ)を使用して下さい。
;・ﾕｰｻﾞｰ処理終了後、条件に応じて以下の対応をする事。
;	→AUTO動作を開始する場合は@R014へJMP
;	→AUTO動作を開始しない場合は@R015へJMP
STG R40401               ; _AUTOﾓｰﾄﾞ移行ﾕｰｻﾞｰSTG
JMP @R000
;//User Open Area Header　
;AUTO動作設定により起動、終了を記述してください。
STG @R000
MPS
LD= DM5010 #1            ; _AUTO動作番号
LD= W2001 W2012          ; PZT 機種番号  剥離・USｸﾘｰﾅ 機種番号
LD= W2002 W2012          ; ﾄﾚｲﾁｪﾝｼﾞｬ 機種番号  剥離・USｸﾘｰﾅ 機種番号
OR CR2002                ; 常時ON
ANL
OR DM2000.2              ; 下流 OFF-LINE
ANL
ANL
MPS
AND<> DM5220 #0          ; _機種分類2機種名称
JMP @R002
MRD
AND= DM5220 #0           ; _機種分類2機種名称
DW #1 @DM22
CON
JMP @R004
MPP
ANB CR2002               ; 常時ON
SET @R500
CON
JMP @R014
MRD
AND<> DM5010 #1          ; _AUTO動作番号
SET R54402               ; ﾊﾟﾗﾒｰﾀNG
CON
JMP @R001
MPP
LD<> W2001 W2012         ; PZT 機種番号  剥離・USｸﾘｰﾅ 機種番号
LD<> W2002 W2012         ; ﾄﾚｲﾁｪﾝｼﾞｬ 機種番号  剥離・USｸﾘｰﾅ 機種番号
ANB CR2002               ; 常時ON
ORL
ANB DM2000.2             ; 下流 OFF-LINE
ANL
JMP @R012
STG @R001
AND R54403               ; ﾊﾟﾗﾒｰﾀ設定ｴﾗｰ解除
RES R54403               ; ﾊﾟﾗﾒｰﾀ設定ｴﾗｰ解除
CON
JMP @R015
STG @R012
AND MR20503              ; 機種番号不一致ｴﾗｰ解除
RES MR20503              ; 機種番号不一致ｴﾗｰ解除
CON
JMP @R015
;//User Open Area Footer
STG @R002
ANB R39202               ; SELECT_ACT Busy
SET R39204               ; SELECT_ACT Interlock
CON
ZRES @DM30 @DM37
CON
DW #0 @DM31
CON
DW #1 @DM32
CON
DW #2 @DM33
CON
DW #0 @DM34
CON
DW #3 @DM35
CON
DW #1 @DM36
CON
SET @R200
CON
JMP @R003
STG @R003
AND @R201
RES @R201
CON
RES R39204               ; SELECT_ACT Interlock
CON
MPS
AND @R205
ZRES @DM20 @DM27
CON
JMP @R004
MRD
AND @R206
JMP @R014
MPP
AND @R208
JMP @R015
;ﾛｲｺｶｰﾄﾞ情報読込
STG @R004
ANB R39102               ; SELECT_Y_N Busy
SET R39104               ; SELECT_Y_N Interlock
CON
DW #2 @DM21
CON
ZRES B00 B01             ; Barcord読込完了  Barcord読込NG
CON
SET @R300
CON
JMP @R005
STG @R005
AND @R301
RES @R301
CON
RES R39104               ; SELECT_Y_N Interlock
CON
MPS
AND @R306
JMP @R006
MPP
ANB @R306
JMP @R015
;ﾛｲｺｶｰﾄﾞ読込確認/処理
STG @R006
MPS
AND B00                  ; Barcord読込完了
@ZRES DM5220 DM5236      ; _機種分類2機種名称  _機種分類4機種名称
CON
JMP @R007
MPP
LDB B00                  ; Barcord読込完了
OR B01                   ; Barcord読込NG
ANL
DW #1 @DM22
CON
JMP @R004
;ロイコ情報格納
STG @R007
BMOV W00 DM5220 #8       ; ﾛｲｺｶｰﾄﾞ情報1  _機種分類2機種名称
SET MR21500              ; 機種設定確認
CON
JMP @R009
STG @R009
AND MR21501              ; 機種確認完了
RES MR21501              ; 機種確認完了
CON
JMP @R010
;照合結果:20=正常　100:再読み込み　101:定停止
;
STG @R010
MPS
AND= DM20002 #20         ; 機種照合結果
JMP @R011
MRD
AND= DM20002 #100        ; 機種照合結果
JMP @R004
MPP
AND= DM20002 #101        ; 機種照合結果
JMP @R015
STG @R011
MPS
SET @R500
CON
JMP @R013
MPP
DW.D #0 EM60             ; 投入ﾜｰｸ数現在値
CON
RDASC.D DM5228 DM10      ; _機種分類3機種名称
STG @R013
AND @R501
RES @R501
CON
JMP @R014
STG @R014
SET R40402               ; _AUTOﾓｰﾄﾞ移行OK
CON
ENDS
STG @R015
SET R40403               ; _AUTOﾓｰﾄﾞ移行NG
CON
ENDS
;<h1/> 初期ﾛｯﾄ設定   @MR5400
STG @R500
SET @R502
CON
JMP @R504
STG @R504
OUT MR20602              ; ﾛｯﾄ数設定画面表示
MPS
LD< DM20010 DM20012      ; ﾛｯﾄ内CAV総数  残CAV数概算値
OR MR20603               ; 残CAV数ﾘｾｯﾄ
LD=.L DM22212 +0         ; 残CAV数_剥離_1ﾛｯﾄ
ANP @R504
ORL
ANL
MOV DM20010 DM20012      ; ﾛｯﾄ内CAV総数  残CAV数概算値
MOV.L DM20010 DM22200    ; ﾛｯﾄ内CAV総数  投入予定CAV数_1ﾛｯﾄ
MOV.L DM20010 DM22210    ; ﾛｯﾄ内CAV総数  残CAV数_ｸﾘｰﾆﾝｸﾞ_1ﾛｯﾄ
MOV.L DM20010 DM22212    ; ﾛｯﾄ内CAV総数  残CAV数_剥離_1ﾛｯﾄ
MOV.L DM20010 DM22220    ; ﾛｯﾄ内CAV総数  残CAV数_装置_1ﾛｯﾄ_通信用
MPP
AND MR20601              ; ﾛｯﾄ数設定完了
JMP @R515
STG @R515
RES MR20410              ; Task1→ﾛｯﾄｻｲｸﾙ停止中
CON
RES MR20411              ; Task3→ﾛｯﾄｻｲｸﾙ停止完了
CON
SET @R501
CON
RES @R502
CON
ENDS
;<h1/>ModeOut_Handle/ﾓｰﾄﾞOUT直後起動
;[作成上の注意点]
;・ﾒｲﾝﾓｼﾞｭｰﾙ停止後、定停止中になる直前に起動します。
;・ﾕｰｻﾞｰｵｰﾌﾟﾝｴﾘｱ以外は修正しないで下さい。
;・ﾒｲﾝﾓｼﾞｭｰﾙと同様、安全ｶﾊﾞｰ、非常停止などの影響を受けます。
;・STG〜JMP命令は@R(ﾛｰｶﾙﾘﾚｰ)を使用して下さい。
;・動作記述をする事ができます。
LD R40407                ; _ﾓｰﾄﾞOUTﾕｰｻﾞｰSTG
SET @R100
;//User Open Area Header
STG @R100
ZRES MR10000 MR10015     ; Task0 HOME退避完了
CON
JMP @R115
;//User Open Area Footer
STG @R115
RES R40407               ; _ﾓｰﾄﾞOUTﾕｰｻﾞｰSTG
CON
ENDS
;<h1/>*Select_ACT 
;MyTask Select_ACT Process Substance/SELECT_ACT処理実体
STG @R200
ANB R39202               ; SELECT_ACT Busy
MPS
ZRES @R205 @R208
CON
DW #0 @DM30
CON
BMOV @DM30 DM60030 #7    ; TaskNo /SELECT_ACT
MPP
SET R39200               ; SELECT_ACT Start
CON
SET @R202
CON
JMP @R203
STG @R203
AND R39202               ; SELECT_ACT Busy
AND<> DM60037 #0         ; SelectSW /SELECT_ACT
MPS
AND= DM60037 #1          ; SelectSW /SELECT_ACT
SET @R205
CON
JMP @R204
MRD
AND= DM60037 #2          ; SelectSW /SELECT_ACT
SET @R206
CON
JMP @R204
MRD
AND= DM60037 #3          ; SelectSW /SELECT_ACT
SET @R207
CON
JMP @R204
MPP
AND= DM60037 #4          ; SelectSW /SELECT_ACT
SET @R208
CON
JMP @R204
STG @R204
ANB R39202               ; SELECT_ACT Busy
RES @R202
CON
SET @R201
CON
ENDS
;<h1/>*Select_Y_N 
;MyTask Select_Y_N Process Substance/SELECT_Y_N処理実体
STG @R300
ANB R39102               ; SELECT_Y_N Busy
MPS
ZRES @R306 @R307
CON
DW #0 @DM20
CON
BMOV @DM20 DM60020 #3    ; TaskNo /SELECT_Y_N
MPP
SET R39100               ; SELECT_Y_N Start
CON
SET @R302
CON
JMP @R303
STG @R303
AND R39102               ; SELECT_Y_N Busy
MPS
AND= DM60023 #1          ; Y_N /SELECT_Y_N
SET @R306
CON
JMP @R304
MPP
AND= DM60023 #2          ; Y_N /SELECT_Y_N
RES @R306
CON
JMP @R304
STG @R304
ANB R39102               ; SELECT_Y_N Busy
RES @R302
CON
SET @R301
CON
ENDS
END
ENDH
