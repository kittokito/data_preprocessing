DEVICE:53
;MODULE:Master
;MODULE_TYPE:0
;SCRIPT_TYPE:
LD R40013                ; 非常停止
ZRES @R000 @R915
;ACTION PARAMETER TRANSFER
;*** ﾃﾞﾊﾞｯｸﾞ中の誤操作禁止のためﾃﾞｰﾀから一回中継する ***
LD CR2002                ; 常時ON
MOV.D DM1406 LR000       ; ACTION PARAMETER 00
;<h1/>Task Control / タスク制御
;Task Boot & Shutdown control / タスク起動終了
;<h1/>!!!! Taskの増減により都度編集すること
LDP R40004               ; TASKDO
LD R40001                ; 自動動作中
OR R40003                ; 原点復帰中
ANL
MPS
AND R41100               ; TASK1 起動有効
MDSTRT TASK1
MRD
AND R41101               ; TASK2 起動有効
MDSTRT TASK2
MRD
AND R41102               ; TASK3 起動有効
MDSTRT TASK3
MRD
AND R41103               ; TASK4 起動有効
MDSTRT TASK4
MRD
AND R41115               ; TASK16 起動有効
MDSTRT Index
MPP
SET @R001
;ﾓｰﾄﾞ起動 / MODE RUNNING START
STG @R001
MPS
AND R40001               ; 自動動作中
MOV R41100 R41300        ; TASK1 起動有効  TASK1 AUTO起動
JMP @R002
MPP
AND R40003               ; 原点復帰中
MOV R41100 R41200        ; TASK1 起動有効  TASK1原点復帰起動
RES R42214               ; INDEX原点復帰完了
CON
JMP @R002
;<h1/>STEP Operation / STEP動作
;<h1/>!!!! Taskの増減により都度編集すること
LDP R40004               ; TASKDO
AND R40002               ; ﾒﾝﾃﾅﾝｽ動作中
MPS
AND= DM1404 #1
SET R41400               ; TASK1 STEP起動
CON
MDSTRT TASK1
MRD
AND= DM1404 #2
SET R41401               ; TASK2 STEP起動
CON
MDSTRT TASK2
MRD
AND= DM1404 #3
SET R41402               ; TASK3 STEP起動
CON
MDSTRT TASK3
MRD
AND= DM1404 #4
SET R41403               ; TASK4 STEP起動
CON
MDSTRT TASK4
MRD
AND= DM1404 #16
SET R41415               ; TASK16 STEP起動
CON
MDSTRT Index
MPP
SET @R002
;TASK起動確認待ち / WAIT TASK BOOT SIGNAL
STG @R002
LDB R40002               ; ﾒﾝﾃﾅﾝｽ動作中
AND= R40300 R41100       ; TASK1動作中  TASK1 起動有効
LD R40002                ; ﾒﾝﾃﾅﾝｽ動作中
AND<> R40300 #0          ; TASK1動作中
ORL
ANL
SET R40400               ; 動作開始
CON
JMP @R003
;TASK終了待ち / WATI TASK OFF
STG @R003
AND= R40300 #0           ; TASK1動作中
RES R40400               ; 動作開始
CON
JMP @R004
;<h1/>ﾓｼﾞｭｰﾙ停止処理
;<h1/>!!!! Taskの増減により都度編集すること
STG @R004
MPS
AND R41100               ; TASK1 起動有効
MDSTOP TASK1
MRD
AND R41101               ; TASK2 起動有効
MDSTOP TASK2
MRD
AND R41102               ; TASK3 起動有効
MDSTOP TASK3
MRD
AND R41103               ; TASK4 起動有効
MDSTOP TASK4
MRD
AND R41115               ; TASK16 起動有効
MDSTOP Index
MPP
JMP @R005
STG @R005
RES R40004               ; TASKDO
CON
RES R40011               ; HOLD
CON
ENDS
;STOP Manegment/停止処理
LD R40001                ; 自動動作中
OR R40002                ; ﾒﾝﾃﾅﾝｽ動作中
ANP R40012               ; HOLD要求
OR R40003                ; 原点復帰中
SET R40011               ; HOLD
CON
RES R40012               ; HOLD要求
LDF R40004               ; TASKDO
MPS
ZRES R41601 R41603       ; TP AUTO選択  TP STEP選択
CON
RES R40011               ; HOLD
CON
RES R40001               ; 自動動作中
CON
RES R40002               ; ﾒﾝﾃﾅﾝｽ動作中
MPP
AND R40003               ; 原点復帰中
RES R40003               ; 原点復帰中
CON
SET R40009               ; 原点復帰完了
LDF R41801               ; 手動操作中
RES R40003               ; 原点復帰中
;<h1/>＠モード選択　/　Select Mode
LDB R40001               ; 自動動作中
ANB R40002               ; ﾒﾝﾃﾅﾝｽ動作中
ANB R40003               ; 原点復帰中
ANB R40004               ; TASKDO
OUT R40000               ; 定停止中
;装置起動条件 / Machine Running Condition
LDB R40400               ; 動作開始
ANB R40106               ; ｴﾗｰ中
ANB R40005               ; ﾎﾟｰｽﾞ中
ANB R40013               ; 非常停止
AND R42008
OUT @R100                ; 起動条件
;ＨＯＭＥ
LDP R40009               ; 原点復帰完了
MPS
AND= FM287 #1            ; ModelIdentficationNumber
RES MR507                ; 減圧封止　CL選択
CON
SET MR506                ; 減圧封止　BK選択
CON
SET R42400               ; INDEX BK選択中
CON
MOV #1 @DM10             ; 機種記憶
MPP
AND= FM287 #2            ; ModelIdentficationNumber
SET MR507                ; 減圧封止　CL選択
CON
RES MR506                ; 減圧封止　BK選択
CON
RES R42400               ; INDEX BK選択中
CON
MOV #2 @DM10             ; 機種記憶
;if fm287 = 1 then 
;dm8000.t = dm2500.t
;else
;dm8000.t = dm2600.t
;end if
;
;
;
;
;
LDP R40009               ; 原点復帰完了
NCJ #1000
;if fm287 = 1 then 
;
LD= FM287 #1             ; ModelIdentficationNumber
NCJ #2000
;dm8000.t = dm2500.t
;
LD CR2002                ; 常時ON
SMOV DM2500 DM8000
;else
;
LD CR2002                ; 常時ON
CJ #2001
LABEL #2000
;dm8000.t = dm2600.t
;
LD CR2002                ; 常時ON
SMOV DM2600 DM8000
;end if
;
LABEL #2001
LABEL #1000
;
LD R40000                ; 定停止中
AND<> FM287 @DM10        ; ModelIdentficationNumber  機種記憶
RES R40009               ; 原点復帰完了
;ＡＵＴＯ
LD R40009                ; 原点復帰完了
ANB R40004               ; TASKDO
OUT R41500               ; TP AUTO押下条件
;ＳＴＥＰ
LD R40009                ; 原点復帰完了
ANB R40004               ; TASKDO
OUT R41501               ; TP STEP押下条件
;MODE_起動 / BOOT EACH MODE
LD R40000                ; 定停止中
AND @R100                ; 起動条件
ANP R42000
DW #10 DM1500            ; 画面切替
CON
MPS
AND R41602               ; TP HOME選択
RES R40009               ; 原点復帰完了
CON
SET R40003               ; 原点復帰中
CON
SET R40004               ; TASKDO
MRD
AND R41601               ; TP AUTO選択
SET R40001               ; 自動動作中
CON
SET R40004               ; TASKDO
MPP
AND R41603               ; TP STEP選択
SET R40002               ; ﾒﾝﾃﾅﾝｽ動作中
CON
SET R40004               ; TASKDO
;Ｃａｌｌ　Ｐｏｓｔ
LD R40002                ; ﾒﾝﾃﾅﾝｽ動作中
AND R40101               ; CALL POST
LD R42000
OR R40103                ; POST 無効
ANL
ANB R40106               ; ｴﾗｰ中
ANB R40013               ; 非常停止
ANB R40005               ; ﾎﾟｰｽﾞ中
ORB R40002               ; ﾒﾝﾃﾅﾝｽ動作中
OUT R40102               ; POST OK
;Error Release Delay Management / エラー解除遅延処理
LD R40106                ; ｴﾗｰ中
TMR @4 #15
LD R40010                ; ERROR
ANB R40106               ; ｴﾗｰ中
SET R40106               ; ｴﾗｰ中
CON
SET @R200                ; ERROR先頭
;選択SWの表示/非表示切替
STG @R200                ; ERROR先頭
MPS
AND<> DM1203 #0
SET R41609               ; エラー復帰SW有効
MRD
AND<> DM1204 #0
SET R41610               ; エラー復帰SW有効
MRD
AND<> DM1205 #0
SET R41611               ; エラー復帰SW有効
MRD
AND<> DM1206 #0
SET R41612               ; エラー復帰SW有効
MPP
AND @T4
JMP @R201
STG @R201
AND<> #0 DM1201          ; 復帰SW番号
LDP R42000
ANB R40005               ; ﾎﾟｰｽﾞ中
OR R40105                ; ｴﾗｰ中非常停止
ANL
ANB LR208                ; ｴﾗｰﾘｾｯﾄｷｰ要求
JMP @R202
MOV DM1201 DM1207        ; 復帰SW番号  ｴﾗｰ復帰SW番号(ﾕｰｻﾞｰ用)
STG @R202
TMR @3 #5
CON
AND @T3
MPS
RES R40100               ; ﾌﾞｻﾞｰｵﾌ
CON
RES R40010               ; ERROR
CON
ZRES R41609 R41612       ; エラー復帰SW有効  エラー復帰SW有効
CON
RES R40105               ; ｴﾗｰ中非常停止
CON
RES R40106               ; ｴﾗｰ中
CON
ENDS
MPP
FMOV #0 DM1201 #6        ; 復帰SW番号
LD LR208                 ; ｴﾗｰﾘｾｯﾄｷｰ要求
ANP R42004
SET LR209                ; ｴﾗｰﾘｾｯﾄｷｰ動作OK
LD LR208                 ; ｴﾗｰﾘｾｯﾄｷｰ要求
AND LR209                ; ｴﾗｰﾘｾｯﾄｷｰ動作OK
RES LR208                ; ｴﾗｰﾘｾｯﾄｷｰ要求
CON
RES LR209                ; ｴﾗｰﾘｾｯﾄｷｰ動作OK
;割込みSW押下可能条件 / Interupt SW push condition
;必要に応じて条件を追加すること
LD R41512                ; 割込みSW1表示
AND R40004               ; TASKDO
ANB R40011               ; HOLD
AND R40001               ; 自動動作中
OUT R41508               ; 割込みSW1押下許可
LD R41513                ; 割込みSW2表示
AND R40004               ; TASKDO
ANB R40011               ; HOLD
AND R40001               ; 自動動作中
OUT R41509               ; 割込みSW2押下許可
LD R41514                ; 割込みSW3表示
AND R40004               ; TASKDO
ANB R40011               ; HOLD
AND R40001               ; 自動動作中
OUT R41510               ; 割込みSW3押下許可
LD R41515                ; 割込みSW4表示
AND R40004               ; TASKDO
ANB R40011               ; HOLD
AND R40001               ; 自動動作中
OUT R41511               ; 割込みSW4押下許可
;<h1/>CT計測 / CT Measurement
LD R40403                ; サイクルタイム計測
MPS
ANFB R40404              ; ｻｲｸﾙﾀｲﾑ取得
TMH @10 $FFFFFFFF
MPP
ANP R40404               ; ｻｲｸﾙﾀｲﾑ取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T10
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1640             ; C/T
MPP
RES R40404               ; ｻｲｸﾙﾀｲﾑ取得
;<h1/>処理時間計測 / Process time measurement
LD R40500                ; 処理時間1計測開始
MPS
TMH @11 $FFFFFFFF
MPP
ANP R40600               ; 処理時間1取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T11
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1642             ; 処理時間1
MPP
RES R40500               ; 処理時間1計測開始
CON
RES R40600               ; 処理時間1取得
LD R40501                ; 処理時間2計測開始
MPS
TMH @12 $FFFFFFFF
MPP
ANP R40601               ; 処理時間2取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T12
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1644             ; 処理時間2
MPP
RES R40501               ; 処理時間2計測開始
CON
RES R40601               ; 処理時間2取得
LD R40502                ; 処理時間3計測開始
MPS
TMH @13 $FFFFFFFF
MPP
ANP R40602               ; 処理時間3取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T13
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1646             ; 処理時間3
MPP
RES R40502               ; 処理時間3計測開始
CON
RES R40602               ; 処理時間3取得
LD R40503                ; 処理時間4計測開始
MPS
TMH @14 $FFFFFFFF
MPP
ANP R40603               ; 処理時間4取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T14
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1648             ; 処理時間4
MPP
RES R40503               ; 処理時間4計測開始
CON
RES R40603               ; 処理時間4取得
LD R40504                ; 処理時間5計測開始
MPS
TMH @15 $FFFFFFFF
MPP
ANP R40604               ; 処理時間5取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T15
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1650             ; 処理時間5
MPP
RES R40504               ; 処理時間5計測開始
CON
RES R40604               ; 処理時間5取得
LD R40505                ; 処理時間6計測開始
MPS
TMH @16 $FFFFFFFF
MPP
ANP R40605               ; 処理時間6取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T16
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1652             ; 処理時間6
MPP
RES R40505               ; 処理時間6計測開始
CON
RES R40605               ; 処理時間6取得
LD R40506                ; 処理時間7計測開始
MPS
TMH @17 $FFFFFFFF
MPP
ANP R40606               ; 処理時間7取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T17
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1654             ; 処理時間7
MPP
RES R40506               ; 処理時間7計測開始
CON
RES R40606               ; 処理時間7取得
LD R40507                ; 処理時間8計測開始
MPS
TMH @18 $FFFFFFFF
MPP
ANP R40607               ; 処理時間8取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T18
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1656             ; 処理時間8
MPP
RES R40507               ; 処理時間8計測開始
CON
RES R40607               ; 処理時間8取得
LD R40508                ; 処理時間9計測開始
MPS
TMH @19 $FFFFFFFF
MPP
ANP R40608               ; 処理時間9取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T19
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1658             ; 処理時間9
MPP
RES R40508               ; 処理時間9計測開始
CON
RES R40608               ; 処理時間9取得
LD R40509                ; 処理時間10計測開始
MPS
TMH @20 $FFFFFFFF
MPP
ANP R40609               ; 処理時間10取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T20
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1660             ; 処理時間10
MPP
RES R40509               ; 処理時間10計測開始
CON
RES R40609               ; 処理時間10取得
LD R40510                ; 処理時間11計測開始
MPS
TMH @21 $FFFFFFFF
MPP
ANP R40610               ; 処理時間11取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T21
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1662             ; 処理時間11
MPP
RES R40510               ; 処理時間11計測開始
CON
RES R40610               ; 処理時間11取得
LD R40511                ; 処理時間12計測開始
MPS
TMH @22 $FFFFFFFF
MPP
ANP R40611               ; 処理時間12取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T22
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1664             ; 処理時間12
MPP
RES R40511               ; 処理時間12計測開始
CON
RES R40611               ; 処理時間12取得
LD R40512                ; 処理時間13計測開始
MPS
TMH @23 $FFFFFFFF
MPP
ANP R40612               ; 処理時間13取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T23
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1666             ; 処理時間13
MPP
RES R40512               ; 処理時間13計測開始
CON
RES R40612               ; 処理時間13取得
LD R40513                ; 処理時間14計測開始
MPS
TMH @24 $FFFFFFFF
MPP
ANP R40613               ; 処理時間14取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T24
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1668             ; 処理時間14
MPP
RES R40513               ; 処理時間14計測開始
CON
RES R40613               ; 処理時間14取得
LD R40514                ; 処理時間15計測開始
MPS
TMH @25 $FFFFFFFF
MPP
ANP R40614               ; 処理時間15取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T25
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1670             ; 処理時間15
MPP
RES R40514               ; 処理時間15計測開始
CON
RES R40614               ; 処理時間15取得
LD R40515                ; 処理時間16計測開始
MPS
TMH @26 $FFFFFFFF
MPP
ANP R40615               ; 処理時間16取得
MPS
LDA.D $FFFFFFFF
CON
SUB.D @T26
CON
FLOAT
CON
DIV.F +100
CON
STA.F DM1672             ; 処理時間16
MPP
RES R40515               ; 処理時間16計測開始
CON
RES R40615               ; 処理時間16取得
;SELECT ACTION /
LD R40112                ; SELECT ACTION DO
@DW #0 DM1235            ; SA Select SW No.
CON
@SET @MR300              ; START SA
STG @MR300               ; START SA
MPS
AND<> DM1231 #0          ; Select Action SW1
SET R41808               ; SELECT ACT SW1有効
MRD
AND<> DM1232 #0          ; Select Action SW2
SET R41809               ; SELECT ACT SW2有効
MRD
AND<> DM1233 #0          ; Select Action SW3
SET R41810               ; SELECT ACT SW3有効
MRD
AND<> DM1234 #0          ; Select Action SW4
SET R41811               ; SELECT ACT SW4有効
MPP
JMP @MR301
STG @MR301
AND<> DM1235 #0          ; SA Select SW No.
ANB R40005               ; ﾎﾟｰｽﾞ中
JMP @MR302
STG @MR302
FMOV #0 DM1230 #5        ; Select Action No.
RES R40100               ; ﾌﾞｻﾞｰｵﾌ
CON
ZRES R41808 R41811       ; SELECT ACT SW1有効  SELECT ACT SW4有効
CON
RES R40112               ; SELECT ACTION DO
CON
ENDS
;手動操作 / Manual Output Operation
LDP R41800               ; 手動操作開始
RES R41800               ; 手動操作開始
CON
SET R41801               ; 手動操作中
LD R41801                ; 手動操作中
MPS
ANP R41802               ; 手動操作終了
DW #10 DM1500            ; 画面切替
CON
RES R41801               ; 手動操作中
MPP
ANP R41803               ; 手動操作終了(RB Teach)
DW #0 DM3001             ; ｵｰﾊﾞｰﾗｯﾌﾟｳｨﾝﾄﾞｳ
CON
DW #601 DM1500           ; 画面切替
CON
RES R41801               ; 手動操作中
END
ENDH
