DEVICE:53
;MODULE:QR_TFIR-32
;MODULE_TYPE:1
;SCRIPT_TYPE:
;Port1 "g" command
LD= V0 #15               ; 
ANB @CR2008
@SET @MR000
;Port 1
STG @MR000
JMP @MR001
FMOV #0 DM34001 #30      ; Port4 送信ﾃﾞｰﾀ長
FMOV #0 DM34259 #30      ; Port4 受信ﾃﾞｰﾀ1
FMOV #0 DM35400 #200     ; Port4 受信ﾃﾞｰﾀ
STG @MR001
DW $0001 DM34001         ; Port4 送信ﾃﾞｰﾀ長
CON
DW $6700 DM34002         ; Port4 送信ﾃﾞｰﾀ1
CON
SET R34101               ; Port4 送信要求
CON
JMP @MR002
STG @MR002
AND R34001               ; Port4 送信完了
RES R34101               ; Port4 送信要求
CON
JMP @MR003
STG @MR003
MPS
AND R34002               ; Port4 受信ﾃﾞｰﾀ読出要求
SET R34102               ; Port4 受信ﾃﾞｰﾀ読出完了
CON
JMP @MR004
MPP
TMR @0 #50
CON
AND @T0
SET R34401               ; Port4 通信エラー
CON
JMP @MR004
STG @MR004
ANB R34002               ; Port4 受信ﾃﾞｰﾀ読出要求
RES R34102               ; Port4 受信ﾃﾞｰﾀ読出完了
CON
JMP @MR005
STG @MR005
MPS
ANB R34401               ; Port4 通信エラー
SET @MR006
CON
ENDS
MPP
AND R34401               ; Port4 通信エラー
JMP @MR007
;@DM1 = 0
;@DM2 = 0
;
;FOR @DM0 = 0 TO DM34258
;	IF MID(DM34259.T,@DM0,1) = "," THEN
;		INC(@DM1)
;		@DM2 = 0
;	ELSE
;		IF @DM1 = 0 THEN
;			DM35400.T:@DM2 = MID(DM34259.T,@DM0,1)  
;			INC(@DM2)
;		ELSE IF @DM1 = 1 THEN
;			DM35410.T:@DM2 = MID(DM34259.T,@DM0,1)  
;			INC(@DM2)
;		ELSE
;			DM35420.T:@DM2 = MID(DM34259.T,@DM0,1)  
;			INC(@DM2)
;		END IF
;	END IF
;NEXT
; 
;FOR @DM0 = 0 TO 29
;	DM35400:@DM0 = SWAP(DM35400:@DM0)
;NEXT
;
;'作業者側から見て、カートリッジ1,2,3と格納させる
;'(DENSOと読込みデータ格納の順番を統一)
;UNIS(DM35400,DM35520.T,10)
;UNIS(DM35410,DM35510.T,10)
;UNIS(DM35420,DM35500.T,10)
;
;SET (@MR006,@MR007)
LD @MR006
NCJ #1002
;@DM1 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM1
;@DM2 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM2
;FOR @DM0 = 0 TO DM34258
;
LD CR2002                ; 常時ON
MOV #0 @DM0
LABEL #2000
LD> @DM0 DM34258         ; Port4 受信ﾃﾞｰﾀ長
CJ #2001
;	IF MID(DM34259.T,@DM0,1) = "," THEN
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM0
LD CR2002                ; 常時ON
SMID DM34259 *@VM0 @DM0 #1;Port4 受信ﾃﾞｰﾀ1
LD CR2002                ; 常時ON
LEN *VM0 @VM2
LD CR2002                ; 常時ON
LDA @VM2
CON
SRA #1
CON
STA @VM2
CON
INC @VM2
CON
ADRADD.S @VM2 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM3
SMOV "," *@VM3
LD CR2002                ; 常時ON
SCMP *@VM0 *@VM3
LD CR2010                ; ＝
NCJ #2002
;		INC(@DM1)
;
LD CR2002                ; 常時ON
INC @DM1
;		@DM2 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM2
;	ELSE
;
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;		IF @DM1 = 0 THEN
;
LD= @DM1 #0
NCJ #2004
;			DM35400.T:@DM2 = MID(DM34259.T,@DM0,1)  
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z11
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM5
LD CR2002                ; 常時ON
SMID DM34259 *@VM5 @DM0 #1;Port4 受信ﾃﾞｰﾀ1
LD CR2002                ; 常時ON
SMOV *@VM5 DM35400:Z11   ; Port4 受信ﾃﾞｰﾀ
;			INC(@DM2)
;
LD CR2002                ; 常時ON
INC @DM2
LD CR2002                ; 常時ON
CJ #2005
LABEL #2004
;		ELSE IF @DM1 = 1 THEN
;
LD= @DM1 #1
NCJ #2006
;			DM35410.T:@DM2 = MID(DM34259.T,@DM0,1)  
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z11
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM7
LD CR2002                ; 常時ON
SMID DM34259 *@VM7 @DM0 #1;Port4 受信ﾃﾞｰﾀ1
LD CR2002                ; 常時ON
SMOV *@VM7 DM35410:Z11
;			INC(@DM2)
;
LD CR2002                ; 常時ON
INC @DM2
;		ELSE
;
LD CR2002                ; 常時ON
CJ #2007
LABEL #2006
;			DM35420.T:@DM2 = MID(DM34259.T,@DM0,1)  
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z11
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM9
LD CR2002                ; 常時ON
SMID DM34259 *@VM9 @DM0 #1;Port4 受信ﾃﾞｰﾀ1
LD CR2002                ; 常時ON
SMOV *@VM9 DM35420:Z11
;			INC(@DM2)
;
LD CR2002                ; 常時ON
INC @DM2
;		END IF
;
LABEL #2007
LABEL #2005
;	END IF
;
LABEL #2003
;NEXT
;
LD CR2002                ; 常時ON
INC @DM0
LDB CR2009               ; 演算結果が負
CJ #2000
LABEL #2001
;FOR @DM0 = 0 TO 29
;
LD CR2002                ; 常時ON
MOV #0 @DM0
LABEL #2008
LD> @DM0 #29
CJ #2009
;	DM35400:@DM0 = SWAP(DM35400:@DM0)
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
LDA DM35400:Z12          ; Port4 受信ﾃﾞｰﾀ
CON
SWAP
CON
STA DM35400:Z11          ; Port4 受信ﾃﾞｰﾀ
;NEXT
;
LD CR2002                ; 常時ON
INC @DM0
LDB CR2009               ; 演算結果が負
CJ #2008
LABEL #2009
;'作業者側から見て、カートリッジ1,2,3と格納させる
;
;'(DENSOと読込みデータ格納の順番を統一)
;
;UNIS(DM35400,DM35520.T,10)
;
LD CR2002                ; 常時ON
UNIS DM35400 DM35520 #10 ; Port4 受信ﾃﾞｰﾀ
;UNIS(DM35410,DM35510.T,10)
;
LD CR2002                ; 常時ON
UNIS DM35410 DM35510 #10
;UNIS(DM35420,DM35500.T,10)
;
LD CR2002                ; 常時ON
UNIS DM35420 DM35500 #10 ; Port4 受信ﾃﾞｰﾀ
;SET (@MR006,@MR007)
LD @MR006
SET @MR007
LABEL #1002
;
STG @MR007
RES @MR006
CON
RES R34102               ; Port4 受信ﾃﾞｰﾀ読出完了
CON
SET R34400               ; Port4 通信完了
CON
ENDS
LD R50010                ; Emergency　Stop
ZRES @MR000 @MR015
LD R34400                ; Port4 通信完了
OR R50010                ; Emergency　Stop
MEND
END
ENDH
