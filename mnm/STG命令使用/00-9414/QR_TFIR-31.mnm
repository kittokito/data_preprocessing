DEVICE:53
;MODULE:QR_TFIR-31
;MODULE_TYPE:1
;SCRIPT_TYPE:
;Port1 "g" command
LD= V0 #15               ; 
ANB @CR2008
@SET @MR000
;Port 1
STG @MR000
JMP @MR001
FMOV #0 DM30001 #30      ; Port1 送信ﾃﾞｰﾀ数
FMOV #0 DM30259 #30      ; Port1 受信ﾃﾞｰﾀ
FMOV #0 DM31400 #200     ; Port1 受信ﾃﾞｰﾀ
STG @MR001
DW $0001 DM30001         ; Port1 送信ﾃﾞｰﾀ数
CON
DW $6700 DM30002         ; Port1 送信ﾃﾞｰﾀ
CON
SET R30101               ; Port1 送信要求
CON
JMP @MR002
STG @MR002
AND R30001               ; Port1 送信完了
RES R30101               ; Port1 送信要求
CON
JMP @MR003
STG @MR003
MPS
AND R30002               ; Port1 読出要求
SET R30102               ; Port1 受信ﾃﾞﾀ読出完了
CON
JMP @MR004
MPP
TMR @0 #50
CON
AND @T0
SET R30401               ; Port1 通信エラー
CON
JMP @MR004
STG @MR004
ANB R30002               ; Port1 読出要求
RES R30102               ; Port1 受信ﾃﾞﾀ読出完了
CON
JMP @MR005
STG @MR005
MPS
ANB R30401               ; Port1 通信エラー
SET @MR006
CON
ENDS
MPP
AND R30401               ; Port1 通信エラー
JMP @MR007
;@DM1 = 0
;@DM2 = 0
;
;FOR @DM0 = 0 TO DM30258
;	IF MID(DM30259.T,@DM0,1) = "," THEN
;		INC(@DM1)
;		@DM2 = 0
;	ELSE
;		IF @DM1 = 0 THEN
;			DM31400.T:@DM2 = MID(DM30259.T,@DM0,1)  
;			INC(@DM2)
;		ELSE IF @DM1 = 1 THEN
;			DM31410.T:@DM2 = MID(DM30259.T,@DM0,1)  
;			INC(@DM2)
;		ELSE
;			DM31420.T:@DM2 = MID(DM30259.T,@DM0,1)  
;			INC(@DM2)
;		END IF
;	END IF
;NEXT
; 
;FOR @DM0 = 0 TO 29
;	DM31400:@DM0 = SWAP(DM31400:@DM0)
;NEXT
;
;'作業者側から見て、カートリッジ1,2,3と格納させる
;'(DENSOと読込みデータ格納の順番を統一)
;UNIS(DM31400,DM31520.T,10)
;UNIS(DM31410,DM31510.T,10)
;UNIS(DM31420,DM31500.T,10)
;
;SET (@MR006,@MR007)
LD @MR006
NCJ #1002
;@DM1 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM1
;@DM2 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM2
;FOR @DM0 = 0 TO DM30258
;
LD CR2002                ; 常時ON
MOV #0 @DM0
LABEL #2000
LD> @DM0 DM30258         ; Port1 受信ﾃﾞｰﾀ数
CJ #2001
;	IF MID(DM30259.T,@DM0,1) = "," THEN
;
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM0
LD CR2002                ; 常時ON
SMID DM30259 *@VM0 @DM0 #1;Port1 受信ﾃﾞｰﾀ
LD CR2002                ; 常時ON
LEN *VM0 @VM2
LD CR2002                ; 常時ON
LDA @VM2
CON
SRA #1
CON
STA @VM2
CON
INC @VM2
CON
ADRADD.S @VM2 VM0
LD CR2002                ; 常時ON
MOV.D VM0 @VM3
SMOV "," *@VM3
LD CR2002                ; 常時ON
SCMP *@VM0 *@VM3
LD CR2010                ; ＝
NCJ #2002
;		INC(@DM1)
;
LD CR2002                ; 常時ON
INC @DM1
;		@DM2 = 0
;
LD CR2002                ; 常時ON
MOV #0 @DM2
;	ELSE
;
LD CR2002                ; 常時ON
CJ #2003
LABEL #2002
;		IF @DM1 = 0 THEN
;
LD= @DM1 #0
NCJ #2004
;			DM31400.T:@DM2 = MID(DM30259.T,@DM0,1)  
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z11
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM5
LD CR2002                ; 常時ON
SMID DM30259 *@VM5 @DM0 #1;Port1 受信ﾃﾞｰﾀ
LD CR2002                ; 常時ON
SMOV *@VM5 DM31400:Z11   ; Port1 受信ﾃﾞｰﾀ
;			INC(@DM2)
;
LD CR2002                ; 常時ON
INC @DM2
LD CR2002                ; 常時ON
CJ #2005
LABEL #2004
;		ELSE IF @DM1 = 1 THEN
;
LD= @DM1 #1
NCJ #2006
;			DM31410.T:@DM2 = MID(DM30259.T,@DM0,1)  
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z11
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM7
LD CR2002                ; 常時ON
SMID DM30259 *@VM7 @DM0 #1;Port1 受信ﾃﾞｰﾀ
LD CR2002                ; 常時ON
SMOV *@VM7 DM31410:Z11
;			INC(@DM2)
;
LD CR2002                ; 常時ON
INC @DM2
;		ELSE
;
LD CR2002                ; 常時ON
CJ #2007
LABEL #2006
;			DM31420.T:@DM2 = MID(DM30259.T,@DM0,1)  
;
LD CR2002                ; 常時ON
LDA @DM2
CON
EXT
CON
STA.L Z11
LD CR2002                ; 常時ON
ADRSET VM2 VM0
MOV #0 VM2
MOV.D VM0 @VM9
LD CR2002                ; 常時ON
SMID DM30259 *@VM9 @DM0 #1;Port1 受信ﾃﾞｰﾀ
LD CR2002                ; 常時ON
SMOV *@VM9 DM31420:Z11
;			INC(@DM2)
;
LD CR2002                ; 常時ON
INC @DM2
;		END IF
;
LABEL #2007
LABEL #2005
;	END IF
;
LABEL #2003
;NEXT
;
LD CR2002                ; 常時ON
INC @DM0
LDB CR2009               ; 演算結果が負
CJ #2000
LABEL #2001
;FOR @DM0 = 0 TO 29
;
LD CR2002                ; 常時ON
MOV #0 @DM0
LABEL #2008
LD> @DM0 #29
CJ #2009
;	DM31400:@DM0 = SWAP(DM31400:@DM0)
;
LD CR2002                ; 常時ON
LDA @DM0
CON
EXT
CON
STA.L Z11
CON
LDA @DM0
CON
EXT
CON
STA.L Z12
CON
LDA DM31400:Z12          ; Port1 受信ﾃﾞｰﾀ
CON
SWAP
CON
STA DM31400:Z11          ; Port1 受信ﾃﾞｰﾀ
;NEXT
;
LD CR2002                ; 常時ON
INC @DM0
LDB CR2009               ; 演算結果が負
CJ #2008
LABEL #2009
;'作業者側から見て、カートリッジ1,2,3と格納させる
;
;'(DENSOと読込みデータ格納の順番を統一)
;
;UNIS(DM31400,DM31520.T,10)
;
LD CR2002                ; 常時ON
UNIS DM31400 DM31520 #10 ; Port1 受信ﾃﾞｰﾀ
;UNIS(DM31410,DM31510.T,10)
;
LD CR2002                ; 常時ON
UNIS DM31410 DM31510 #10
;UNIS(DM31420,DM31500.T,10)
;
LD CR2002                ; 常時ON
UNIS DM31420 DM31500 #10 ; Port1 受信ﾃﾞｰﾀ
;SET (@MR006,@MR007)
LD @MR006
SET @MR007
LABEL #1002
;
STG @MR007
RES @MR006
CON
RES R30102               ; Port1 受信ﾃﾞﾀ読出完了
CON
SET R30400               ; Port1 通信完了
CON
ENDS
LD R50010                ; Emergency　Stop
ZRES @MR000 @MR015
LD R30400                ; Port1 通信完了
OR R50010                ; Emergency　Stop
MEND
END
ENDH
