DEVICE:53
;MODULE:QRID_SR
;MODULE_TYPE:0
;<共用ﾗｲﾌﾞﾗﾘｰ>
;QRID読込照合 SR-750,1000 EtherNetI/P 
;
;<説明>
;  ①マクロ宣言にてマクロ引数を設定してください
;  ②SERIAL_COM設定に値を入れてください。
;  ③
;  ④
;  ⑤
;マクロ宣言
; IN先頭B:		EthernetI/Pに割り当てた入力ﾃﾞﾊﾞｲｽB先頭番地(64bit)
; OUT先頭B:		EthernetI/Pに割り当てた出力ﾃﾞﾊﾞｲｽB先頭番地(64bit)
; IN先頭W:		EthernetI/Pに割り当てた入力ﾃﾞﾊﾞｲｽW先頭番地(82word)
; OUT先頭W:		EthernetI/Pに割り当てた出力ﾃﾞﾊﾞｲｽW先頭番地(36word)
; 受信先頭@DM: 	ｺﾏﾝﾄﾞ、ﾃﾞｰﾀの受信内容を格納
; Result_Code:	マクロ起動結果内容を格納
; I/F Bit:		#0	:Prog->Macro	:QRID読取開始
;				#1	:Macro->Prog	:QRID読取完了
;				#2	:Macro->Prog	:QRID読取中
;				#3	:Macro->Prog	:
;				#4	:Prog->Macro	:
;				#5	:Prog->Macro	:
;				#6	:Prog->Macro	:
;				#7	:Prog->Macro	:ﾏｸﾛ強制終了
;<h1/>QR1
LD CR2002                ; 常時ON
ANB @MR007
MSTRT QRID_SR_COM B1000 B1040 W2000 W2052 @DM100 @DM10 @MR000;SR-750 Series[1]Error  SR-750 Series[1]ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ  SR-750 Series[1]ﾊﾞﾝｸ番号  SR1 Seriesﾃﾞｰﾀ(0000)  SR1 Result_Code
;QRID読取ﾒｲﾝｲﾝﾀｰﾌｪｲｽ
;[bit]
;MR20300:SR_1SL読取開始
;MR20301:SR_1SL読取完了
;MR20302:SR_1SL読取中
;MR20315:SR_1SL読取通信異常
;[word]
;DM10400～DM10419:Tｺｰﾄﾞ  (20ﾜｰﾄﾞ)
;DM10420:ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ  (1ﾜｰﾄﾞ)
;DM10421:ISOIECｸﾞﾚｰﾄﾞ  (1ﾜｰﾄﾞ)
;DM10422:AIMDPMｸﾞﾚｰﾄﾞ  (1ﾜｰﾄﾞ)
;MAIN
STG MR20300              ; SR1_読取開始
ANB @MR002
SET MR20302              ; SR1_読取中
CON
JMP @MR100
;Memory clear
STG @MR100
RES MR20315              ; SR1_1SL読取通信異常
CON
RES MR20301              ; SR1_読取完了
CON
ZRES DM10400 DM10449     ; SR1_Tｺｰﾄﾞﾃﾞｰﾀ  SR1_予約
CON
ZRES @DM10 @DM19         ; SR1 Result_Code
CON
ZRES @DM100 @DM199       ; SR1 Seriesﾃﾞｰﾀ(0000)
CON
JMP @MR101
;汎用通信
STG @MR101
DW #0 @DM10              ; SR1 Result_Code
CON
SET @MR000
CON
JMP @MR102
STG @MR102
AND @MR001
RES @MR001
CON
JMP @MR103
STG @MR103
MPS
AND= @DM10 #20           ; SR1 Result_Code
JMP @MR104
MRD
LD<> @DM10 #20           ; SR1 Result_Code
AND<> @DM10 #0           ; SR1 Result_Code
ANL
SET MR20315              ; SR1_1SL読取通信異常
CON
JMP @MR104
MPP
BSWAP @DM100 #10         ; SR1 Seriesﾃﾞｰﾀ(0000)
LD CR2002                ; 常時ON
BMOV @DM100 DM10400 #20  ; SR1 Seriesﾃﾞｰﾀ(0000)  SR1_Tｺｰﾄﾞﾃﾞｰﾀ
MOV @DM170 DM10420       ; SR1_ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ
MOV @DM171 DM10421       ; SR1_ISOIECｸﾞﾚｰﾄﾞ 
MOV @DM172 DM10422       ; SR1_AIMDPMｸﾞﾚｰﾄﾞ
BMOV DM10400 W1C84 #10   ; SR1_Tｺｰﾄﾞﾃﾞｰﾀ
MOV @DM10 W1C96          ; SR1 Result_Code
STG @MR104
MPS
RES MR20302              ; SR1_読取中
CON
SET MR20301              ; SR1_読取完了
CON
ENDS
MPP
BMOV @DM100 DM3200 #10   ; SR1 Seriesﾃﾞｰﾀ(0000)  IND2-ST2 QRID-1
;<h1/>QR2
LD CR2002                ; 常時ON
ANB @MR207
MSTRT QRID_SR_COM B1080 B10C0 W2080 W20D2 @DM200 @DM20 @MR200;SR-750 Series[2]Error  SR-750 Series[2]ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ  SR-750 Series[2]ﾊﾞﾝｸ番号  SR2 Seriesﾃﾞｰﾀ(0000)  SR2 Result_Code
;QRID読取ﾒｲﾝｲﾝﾀｰﾌｪｲｽ
;[Bit]
;MR20400:SR2_1SL読取開始
;MR20401:SR2_1SL読取完了
;MR20402:SR2_1SL読取中
;MR20415:SR2_1SL読取通信異常
;[Word]
;DM10450～DM10459:Tｺｰﾄﾞ  (20ﾜｰﾄﾞ)
;DM10470:ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ  (1ﾜｰﾄﾞ)
;DM10471:ISOIECｸﾞﾚｰﾄﾞ  (1ﾜｰﾄﾞ)
;DM10472:AIMDPMｸﾞﾚｰﾄﾞ  (1ﾜｰﾄﾞ)
;MAIN
STG MR20400              ; SR2_読取開始
ANB @MR202
SET MR20402              ; SR2_読取中
CON
JMP @MR300
;Memory clear
STG @MR300
RES MR20415              ; SR2_1SL読取通信異常
CON
RES MR20401              ; SR2_読取完了
CON
ZRES DM10450 DM10499     ; SR2_Tｺｰﾄﾞﾃﾞｰﾀ  SR2_予約
CON
ZRES @DM20 @DM29         ; SR2 Result_Code
CON
ZRES @DM200 @DM299       ; SR2 Seriesﾃﾞｰﾀ(0000)
CON
JMP @MR301
;汎用通信
STG @MR301
DW #0 @DM20              ; SR2 Result_Code
CON
SET @MR200
CON
JMP @MR302
STG @MR302
AND @MR201
RES @MR201
CON
JMP @MR303
STG @MR303
MPS
AND= @DM20 #20           ; SR2 Result_Code
JMP @MR304
MRD
LD<> @DM20 #20           ; SR2 Result_Code
AND<> @DM20 #0           ; SR2 Result_Code
ANL
SET MR20415              ; SR2_1SL読取通信異常
CON
JMP @MR304
MRD
BSWAP @DM200 #10         ; SR2 Seriesﾃﾞｰﾀ(0000)
MPP
MOV @DM20 W1CAA          ; SR2 Result_Code
LD CR2002                ; 常時ON
BMOV @DM200 DM10450 #20  ; SR2 Seriesﾃﾞｰﾀ(0000)  SR2_Tｺｰﾄﾞﾃﾞｰﾀ
MOV @DM270 DM10470       ; SR2_ﾏｯﾁﾝｸﾞﾚﾍﾞﾙ
MOV @DM271 DM10471       ; SR2_ISOIECｸﾞﾚｰﾄﾞ 
MOV @DM272 DM10472       ; SR2_AIMDPMｸﾞﾚｰﾄﾞ
BMOV DM10450 W1CA0 #10   ; SR2_Tｺｰﾄﾞﾃﾞｰﾀ
STG @MR304
MPS
RES MR20402              ; SR2_読取中
CON
SET MR20401              ; SR2_読取完了
CON
ENDS
MPP
BMOV @DM200 DM3780 #20   ; SR2 Seriesﾃﾞｰﾀ(0000)  排出時読込 QRID-1
END
ENDH
