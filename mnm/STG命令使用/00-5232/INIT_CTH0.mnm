DEVICE:53
;MODULE:INIT_CTH0
;MODULE_TYPE:0
;SCRIPT_TYPE:
;------------------------------------------------------------------------------------------------------
;-- タイトル								: CPU高速カウンタ設定(CTH0)
;------------------------------------------------------------------------------------------------------
;-- 動作モード							: アップダウンカウント
;-- 入力方式								: 外部入力(位相差(1逓倍))
;-- 入力時定数							: 10μs
;-- カウント範囲							: 32ビット符号あり
;-- カウント方式							: リニアカウンタ
;-- 現在値(CTH0)の初期化					: しない
;------------------------------------------------------------------------------------------------------
;-- コンパレータ							: 使用しない
;------------------------------------------------------------------------------------------------------
;-- プリセット							: 使用しない
;------------------------------------------------------------------------------------------------------
;-- カウンタイネーブル					: 使用しない
;------------------------------------------------------------------------------------------------------
;-- 入力方式								: 外部入力(位相差(1逓倍))
LD CR2008                ; 運転開始時1ｽｷｬﾝON
RES CR2113               ; CTH0ｶｳﾝﾄ入力方式選択
CON
SET CR2114               ; CTH0ｶｳﾝﾄ入力方式選択
CON
RES CR2115               ; CTH0ｶｳﾝﾄ入力方式選択
;-- 入力時定数							: 10μs
LD CR2008                ; 運転開始時1ｽｷｬﾝON
MOV #0 CM1620            ; 入力時定数設定
SET CR2305               ; CPUﾕﾆｯﾄ入力時定数設定
;-- カウント範囲							: 32ビット符号あり
LD CR2008                ; 運転開始時1ｽｷｬﾝON
BSET CM1608 #7           ; CTH0ｲﾈｰﾌﾞﾙﾘｾｯﾄ設定
;-- カウント方式							: リニアカウンタ
LD CR2008                ; 運転開始時1ｽｷｬﾝON
RES CR2402               ; CTH0ｶｳﾝﾀ方式選択
;-- 現在値(CTH0)の初期化					: しない
;-- コンパレータ							: 使用しない
;-- コンパレータ設定を初期化
LD CR2008                ; 運転開始時1ｽｷｬﾝON
RES CR2103               ; CTC0ON時CTH0自動ﾘｾｯﾄ
CON
SET CR2104               ; CTC0ｺﾝﾊﾟﾚｰﾀ一致出力禁止
CON
RES CR2105               ; ｺﾝﾊﾟﾚｰﾀ一致出力OFF
CON
RES CR2106               ; ｺﾝﾊﾟﾚｰﾀ一致出力ON
CON
RES CR2107               ; ｺﾝﾊﾟﾚｰﾀ一致出力ON/OFF反転
LD CR2008                ; 運転開始時1ｽｷｬﾝON
RES CR2112               ; CTC1ON時CTH0自動ﾘｾｯﾄ
CON
SET CR2108               ; CTC1ｺﾝﾊﾟﾚｰﾀ一致出力禁止
CON
RES CR2109               ; ｺﾝﾊﾟﾚｰﾀ一致出力OFF
CON
RES CR2110               ; ｺﾝﾊﾟﾚｰﾀ一致出力ON
CON
RES CR2111               ; ｺﾝﾊﾟﾚｰﾀ一致出力ON/OFF反転
;-- プリセット							: 使用しない
;-- プリセット設定を初期化
LD CR2008                ; 運転開始時1ｽｷｬﾝON
RES CR2400               ; CTH0外部ﾌﾟﾘｾｯﾄ入力の設定
CON
RES CR2401               ; CTH0外部ﾌﾟﾘｾｯﾄ入力の設定
;-- カウンタイネーブル					: 使用しない
;-- カウンタイネーブル設定を初期化
LD CR2008                ; 運転開始時1ｽｷｬﾝON
BRES CM1608 #0           ; CTH0ｲﾈｰﾌﾞﾙﾘｾｯﾄ設定
CON
BRES CM1608 #1           ; CTH0ｲﾈｰﾌﾞﾙﾘｾｯﾄ設定
CON
BRES CM1608 #2           ; CTH0ｲﾈｰﾌﾞﾙﾘｾｯﾄ設定
LD CR2008                ; 運転開始時1ｽｷｬﾝON
BRES CM1608 #4           ; CTH0ｲﾈｰﾌﾞﾙﾘｾｯﾄ設定
CON
BRES CM1608 #5           ; CTH0ｲﾈｰﾌﾞﾙﾘｾｯﾄ設定
;-- CPU高速カウンタの動作
;-- 入力方式								: 外部入力(位相差(1逓倍))
LD CR2002                ; 常時ON
CTH.L #0 R010            ; ENCｶｳﾝﾄ  ﾛｰﾀﾘｴﾝｺｰﾀﾞ A相
;送りﾊﾟﾙｽ量
;送り量：***,**mm
;ﾛｰﾗｰ径：Φ20
;ｴﾝｺｰﾀﾞ1回転：400pls
;
;@DM4.L = DM4210.L + DM4222.L
;@DM6.L = DM4212.L + DM4224.L
;@DM8.L = DM4214.L + DM4226.L
;@DM10.L = DM4216.L + DM4228.L
;@DM12.L = DM4220.L
LD CR2002                ; 常時ON
NCJ #1000
;@DM4.L = DM4210.L + DM4222.L
;
LD CR2002                ; 常時ON
LDA.L DM4210             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
ADD.L DM4222             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
STA.L @DM4
;@DM6.L = DM4212.L + DM4224.L
;
LD CR2002                ; 常時ON
LDA.L DM4212             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
ADD.L DM4224             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
STA.L @DM6
;@DM8.L = DM4214.L + DM4226.L
;
LD CR2002                ; 常時ON
LDA.L DM4214             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
ADD.L DM4226             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
STA.L @DM8
;@DM10.L = DM4216.L + DM4228.L
;
LD CR2002                ; 常時ON
LDA.L DM4216             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
ADD.L DM4228             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
STA.L @DM10
;@DM12.L = DM4220.L
LD CR2002                ; 常時ON
MOV.L DM4220 @DM12       ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
LABEL #1000
;
LD CR2002                ; 常時ON
MPS
LDA.F +20
CON
MUL.F +3.14
CON
DIV.F +400
CON
STA.F @DM0               ; ｴﾝｺｰﾀﾞ1pls移動量
MRD
LDA.L @DM4
CON
FLOAT.L
CON
DIV.F @DM0               ; ｴﾝｺｰﾀﾞ1pls移動量
CON
INTG.L
CON
MUL.L -1
CON
STA.L FM100              ; 1ﾋﾟｯﾁ ENCｶｳﾝﾄ目標値(送り)
MRD
LDA.L @DM6
CON
FLOAT.L
CON
DIV.F @DM0               ; ｴﾝｺｰﾀﾞ1pls移動量
CON
INTG.L
CON
MUL.L -1
CON
STA.L FM150              ; 1行 ENCｶｳﾝﾄ目標値(送り)
MRD
LDA.L @DM8
CON
LDA.L DM4214             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
FLOAT.L
CON
DIV.F @DM0               ; ｴﾝｺｰﾀﾞ1pls移動量
CON
INTG.L
CON
STA.L FM200              ; 1ﾋﾟｯﾁ大 ENCｶｳﾝﾄ目標値(戻し)
MRD
LDA.L @DM10
CON
LDA.L DM4216             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
FLOAT.L
CON
DIV.F @DM0               ; ｴﾝｺｰﾀﾞ1pls移動量
CON
INTG.L
CON
STA.L FM250              ; 1ﾋﾟｯﾁ小 450mmENCｶｳﾝﾄ目標値(戻し)
MPP
LDA.L @DM12
CON
LDA.L DM4220             ; _機種別ﾃﾞｰﾀ　ﾃﾝﾎﾟﾗﾘ
CON
FLOAT.L
CON
DIV.F @DM0               ; ｴﾝｺｰﾀﾞ1pls移動量
CON
INTG.L
CON
MUL.L -1
CON
STA.L FM300              ; ﾛﾝｸﾞﾋﾟｯﾁENCｶｳﾝﾄ目標値(送り)
END
ENDH
