DEVICE:53
;MODULE:Sensor
;MODULE_TYPE:0
;OneSystem UserOpen-Module
;
;-----------------------------------------
;ModuleName	:	SENSOR
;ModuleType	:	User Open Module
;Function	:	SENSOR Monitor
;-----------------------------------------
;*1送信毎に送信ﾌｧｲﾙ削除
;Copylight(C) 2011 SEIKO EPSON Corp. All rights reserved.
;<h1/>ｼﾘﾝﾀﾞｰ ｾﾝｻｰ監視
LD R46100                ; _自動運転中　ﾓｰﾄﾞﾌﾗｸﾞ
OR R46101                ; _原点復帰中　ﾓｰﾄﾞﾌﾗｸﾞ
LD CR2003                ; 常時OFF
AND R46102               ; _ﾒﾝﾃﾅﾝｽ運転中　ﾓｰﾄﾞﾌﾗｸﾞ
ORL
ANB R46200               ; _安全ｶﾊﾞｰ1開中
ANB R39004               ; ｴﾗｰ中
ANB R59915               ; _運転ﾓｰﾄﾞ指定
MC
;TASK0
LD MR7215                ; 位置決めﾋﾟﾝ 上昇
LDB R4404                ; 位置決めﾋﾟﾝ 上昇端
LD R4404                 ; 位置決めﾋﾟﾝ 上昇端
AND R4405                ; 位置決めﾋﾟﾝ 下降端
ORL
ANL
TMR @0 #30               ; 位置決めﾋﾟﾝ 上昇監視
CON
AND @T0                  ; 位置決めﾋﾟﾝ 上昇監視
DW #4404 DM60009         ; Sensor ERROR No.
CON
SET MR4404               ; 位置決めﾋﾟﾝ 上昇端ｴﾗｰ
LDB MR7215               ; 位置決めﾋﾟﾝ 上昇
LDB R4405                ; 位置決めﾋﾟﾝ 下降端
LD R4404                 ; 位置決めﾋﾟﾝ 上昇端
AND R4405                ; 位置決めﾋﾟﾝ 下降端
ORL
ANL
TMR @1 #30               ; 位置決めﾋﾟﾝ 下降監視
CON
AND @T1                  ; 位置決めﾋﾟﾝ 下降監視
DW #4405 DM60009         ; Sensor ERROR No.
CON
SET MR4405               ; 位置決めﾋﾟﾝ 下降端ｴﾗｰ
;TASK1
LD MR7208                ; 転写ﾍｯﾄﾞ固定 解除
LDB R4406                ; 転写ﾍｯﾄﾞ固定 解除端
LD R4406                 ; 転写ﾍｯﾄﾞ固定 解除端
AND R4407                ; 転写ﾍｯﾄﾞ固定 固定端
ORL
ANL
TMR @10 #30              ; 転写ﾍｯﾄﾞ固定 解除監視
CON
AND @T10                 ; 転写ﾍｯﾄﾞ固定 解除監視
DW #4406 DM60009         ; Sensor ERROR No.
CON
SET MR4406               ; 転写ﾍｯﾄﾞ固定 解除端ｴﾗｰ
LDB MR7208               ; 転写ﾍｯﾄﾞ固定 解除
LDB R4407                ; 転写ﾍｯﾄﾞ固定 固定端
LD R4406                 ; 転写ﾍｯﾄﾞ固定 解除端
AND R4407                ; 転写ﾍｯﾄﾞ固定 固定端
ORL
ANL
TMR @11 #30              ; 転写ﾍｯﾄﾞ固定 固定監視
CON
AND @T11                 ; 転写ﾍｯﾄﾞ固定 固定監視
DW #4407 DM60009         ; Sensor ERROR No.
CON
SET MR4407               ; 転写ﾍｯﾄﾞ固定 固定端ｴﾗｰ
LD MR7302                ; ｼｬｯﾀｰ閉
ANB MR7303               ; ｼｬｯﾀｰ開
LDB R4108                ; ｼｬｯﾀｰ閉端
LD R4108                 ; ｼｬｯﾀｰ閉端
AND R4109                ; ｼｬｯﾀｰ開端
ORL
ANL
TMR @12 #30
CON
AND @T12
DW #4108 DM60009         ; Sensor ERROR No.
CON
SET MR4108               ; ｼｬｯﾀｰ閉端ｴﾗｰ
LDB MR7302               ; ｼｬｯﾀｰ閉
AND MR7303               ; ｼｬｯﾀｰ開
LDB R4109                ; ｼｬｯﾀｰ開端
LD R4108                 ; ｼｬｯﾀｰ閉端
AND R4109                ; ｼｬｯﾀｰ開端
ORL
ANL
TMR @13 #30
CON
AND @T13
DW #4109 DM60009         ; Sensor ERROR No.
CON
SET MR4109               ; ｼｬｯﾀｰ開端ｴﾗｰ
;TASK2
LD MR7213                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降
ANB MR7214               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇
LDB R4009                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降端
LD R4009                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降端
AND R4010                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇端
ORL
ANL
TMR @23 #30              ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降監視
CON
AND @T23                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降監視
DW #4009 DM60009         ; Sensor ERROR No.
CON
SET MR4009               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降端ｴﾗｰ
LD MR7214                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇
ANB MR7213               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降
LDB R4010                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇端
LD R4009                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 下降端
AND R4010                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇端
ORL
ANL
TMR @24 #30              ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇監視
CON
AND @T24                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇監視
DW #4010 DM60009         ; Sensor ERROR No.
CON
SET MR4010               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇端ｴﾗｰ
;TASK3
LD MR7202                ; ｽｸﾚﾊﾟｰ上下 下降
LDB R4001                ; ｽｸﾚﾊﾟｰ上下 下降端
LD R4001                 ; ｽｸﾚﾊﾟｰ上下 下降端
AND R4002                ; ｽｸﾚﾊﾟｰ上下 上昇端
ORL
ANL
TMR @30 #30              ; ｽｸﾚﾊﾟｰ上下 下降監視
CON
AND @T30                 ; ｽｸﾚﾊﾟｰ上下 下降監視
AND CR2003               ; 常時OFF
DW #4001 DM60009         ; Sensor ERROR No.
CON
SET MR4001               ; ｽｸﾚﾊﾟｰ上下 下降端ｴﾗｰ
LDB MR7202               ; ｽｸﾚﾊﾟｰ上下 下降
LDB R4002                ; ｽｸﾚﾊﾟｰ上下 上昇端
LD R4001                 ; ｽｸﾚﾊﾟｰ上下 下降端
AND R4002                ; ｽｸﾚﾊﾟｰ上下 上昇端
ORL
ANL
TMR @31 #30              ; ｽｸﾚﾊﾟｰ上下 上昇監視
CON
AND @T31                 ; ｽｸﾚﾊﾟｰ上下 上昇監視
DW #4002 DM60009         ; Sensor ERROR No.
CON
SET MR4002               ; ｽｸﾚﾊﾟｰ上下 上昇端ｴﾗｰ
LD MR7203                ; ｽｸﾚﾊﾟｰ待避上下 下降
LDB R4003                ; ｽｸﾚﾊﾟｰ待避上下 下降端
LD R4003                 ; ｽｸﾚﾊﾟｰ待避上下 下降端
AND R4004                ; ｽｸﾚﾊﾟｰ待避上下 上昇端
ORL
ANL
TMR @32 #30              ; ｽｸﾚﾊﾟｰ待避上下 下降監視
CON
AND @T32                 ; ｽｸﾚﾊﾟｰ待避上下 下降監視
DW #4003 DM60009         ; Sensor ERROR No.
CON
SET MR4003               ; ｽｸﾚﾊﾟｰ待避上下 下降端ｴﾗｰ
LDB MR7203               ; ｽｸﾚﾊﾟｰ待避上下 下降
LDB R4004                ; ｽｸﾚﾊﾟｰ待避上下 上昇端
LD R4003                 ; ｽｸﾚﾊﾟｰ待避上下 下降端
AND R4004                ; ｽｸﾚﾊﾟｰ待避上下 上昇端
ORL
ANL
TMR @33 #30              ; ｽｸﾚﾊﾟｰ待避上下 上昇監視
CON
AND @T33                 ; ｽｸﾚﾊﾟｰ待避上下 上昇監視
DW #4004 DM60009         ; Sensor ERROR No.
CON
SET MR4004               ; ｽｸﾚﾊﾟｰ待避上下 上昇端ｴﾗｰ
LD MR7209                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降
ANB MR7210               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇
LDB R4005                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降端
LD R4005                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降端
AND R4006                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇端
ORL
ANL
TMR @34 #30              ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降監視
CON
AND @T34                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降監視
DW #4005 DM60009         ; Sensor ERROR No.
CON
SET MR4005               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降端ｴﾗｰ
LD MR7210                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇
ANB MR7209               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降
LDB R4006                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇端
LD R4005                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 下降端
AND R4006                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇端
ORL
ANL
TMR @35 #30              ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇監視
CON
AND @T35                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇監視
DW #4006 DM60009         ; Sensor ERROR No.
CON
SET MR4006               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-1 上昇端ｴﾗｰ
LD MR7211                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降
ANB MR7212               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇
LDB R4007                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降端
LD R4007                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降端
AND R4008                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇端
ORL
ANL
TMR @36 #30              ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降監視
CON
AND @T36                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降監視
DW #4007 DM60009         ; Sensor ERROR No.
CON
SET MR4007               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降端ｴﾗｰ
LD MR7212                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇
ANB MR7211               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降
LDB R4008                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇端
LD R4007                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 下降端
AND R4008                ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇端
ORL
ANL
TMR @37 #30              ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇監視
CON
AND @T37                 ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇監視
DW #4008 DM60009         ; Sensor ERROR No.
CON
SET MR4008               ; ﾙﾐﾗｰｸﾗﾝﾌﾟ-2 上昇端ｴﾗｰ
;TASK4
LD MR7204                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 下降
ANB MR7205               ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 上昇
MPS
LDB R4200                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 下降端
LD R4200                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 下降端
AND R4201                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 上昇端
ORL
ANL
TMR @40 #30              ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 下降監視
CON
AND @T40                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 下降監視
DW #4200 DM60009         ; Sensor ERROR No.
CON
SET MR4200               ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 下降端ｴﾗｰ
MPP
LDB R4202                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 下降端
LD R4202                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 下降端
AND R4203                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 上昇端
ORL
ANL
TMR @42 #30              ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 下降監視
CON
AND @T42                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 下降監視
DW #4202 DM60009         ; Sensor ERROR No.
CON
SET MR4202               ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 下降端ｴﾗｰ
LD MR7205                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 上昇
ANB MR7204               ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 下降
MPS
LDB R4201                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 上昇端
LD R4200                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 下降端
AND R4201                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 上昇端
ORL
ANL
TMR @41 #30              ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 上昇監視
CON
AND @T41                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 上昇監視
DW #4201 DM60009         ; Sensor ERROR No.
CON
SET MR4201               ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 上昇端ｴﾗｰ
MPP
LDB R4203                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 上昇端
LD R4202                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 下降端
AND R4203                ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 上昇端
ORL
ANL
TMR @43 #30              ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 上昇監視
CON
AND @T43                 ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ- 上昇監視
DW #4203 DM60009         ; Sensor ERROR No.
CON
SET MR4203               ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-奥 上昇端ｴﾗｰ
LD MR7206                ; 転写S_ﾙﾐﾗｰ引張り 引張り
ANB MR7207               ; 転写S_ﾙﾐﾗｰ引張り 戻し
LDB R4204                ; 転写S_ﾙﾐﾗｰ引張り 引張り端
LD R4204                 ; 転写S_ﾙﾐﾗｰ引張り 引張り端
AND R4205                ; 転写S_ﾙﾐﾗｰ引張り 戻し端
ORL
ANL
TMR @44 #30              ; 転写S_ﾙﾐﾗｰ引張り 引張り監視
CON
AND @T44                 ; 転写S_ﾙﾐﾗｰ引張り 引張り監視
DW #4204 DM60009         ; Sensor ERROR No.
CON
SET MR4204               ; 転写S_ﾙﾐﾗｰ引張り 引張り端ｴﾗｰ
LD MR7207                ; 転写S_ﾙﾐﾗｰ引張り 戻し
ANB MR7206               ; 転写S_ﾙﾐﾗｰ引張り 引張り
LDB R4205                ; 転写S_ﾙﾐﾗｰ引張り 戻し端
LD R4204                 ; 転写S_ﾙﾐﾗｰ引張り 引張り端
AND R4205                ; 転写S_ﾙﾐﾗｰ引張り 戻し端
ORL
ANL
TMR @45 #30              ; 転写S_ﾙﾐﾗｰ引張り 戻し監視
CON
AND @T45                 ; 転写S_ﾙﾐﾗｰ引張り 戻し監視
DW #4205 DM60009         ; Sensor ERROR No.
CON
SET MR4205               ; 転写S_ﾙﾐﾗｰ引張り 戻し端ｴﾗｰ
MCR
;TASK0 Sensor ERROR
LD>= DM60009 #4404       ; Sensor ERROR No.
AND<= DM60009 #4405      ; Sensor ERROR No.
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #0 @DM0               ; TaskNo /ERROR_DISP
CON
DW #0 @DM1               ; ErrorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2                 ; SensorNo /ERROR_DISP
CON
SET @R100                ; ERROR
CON
SET @R000
;TASK1 Sensor ERROR
LD>= DM60009 #4406       ; Sensor ERROR No.
AND<= DM60009 #4407      ; Sensor ERROR No.
LD>= DM60009 #4108       ; Sensor ERROR No.
AND<= DM60009 #4109      ; Sensor ERROR No.
ORL
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #1 @DM0               ; TaskNo /ERROR_DISP
CON
DW #0 @DM1               ; ErrorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2                 ; SensorNo /ERROR_DISP
CON
SET @R100                ; ERROR
CON
SET @R000
;TASK2 Sensor ERROR
LD>= DM60009 #4012       ; Sensor ERROR No.
AND<= DM60009 #4014      ; Sensor ERROR No.
LD>= DM60009 #4009       ; Sensor ERROR No.
AND<= DM60009 #4010      ; Sensor ERROR No.
ORL
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #2 @DM0               ; TaskNo /ERROR_DISP
CON
DW #0 @DM1               ; ErrorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2                 ; SensorNo /ERROR_DISP
CON
SET @R100                ; ERROR
CON
SET @R000
;TASK3 Sensor ERROR
LD>= DM60009 #4001       ; Sensor ERROR No.
AND<= DM60009 #4008      ; Sensor ERROR No.
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #3 @DM0               ; TaskNo /ERROR_DISP
CON
DW #0 @DM1               ; ErrorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2                 ; SensorNo /ERROR_DISP
CON
SET @R100                ; ERROR
CON
SET @R000
;TASK4 Sensor ERROR
LD>= DM60009 #4200       ; Sensor ERROR No.
AND<= DM60009 #4205      ; Sensor ERROR No.
ANB R39004               ; ｴﾗｰ中
SET R39004               ; ｴﾗｰ中
CON
DW #4 @DM0               ; TaskNo /ERROR_DISP
CON
DW #0 @DM1               ; ErrorNo /ERROR_DISP
CON
DW $1000 @DM9            ; ReturnSW /ERROR_DISP
CON
LDA DM60009              ; Sensor ERROR No.
CON
STA @DM2                 ; SensorNo /ERROR_DISP
CON
SET @R100                ; ERROR
CON
SET @R000
;Task Error Reset/エラー解除
STG @R000
AND @R101                ; ERROR_End
RES @R101                ; ERROR_End
CON
RES R39004               ; ｴﾗｰ中
CON
ZRES MR4404 MR4407       ; 位置決めﾋﾟﾝ 上昇端ｴﾗｰ  転写ﾍｯﾄﾞ固定 固定端ｴﾗｰ
CON
ZRES MR4012 MR4014       ; ﾙﾐﾗｰ巻取りﾃﾝｼｮﾝ 上昇端ｴﾗｰ  ﾙﾐﾗｰ巻取りﾃﾝｼｮﾝ 最下降端ｴﾗｰ
CON
ZRES MR4001 MR4010       ; ｽｸﾚﾊﾟｰ上下 下降端ｴﾗｰ  ﾙﾐﾗｰｸﾗﾝﾌﾟ-3 上昇端ｴﾗｰ
CON
ZRES MR4200 MR4205       ; 転写S_ﾙﾐﾗｰｸﾗﾝﾌﾟ-前 下降端ｴﾗｰ  転写S_ﾙﾐﾗｰ引張り 戻し端ｴﾗｰ
CON
DW #0 DM60009            ; Sensor ERROR No.
CON
ENDS
;MyTask Error Process Substance/エラー処理実体
STG @R100                ; ERROR
ANB R39002               ; ERROR_DISP Busy
MPS
ZRES @R105 @R108         ; SW1  SW4
CON
DISN @DM9 @DM3 #4        ; ReturnSW /ERROR_DISP
MRD
BMOV @DM0 DM60000 #7     ; TaskNo /ERROR_DISP  TaskNo /ERROR_DISP
MPP
SET R39000               ; ERROR_DISP Start
CON
SET @R102                ; ERROR Busy
CON
JMP @R103
STG @R103
AND R39002               ; ERROR_DISP Busy
AND= DM60008 @DM1        ; ReturnNo /ERROR_DISP  ErrorNo /ERROR_DISP
JMP @R104
STG @R104
ANB R39002               ; ERROR_DISP Busy
RES @R102                ; ERROR Busy
CON
SET @R101                ; ERROR_End
CON
ENDS
END
ENDH
