DEVICE:53
;MODULE:温調
;MODULE_TYPE:0
;SCRIPT_TYPE:
LD R50000                ; 即停止
OR R50900                ; TRAP
ZRES @MR000 @MR2915
;温調マクロ
;プロトコルマクロ
;
LD CR2002                ; 常時ON
OUT R30700               ; 動作許可
;現在値読出し／ＵＴ０
;
LD R32000                ; 通信可能
ANB R35000               ; UT0現在値読出し通信完了ﾌﾗｸﾞ
ANB R31400               ; 受信読出要求（ﾏｸﾛ1）
ANB R30800               ; 受信照合（ﾏｸﾛ1）
DW #0 DM30002            ; Port2 送信ﾃﾞｰﾀ1
CON
DW #0 DM30003            ; Port2 送信ﾃﾞｰﾀ2
CON
SET R30100               ; ﾏｸﾛ開始1
LDP R31400               ; 受信読出要求（ﾏｸﾛ1）
AND R30800               ; 受信照合（ﾏｸﾛ1）
MOV.D DM30004 DM38000    ; Port2 送信ﾃﾞｰﾀ3  UT0/CH1現在値（読出し）
MOV.D DM38000 DM568      ; UT0/CH1現在値（読出し）  L ﾋｰﾀ温度
MOV.D DM30006 DM38100    ; Port2 送信ﾃﾞｰﾀ5  UT0/CH2現在値（読出し）
MOV.D DM38100 DM588      ; UT0/CH2現在値（読出し）  R ﾋｰﾀ温度
RES R30100               ; ﾏｸﾛ開始1
SET R35000               ; UT0現在値読出し通信完了ﾌﾗｸﾞ
LD R30100                ; ﾏｸﾛ開始1
AND R32008               ; 受信不一致Err
SET R30701               ; Errｸﾘｱ要求
LDP R32001               ; Errｸﾘｱ完了
RES R30701               ; Errｸﾘｱ要求
CON
RES R30100               ; ﾏｸﾛ開始1
;ステータス読出し／ＵＴ０
;
LD R32000                ; 通信可能
AND R35000               ; UT0現在値読出し通信完了ﾌﾗｸﾞ
ANB R35004               ; UT0ｽﾃｰﾀｽ読出し通信完了ﾌﾗｸﾞ
ANB R31401               ; 受信読出要求（ﾏｸﾛ2）
ANB R30801               ; 受信照合（ﾏｸﾛ2）
DW #0 DM30008            ; Port2 送信ﾃﾞｰﾀ2
CON
DW #0 DM3009
CON
SET R30101               ; Port2 送信完了
LDP R31401               ; 受信読出要求（ﾏｸﾛ2）
AND R30801               ; 受信照合（ﾏｸﾛ2）
MOV.D DM30010 DM38012    ; Port2 送信ﾃﾞｰﾀ9
MOV.D DM30012 DM38112    ; Port2 送信ﾃﾞｰﾀ11
SET R35004               ; UT0ｽﾃｰﾀｽ読出し通信完了ﾌﾗｸﾞ
RES R30101               ; Port2 送信完了
LD R30101                ; Port2 送信完了
AND R32001               ; Errｸﾘｱ完了
SET R30701               ; Errｸﾘｱ要求
LDP R32001               ; Errｸﾘｱ完了
RES R30701               ; Errｸﾘｱ要求
CON
RES R30101               ; Port2 送信完了
LD R35000                ; UT0現在値読出し通信完了ﾌﾗｸﾞ
AND R35004               ; UT0ｽﾃｰﾀｽ読出し通信完了ﾌﾗｸﾞ
ZRES R35000 R35015       ; UT0現在値読出し通信完了ﾌﾗｸﾞ
;<h1/>画面グラフ表示 / Graph display
;ﾄﾘｶﾞ管理 / Trig check
LDP R51806               ; ﾋｰﾀ連動sw ﾊﾟﾈﾙ
ALT R51807               ; ﾋｰﾀ連動取込
LDP R51802               ; 取込開始sw ﾊﾟﾈﾙ
LD R51807                ; ﾋｰﾀ連動取込
LDP R3208                ; (L)Heater ACTUATE
ORP R3212                ; (R)Heater ACTUATE
ANL
ORL
ANB R51803               ; 取込中
MPS
RES R51807               ; ﾋｰﾀ連動取込
CON
DW #0 DM5650
CON
SET R51803               ; 取込中
MPP
FMOV #0 DM6000 #640
LDP R51804               ; 取込終了sw ﾊﾟﾈﾙ
OR>= DM5650 #320
RES R51800               ; ｻﾝﾌﾟﾘﾝｸﾞﾄﾘｶﾞ
CON
RES R51803               ; 取込中
;取り込みメイン / 
LD R51803                ; 取込中
ANP CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
MOV DM5650 Z7
MOV DM38000 DM6000:Z7    ; UT0/CH1現在値（読出し）
MOV DM38100 DM6320:Z7    ; UT0/CH2現在値（読出し）
INC DM5650
LD R51803                ; 取込中
ANP CR2006               ; 1sｸﾛｯｸﾊﾟﾙｽ
ALT R51800               ; ｻﾝﾌﾟﾘﾝｸﾞﾄﾘｶﾞ
;表示目盛 / Display scale
;DM5722 = (DM5702-DM5700)/10     'X軸ピッチ計算
;DM5704 =  DM5700 + DM5722       '各目盛計算
;DM5706 =  DM5704 + DM5722       
;DM5708 =  DM5706 + DM5722       
;DM5710 =  DM5708 + DM5722
;DM5712 =  DM5710 + DM5722
;DM5714 =  DM5712 + DM5722
;DM5716 =  DM5714 + DM5722
;DM5718 =  DM5716 + DM5722
;DM5720 =  DM5718 + DM5722
;       
;DM6722 = (DM6702-DM6700)/5      'Y軸ピッチ計算
;DM6704 =  DM6700 + DM6722       '各目盛計算
;DM6706 =  DM6704 + DM6722       
;DM6708 =  DM6706 + DM6722       
;DM6710 =  DM6708 + DM6722       
LD= DM3000 #5            ; 表示画面
OR= DM3000 #4            ; 表示画面
NCJ #1000
;DM5722 = (DM5702-DM5700)/10     'X軸ピッチ計算
;
LD CR2002                ; 常時ON
LDA DM5700
CON
EXT
CON
STA.L @VM0
CON
LDA DM5702
CON
EXT
CON
SUB.L @VM0
CON
EXT.L
CON
DIV.L +10
CON
STA DM5722
;DM5704 =  DM5700 + DM5722       '各目盛計算
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM2
CON
LDA DM5700
CON
EXT
CON
ADD.L @VM2
CON
STA DM5704
;DM5706 =  DM5704 + DM5722       
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM4
CON
LDA DM5704
CON
EXT
CON
ADD.L @VM4
CON
STA DM5706
;DM5708 =  DM5706 + DM5722       
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM6
CON
LDA DM5706
CON
EXT
CON
ADD.L @VM6
CON
STA DM5708
;DM5710 =  DM5708 + DM5722
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM8
CON
LDA DM5708
CON
EXT
CON
ADD.L @VM8
CON
STA DM5710
;DM5712 =  DM5710 + DM5722
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM10
CON
LDA DM5710
CON
EXT
CON
ADD.L @VM10
CON
STA DM5712
;DM5714 =  DM5712 + DM5722
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM12
CON
LDA DM5712
CON
EXT
CON
ADD.L @VM12
CON
STA DM5714
;DM5716 =  DM5714 + DM5722
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM14
CON
LDA DM5714
CON
EXT
CON
ADD.L @VM14
CON
STA DM5716
;DM5718 =  DM5716 + DM5722
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM16
CON
LDA DM5716
CON
EXT
CON
ADD.L @VM16
CON
STA DM5718
;DM5720 =  DM5718 + DM5722
;
LD CR2002                ; 常時ON
LDA DM5722
CON
EXT
CON
STA.L @VM18
CON
LDA DM5718
CON
EXT
CON
ADD.L @VM18
CON
STA DM5720
;DM6722 = (DM6702-DM6700)/5      'Y軸ピッチ計算
;
LD CR2002                ; 常時ON
LDA DM6700
CON
EXT
CON
STA.L @VM20
CON
LDA DM6702
CON
EXT
CON
SUB.L @VM20
CON
EXT.L
CON
DIV.L +5
CON
STA DM6722
;DM6704 =  DM6700 + DM6722       '各目盛計算
;
LD CR2002                ; 常時ON
LDA DM6722
CON
EXT
CON
STA.L @VM22
CON
LDA DM6700
CON
EXT
CON
ADD.L @VM22
CON
STA DM6704
;DM6706 =  DM6704 + DM6722       
;
LD CR2002                ; 常時ON
LDA DM6722
CON
EXT
CON
STA.L @VM24
CON
LDA DM6704
CON
EXT
CON
ADD.L @VM24
CON
STA DM6706
;DM6708 =  DM6706 + DM6722       
;
LD CR2002                ; 常時ON
LDA DM6722
CON
EXT
CON
STA.L @VM26
CON
LDA DM6706
CON
EXT
CON
ADD.L @VM26
CON
STA DM6708
;DM6710 =  DM6708 + DM6722       
LD CR2002                ; 常時ON
LDA DM6722
CON
EXT
CON
STA.L @VM28
CON
LDA DM6708
CON
EXT
CON
ADD.L @VM28
CON
STA DM6710
LABEL #1000
;
;X軸初期化 / X Axis initialize
;FOR DM5652=1 TO 320 STEP 1
;  Z6 = DM5652
;  BMOV(DM5652,DM5000:Z6,1)
;NEXT 
;BMOV(DM5000,DM5320,320)
LDP T200                 ; 遅延ﾀｲﾏ−200　1s
NCJ #1001
;FOR DM5652=1 TO 320 STEP 1
;
LD CR2002                ; 常時ON
MOV #1 DM5652
LABEL #2000
LD> DM5652 #320
CJ #2001
;  Z6 = DM5652
;
LD CR2002                ; 常時ON
LDA DM5652
CON
EXT
CON
STA.L Z6
;  BMOV(DM5652,DM5000:Z6,1)
;
LD CR2002                ; 常時ON
BMOV DM5652 DM5000:Z6 #1
;NEXT 
;
LD CR2002                ; 常時ON
INC DM5652
LDB CR2009
CJ #2000
LABEL #2001
;BMOV(DM5000,DM5320,320)
LD CR2002                ; 常時ON
BMOV DM5000 DM5320 #320
LABEL #1001
;
;温調管理 / 
LD CR2002                ; 常時ON
ANB MR915
AND @MR010               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_L側
MPS
LDP CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
AND> DM882 #20
ANL
@INC.D DM890
MRD
LDP CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
AND @MR012
ANL
@INC.D DM892
MRD
LDP CR2005               ; 100msｸﾛｯｸﾊﾟﾙｽ
AND @MR013
ANL
@INC.D DM894
MRD
LDA DM38000              ; UT0/CH1現在値（読出し）
CON
SUB DM880
CON
STA DM882
MRD
AND<=.D #280 DM38000     ; UT0/CH1現在値（読出し）
SET @MR012
CON
@MOV.D DM890 DM902
MRD
ANP R1000                ; L_HEATER ON
MOV.D DM38000 DM924      ; UT0/CH1現在値（読出し）
MRD
AND R1000                ; L_HEATER ON
MPS
@MOV.D DM892 DM904
MPP
AND>=.D DM38100 DM924    ; UT0/CH2現在値（読出し）
@MOV.D DM38000 DM924     ; UT0/CH1現在値（読出し）
MRD
ANB R1000                ; L_HEATER ON
MPS
LD MR6300                ; L_冷却ｴｱﾌﾞﾛｰ
AND>=.D #290 DM38000     ; UT0/CH1現在値（読出し）
ANL
SET @MR013
CON
@MOV.D DM892 DM906
MPP
ANP MR6300               ; L_冷却ｴｱﾌﾞﾛｰ
MOV.D DM38000 DM924      ; UT0/CH1現在値（読出し）
MPP
ANF MR6300               ; L_冷却ｴｱﾌﾞﾛｰ
MOV.D DM894 DM908
MOV.D DM38000 DM928      ; UT0/CH1現在値（読出し）
LD CR2002                ; 常時ON
AND MR2003               ; L_HEATER ACTUATE
SET @MR010               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_L側
@MOV.D DM38000 DM880     ; UT0/CH1現在値（読出し）
LDP @MR010               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_L側
ANB MR915
RES @MR012
CON
RES @MR013
CON
DW.D #0 DM902
CON
DW.D #0 DM924
CON
DW.D #0 DM904
CON
DW.D #0 DM906
CON
DW.D #0 DM908
CON
DW.D #0 DM918
LD @MR010                ; 温度ﾌﾟﾛﾌｧｲﾙ取得_L側
ANP MR1300               ; L溶着RBｽﾀｰﾄ
DW.D #0 DM890
CON
DW.D #0 DM892
CON
DW.D #0 DM894
CON
RES @MR010               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_L側
LD CR2002                ; 常時ON
ANB MR915
AND @MR011               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_R側
MPS
LD CR2005                ; 100msｸﾛｯｸﾊﾟﾙｽ
AND> DM872 #20
ANL
@INC.D DM896
MRD
LD CR2005                ; 100msｸﾛｯｸﾊﾟﾙｽ
AND @MR014
ANL
@INC.D DM898
MRD
LD CR2005                ; 100msｸﾛｯｸﾊﾟﾙｽ
AND @MR015
ANL
@INC.D DM900
MRD
LDA DM38100              ; UT0/CH2現在値（読出し）
CON
SUB DM870
CON
STA DM872
MRD
AND<=.D #280 DM38100     ; UT0/CH2現在値（読出し）
SET @MR014
CON
@MOV.D DM896 DM912
MRD
ANP R1005                ; R_HEATER ON
MOV.D DM38100 DM934      ; UT0/CH2現在値（読出し）
MRD
AND R1005                ; R_HEATER ON
MPS
@MOV.D DM898 DM914
MPP
AND>=.D DM38100 DM934    ; UT0/CH2現在値（読出し）
@MOV.D DM38100 DM934     ; UT0/CH2現在値（読出し）
MRD
ANB R1005                ; R_HEATER ON
MPS
LD MR6500                ; R_冷却ｴｱﾌﾞﾛｰ
AND>=.D #290 DM38100     ; UT0/CH2現在値（読出し）
ANL
SET @MR015
CON
@MOV.D DM898 DM916
MPP
ANP MR6500               ; R_冷却ｴｱﾌﾞﾛｰ
MOV.D DM38100 DM934      ; UT0/CH2現在値（読出し）
MPP
ANF MR6500               ; R_冷却ｴｱﾌﾞﾛｰ
MOV.D DM900 DM918
MOV.D DM38100 DM938      ; UT0/CH2現在値（読出し）
LD CR2002                ; 常時ON
AND MR2004               ; R_HEATER ACTUATE
SET @MR011               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_R側
@MOV.D DM38100 DM870     ; UT0/CH2現在値（読出し）
LDP @MR011               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_R側
ANB MR915
RES @MR014
CON
RES @MR015
CON
DW.D #0 DM912
CON
DW.D #0 DM934
CON
DW.D #0 DM914
CON
DW.D #0 DM916
CON
DW.D #0 DM918
CON
DW.D #0 DM938
LD @MR011                ; 温度ﾌﾟﾛﾌｧｲﾙ取得_R側
ANP MR1400               ; R溶着RBｽﾀｰﾄ
DW.D #0 DM896
CON
DW.D #0 DM898
CON
DW.D #0 DM900
CON
RES @MR011               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_R側
LD @MR010                ; 温度ﾌﾟﾛﾌｧｲﾙ取得_L側
LOGE #0
LDB @MR010               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_L側
LOGD #0
LD @MR011                ; 温度ﾌﾟﾛﾌｧｲﾙ取得_R側
LOGE #1
LDB @MR011               ; 温度ﾌﾟﾛﾌｧｲﾙ取得_R側
LOGD #1
LD R53201                ; L側溶着ｻｲｸﾙ動作中
AND CR2004               ; 10msｸﾛｯｸﾊﾟﾙｽ
MEP
OUT MR1800               ; L側温度ﾌﾟﾛﾌｧｲﾙ取得ﾄﾘｶﾞ
LD R53211                ; R側溶着ｻｲｸﾙ動作中
AND CR2004               ; 10msｸﾛｯｸﾊﾟﾙｽ
MEP
OUT MR1801               ; L側温度ﾌﾟﾛﾌｧｲﾙ取得ﾄﾘｶﾞ
END
ENDH
